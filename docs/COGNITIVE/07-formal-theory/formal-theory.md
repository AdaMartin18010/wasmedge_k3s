# 07. å½¢å¼åŒ–ç†è®ºï¼šç»“æ„åŒæ„ä¸å…³ç³»ç­‰ä»·

## ğŸ“‘ ç›®å½•

- [07.1 æ–‡æ¡£å®šä½](#071-æ–‡æ¡£å®šä½)
- [07.1.1 å½¢å¼åŒ–åŸºç¡€ç†è®º](#0711-å½¢å¼åŒ–åŸºç¡€ç†è®º)
  - [å½¢å¼ç³»ç»Ÿå®šä¹‰](#å½¢å¼ç³»ç»Ÿå®šä¹‰)
  - [æ¨¡å‹è®ºåŸºç¡€](#æ¨¡å‹è®ºåŸºç¡€)
  - [è¯æ˜è®ºåŸºç¡€](#è¯æ˜è®ºåŸºç¡€)
  - [é›†åˆè®ºåŸºç¡€](#é›†åˆè®ºåŸºç¡€)
  - [ç±»å‹è®ºåŸºç¡€](#ç±»å‹è®ºåŸºç¡€)
- [07.2 ç»“æ„åŒæ„æ€§](#072-ç»“æ„åŒæ„æ€§)
  - [07.2.1 å®¹å™¨è¿è¡Œæ—¶åŒæ„](#0721-å®¹å™¨è¿è¡Œæ—¶åŒæ„)
  - [07.2.2 ç¼–æ’ç³»ç»ŸåŒæ„](#0722-ç¼–æ’ç³»ç»ŸåŒæ„)
  - [07.2.3 å­˜å‚¨ç³»ç»ŸåŒæ„](#0723-å­˜å‚¨ç³»ç»ŸåŒæ„)
  - [07.2.4 ç½‘ç»œç³»ç»ŸåŒæ„](#0724-ç½‘ç»œç³»ç»ŸåŒæ„)
- [07.3 å…³ç³»ç­‰ä»·æ€§](#073-å…³ç³»ç­‰ä»·æ€§)
  - [07.3.1 è¿è¡Œæ—¶æ¥å£ç­‰ä»·](#0731-è¿è¡Œæ—¶æ¥å£ç­‰ä»·)
  - [07.3.2 API æ¥å£ç­‰ä»·](#0732-api-æ¥å£ç­‰ä»·)
  - [07.3.3 åè®®ç­‰ä»·](#0733-åè®®ç­‰ä»·)
  - [07.3.4 è§„èŒƒç­‰ä»·](#0734-è§„èŒƒç­‰ä»·)
- [07.4 åˆ†å¸ƒå¼ç³»ç»Ÿç†è®º](#074-åˆ†å¸ƒå¼ç³»ç»Ÿç†è®º)
  - [07.4.1 CAP å®šç†åº”ç”¨](#0741-cap-å®šç†åº”ç”¨)
  - [07.4.2 ä¸€è‡´æ€§æ¨¡å‹](#0742-ä¸€è‡´æ€§æ¨¡å‹)
  - [07.4.3 å¯ç”¨æ€§æ¨¡å‹](#0743-å¯ç”¨æ€§æ¨¡å‹)
  - [07.4.4 åˆ†åŒºå®¹å¿æ€§](#0744-åˆ†åŒºå®¹å¿æ€§)
- [07.5 åŠŸèƒ½èšåˆç†è®º](#075-åŠŸèƒ½èšåˆç†è®º)
  - [07.5.1 åŠŸèƒ½ç»„åˆ](#0751-åŠŸèƒ½ç»„åˆ)
  - [07.5.2 æ¥å£æŠ½è±¡](#0752-æ¥å£æŠ½è±¡)
  - [07.5.3 æ’ä»¶æœºåˆ¶](#0753-æ’ä»¶æœºåˆ¶)
  - [07.5.4 æ¨¡å—åŒ–è®¾è®¡](#0754-æ¨¡å—åŒ–è®¾è®¡)
- [07.6 ç½‘ç»œæ‹“æ‰‘ç†è®º](#076-ç½‘ç»œæ‹“æ‰‘ç†è®º)
  - [07.6.1 æ‹“æ‰‘ç»“æ„](#0761-æ‹“æ‰‘ç»“æ„)
  - [07.6.2 è·¯ç”±åè®®](#0762-è·¯ç”±åè®®)
  - [07.6.3 è´Ÿè½½å‡è¡¡](#0763-è´Ÿè½½å‡è¡¡)
  - [07.6.4 æœåŠ¡å‘ç°](#0764-æœåŠ¡å‘ç°)
- [07.7 å½¢å¼åŒ–æ¨¡å‹](#077-å½¢å¼åŒ–æ¨¡å‹)
  - [07.7.1 çŠ¶æ€æœºæ¨¡å‹](#0771-çŠ¶æ€æœºæ¨¡å‹)
  - [07.7.2 äº‹ä»¶é©±åŠ¨æ¨¡å‹](#0772-äº‹ä»¶é©±åŠ¨æ¨¡å‹)
  - [07.7.3 æ§åˆ¶ç†è®ºæ¨¡å‹](#0773-æ§åˆ¶ç†è®ºæ¨¡å‹)
  - [07.7.4 å›¾è®ºæ¨¡å‹](#0774-å›¾è®ºæ¨¡å‹)
- [07.8 è™šæ‹ŸåŒ–å±‚æ¬¡çš„å½¢å¼åŒ–ç†è®º](#078-è™šæ‹ŸåŒ–å±‚æ¬¡çš„å½¢å¼åŒ–ç†è®º)
  - [07.8.1 Popek-Goldberg è™šæ‹ŸåŒ–å®šç†](#0781-popek-goldberg-è™šæ‹ŸåŒ–å®šç†)
  - [07.8.2 è™šæ‹ŸåŒ–ï¼ˆå…¨è™šæ‹ŸåŒ–ï¼‰å½¢å¼åŒ–æ¨¡å‹](#0782-è™šæ‹ŸåŒ–å…¨è™šæ‹ŸåŒ–å½¢å¼åŒ–æ¨¡å‹)
  - [07.8.3 åŠè™šæ‹ŸåŒ–å½¢å¼åŒ–æ¨¡å‹](#0783-åŠè™šæ‹ŸåŒ–å½¢å¼åŒ–æ¨¡å‹)
  - [07.8.4 å®¹å™¨åŒ–å½¢å¼åŒ–æ¨¡å‹](#0784-å®¹å™¨åŒ–å½¢å¼åŒ–æ¨¡å‹)
  - [07.8.5 æ²™ç›’åŒ–å½¢å¼åŒ–æ¨¡å‹](#0785-æ²™ç›’åŒ–å½¢å¼åŒ–æ¨¡å‹)
  - [07.8.6 å››å±‚æ¬¡å½¢å¼åŒ–å¯¹æ¯”](#0786-å››å±‚æ¬¡å½¢å¼åŒ–å¯¹æ¯”)
- [07.9 åŒæ„ç­‰ä»·æ˜ å°„è¡¨](#079-åŒæ„ç­‰ä»·æ˜ å°„è¡¨)
- [07.10 å‚è€ƒ](#0710-å‚è€ƒ)

---

## 07.1 æ–‡æ¡£å®šä½

æœ¬æ–‡æ¡£ä»å½¢å¼åŒ–ç†è®ºï¼ˆFormal Theoryï¼‰è§’åº¦æ¢³ç†äº‘åŸç”Ÿå®¹å™¨æŠ€æœ¯æ ˆçš„ç»“æ„åŒæ„æ€§ã€å…³ç³»ç­‰
ä»·æ€§ã€åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºã€åŠŸèƒ½èšåˆå’Œç½‘ç»œæ‹“æ‰‘æ”¯æŒï¼Œä½œä¸ºæŠ€æœ¯æœ¬è´¨çš„ç†è®ºå‚è€ƒã€‚

æ ¹æ® Wikipediaï¼Œå½¢å¼åŒ–ç†è®ºï¼ˆFormal Theoryï¼‰æ˜¯æŒ‡ä½¿ç”¨å½¢å¼ç³»ç»Ÿï¼ˆFormal Systemï¼‰æ¥è¡¨
è¾¾å’Œæ¨å¯¼æ•°å­¦æˆ–é€»è¾‘å‘½é¢˜çš„ç†è®ºã€‚å½¢å¼ç³»ç»Ÿç”±ç¬¦å·ã€è¯­æ³•è§„åˆ™å’Œæ¨ç†è§„åˆ™ç»„æˆï¼Œç”¨äºä¸¥æ ¼å®š
ä¹‰å’ŒéªŒè¯æ•°å­¦ç»“æ„ã€‚

**Wikipedia å®šä¹‰å‚è€ƒ**ï¼ˆas of 2025-11-02ï¼‰ï¼š

> "A formal theory is a set of sentences in a formal language. A formal system
> (also called a logical calculus) is a formal theory together with a formal
> grammar that consists of a recursive definition of the well-formed formulas of
> the theory."

## 07.1.1 å½¢å¼åŒ–åŸºç¡€ç†è®º

### å½¢å¼ç³»ç»Ÿå®šä¹‰

æ ¹æ® Wikipediaï¼Œå½¢å¼ç³»ç»Ÿï¼ˆFormal Systemï¼‰ç”±ä»¥ä¸‹éƒ¨åˆ†ç»„æˆï¼š

**å½¢å¼ç³»ç»Ÿç»„æˆ**ï¼š

$$\mathcal{F} = (L, A, R)$$

å…¶ä¸­ï¼š

- $L$ = å½¢å¼è¯­è¨€ï¼ˆFormal Languageï¼‰ï¼šç¬¦å·é›†åˆå’Œè¯­æ³•è§„åˆ™
- $A$ = å…¬ç†é›†åˆï¼ˆAxiomsï¼‰ï¼šä½œä¸ºåŸºç¡€çš„è¯­å¥
- $R$ = æ¨ç†è§„åˆ™é›†åˆï¼ˆInference Rulesï¼‰ï¼šæ¨å¯¼è§„åˆ™

**å½¢å¼è¯­è¨€å®šä¹‰**ï¼š

è®¾å½¢å¼è¯­è¨€ $L = (\Sigma, \mathcal{G})$ï¼Œå…¶ä¸­ï¼š

- $\Sigma$ = ç¬¦å·é›†åˆï¼ˆAlphabetï¼‰ï¼šæœ‰é™çš„ç¬¦å·é›†åˆ
- $\mathcal{G}$ = è¯­æ³•è§„åˆ™ï¼ˆGrammarï¼‰ï¼šå®šä¹‰åˆæ³•å…¬å¼ï¼ˆWell-formed Formulaï¼‰çš„è§„åˆ™

**å…¬ç†ç³»ç»Ÿå®šä¹‰**ï¼š

å…¬ç†ç³»ç»Ÿ $A$ æ˜¯ä¸€ç»„è¢«è§†ä¸ºè‡ªæ˜ï¼ˆSelf-evidentï¼‰çš„è¯­å¥ï¼Œä¸éœ€è¦è¯æ˜ã€‚

**æ¨ç†è§„åˆ™å®šä¹‰**ï¼š

æ¨ç†è§„åˆ™ $R$ æ˜¯ä»å·²æœ‰è¯­å¥æ¨å¯¼æ–°è¯­å¥çš„è§„åˆ™ï¼Œé€šå¸¸è¡¨ç¤ºä¸ºï¼š

$$\frac{P_1, P_2, \ldots, P_n}{Q}$$

è¡¨ç¤ºä»å‰æ $P_1, P_2, \ldots, P_n$ å¯ä»¥æ¨å¯¼å‡ºç»“è®º $Q$ã€‚

### æ¨¡å‹è®ºåŸºç¡€

æ ¹æ® Wikipediaï¼Œæ¨¡å‹è®ºï¼ˆModel Theoryï¼‰ç ”ç©¶æ•°å­¦ç»“æ„å¦‚ä½•æ»¡è¶³ç‰¹å®šå…¬ç†ç³»ç»Ÿã€‚

**æ¨¡å‹å®šä¹‰**ï¼š

è®¾ $\mathcal{T}$ æ˜¯ä¸€ä¸ªç†è®ºï¼ˆTheoryï¼‰ï¼Œ$\mathcal{M}$ æ˜¯ä¸€ä¸ªç»“æ„ï¼ˆStructureï¼‰ï¼Œå¦‚
æœ $\mathcal{M}$ æ»¡è¶³ $\mathcal{T}$ ä¸­çš„æ‰€æœ‰è¯­å¥ï¼Œåˆ™ç§° $\mathcal{M}$ æ˜¯
$\mathcal{T}$ çš„ä¸€ä¸ªæ¨¡å‹ï¼ˆModelï¼‰ï¼Œè®°ä¸º $\mathcal{M} \models \mathcal{T}$ã€‚

**å®¹å™¨æŠ€æœ¯æ¨¡å‹**ï¼š

- **OCI è§„èŒƒæ¨¡
  å‹**ï¼š$\mathcal{M}_{\text{OCI}} \models \mathcal{T}_{\text{OCI}}$ï¼Œè¡¨ç¤ºç»“æ„æ»¡
  è¶³ OCI è§„èŒƒ
- **CRI è§„èŒƒæ¨¡
  å‹**ï¼š$\mathcal{M}_{\text{CRI}} \models \mathcal{T}_{\text{CRI}}$ï¼Œè¡¨ç¤ºç»“æ„æ»¡
  è¶³ CRI è§„èŒƒ
- **CNI è§„èŒƒæ¨¡
  å‹**ï¼š$\mathcal{M}_{\text{CNI}} \models \mathcal{T}_{\text{CNI}}$ï¼Œè¡¨ç¤ºç»“æ„æ»¡
  è¶³ CNI è§„èŒƒ

### è¯æ˜è®ºåŸºç¡€

æ ¹æ® Wikipediaï¼Œè¯æ˜è®ºï¼ˆProof Theoryï¼‰åˆ†ææ•°å­¦è¯æ˜çš„ç»“æ„å’Œæ€§è´¨ã€‚

**è¯æ˜å®šä¹‰**ï¼š

è®¾ $\mathcal{T}$ æ˜¯ä¸€ä¸ªç†è®ºï¼Œè¯­å¥ $\phi$ åœ¨ $\mathcal{T}$ ä¸­å¯è¯æ˜ï¼ˆProvableï¼‰ï¼Œ
è®°ä¸º $\mathcal{T} \vdash \phi$ï¼Œå½“ä¸”ä»…å½“å­˜åœ¨ä¸€ä¸ªä»å…¬ç†åˆ° $\phi$ çš„æœ‰é™æ¨å¯¼åºåˆ—ã€‚

**å®Œå¤‡æ€§å®šç†**ï¼š

æ ¹æ® GÃ¶del å®Œå¤‡æ€§å®šç†ï¼ˆGÃ¶del's Completeness Theoremï¼‰ï¼Œå¯¹äºä¸€é˜¶é€»è¾‘ï¼š

$$\mathcal{T} \models \phi \quad \text{å½“ä¸”ä»…å½“} \quad \mathcal{T} \vdash \phi$$

å³ï¼šè¯­ä¹‰å¯æ»¡è¶³ï¼ˆSatisfiableï¼‰ç­‰ä»·äºè¯­æ³•å¯è¯æ˜ï¼ˆProvableï¼‰ã€‚

**ä¸€è‡´æ€§å®šä¹‰**ï¼š

ç†è®º $\mathcal{T}$ æ˜¯ä¸€è‡´çš„ï¼ˆConsistentï¼‰ï¼Œå½“ä¸”ä»…å½“ä¸å­˜åœ¨è¯­å¥ $\phi$ ä½¿å¾—
$\mathcal{T} \vdash \phi$ å’Œ $\mathcal{T} \vdash \neg \phi$ åŒæ—¶æˆç«‹ã€‚

**GÃ¶del ä¸å®Œå¤‡æ€§å®šç†**ï¼š

æ ¹æ® Wikipediaï¼ŒGÃ¶del ç¬¬ä¸€ä¸å®Œå¤‡æ€§å®šç†ï¼ˆGÃ¶del's First Incompleteness Theoremï¼‰æŒ‡
å‡ºï¼šä»»ä½•è¶³å¤Ÿå¼ºçš„é€’å½’å…¬ç†ç³»ç»Ÿï¼Œå¦‚æœæ˜¯ä¸€è‡´çš„ï¼Œåˆ™å¿…ç„¶æ˜¯ä¸å®Œå¤‡çš„ã€‚å³å­˜åœ¨æ—¢ä¸èƒ½è¢«è¯æ˜
ä¹Ÿä¸èƒ½è¢«å¦è¯çš„è¯­å¥ã€‚

**å®¹å™¨æŠ€æœ¯ä¸€è‡´æ€§**ï¼š

- **OCI è§„èŒƒä¸€è‡´æ€§**ï¼š$\mathcal{T}_{\text{OCI}}$ æ˜¯ä¸€è‡´çš„ï¼Œä¸å­˜åœ¨çŸ›ç›¾çš„è§„èŒƒå®šä¹‰
- **CRI è§„èŒƒä¸€è‡´æ€§**ï¼š$\mathcal{T}_{\text{CRI}}$ æ˜¯ä¸€è‡´çš„ï¼Œæ‰€æœ‰å®ç°éƒ½éµå¾ªç›¸åŒçš„
  è¯­ä¹‰
- **Kubernetes API ä¸€è‡´æ€§**ï¼š$\mathcal{T}_{\text{K8s}}$ æ˜¯ä¸€è‡´çš„ï¼ŒAPI å®šä¹‰æ— çŸ›ç›¾

### é›†åˆè®ºåŸºç¡€

æ ¹æ® Wikipediaï¼Œé›†åˆè®ºï¼ˆSet Theoryï¼‰æ˜¯ç ”ç©¶é›†åˆçš„æ•°å­¦ç†è®ºï¼Œæ˜¯æ•°å­¦çš„åŸºç¡€ç†è®ºä¹‹ä¸€ã€‚

**ZFC å…¬ç†ç³»ç»Ÿ**ï¼ˆZermelo-Fraenkel Set Theory with Choiceï¼‰ï¼š

æ ¹æ® Wikipediaï¼ŒZFC æ˜¯é›†åˆè®ºçš„æ ‡å‡†å…¬ç†ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š

1. **å¤–å»¶å…¬ç†ï¼ˆAxiom of Extensionalityï¼‰**ï¼šä¸¤ä¸ªé›†åˆç›¸ç­‰å½“ä¸”ä»…å½“å®ƒä»¬åŒ…å«ç›¸åŒçš„å…ƒ
   ç´ 
2. **ç©ºé›†å…¬ç†ï¼ˆAxiom of Empty Setï¼‰**ï¼šå­˜åœ¨ç©ºé›† $\emptyset$
3. **é…å¯¹å…¬ç†ï¼ˆAxiom of Pairingï¼‰**ï¼šå¯¹äºä»»æ„ä¸¤ä¸ªé›†åˆ $A$ å’Œ $B$ï¼Œå­˜åœ¨é›†åˆ
   $\{A, B\}$
4. **å¹¶é›†å…¬ç†ï¼ˆAxiom of Unionï¼‰**ï¼šå¯¹äºä»»æ„é›†åˆ $A$ï¼Œå­˜åœ¨å…¶æ‰€æœ‰å…ƒç´ çš„å¹¶é›†
   $\bigcup A$
5. **å¹‚é›†å…¬ç†ï¼ˆAxiom of Power Setï¼‰**ï¼šå¯¹äºä»»æ„é›†åˆ $A$ï¼Œå­˜åœ¨å…¶æ‰€æœ‰å­é›†çš„é›†åˆ
   $\mathcal{P}(A)$
6. **åˆ†ç¦»å…¬ç†ï¼ˆAxiom Schema of Separationï¼‰**ï¼šå¯¹äºä»»æ„é›†åˆ $A$ å’Œæ€§è´¨ $P$ï¼Œå­˜åœ¨
   æ»¡è¶³ $P$ çš„å­é›† $\{x \in A | P(x)\}$
7. **æ›¿æ¢å…¬ç†ï¼ˆAxiom Schema of Replacementï¼‰**ï¼šå¯¹äºä»»æ„é›†åˆ $A$ å’Œå‡½æ•° $f$ï¼Œå­˜
   åœ¨åƒé›†åˆ $\{f(x) | x \in A\}$
8. **æ— ç©·å…¬ç†ï¼ˆAxiom of Infinityï¼‰**ï¼šå­˜åœ¨å½’çº³é›†åˆï¼ˆåŒ…å«ç©ºé›†ä¸”å¯¹åç»§è¿ç®—å°é—­ï¼‰
9. **æ­£åˆ™å…¬ç†ï¼ˆAxiom of Regularityï¼‰**ï¼šä»»æ„éç©ºé›†åˆéƒ½åŒ…å«ä¸€ä¸ªä¸å®ƒä¸ç›¸äº¤çš„å…ƒç´ 
10. **é€‰æ‹©å…¬ç†ï¼ˆAxiom of Choiceï¼‰**ï¼šå¯¹äºä»»æ„é›†åˆæ—ï¼Œå­˜åœ¨é€‰æ‹©å‡½æ•°

**å®¹å™¨æŠ€æœ¯é›†åˆè®ºåº”ç”¨**ï¼š

- **Pod é›†åˆ**ï¼š$\mathcal{P} = \{p_1, p_2, \ldots, p_n\}$ï¼Œå…¶ä¸­ $p_i$ æ˜¯ Pod å¯¹
  è±¡
- **Node é›†åˆ**ï¼š$\mathcal{N} = \{n_1, n_2, \ldots, n_m\}$ï¼Œå…¶ä¸­ $n_j$ æ˜¯ Node
  å¯¹è±¡
- **è°ƒåº¦å‡½æ•°**ï¼š$f: \mathcal{P} \rightarrow \mathcal{N}$ï¼Œå°† Pod æ˜ å°„åˆ° Nodeï¼Œæ»¡
  è¶³ï¼š
  - **å•å°„æ€§**ï¼ˆInjectiveï¼‰ï¼šä¸åŒ Pod å¯ä»¥è°ƒåº¦åˆ°åŒä¸€ Node
  - **æ»¡å°„æ€§**ï¼ˆSurjectiveï¼‰ï¼šæ¯ä¸ª Node éƒ½å¯ä»¥è¢«è°ƒåº¦
  - **å®¹é‡çº¦æŸ**ï¼š$|f^{-1}(n_j)| \leq \text{capacity}(n_j)$ï¼ˆæ¯ä¸ª Node çš„ Pod æ•°
    é‡ä¸è¶…è¿‡å®¹é‡ï¼‰

**é›†åˆè¿ç®—**ï¼š

- **å¹¶
  é›†**ï¼š$\mathcal{P}_1 \cup \mathcal{P}_2 = \{p | p \in \mathcal{P}_1 \text{ æˆ– } p \in \mathcal{P}_2\}$
- **äº¤
  é›†**ï¼š$\mathcal{P}_1 \cap \mathcal{P}_2 = \{p | p \in \mathcal{P}_1 \text{ ä¸” } p \in \mathcal{P}_2\}$
- **å·®
  é›†**ï¼š$\mathcal{P}_1 \setminus \mathcal{P}_2 = \{p | p \in \mathcal{P}_1 \text{ ä¸” } p \notin \mathcal{P}_2\}$
- **ç¬›å¡å°”
  ç§¯**ï¼š$\mathcal{P} \times \mathcal{N} = \{(p, n) | p \in \mathcal{P}, n \in \mathcal{N}\}$ï¼ˆPod
  ä¸ Node çš„é…å¯¹ï¼‰

### ç±»å‹è®ºåŸºç¡€

æ ¹æ® Wikipediaï¼Œç±»å‹è®ºï¼ˆType Theoryï¼‰æ˜¯ç ”ç©¶ç±»å‹ç³»ç»Ÿçš„æ•°å­¦ç†è®ºï¼Œå¹¿æ³›åº”ç”¨äºè®¡ç®—æœº
ç§‘å­¦ã€‚

**ç±»å‹ç³»ç»Ÿå®šä¹‰**ï¼š

ç±»å‹ç³»ç»Ÿ $\mathcal{T} = (Type, Term, \vdash)$ï¼Œå…¶ä¸­ï¼š

- $Type$ = ç±»å‹é›†åˆï¼ˆType Universeï¼‰
- $Term$ = é¡¹ï¼ˆTermï¼‰é›†åˆ
- $\vdash$ = ç±»å‹åˆ¤æ–­å…³ç³»ï¼ˆTyping Relationï¼‰ï¼š$Term \vdash Type$

**å®¹å™¨æŠ€æœ¯ç±»å‹ç³»ç»Ÿ**ï¼š

- **Image ç±»å‹**ï¼š$\text{Image}: \text{Registry} \rightarrow \text{Image}$ï¼ˆä»é•œ
  åƒä»“åº“åˆ°é•œåƒï¼‰
- **Container ç±»
  å‹**ï¼š$\text{Container}: \text{Image} \rightarrow \text{Container}$ï¼ˆä»é•œåƒåˆ°
  å®¹å™¨ï¼‰
- **Pod ç±»å‹**ï¼š$\text{Pod}: \text{Container}^* \rightarrow \text{Pod}$ï¼ˆä»å®¹å™¨
  åˆ—è¡¨åˆ° Podï¼‰

**ç±»å‹å®‰å…¨**ï¼š

æ ¹æ® Wikipediaï¼Œç±»å‹å®‰å…¨ï¼ˆType Safetyï¼‰æ˜¯æŒ‡ç±»å‹ç³»ç»Ÿä¿è¯ç¨‹åºä¸ä¼šå‡ºç°ç±»å‹é”™è¯¯ã€‚

**å®¹å™¨æŠ€æœ¯ç±»å‹å®‰å…¨**ï¼š

- **OCI ç±»å‹å®‰å…¨**ï¼šOCI é•œåƒå¿…é¡»ç¬¦åˆ Manifest å’Œ Config çš„ç±»å‹å®šä¹‰
- **CRI ç±»å‹å®‰å…¨**ï¼šCRI æ¥å£è°ƒç”¨å¿…é¡»ç¬¦åˆ API ç±»å‹å®šä¹‰
- **Kubernetes ç±»å‹å®‰å…¨**ï¼šKubernetes å¯¹è±¡å¿…é¡»ç¬¦åˆ Schema å®šä¹‰

**ä¾èµ–ç±»å‹**ï¼ˆDependent Typesï¼‰ï¼š

æ ¹æ® Wikipediaï¼Œä¾èµ–ç±»å‹å…è®¸ç±»å‹ä¾èµ–äºå€¼ï¼Œæä¾›äº†æ›´ç²¾ç¡®çš„ç±»å‹è¡¨è¾¾èƒ½åŠ›ã€‚

**å®¹å™¨æŠ€æœ¯ä¾èµ–ç±»å‹**ï¼š

- **Pod ç±»å‹ä¾èµ–äº
  Image**ï¼š$\text{Pod}(\text{Image}): \text{Image} \rightarrow \text{Pod}$
- **Container ç±»å‹ä¾èµ–äº
  Runtime**ï¼š$\text{Container}(\text{Runtime}): \text{Runtime} \rightarrow \text{Container}$

---

**æ–‡æ¡£ç»“æ„**ï¼š

- **ç»“æ„åŒæ„æ€§**ï¼šä¸åŒæŠ€æœ¯åœ¨ç»“æ„ä¸Šçš„åŒæ„å…³ç³»
- **å…³ç³»ç­‰ä»·æ€§**ï¼šä¸åŒæŠ€æœ¯åœ¨åŠŸèƒ½ä¸Šçš„ç­‰ä»·å…³ç³»
- **åˆ†å¸ƒå¼ç³»ç»Ÿç†è®º**ï¼šCAP å®šç†ã€ä¸€è‡´æ€§ã€å¯ç”¨æ€§ç­‰ç†è®ºåº”ç”¨
- **åŠŸèƒ½èšåˆç†è®º**ï¼šåŠŸèƒ½ç»„åˆã€æ¥å£æŠ½è±¡ã€æ’ä»¶æœºåˆ¶
- **ç½‘ç»œæ‹“æ‰‘ç†è®º**ï¼šæ‹“æ‰‘ç»“æ„ã€è·¯ç”±åè®®ã€è´Ÿè½½å‡è¡¡
- **å½¢å¼åŒ–æ¨¡å‹**ï¼šçŠ¶æ€æœºã€äº‹ä»¶é©±åŠ¨ã€æ§åˆ¶ç†è®ºã€å›¾è®ºæ¨¡å‹

**å½¢å¼åŒ–ç†è®ºæ ¸å¿ƒæ¦‚å¿µ**ï¼ˆæ ¹æ® Wikipediaï¼‰ï¼š

1. **å½¢å¼ç³»ç»Ÿï¼ˆFormal Systemï¼‰**ï¼š

   - **è¯­è¨€ï¼ˆLanguageï¼‰**ï¼šç¬¦å·é›†åˆå’Œè¯­æ³•è§„åˆ™
   - **å…¬ç†ï¼ˆAxiomsï¼‰**ï¼šä½œä¸ºç†è®ºåŸºç¡€çš„è¯­å¥
   - **æ¨ç†è§„åˆ™ï¼ˆInference Rulesï¼‰**ï¼šä»å…¬ç†æ¨å¯¼å®šç†çš„è§„åˆ™

2. **æ¨¡å‹è®ºï¼ˆModel Theoryï¼‰**ï¼š

   - ç ”ç©¶æ•°å­¦ç»“æ„å¦‚ä½•æ»¡è¶³ç‰¹å®šå…¬ç†ç³»ç»Ÿ
   - ä¸åŒæ¨¡å‹ä¹‹é—´çš„å…³ç³»
   - è¯­ä¹‰å’Œè¯­æ³•ä¹‹é—´çš„å…³ç³»

3. **è¯æ˜è®ºï¼ˆProof Theoryï¼‰**ï¼š

   - åˆ†ææ•°å­¦è¯æ˜çš„ç»“æ„
   - ç ”ç©¶å¯è¯æ˜æ€§å’Œä¸€è‡´æ€§
   - æ„é€ æ€§è¯æ˜å’Œéæ„é€ æ€§è¯æ˜

4. **é›†åˆè®ºï¼ˆSet Theoryï¼‰**ï¼š
   - ZFC å…¬ç†ç³»ç»Ÿ
   - é›†åˆè¿ç®—å’Œå…³ç³»
   - åŸºæ•°ä¸åºæ•°

## 07.2 ç»“æ„åŒæ„æ€§

### 07.2.1 å®¹å™¨è¿è¡Œæ—¶åŒæ„

**åŒæ„å®šä¹‰**ï¼šä¸¤ä¸ªå®¹å™¨è¿è¡Œæ—¶åœ¨ç»“æ„ä¸ŠåŒæ„ï¼Œå½“ä¸”ä»…å½“å®ƒä»¬åœ¨åŠŸèƒ½ç»„ä»¶ä¸Šå­˜åœ¨ä¸€ä¸€å¯¹åº”å…³
ç³»ã€‚

**åŒæ„æ˜ å°„**ï¼š

| Docker (runc)       | containerd          | crun          | WasmEdge             | åŠŸèƒ½        |
| ------------------- | ------------------- | ------------- | -------------------- | ----------- |
| **dockerd**         | **containerd**      | **crun**      | **WasmEdge**         | å®ˆæŠ¤è¿›ç¨‹    |
| **containerd-shim** | **containerd-shim** | **crun-shim** | **runwasi**          | è¿è¡Œæ—¶ shim |
| **runc**            | **runc**            | **crun**      | **WasmEdge Runtime** | å®é™…è¿è¡Œæ—¶  |
| **OCI Image**       | **OCI Image**       | **OCI Image** | **OCI Artifact**     | é•œåƒè§„èŒƒ    |
| **rootfs**          | **rootfs**          | **rootfs**    | **Wasm Module**      | åº”ç”¨æ‰“åŒ…    |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾è¿è¡Œæ—¶ä¸º $R = \{D, S, I, A\}$ï¼Œå…¶ä¸­ï¼š

- $D$ = å®ˆæŠ¤è¿›ç¨‹ï¼ˆDaemonï¼‰
- $S$ = Shim è¿›ç¨‹
- $I$ = é•œåƒï¼ˆImageï¼‰
- $A$ = åº”ç”¨ï¼ˆApplicationï¼‰

**Docker ç»“æ„**ï¼š
$$R_D = \{\text{dockerd}, \text{containerd-shim}, \text{OCI Image}, \text{rootfs}\}$$

**containerd ç»“æ„**ï¼š
$$R_C = \{\text{containerd}, \text{containerd-shim}, \text{OCI Image}, \text{rootfs}\}$$

**crun ç»“æ„**ï¼š
$$R_{crun} = \{\text{crun}, \text{crun-shim}, \text{OCI Image}, \text{rootfs}\}$$

**WasmEdge ç»“æ„**ï¼š
$$R_W = \{\text{WasmEdge}, \text{runwasi}, \text{OCI Artifact}, \text{Wasm Module}\}$$

**åŒæ„å®šç† 07.1**ï¼šæ‰€æœ‰å®¹å™¨è¿è¡Œæ—¶åœ¨ç»“æ„ä¸ŠåŒæ„ï¼Œå³å­˜åœ¨åŒå°„
$f: R_D \rightarrow R_C \rightarrow R_{crun} \rightarrow R_W$ã€‚

**è¯æ˜**ï¼šæ‰€æœ‰è¿è¡Œæ—¶éƒ½éµå¾ª OCI è§„èŒƒï¼Œç»„ä»¶åŠŸèƒ½ä¸€ä¸€å¯¹åº”ã€‚

$\square$

### 07.2.2 ç¼–æ’ç³»ç»ŸåŒæ„

**åŒæ„å®šä¹‰**ï¼šç¼–æ’ç³»ç»Ÿåœ¨æ§åˆ¶å¹³é¢ç»“æ„ä¸ŠåŒæ„ã€‚

**åŒæ„æ˜ å°„**ï¼š

| Kubernetes             | K3s                | Docker Swarm        | åŠŸèƒ½     |
| ---------------------- | ------------------ | ------------------- | -------- |
| **API Server**         | **k3s API Server** | **Swarm Manager**   | API ç½‘å…³ |
| **etcd**               | **sqlite**         | **Raft**            | çŠ¶æ€å­˜å‚¨ |
| **Controller Manager** | **K3s Controller** | **Orchestrator**    | æ§åˆ¶å™¨   |
| **Scheduler**          | **K3s Scheduler**  | **Swarm Scheduler** | è°ƒåº¦å™¨   |
| **kubelet**            | **k3s Agent**      | **Swarm Worker**    | èŠ‚ç‚¹ä»£ç† |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾ç¼–æ’ç³»ç»Ÿä¸º $O = \{A, S, C, Sch, N\}$ï¼Œå…¶ä¸­ï¼š

- $A$ = API Server
- $S$ = çŠ¶æ€å­˜å‚¨ï¼ˆStorageï¼‰
- $C$ = æ§åˆ¶å™¨ï¼ˆControllerï¼‰
- $Sch$ = è°ƒåº¦å™¨ï¼ˆSchedulerï¼‰
- $N$ = èŠ‚ç‚¹ä»£ç†ï¼ˆNode Agentï¼‰

**Kubernetes ç»“æ„**ï¼š
$$O_K = \{\text{API Server}, \text{etcd}, \text{Controller Manager}, \text{Scheduler}, \text{kubelet}\}$$

**K3s ç»“æ„**ï¼š
$$O_{K3} = \{\text{k3s API Server}, \text{sqlite}, \text{K3s Controller}, \text{K3s Scheduler}, \text{k3s Agent}\}$$

**Docker Swarm ç»“æ„**ï¼š
$$O_S = \{\text{Swarm Manager}, \text{Raft}, \text{Orchestrator}, \text{Swarm Scheduler}, \text{Swarm Worker}\}$$

**åŒæ„å®šç† 07.2**ï¼šæ‰€æœ‰ç¼–æ’ç³»ç»Ÿåœ¨æ§åˆ¶å¹³é¢ç»“æ„ä¸ŠåŒæ„ï¼Œå³å­˜åœ¨åŒå°„
$g: O_K \rightarrow O_{K3} \rightarrow O_S$ã€‚

**è¯æ˜**ï¼šæ‰€æœ‰ç¼–æ’ç³»ç»Ÿéƒ½éµå¾ªç›¸åŒçš„æ§åˆ¶å¹³é¢æ¶æ„æ¨¡å¼ã€‚

$\square$

### 07.2.3 å­˜å‚¨ç³»ç»ŸåŒæ„

**åŒæ„å®šä¹‰**ï¼šå­˜å‚¨ç³»ç»Ÿåœ¨å­˜å‚¨æŠ½è±¡ä¸ŠåŒæ„ã€‚

**åŒæ„æ˜ å°„**ï¼š

| etcd                | sqlite          | Raft           | Consul              | åŠŸèƒ½     |
| ------------------- | --------------- | -------------- | ------------------- | -------- |
| **Key-Value Store** | **SQLite DB**   | **Raft Log**   | **Key-Value Store** | æ•°æ®å­˜å‚¨ |
| **Watch API**       | **Triggers**    | **Raft State** | **Watch API**       | å˜æ›´é€šçŸ¥ |
| **Transaction**     | **Transaction** | **Raft Entry** | **Transaction**     | äº‹åŠ¡æ”¯æŒ |
| **Lease**           | **WAL**         | **Raft Term**  | **Session**         | ç§Ÿçº¦æœºåˆ¶ |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾å­˜å‚¨ç³»ç»Ÿä¸º $St = \{K, W, T, L\}$ï¼Œå…¶ä¸­ï¼š

- $K$ = Key-Value å­˜å‚¨
- $W$ = Watch æœºåˆ¶
- $T$ = äº‹åŠ¡æ”¯æŒ
- $L$ = ç§Ÿçº¦æœºåˆ¶

**etcd ç»“æ„**ï¼š
$$St_e = \{\text{Key-Value}, \text{Watch}, \text{Transaction}, \text{Lease}\}$$

**sqlite ç»“æ„**ï¼š
$$St_s = \{\text{SQLite DB}, \text{Triggers}, \text{Transaction}, \text{WAL}\}$$

**Raft ç»“æ„**ï¼š
$$St_r = \{\text{Raft Log}, \text{Raft State}, \text{Raft Entry}, \text{Raft Term}\}$$

**åŒæ„å®šç† 07.3**ï¼šæ‰€æœ‰åˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿåœ¨å­˜å‚¨æŠ½è±¡ä¸ŠåŒæ„ï¼Œå³å­˜åœ¨åŒå°„
$h: St_e \rightarrow St_s \rightarrow St_r$ã€‚

**è¯æ˜**ï¼šæ‰€æœ‰å­˜å‚¨ç³»ç»Ÿéƒ½æä¾›ç›¸åŒçš„å­˜å‚¨æŠ½è±¡æ¥å£ã€‚

$\square$

### 07.2.4 ç½‘ç»œç³»ç»ŸåŒæ„

**åŒæ„å®šä¹‰**ï¼šç½‘ç»œç³»ç»Ÿåœ¨ç½‘ç»œæŠ½è±¡ä¸ŠåŒæ„ã€‚

**åŒæ„æ˜ å°„**ï¼š

| flannel               | Calico                | Cilium                | åŠŸèƒ½     |
| --------------------- | --------------------- | --------------------- | -------- |
| **CNI Plugin**        | **CNI Plugin**        | **CNI Plugin**        | CNI æ¥å£ |
| **VXLAN/IPIP**        | **BGP**               | **eBPF**              | ç½‘ç»œåè®® |
| **Network Policy**    | **Network Policy**    | **Network Policy**    | ç½‘ç»œç­–ç•¥ |
| **Service Discovery** | **Service Discovery** | **Service Discovery** | æœåŠ¡å‘ç° |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾ç½‘ç»œç³»ç»Ÿä¸º $N = \{C, P, NP, SD\}$ï¼Œå…¶ä¸­ï¼š

- $C$ = CNI æ¥å£
- $P$ = ç½‘ç»œåè®®
- $NP$ = ç½‘ç»œç­–ç•¥
- $SD$ = æœåŠ¡å‘ç°

**flannel ç»“æ„**ï¼š
$$N_f = \{\text{CNI}, \text{VXLAN/IPIP}, \text{Network Policy}, \text{Service Discovery}\}$$

**Calico ç»“æ„**ï¼š
$$N_c = \{\text{CNI}, \text{BGP}, \text{Network Policy}, \text{Service Discovery}\}$$

**Cilium ç»“æ„**ï¼š
$$N_{ci} = \{\text{CNI}, \text{eBPF}, \text{Network Policy}, \text{Service Discovery}\}$$

**åŒæ„å®šç† 07.4**ï¼šæ‰€æœ‰ CNI ç½‘ç»œç³»ç»Ÿåœ¨ç½‘ç»œæŠ½è±¡ä¸ŠåŒæ„ï¼Œå³å­˜åœ¨åŒå°„
$i: N_f \rightarrow N_c \rightarrow N_{ci}$ã€‚

**è¯æ˜**ï¼šæ‰€æœ‰ç½‘ç»œç³»ç»Ÿéƒ½éµå¾ª CNI è§„èŒƒï¼Œæ¥å£ä¸€è‡´ã€‚

$\square$

## 07.3 å…³ç³»ç­‰ä»·æ€§

### 07.3.1 è¿è¡Œæ—¶æ¥å£ç­‰ä»·

**ç­‰ä»·å®šä¹‰**ï¼šä¸¤ä¸ªè¿è¡Œæ—¶æ¥å£åœ¨åŠŸèƒ½ä¸Šç­‰ä»·ï¼Œå½“ä¸”ä»…å½“å®ƒä»¬æä¾›ç›¸åŒçš„åŠŸèƒ½é›†åˆã€‚

**ç­‰ä»·æ˜ å°„**ï¼š

| CRI (containerd)    | CRI-O               | Docker API        | åŠŸèƒ½ç­‰ä»· |
| ------------------- | ------------------- | ----------------- | -------- |
| **PullImage**       | **PullImage**       | **docker pull**   | é•œåƒæ‹‰å– |
| **CreateContainer** | **CreateContainer** | **docker create** | å®¹å™¨åˆ›å»º |
| **StartContainer**  | **StartContainer**  | **docker start**  | å®¹å™¨å¯åŠ¨ |
| **StopContainer**   | **StopContainer**   | **docker stop**   | å®¹å™¨åœæ­¢ |
| **RemoveContainer** | **RemoveContainer** | **docker rm**     | å®¹å™¨åˆ é™¤ |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾è¿è¡Œæ—¶æ¥å£ä¸º $I = \{P, C, S, St, R\}$ï¼Œå…¶ä¸­ï¼š

- $P$ = Pull é•œåƒ
- $C$ = Create å®¹å™¨
- $S$ = Start å®¹å™¨
- $St$ = Stop å®¹å™¨
- $R$ = Remove å®¹å™¨

**ç­‰ä»·å®šç† 07.5**ï¼šCRIã€CRI-Oã€Docker API åœ¨åŠŸèƒ½ä¸Šç­‰ä»·ï¼Œå³
$I_{CRI} \equiv I_{CRI-O} \equiv I_{Docker}$ã€‚

**è¯æ˜**ï¼šæ‰€æœ‰æ¥å£éƒ½æä¾›ç›¸åŒçš„å®¹å™¨æ“ä½œåŠŸèƒ½ã€‚

$\square$

### 07.3.2 API æ¥å£ç­‰ä»·

**ç­‰ä»·å®šä¹‰**ï¼šAPI æ¥å£åœ¨è¯­ä¹‰ä¸Šç­‰ä»·ã€‚

**ç­‰ä»·æ˜ å°„**ï¼š

| Kubernetes API                                 | K3s API                                        | åŠŸèƒ½ç­‰ä»· |
| ---------------------------------------------- | ---------------------------------------------- | -------- |
| **GET /api/v1/pods**                           | **GET /api/v1/pods**                           | Pod æŸ¥è¯¢ |
| **POST /api/v1/namespaces/{ns}/pods**          | **POST /api/v1/namespaces/{ns}/pods**          | Pod åˆ›å»º |
| **PUT /api/v1/namespaces/{ns}/pods/{name}**    | **PUT /api/v1/namespaces/{ns}/pods/{name}**    | Pod æ›´æ–° |
| **DELETE /api/v1/namespaces/{ns}/pods/{name}** | **DELETE /api/v1/namespaces/{ns}/pods/{name}** | Pod åˆ é™¤ |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾ API æ¥å£ä¸º $A = \{G, P, U, D\}$ï¼Œå…¶ä¸­ï¼š

- $G$ = GETï¼ˆæŸ¥è¯¢ï¼‰
- $P$ = POSTï¼ˆåˆ›å»ºï¼‰
- $U$ = PUTï¼ˆæ›´æ–°ï¼‰
- $D$ = DELETEï¼ˆåˆ é™¤ï¼‰

**ç­‰ä»·å®šç† 07.6**ï¼šKubernetes API å’Œ K3s API åœ¨è¯­ä¹‰ä¸Šç­‰ä»·ï¼Œå³
$A_K \equiv A_{K3}$ã€‚

**è¯æ˜**ï¼šK3s å®Œå…¨å…¼å®¹ Kubernetes APIã€‚

$\square$

### 07.3.3 åè®®ç­‰ä»·

**ç­‰ä»·å®šä¹‰**ï¼šç½‘ç»œåè®®åœ¨ä¼ è¾“å±‚åŠŸèƒ½ä¸Šç­‰ä»·ã€‚

**ç­‰ä»·æ˜ å°„**ï¼š

| HTTP/1.1      | HTTP/2         | gRPC                 | åŠŸèƒ½ç­‰ä»· |
| ------------- | -------------- | -------------------- | -------- |
| **è¯·æ±‚-å“åº”** | **æµå¼ä¼ è¾“**   | **åŒå‘æµ**           | é€šä¿¡æ¨¡å¼ |
| **æ–‡æœ¬åè®®**  | **äºŒè¿›åˆ¶åè®®** | **Protocol Buffers** | ç¼–ç æ ¼å¼ |
| **TCP**       | **TCP**        | **HTTP/2 over TCP**  | ä¼ è¾“å±‚   |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾åè®®ä¸º $Pr = \{M, E, T\}$ï¼Œå…¶ä¸­ï¼š

- $M$ = é€šä¿¡æ¨¡å¼ï¼ˆMessage Patternï¼‰
- $E$ = ç¼–ç æ ¼å¼ï¼ˆEncoding Formatï¼‰
- $T$ = ä¼ è¾“å±‚ï¼ˆTransport Layerï¼‰

**ç­‰ä»·å®šç† 07.7**ï¼šHTTP/1.1ã€HTTP/2ã€gRPC åœ¨ä¼ è¾“å±‚åŠŸèƒ½ä¸Šç­‰ä»·ï¼Œå³
$Pr_{HTTP1} \equiv Pr_{HTTP2} \equiv Pr_{gRPC}$ã€‚

**è¯æ˜**ï¼šæ‰€æœ‰åè®®éƒ½åŸºäº TCPï¼Œæä¾›å¯é çš„ä¼ è¾“æœåŠ¡ã€‚

$\square$

### 07.3.4 è§„èŒƒç­‰ä»·

**ç­‰ä»·å®šä¹‰**ï¼šå®¹å™¨è§„èŒƒåœ¨è¯­ä¹‰ä¸Šç­‰ä»·ã€‚

**ç­‰ä»·æ˜ å°„**ï¼š

| OCI Image Spec | Docker Image Format | åŠŸèƒ½ç­‰ä»· |
| -------------- | ------------------- | -------- |
| **Manifest**   | **Manifest**        | æ¸…å•     |
| **Config**     | **Config**          | é…ç½®     |
| **Layers**     | **Layers**          | å±‚       |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾å®¹å™¨è§„èŒƒä¸º $Sp = \{M, C, L\}$ï¼Œå…¶ä¸­ï¼š

- $M$ = Manifestï¼ˆæ¸…å•ï¼‰
- $C$ = Configï¼ˆé…ç½®ï¼‰
- $L$ = Layersï¼ˆå±‚ï¼‰

**ç­‰ä»·å®šç† 07.8**ï¼šOCI Image Spec å’Œ Docker Image Format åœ¨è¯­ä¹‰ä¸Šç­‰ä»·ï¼Œå³
$Sp_{OCI} \equiv Sp_{Docker}$ã€‚

**è¯æ˜**ï¼šOCI Image Spec åŸºäº Docker Image Format æ ‡å‡†åŒ–ã€‚

$\square$

## 07.4 åˆ†å¸ƒå¼ç³»ç»Ÿç†è®º

### 07.4.1 CAP å®šç†åº”ç”¨

**CAP å®šç†**ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œä¸€è‡´æ€§ï¼ˆConsistencyï¼‰ã€å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰ã€åˆ†
åŒºå®¹å¿æ€§ï¼ˆPartition toleranceï¼‰ä¸‰è€…ä¸å¯å…¼å¾—ã€‚

**CAP å®šç†åº”ç”¨**ï¼š

| ç³»ç»Ÿ           | C   | A   | P   | é€‰æ‹©    | è¯´æ˜               |
| -------------- | --- | --- | --- | ------- | ------------------ |
| **etcd**       | âœ…  | âŒ  | âœ…  | **CP**  | å¼ºä¸€è‡´æ€§ï¼Œå®¹å¿åˆ†åŒº |
| **sqlite**     | âœ…  | âœ…  | âŒ  | **CA**  | å•èŠ‚ç‚¹ï¼Œå¼ºä¸€è‡´æ€§   |
| **Consul**     | âœ…  | âœ…  | âœ…  | **CAP** | æœ€ç»ˆä¸€è‡´æ€§ï¼Œé«˜å¯ç”¨ |
| **Kubernetes** | âœ…  | âŒ  | âœ…  | **CP**  | å¼ºä¸€è‡´æ€§ï¼Œå®¹å¿åˆ†åŒº |
| **K3s**        | âœ…  | âœ…  | âŒ  | **CA**  | å•èŠ‚ç‚¹ï¼Œå¼ºä¸€è‡´æ€§   |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾åˆ†å¸ƒå¼ç³»ç»Ÿä¸º $DS = \{C, A, P\}$ï¼Œå…¶ä¸­ï¼š

- $C$ = ä¸€è‡´æ€§ï¼ˆConsistencyï¼‰
- $A$ = å¯ç”¨æ€§ï¼ˆAvailabilityï¼‰
- $P$ = åˆ†åŒºå®¹å¿æ€§ï¼ˆPartition toleranceï¼‰

**CAP å®šç†**ï¼š $$C + A + P \leq 2$$

**åº”ç”¨å®šç† 07.9**ï¼šKubernetes é€‰æ‹© CPï¼ŒK3s é€‰æ‹© CAï¼Œæ ¹æ®åœºæ™¯éœ€æ±‚æƒè¡¡ã€‚

### 07.4.2 ä¸€è‡´æ€§æ¨¡å‹

**ä¸€è‡´æ€§æ¨¡å‹åˆ†ç±»**ï¼š

| æ¨¡å‹           | å®šä¹‰                 | ç¤ºä¾‹          | åº”ç”¨åœºæ™¯     |
| -------------- | -------------------- | ------------- | ------------ |
| **å¼ºä¸€è‡´æ€§**   | æ‰€æœ‰èŠ‚ç‚¹çœ‹åˆ°ç›¸åŒçŠ¶æ€ | etcd          | æ§åˆ¶å¹³é¢çŠ¶æ€ |
| **æœ€ç»ˆä¸€è‡´æ€§** | æœ€ç»ˆæ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€ä¸€è‡´ | Consul        | æœåŠ¡å‘ç°     |
| **ä¼šè¯ä¸€è‡´æ€§** | åŒä¸€ä¼šè¯å†…ä¸€è‡´       | Session State | Web ä¼šè¯     |
| **å› æœä¸€è‡´æ€§** | å› æœç›¸å…³æ“ä½œä¸€è‡´     | Vector Clock  | åˆ†å¸ƒå¼æ—¥å¿—   |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾ä¸€è‡´æ€§æ¨¡å‹ä¸º $CM = \{S, E, C, CA\}$ï¼Œå…¶ä¸­ï¼š

- $S$ = å¼ºä¸€è‡´æ€§ï¼ˆStrong Consistencyï¼‰
- $E$ = æœ€ç»ˆä¸€è‡´æ€§ï¼ˆEventual Consistencyï¼‰
- $C$ = ä¼šè¯ä¸€è‡´æ€§ï¼ˆSession Consistencyï¼‰
- $CA$ = å› æœä¸€è‡´æ€§ï¼ˆCausal Consistencyï¼‰

**ä¸€è‡´æ€§å®šç† 07.10**ï¼šå¯¹äºåˆ†å¸ƒå¼å­˜å‚¨ç³»ç»Ÿï¼Œå¼ºä¸€è‡´æ€§éœ€è¦ç‰ºç‰²å¯ç”¨æ€§ï¼Œæœ€ç»ˆä¸€è‡´æ€§æé«˜
å¯ç”¨æ€§ä½†ç‰ºç‰²ä¸€è‡´æ€§ã€‚

### 07.4.3 å¯ç”¨æ€§æ¨¡å‹

**å¯ç”¨æ€§è®¡ç®—**ï¼š

$$A = \frac{\text{æ­£å¸¸è¿è¡Œæ—¶é—´}}{\text{æ€»æ—¶é—´}} = \frac{MTBF}{MTBF + MTTR}$$

å…¶ä¸­ï¼š

- $MTBF$ = å¹³å‡æ•…éšœé—´éš”æ—¶é—´ï¼ˆMean Time Between Failuresï¼‰
- $MTTR$ = å¹³å‡ä¿®å¤æ—¶é—´ï¼ˆMean Time To Repairï¼‰

**å¯ç”¨æ€§ç­‰çº§**ï¼š

| ç­‰çº§        | å¯ç”¨æ€§  | å¹´åœæœºæ—¶é—´ | ç¤ºä¾‹       |
| ----------- | ------- | ---------- | ---------- |
| **99%**     | 99%     | 3.65 å¤©    | å•èŠ‚ç‚¹ç³»ç»Ÿ |
| **99.9%**   | 99.9%   | 8.76 å°æ—¶  | å†—ä½™ç³»ç»Ÿ   |
| **99.99%**  | 99.99%  | 52.56 åˆ†é’Ÿ | é«˜å¯ç”¨é›†ç¾¤ |
| **99.999%** | 99.999% | 5.26 åˆ†é’Ÿ  | å…³é”®ç³»ç»Ÿ   |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾å¯ç”¨æ€§ä¸º $A = \frac{MTBF}{MTBF + MTTR}$ï¼Œåˆ™ï¼š

- **å•èŠ‚ç‚¹ç³»ç»Ÿ**ï¼š$A = 99\%$ï¼ˆMTBF = 1 å¹´ï¼ŒMTTR = 3.65 å¤©ï¼‰
- **å†—ä½™ç³»ç»Ÿ**ï¼š$A = 99.9\%$ï¼ˆMTBF = 1 å¹´ï¼ŒMTTR = 8.76 å°æ—¶ï¼‰
- **é«˜å¯ç”¨é›†ç¾¤**ï¼š$A = 99.99\%$ï¼ˆMTBF = 1 å¹´ï¼ŒMTTR = 52.56 åˆ†é’Ÿï¼‰

**å¯ç”¨æ€§å®šç† 07.11**ï¼šé€šè¿‡å†—ä½™å’Œå¿«é€Ÿä¿®å¤å¯ä»¥æé«˜ç³»ç»Ÿå¯ç”¨æ€§ã€‚

### 07.4.4 åˆ†åŒºå®¹å¿æ€§

**åˆ†åŒºå®¹å¿æ€§**ï¼šç³»ç»Ÿåœ¨ç½‘ç»œåˆ†åŒºæ—¶ä»èƒ½æ­£å¸¸å·¥ä½œã€‚

**åˆ†åŒºå®¹å¿ç­–ç•¥**ï¼š

| ç­–ç•¥         | è¯´æ˜               | ç¤ºä¾‹             |
| ------------ | ------------------ | ---------------- |
| **æœ€ç»ˆä¸€è‡´** | æ¥å—åˆ†åŒºï¼Œæœ€ç»ˆä¸€è‡´ | Consulã€DynamoDB |
| **å¼ºä¸€è‡´**   | åˆ†åŒºæ—¶æš‚åœå†™å…¥     | etcdã€Zookeeper  |
| **æœ¬åœ°ä¼˜å…ˆ** | åˆ†åŒºæ—¶æœ¬åœ°å¯ç”¨     | sqliteã€è¾¹ç¼˜è®¡ç®— |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾åˆ†åŒºå®¹å¿æ€§ä¸º $PT = \{EC, SC, LF\}$ï¼Œå…¶ä¸­ï¼š

- $EC$ = æœ€ç»ˆä¸€è‡´ï¼ˆEventual Consistencyï¼‰
- $SC$ = å¼ºä¸€è‡´ï¼ˆStrong Consistencyï¼‰
- $LF$ = æœ¬åœ°ä¼˜å…ˆï¼ˆLocal Firstï¼‰

**åˆ†åŒºå®¹å¿å®šç† 07.12**ï¼šè¾¹ç¼˜è®¡ç®—åœºæ™¯é€‰æ‹©æœ¬åœ°ä¼˜å…ˆç­–ç•¥ï¼Œä¸­å¿ƒé›†ç¾¤é€‰æ‹©å¼ºä¸€è‡´ç­–ç•¥ã€‚

## 07.5 åŠŸèƒ½èšåˆç†è®º

### 07.5.1 åŠŸèƒ½ç»„åˆ

**åŠŸèƒ½ç»„åˆå®šä¹‰**ï¼šé€šè¿‡ç»„åˆå¤šä¸ªåŠŸèƒ½æ¨¡å—å®ç°å¤æ‚åŠŸèƒ½ã€‚

**åŠŸèƒ½ç»„åˆç¤ºä¾‹**ï¼š

```yaml
åŠŸèƒ½ç»„åˆ:
  Kubernetes = CRI + CNI + CSI + OPA K3s = CRI + CNI + CSI + OPA (è½»é‡ç‰ˆ)
  WasmEdge = WASI + WASI-NN + GPU Plugin OPA-Wasm = OPA + Wasm Compiler
```

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾åŠŸèƒ½ç»„åˆä¸º $F = f_1 \circ f_2 \circ \cdots \circ f_n$ï¼Œå…¶ä¸­ $\circ$ è¡¨ç¤ºå‡½æ•°ç»„
åˆã€‚

**åŠŸèƒ½ç»„åˆå®šç† 07.13**ï¼šå¤æ‚ç³»ç»Ÿå¯ä»¥é€šè¿‡åŠŸèƒ½ç»„åˆå®ç°ï¼Œå³
$S = F_1 \circ F_2 \circ \cdots \circ F_n$ã€‚

### 07.5.2 æ¥å£æŠ½è±¡

**æ¥å£æŠ½è±¡å®šä¹‰**ï¼šé€šè¿‡æ¥å£æŠ½è±¡éšè—å®ç°ç»†èŠ‚ã€‚

**æ¥å£æŠ½è±¡å±‚æ¬¡**ï¼š

| å±‚æ¬¡       | æ¥å£    | å®ç°            | è¯´æ˜       |
| ---------- | ------- | --------------- | ---------- |
| **åº”ç”¨å±‚** | Pod API | Pod å¯¹è±¡        | åº”ç”¨æŠ½è±¡   |
| **ç¼–æ’å±‚** | CRI     | containerd/runc | è¿è¡Œæ—¶æŠ½è±¡ |
| **ç½‘ç»œå±‚** | CNI     | flannel/Calico  | ç½‘ç»œæŠ½è±¡   |
| **å­˜å‚¨å±‚** | CSI     | EBS/NFS         | å­˜å‚¨æŠ½è±¡   |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾æ¥å£æŠ½è±¡ä¸º $Abst = \{App, Orc, Net, St\}$ï¼Œå…¶ä¸­ï¼š

- $App$ = åº”ç”¨å±‚æŠ½è±¡
- $Orc$ = ç¼–æ’å±‚æŠ½è±¡
- $Net$ = ç½‘ç»œå±‚æŠ½è±¡
- $St$ = å­˜å‚¨å±‚æŠ½è±¡

**æ¥å£æŠ½è±¡å®šç† 07.14**ï¼šé€šè¿‡æ¥å£æŠ½è±¡å¯ä»¥å®ç°å®ç°çš„æ›¿æ¢ï¼Œå³
$Impl_1 \equiv Impl_2$ï¼ˆé€šè¿‡ç›¸åŒæ¥å£ï¼‰ã€‚

### 07.5.3 æ’ä»¶æœºåˆ¶

**æ’ä»¶æœºåˆ¶å®šä¹‰**ï¼šé€šè¿‡æ’ä»¶æ‰©å±•ç³»ç»ŸåŠŸèƒ½ã€‚

**æ’ä»¶æœºåˆ¶ç¤ºä¾‹**ï¼š

| ç³»ç»Ÿ             | æ’ä»¶æœºåˆ¶          | æ’ä»¶ç¤ºä¾‹                      |
| ---------------- | ----------------- | ----------------------------- |
| **Kubernetes**   | Controller        | HPAã€VPAã€Cluster Autoscaler  |
| **WasmEdge**     | Plugin            | WASI-NNã€GPU Plugin           |
| **CNI**          | CNI Plugin        | flannelã€Calicoã€Cilium       |
| **OPA**          | Policy Plugin     | Gatekeeperã€Kyverno           |
| **Service Mesh** | Envoy Wasm Plugin | Wasm æ’ä»¶çƒ­åŠ è½½ã€æµé‡æ²»ç†æ’ä»¶ |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾æ’ä»¶æœºåˆ¶ä¸º $Plug = \{Base, Ext\}$ï¼Œå…¶ä¸­ï¼š

- $Base$ = åŸºç¡€ç³»ç»Ÿ
- $Ext$ = æ‰©å±•æ’ä»¶

**æ’ä»¶æœºåˆ¶å®šç† 07.15**ï¼šé€šè¿‡æ’ä»¶æœºåˆ¶å¯ä»¥å®ç°åŠŸèƒ½çš„åŠ¨æ€æ‰©å±•ï¼Œå³
$System = Base + \sum Plug_i$ã€‚

### 07.5.4 æ¨¡å—åŒ–è®¾è®¡

**æ¨¡å—åŒ–è®¾è®¡å®šä¹‰**ï¼šé€šè¿‡æ¨¡å—åŒ–å®ç°ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ã€‚

**æ¨¡å—åŒ–è®¾è®¡å±‚æ¬¡**ï¼š

| å±‚æ¬¡           | æ¨¡å—                           | èŒè´£           | æ¥å£             |
| -------------- | ------------------------------ | -------------- | ---------------- |
| **åº”ç”¨å±‚**     | Podã€Serviceã€Deployment       | åº”ç”¨ç®¡ç†       | Kubernetes API   |
| **ç¼–æ’å±‚**     | Controllerã€Scheduler          | ç¼–æ’é€»è¾‘       | Controller API   |
| **é€šä¿¡å±‚**     | Service Meshï¼ˆIstiod/Linkerdï¼‰ | æœåŠ¡é—´é€šä¿¡æ²»ç† | Service Mesh API |
| **è¿è¡Œæ—¶å±‚**   | CRIã€RuntimeClass              | è¿è¡Œæ—¶ç®¡ç†     | CRI API          |
| **åŸºç¡€è®¾æ–½å±‚** | CNIã€CSI                       | åŸºç¡€è®¾æ–½       | CNI/CSI API      |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾æ¨¡å—åŒ–è®¾è®¡ä¸º $Mod = \{M_1, M_2, \ldots, M_n\}$ï¼Œå…¶ä¸­ï¼š

- $M_i$ = ç¬¬ $i$ ä¸ªæ¨¡å—
- $\sum M_i$ = ç³»ç»Ÿæ€»å’Œ

**æ¨¡å—åŒ–è®¾è®¡å®šç† 07.16**ï¼šé€šè¿‡æ¨¡å—åŒ–è®¾è®¡å¯ä»¥å®ç°ç³»ç»Ÿçš„å¯ç»´æŠ¤æ€§å’Œå¯æ‰©å±•æ€§ï¼Œå³
$System = \sum M_i$ï¼ˆæ¨¡å—ç‹¬ç«‹ï¼‰ã€‚

## 07.6 ç½‘ç»œæ‹“æ‰‘ç†è®º

### 07.6.1 æ‹“æ‰‘ç»“æ„

**ç½‘ç»œæ‹“æ‰‘åˆ†ç±»**ï¼š

| æ‹“æ‰‘         | å®šä¹‰                 | ç‰¹ç‚¹       | åº”ç”¨åœºæ™¯            |
| ------------ | -------------------- | ---------- | ------------------- |
| **æ˜Ÿå‹æ‹“æ‰‘** | ä¸­å¿ƒèŠ‚ç‚¹è¿æ¥æ‰€æœ‰èŠ‚ç‚¹ | å•ç‚¹æ•…éšœ   | Kubernetes æ§åˆ¶å¹³é¢ |
| **ç½‘çŠ¶æ‹“æ‰‘** | æ‰€æœ‰èŠ‚ç‚¹äº’ç›¸è¿æ¥     | é«˜å†—ä½™     | Service Mesh        |
| **æ ‘å‹æ‹“æ‰‘** | åˆ†å±‚æ ‘å½¢ç»“æ„         | å¯æ‰©å±•     | é›†ç¾¤å±‚æ¬¡ç»“æ„        |
| **æ€»çº¿æ‹“æ‰‘** | æ‰€æœ‰èŠ‚ç‚¹å…±äº«æ€»çº¿     | ç®€å•ä½†ä½æ•ˆ | å•æœºç½‘ç»œ            |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾ç½‘ç»œæ‹“æ‰‘ä¸ºå›¾ $G = (V, E)$ï¼Œå…¶ä¸­ï¼š

- $V$ = èŠ‚ç‚¹é›†åˆï¼ˆVerticesï¼‰
- $E$ = è¾¹é›†åˆï¼ˆEdgesï¼‰

**æ‹“æ‰‘å®šç† 07.17**ï¼šKubernetes æ§åˆ¶å¹³é¢é‡‡ç”¨æ˜Ÿå‹æ‹“æ‰‘ï¼Œæ•°æ®å¹³é¢é‡‡ç”¨ç½‘çŠ¶æ‹“æ‰‘ã€‚

**Service Mesh æ‹“æ‰‘å®šç† 07.17.1**ï¼šService Mesh æ•°æ®å¹³é¢é‡‡ç”¨ç½‘çŠ¶æ‹“æ‰‘ï¼Œæ¯ä¸ªæœåŠ¡å®
ä¾‹é€šè¿‡ Sidecar æˆ–èŠ‚ç‚¹ä»£ç†ç›¸äº’è¿æ¥ï¼Œå®ç°æœåŠ¡é—´ç›´æ¥é€šä¿¡ï¼Œå³
$G_{SM} = (V_{Service}, E_{Mesh})$ï¼Œå…¶ä¸­ $E_{Mesh}$ è¡¨ç¤ºæœåŠ¡é—´çš„ç½‘çŠ¶è¿æ¥ã€‚

### 07.6.2 è·¯ç”±åè®®

**è·¯ç”±åè®®åˆ†ç±»**ï¼š

| åè®®         | ç±»å‹         | ç‰¹ç‚¹       | åº”ç”¨åœºæ™¯   |
| ------------ | ------------ | ---------- | ---------- |
| **BGP**      | å¤–éƒ¨ç½‘å…³åè®® | å¤§è§„æ¨¡è·¯ç”± | Calico     |
| **OSPF**     | å†…éƒ¨ç½‘å…³åè®® | åŠ¨æ€è·¯ç”±   | å†…éƒ¨ç½‘ç»œ   |
| **é™æ€è·¯ç”±** | é™æ€é…ç½®     | ç®€å•       | å°è§„æ¨¡ç½‘ç»œ |
| **VXLAN**    | éš§é“åè®®     | è™šæ‹Ÿç½‘ç»œ   | flannel    |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾è·¯ç”±åè®®ä¸º $R = \{BGP, OSPF, Static, VXLAN\}$ã€‚

**è·¯ç”±åè®®å®šç† 07.18**ï¼šæ ¹æ®ç½‘ç»œè§„æ¨¡é€‰æ‹©åˆé€‚çš„è·¯ç”±åè®®ï¼Œå¤§è§„æ¨¡é€‰æ‹© BGPï¼Œå°è§„æ¨¡é€‰
æ‹©é™æ€è·¯ç”±ã€‚

### 07.6.3 è´Ÿè½½å‡è¡¡

**è´Ÿè½½å‡è¡¡ç®—æ³•**ï¼š

| ç®—æ³•                     | å®šä¹‰             | ç‰¹ç‚¹              | åº”ç”¨åœºæ™¯   |
| ------------------------ | ---------------- | ----------------- | ---------- |
| **Round Robin**          | è½®è¯¢             | ç®€å•              | æ— çŠ¶æ€æœåŠ¡ |
| **Least Connections**    | æœ€å°‘è¿æ¥         | å‡è¡¡è´Ÿè½½          | é•¿è¿æ¥æœåŠ¡ |
| **IP Hash**              | IP å“ˆå¸Œ          | ä¼šè¯ä¿æŒ          | æœ‰çŠ¶æ€æœåŠ¡ |
| **Weighted Round Robin** | åŠ æƒè½®è¯¢         | æ€§èƒ½å·®å¼‚          | å¼‚æ„èŠ‚ç‚¹   |
| **Service Mesh LB**      | æœåŠ¡ç½‘æ ¼è´Ÿè½½å‡è¡¡ | ç»Ÿä¸€ç®¡ç†ã€L7 è·¯ç”± | å¾®æœåŠ¡æ¶æ„ |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾è´Ÿè½½å‡è¡¡å‡½æ•°ä¸º $LB(S, A)$ï¼Œå…¶ä¸­ï¼š

- $S$ = æœåŠ¡å™¨é›†åˆ
- $A$ = ç®—æ³•

**Service Mesh è´Ÿè½½å‡è¡¡å¢å¼º**ï¼š

è®¾ Service Mesh è´Ÿè½½å‡è¡¡ä¸º $LB_{SM}(S, A, P)$ï¼Œå…¶ä¸­ï¼š

- $S$ = æœåŠ¡å™¨é›†åˆ
- $A$ = ç®—æ³•ï¼ˆRound Robinã€Least Connectionsã€Consistent Hashing ç­‰ï¼‰
- $P$ = ç­–ç•¥ï¼ˆè·¯ç”±è§„åˆ™ã€ç°åº¦å‘å¸ƒã€ç†”æ–­ç­‰ï¼‰

**è´Ÿè½½å‡è¡¡å®šç† 07.19**ï¼šæ ¹æ®æœåŠ¡ç±»å‹é€‰æ‹©åˆé€‚çš„è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œæ— çŠ¶æ€æœåŠ¡é€‰æ‹© Round
Robinï¼Œæœ‰çŠ¶æ€æœåŠ¡é€‰æ‹© IP Hashã€‚

**Service Mesh è´Ÿè½½å‡è¡¡å®šç† 07.19.1**ï¼šService Mesh æä¾›ç»Ÿä¸€çš„è´Ÿè½½å‡è¡¡å’Œæµé‡ç®¡ç†
ï¼Œæ”¯æŒ L4/L7 è´Ÿè½½å‡è¡¡ï¼Œå¢å¼ºè´Ÿè½½å‡è¡¡èƒ½åŠ›ï¼Œå³
$LB_{SM}(S, A, P) = LB(S, A) + TrafficManagement(P)$ã€‚

### 07.6.4 æœåŠ¡å‘ç°

**æœåŠ¡å‘ç°æœºåˆ¶**ï¼š

| æœºåˆ¶                   | å®šä¹‰             | ç‰¹ç‚¹       | åº”ç”¨åœºæ™¯     |
| ---------------------- | ---------------- | ---------- | ------------ |
| **DNS**                | åŸŸåè§£æ         | ç®€å•       | æ ‡å‡†æœåŠ¡å‘ç° |
| **Consul**             | åˆ†å¸ƒå¼æœåŠ¡å‘ç°   | é«˜å¯ç”¨     | å¤§è§„æ¨¡é›†ç¾¤   |
| **etcd**               | é”®å€¼å­˜å‚¨         | å¼ºä¸€è‡´     | Kubernetes   |
| **Kubernetes Service** | æœåŠ¡æŠ½è±¡         | å†…ç½®       | Kubernetes   |
| **Service Mesh**       | æœåŠ¡ç½‘æ ¼æœåŠ¡å‘ç° | è‡ªåŠ¨ã€é€æ˜ | å¾®æœåŠ¡æ¶æ„   |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾æœåŠ¡å‘ç°ä¸º $SD = \{DNS, Consul, etcd, K8s Service, ServiceMesh\}$ã€‚

**æœåŠ¡å‘ç°å®šç† 07.20**ï¼šKubernetes ä½¿ç”¨ Service å®ç°æœåŠ¡å‘ç°ï¼Œé€šè¿‡ DNS æˆ–ç¯å¢ƒå˜
é‡æš´éœ²æœåŠ¡ã€‚

**Service Mesh æœåŠ¡å‘ç°å®šç† 07.20.1**ï¼šService Mesh è‡ªåŠ¨å‘ç°å’Œæ³¨å†ŒæœåŠ¡ï¼Œæä¾›é€æ˜
çš„æœåŠ¡å‘ç°ï¼Œå³ $SD_{SM} = SD_{K8s} + AutoDiscovery + TransparentProxy$ã€‚

## 07.7 å½¢å¼åŒ–æ¨¡å‹

### 07.7.1 çŠ¶æ€æœºæ¨¡å‹

**çŠ¶æ€æœºå®šä¹‰**ï¼šç³»ç»ŸçŠ¶æ€å’ŒçŠ¶æ€è½¬æ¢çš„æ•°å­¦æ¨¡å‹ã€‚

**Pod çŠ¶æ€æœº**ï¼š

```mermaid
stateDiagram-v2
    [*] --> Pending
    Pending --> Running
    Running --> Succeeded
    Running --> Failed
    Succeeded --> [*]
    Failed --> [*]
    Running --> Terminating
    Terminating --> [*]
```

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾çŠ¶æ€æœºä¸º $SM = \{S, E, T, I, F\}$ï¼Œå…¶ä¸­ï¼š

- $S$ = çŠ¶æ€é›†åˆï¼ˆStatesï¼‰
- $E$ = äº‹ä»¶é›†åˆï¼ˆEventsï¼‰
- $T$ = è½¬æ¢å‡½æ•°ï¼ˆTransitionsï¼‰
- $I$ = åˆå§‹çŠ¶æ€ï¼ˆInitial Stateï¼‰
- $F$ = ç»ˆæ­¢çŠ¶æ€ï¼ˆFinal Statesï¼‰

**çŠ¶æ€æœºå®šç† 07.21**ï¼šKubernetes Pod ç”Ÿå‘½å‘¨æœŸå¯ä»¥ç”¨æœ‰é™çŠ¶æ€æœºå»ºæ¨¡ã€‚

### 07.7.2 äº‹ä»¶é©±åŠ¨æ¨¡å‹

**äº‹ä»¶é©±åŠ¨å®šä¹‰**ï¼šç³»ç»Ÿé€šè¿‡äº‹ä»¶è§¦å‘çŠ¶æ€å˜æ›´ã€‚

**äº‹ä»¶é©±åŠ¨æ¨¡å‹**ï¼š

| äº‹ä»¶              | è§¦å‘               | å¤„ç†            | ç»“æœ           |
| ----------------- | ------------------ | --------------- | -------------- |
| **Pod Created**   | API åˆ›å»º Pod       | Scheduler è°ƒåº¦  | Pod è°ƒåº¦åˆ°èŠ‚ç‚¹ |
| **Pod Scheduled** | Scheduler è°ƒåº¦å®Œæˆ | Kubelet å¯åŠ¨    | Pod å¯åŠ¨       |
| **Pod Running**   | Pod è¿è¡Œ           | Controller ç›‘æ§ | çŠ¶æ€åŒæ­¥       |
| **Pod Failed**    | Pod å¤±è´¥           | Controller é‡å¯ | Pod é‡å¯       |

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾äº‹ä»¶é©±åŠ¨ä¸º $ED = \{E, H, R\}$ï¼Œå…¶ä¸­ï¼š

- $E$ = äº‹ä»¶é›†åˆï¼ˆEventsï¼‰
- $H$ = å¤„ç†å‡½æ•°ï¼ˆHandlersï¼‰
- $R$ = å“åº”ï¼ˆResponsesï¼‰

**äº‹ä»¶é©±åŠ¨å®šç† 07.22**ï¼šKubernetes é‡‡ç”¨äº‹ä»¶é©±åŠ¨æ¶æ„ï¼Œé€šè¿‡ Controller ç›‘å¬äº‹ä»¶å¹¶
å¤„ç†ã€‚

### 07.7.3 æ§åˆ¶ç†è®ºæ¨¡å‹

**æ§åˆ¶ç†è®ºå®šä¹‰**ï¼šé€šè¿‡åé¦ˆæ§åˆ¶å®ç°ç³»ç»Ÿç¨³å®šã€‚

**æ§åˆ¶å¾ªç¯æ¨¡å‹**ï¼š

$$\text{Error}(t) = \text{Desired}(t) - \text{Actual}(t)$$

$$\text{Action}(t) = K \cdot \text{Error}(t)$$

$$\text{Actual}(t+1) = \text{System}(\text{Action}(t))$$

å…¶ä¸­ï¼š

- $K$ = æ§åˆ¶å¢ç›Š
- $\text{Desired}$ = æœŸæœ›çŠ¶æ€
- $\text{Actual}$ = å®é™…çŠ¶æ€

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾æ§åˆ¶å¾ªç¯ä¸º $CL = \{D, A, E, K\}$ï¼Œå…¶ä¸­ï¼š

- $D$ = æœŸæœ›çŠ¶æ€ï¼ˆDesiredï¼‰
- $A$ = å®é™…çŠ¶æ€ï¼ˆActualï¼‰
- $E$ = è¯¯å·®ï¼ˆErrorï¼‰
- $K$ = æ§åˆ¶å¢ç›Šï¼ˆGainï¼‰

**æ§åˆ¶ç†è®ºå®šç† 07.23**ï¼šKubernetes Controller å®ç°æ§åˆ¶å¾ªç¯ï¼Œé€šè¿‡ Reconcile å‡½æ•°
å‡å°è¯¯å·®ã€‚

### 07.7.4 å›¾è®ºæ¨¡å‹

**å›¾è®ºå®šä¹‰**ï¼šç³»ç»Ÿç»„ä»¶å’Œå…³ç³»å¯ä»¥ç”¨å›¾æ¨¡å‹è¡¨ç¤ºã€‚

**ç³»ç»Ÿä¾èµ–å›¾**ï¼š

```mermaid
graph TB
    A[API Server] --> B[etcd]
    A --> C[Controller Manager]
    A --> D[Scheduler]
    C --> B
    D --> B
    E[Kubelet] --> A
    E --> F[CRI]
    F --> G[Runtime]
```

**å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾ç³»ç»Ÿå›¾ä¸º $G = (V, E)$ï¼Œå…¶ä¸­ï¼š

- $V$ = ç»„ä»¶é›†åˆï¼ˆVerticesï¼‰
- $E$ = ä¾èµ–å…³ç³»ï¼ˆEdgesï¼‰

**å›¾è®ºå®šç† 07.24**ï¼šKubernetes ç³»ç»Ÿæ¶æ„å¯ä»¥ç”¨æœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰å»ºæ¨¡ï¼Œç»„ä»¶ä¾èµ–å…³ç³»
æ¸…æ™°ã€‚

## 07.8 è™šæ‹ŸåŒ–å±‚æ¬¡çš„å½¢å¼åŒ–ç†è®º

æœ¬æ–‡æ¡£ä»å½¢å¼åŒ–ç†è®ºè§’åº¦æ·±å…¥åˆ†æè™šæ‹ŸåŒ–ã€åŠè™šæ‹ŸåŒ–ã€å®¹å™¨åŒ–ã€æ²™ç›’åŒ–å››ä¸ªæŠ€æœ¯èŒƒå¼ï¼ŒåŸºäº
Popek-Goldberg å®šç†ã€æ¨¡å‹è®ºã€è¯æ˜è®ºç­‰ç†è®ºåŸºç¡€ï¼Œæä¾›ä¸¥æ ¼çš„å½¢å¼åŒ–å»ºæ¨¡å’Œè¯æ˜ã€‚

### 07.8.1 Popek-Goldberg è™šæ‹ŸåŒ–å®šç†

**Popek-Goldberg å®šç†**ï¼ˆ1974 å¹´ï¼‰ï¼šæ ¹æ® Wikipediaï¼ŒPopek-Goldberg å®šç†ï¼ˆPopek
and Goldberg virtualization theoremï¼‰å®šä¹‰äº†è™šæ‹Ÿæœºç›‘è§†å™¨ï¼ˆVMMï¼‰çš„å……åˆ†å¿…è¦æ¡ä»¶ï¼Œä¸º
åˆ¤æ–­è®¡ç®—æœºä½“ç³»ç»“æ„æ˜¯å¦å¯è¢«æœ‰æ•ˆè™šæ‹ŸåŒ–æä¾›äº†ç†è®ºåŸºç¡€ã€‚

**Wikipedia å®šä¹‰å‚è€ƒ**ï¼ˆas of 2025-11-02ï¼‰ï¼š

> "The Popek and Goldberg virtualization theorem is a result about the formal
> requirements for a computer architecture to support virtualization with a
> virtual machine monitor (VMM). The theorem provides necessary and sufficient
> conditions for a VMM to trap all sensitive instructions."

**å®šç†å†…å®¹**ï¼š

è®¾è®¡ç®—æœºä½“ç³»ç»“æ„ä¸º $\mathcal{A} = \{I, R, S\}$ï¼Œå…¶ä¸­ï¼š

- $I$ = æŒ‡ä»¤é›†åˆï¼ˆInstruction Setï¼‰
- $R$ = å¯„å­˜å™¨é›†åˆï¼ˆRegister Setï¼‰
- $S$ = çŠ¶æ€é›†åˆï¼ˆState Setï¼‰

**æ•æ„ŸæŒ‡ä»¤åˆ†ç±»**ï¼š

1. **æ§åˆ¶æ•æ„ŸæŒ‡ä»¤ï¼ˆControl Sensitive Instructionsï¼‰**ï¼š$I_{\text{control}}$ï¼Œä¿®
   æ”¹ç‰¹æƒçŠ¶æ€çš„æŒ‡ä»¤
2. **è¡Œä¸ºæ•æ„ŸæŒ‡ä»¤ï¼ˆBehavior Sensitive Instructionsï¼‰**ï¼š$I_{\text{behavior}}$ï¼Œ
   è¡Œä¸ºå–å†³äºç‰¹æƒçŠ¶æ€çš„æŒ‡ä»¤
3. **ç‰¹æƒæŒ‡ä»¤ï¼ˆPrivileged Instructionsï¼‰**ï¼š$I_{\text{privileged}}$ï¼Œåªèƒ½åœ¨ç‰¹æƒ
   æ¨¡å¼ä¸‹æ‰§è¡Œçš„æŒ‡ä»¤

**è™šæ‹ŸåŒ–å……åˆ†å¿…è¦æ¡ä»¶**ï¼š

$$\text{Virtualizable}(\mathcal{A}) \Leftrightarrow I_{\text{sensitive}} \subseteq I_{\text{privileged}}$$

å…¶ä¸­ $I_{\text{sensitive}} = I_{\text{control}} \cup I_{\text{behavior}}$ è¡¨ç¤ºæ•
æ„ŸæŒ‡ä»¤é›†åˆã€‚

**è™šæ‹ŸåŒ–å®šç† 07.25**ï¼ˆPopek-Goldbergï¼‰ï¼šè®¡ç®—æœºä½“ç³»ç»“æ„ $\mathcal{A}$ å¯è¢«æœ‰æ•ˆè™š
æ‹ŸåŒ–ï¼Œå½“ä¸”ä»…å½“æ‰€æœ‰æ•æ„ŸæŒ‡ä»¤éƒ½æ˜¯ç‰¹æƒæŒ‡ä»¤ã€‚

**è¯æ˜**ï¼š

- **å¿…è¦æ€§ï¼ˆ$\Rightarrow$ï¼‰**ï¼šå¦‚æœ $\mathcal{A}$ å¯è¢«è™šæ‹ŸåŒ–ï¼Œåˆ™ VMM å¿…é¡»èƒ½å¤Ÿæ•
  è·æ‰€æœ‰æ•æ„ŸæŒ‡ä»¤ã€‚å¦‚æœæ•æ„ŸæŒ‡ä»¤ä¸æ˜¯ç‰¹æƒæŒ‡ä»¤ï¼ŒGuest OS å¯ä»¥åœ¨ç”¨æˆ·æ¨¡å¼ä¸‹æ‰§è¡Œè¿™äº›æŒ‡
  ä»¤ï¼ŒVMM æ— æ³•æ‹¦æˆªï¼Œå¯¼è‡´è™šæ‹ŸåŒ–å¤±è´¥ã€‚
- **å……åˆ†æ€§ï¼ˆ$\Leftarrow$ï¼‰**ï¼šå¦‚æœæ‰€æœ‰æ•æ„ŸæŒ‡ä»¤éƒ½æ˜¯ç‰¹æƒæŒ‡ä»¤ï¼Œå½“ Guest OS æ‰§è¡Œè¿™äº›
  æŒ‡ä»¤æ—¶ï¼Œä¼šäº§ç”Ÿé™·é˜±ï¼ˆTrapï¼‰ï¼ŒVMM å¯ä»¥æ•è·å¹¶æ¨¡æ‹Ÿè¿™äº›æŒ‡ä»¤ï¼Œå®ç°è™šæ‹ŸåŒ–ã€‚

$\square$

**ç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–**ï¼š

å¯¹äºä¸æ»¡è¶³ Popek-Goldberg æ¡ä»¶çš„ä½“ç³»ç»“æ„ï¼ˆå¦‚ x86ï¼‰ï¼Œå¯ä»¥é€šè¿‡ç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–
ï¼ˆIntel VT-xã€AMD-Vï¼‰æ¥æ»¡è¶³è™šæ‹ŸåŒ–æ¡ä»¶ï¼š

$$\text{Virtualizable}_{\text{HW}}(\mathcal{A}) = \text{Virtualizable}(\mathcal{A}) \cup \text{HW\_Support}(\mathcal{A})$$

å…¶ä¸­ $\text{HW\_Support}(\mathcal{A})$ è¡¨ç¤ºç¡¬ä»¶è™šæ‹ŸåŒ–æ”¯æŒ
ï¼ˆVT-xã€AMD-Vã€EPT/NPTã€IOMMUï¼‰ã€‚

### 07.8.2 è™šæ‹ŸåŒ–ï¼ˆå…¨è™šæ‹ŸåŒ–ï¼‰å½¢å¼åŒ–æ¨¡å‹

**å…¨è™šæ‹ŸåŒ–å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾å…¨è™šæ‹ŸåŒ–ç³»ç»Ÿä¸º $\mathcal{V}_{\text{Full}} = \{H, G, P\}$ï¼Œå…¶ä¸­ï¼š

- $H$ = Hypervisorï¼ˆè™šæ‹Ÿæœºç›‘è§†å™¨ï¼‰
- $G$ = Guest OS é›†åˆï¼ˆ$\{G_1, G_2, \ldots, G_n\}$ï¼‰
- $P$ = ç‰©ç†ç¡¬ä»¶èµ„æº

**Hypervisor å½¢å¼åŒ–å®šä¹‰**ï¼š

$$\text{H}: P \rightarrow \{G_1, G_2, \ldots, G_n\}$$

Hypervisor $H$ å°†ç‰©ç†ç¡¬ä»¶èµ„æº $P$ æ˜ å°„åˆ°å¤šä¸ª Guest OS $G_i$ã€‚

**èµ„æºåˆ†é…å‡½æ•°**ï¼š

è®¾èµ„æºåˆ†é…å‡½æ•°ä¸º
$f_H: P \times \{G_1, G_2, \ldots, G_n\} \rightarrow \mathbb{R}^+$ï¼Œåˆ™ï¼š

$$f_H(p, G_i) = r_i$$

å…¶ä¸­ $r_i$ è¡¨ç¤ºåˆ†é…ç»™ Guest OS $G_i$ çš„èµ„æºé‡ã€‚

**èµ„æºçº¦æŸ**ï¼š

$$\sum_{i=1}^{n} f_H(p, G_i) \leq |P|$$

å³æ‰€æœ‰ Guest OS åˆ†é…çš„èµ„æºæ€»å’Œä¸è¶…è¿‡ç‰©ç†èµ„æºæ€»é‡ã€‚

**ç­‰ä»·æ€§ï¼ˆEquivalenceï¼‰å®šç† 07.26**ï¼š

æ ¹æ® Popek-Goldberg å®šç†ï¼Œåœ¨ Hypervisor ä¸‹è¿è¡Œçš„ç¨‹åº $P$ çš„è¡Œä¸ºåº”ä¸ç›´æ¥è¿è¡Œåœ¨ç‰©
ç†ç¡¬ä»¶ä¸Šçš„ç›¸åŒç¨‹åº $P$ å®Œå…¨ä¸€è‡´ï¼š

$$\forall P, \quad \text{Behavior}(P \mid H) = \text{Behavior}(P \mid P_{\text{physical}})$$

å…¶ä¸­ $\text{Behavior}(P \mid X)$ è¡¨ç¤ºç¨‹åº $P$ åœ¨ç¯å¢ƒ $X$ ä¸‹çš„è¡Œä¸ºã€‚

**èµ„æºæ§åˆ¶ï¼ˆResource Controlï¼‰å®šç† 07.27**ï¼š

Hypervisor å¯¹æ‰€æœ‰è™šæ‹Ÿèµ„æºè¿›è¡Œå®Œå…¨æ§åˆ¶ï¼š

$$\forall G_i, \forall r \in \text{Resources}(G_i), \quad \text{Control}(H, r) = \text{True}$$

å…¶ä¸­ $\text{Control}(H, r)$ è¡¨ç¤º Hypervisor $H$ å¯¹èµ„æº $r$ çš„æ§åˆ¶ã€‚

**æ•ˆç‡æ€§ï¼ˆEfficiencyï¼‰å®šç† 07.28**ï¼š

å¤§éƒ¨åˆ†æŒ‡ä»¤åº”åœ¨æ²¡æœ‰ Hypervisor å¹²é¢„çš„æƒ…å†µä¸‹ç›´æ¥åœ¨ç¡¬ä»¶ä¸Šæ‰§è¡Œï¼š

$$\text{Efficiency} = \frac{|\text{Direct\_Execution}|}{|\text{Total\_Instructions}|} \approx 1$$

å…¶ä¸­ $\text{Direct\_Execution}$ è¡¨ç¤ºç›´æ¥æ‰§è¡Œçš„æŒ‡ä»¤é›†åˆã€‚

**å…¨è™šæ‹ŸåŒ–çŠ¶æ€æœºæ¨¡å‹**ï¼š

è®¾å…¨è™šæ‹ŸåŒ–ç³»ç»ŸçŠ¶æ€ä¸º $S_{\text{VM}} = \{S_H, S_G, S_P\}$ï¼Œå…¶ä¸­ï¼š

- $S_H$ = Hypervisor çŠ¶æ€
- $S_G$ = Guest OS çŠ¶æ€é›†åˆ
- $S_P$ = ç‰©ç†ç¡¬ä»¶çŠ¶æ€

**çŠ¶æ€è½¬æ¢å‡½æ•°**ï¼š

$$\delta_{\text{VM}}: S_{\text{VM}} \times I \rightarrow S_{\text{VM}}$$

å…¶ä¸­ $I$ è¡¨ç¤ºæŒ‡ä»¤é›†åˆã€‚

**æŒ‡ä»¤æ‰§è¡Œè·¯å¾„**ï¼š

1. **ç‰¹æƒæŒ‡ä»¤**ï¼š$I_{\text{privileged}}$ â†’ é™·é˜±ï¼ˆTrapï¼‰â†’ Hypervisor æ¨¡æ‹Ÿ â†’ çŠ¶æ€
   æ›´æ–°
2. **éç‰¹æƒæŒ‡ä»¤**ï¼š$I_{\text{non-privileged}}$ â†’ ç›´æ¥æ‰§è¡Œ â†’ ç¡¬ä»¶æ‰§è¡Œ

**å½¢å¼åŒ–è¡¨ç¤º**ï¼š

$$
\delta_{\text{VM}}(s, i) = \begin{cases}
\text{Hypervisor\_Emulate}(s, i) & \text{if } i \in I_{\text{privileged}} \\
\text{Hardware\_Execute}(s, i) & \text{if } i \notin I_{\text{privileged}}
\end{cases}
$$

**å…¨è™šæ‹ŸåŒ–æ•°å­¦æ¨¡å‹**ï¼š

**CPU åˆ©ç”¨ç‡æ¨¡å‹**ï¼š

$$\text{CPU}_{\text{utilization}} = \frac{C_{\text{workload}}}{C_{\text{VM}}} = \frac{C_{\text{workload}}}{C_{\text{workload}} + C_{\text{guest\_os}} + C_{\text{hypervisor}} + C_{\text{vm\_exit}}}$$

å…¶ä¸­ï¼š

- $C_{\text{workload}}$ï¼šå·¥ä½œè´Ÿè½½ CPU å¼€é”€
- $C_{\text{guest\_os}}$ï¼šGuest OS CPU å¼€é”€
- $C_{\text{hypervisor}}$ï¼šHypervisor CPU å¼€é”€
- $C_{\text{vm\_exit}}$ï¼šVM Exit å¼€é”€ï¼ˆæ¯æ¬¡çº¦ 1000-5000 CPU cyclesï¼‰

**å†…å­˜å¼€é”€æ¨¡å‹**ï¼š

$$M_{\text{VM}} = M_{\text{guest\_os}} + M_{\text{workload}} + M_{\text{hypervisor}}$$

**æ€§èƒ½æŸå¤±æ¨¡å‹**ï¼š

$$\text{Performance\_Loss} = 1 - \frac{\text{Performance}_{\text{VM}}}{\text{Performance}_{\text{Native}}} = \frac{C_{\text{hypervisor}} + C_{\text{vm\_exit}} + C_{\text{emulation}}}{C_{\text{total}}} \approx 10-30\%$$

### 07.8.3 åŠè™šæ‹ŸåŒ–å½¢å¼åŒ–æ¨¡å‹

**åŠè™šæ‹ŸåŒ–å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾åŠè™šæ‹ŸåŒ–ç³»ç»Ÿä¸º $\mathcal{V}_{\text{PV}} = \{H, G_{\text{modified}}, P, C\}$ï¼Œ
å…¶ä¸­ï¼š

- $H$ = Hypervisor
- $G_{\text{modified}}$ = ä¿®æ”¹åçš„ Guest OS é›†åˆ
- $P$ = ç‰©ç†ç¡¬ä»¶èµ„æº
- $C$ = åä½œæ¥å£é›†åˆ
  ï¼ˆ$\{\text{Hypercall}, \text{VirtIO}, \text{Grant Table}, \text{Event Channel}\}$ï¼‰

**åä½œæ¥å£å½¢å¼åŒ–å®šä¹‰**ï¼š

$$\text{Hypercall}: G_{\text{modified}} \rightarrow H$$

Hypercall æ¥å£å…è®¸ä¿®æ”¹åçš„ Guest OS ç›´æ¥è°ƒç”¨ Hypervisor æ¥å£ã€‚

**åä½œæ¥å£æ˜ å°„**ï¼š

$$f_{\text{collaboration}}: G_{\text{modified}} \times H \rightarrow \mathbb{R}$$

å…¶ä¸­ $f_{\text{collaboration}}(g, h)$ è¡¨ç¤º Guest OS $g$ ä¸ Hypervisor $h$ çš„åä½œ
æ•ˆç‡ã€‚

**åä½œæ•ˆç‡å®šç† 07.29**ï¼š

åŠè™šæ‹ŸåŒ–é€šè¿‡åä½œæœºåˆ¶æé«˜æ€§èƒ½ï¼š

$$\text{Efficiency}_{\text{PV}} = \frac{|\text{Direct\_Execution}| + |\text{Hypercall}|}{|\text{Total\_Instructions}|} > \text{Efficiency}_{\text{Full}}$$

å…¶ä¸­ $|\text{Hypercall}|$ è¡¨ç¤ºé€šè¿‡ Hypercall åä½œæ‰§è¡Œçš„æŒ‡ä»¤æ•°é‡ã€‚

**åŠè™šæ‹ŸåŒ–çŠ¶æ€æœºæ¨¡å‹**ï¼š

è®¾åŠè™šæ‹ŸåŒ–ç³»ç»ŸçŠ¶æ€ä¸º
$S_{\text{PV}} = \{S_H, S_{G_{\text{modified}}}, S_P, S_C\}$ï¼Œå…¶ä¸­ï¼š

- $S_C$ = åä½œæ¥å£çŠ¶æ€ï¼ˆHypercallã€VirtIOã€Grant Tableã€Event Channelï¼‰

**çŠ¶æ€è½¬æ¢å‡½æ•°**ï¼š

$$\delta_{\text{PV}}: S_{\text{PV}} \times I \rightarrow S_{\text{PV}}$$

**æŒ‡ä»¤æ‰§è¡Œè·¯å¾„**ï¼š

1. **Hypercall æŒ‡ä»¤**ï¼š$I_{\text{hypercall}}$ â†’ Guest OS ç›´æ¥è°ƒç”¨ â†’ Hypervisor
   å¤„ç† â†’ çŠ¶æ€æ›´æ–°
2. **ç‰¹æƒæŒ‡ä»¤**ï¼š$I_{\text{privileged}}$ â†’ é™·é˜± â†’ Hypervisor å¤„ç† â†’ çŠ¶æ€æ›´æ–°
3. **éç‰¹æƒæŒ‡ä»¤**ï¼š$I_{\text{non-privileged}}$ â†’ ç›´æ¥æ‰§è¡Œ â†’ ç¡¬ä»¶æ‰§è¡Œ

**å½¢å¼åŒ–è¡¨ç¤º**ï¼š

$$
\delta_{\text{PV}}(s, i) = \begin{cases}
\text{Hypercall\_Execute}(s, i) & \text{if } i \in I_{\text{hypercall}} \\
\text{Hypervisor\_Emulate}(s, i) & \text{if } i \in I_{\text{privileged}} \setminus I_{\text{hypercall}} \\
\text{Hardware\_Execute}(s, i) & \text{if } i \notin I_{\text{privileged}}
\end{cases}
$$

**åŠè™šæ‹ŸåŒ–æ•°å­¦æ¨¡å‹**ï¼š

**CPU åˆ©ç”¨ç‡æ¨¡å‹**ï¼š

$$\text{CPU}_{\text{utilization}} = \frac{C_{\text{workload}}}{C_{\text{workload}} + C_{\text{guest\_os}} + C_{\text{hypervisor}} + C_{\text{hypercall}} + C_{\text{collaboration}}}$$

å…¶ä¸­ï¼š

- $C_{\text{hypercall}}$ï¼šHypercall å¼€é”€ï¼ˆæ¯æ¬¡çº¦ 50-200 CPU cyclesï¼Œæ¯” VM Exit
  å°‘ 80-95%ï¼‰
- $C_{\text{collaboration}}$ï¼šåä½œæœºåˆ¶å¼€é”€ï¼ˆVirtIOã€Grant Table ç­‰ï¼‰

**æ€§èƒ½æå‡æ¨¡å‹**ï¼š

$$\text{Performance\_Gain} = \frac{C_{\text{vm\_exit}} - C_{\text{hypercall}}}{C_{\text{vm\_exit}}} \approx 80-95\%$$

å³é€šè¿‡ Hypercall å‡å°‘ VM Exitï¼Œæ€§èƒ½æå‡ 80-95%ã€‚

**å†…å­˜å¼€é”€æ¨¡å‹**ï¼š

$$M_{\text{PV}} = M_{\text{guest\_os}} + M_{\text{workload}} + M_{\text{hypervisor}} + M_{\text{grant\_table}}$$

å…¶ä¸­ $M_{\text{grant\_table}}$ è¡¨ç¤º Grant Table å†…å­˜å¼€é”€ï¼ˆé€šå¸¸ < 10MBï¼‰ã€‚

**æ€§èƒ½æŸå¤±æ¨¡å‹**ï¼š

$$\text{Performance\_Loss} = \frac{C_{\text{hypervisor}} + C_{\text{hypercall}} + C_{\text{collaboration}}}{C_{\text{total}}} \approx 5-15\%$$

ç›¸æ¯”å…¨è™šæ‹ŸåŒ–ï¼ˆ10-30%ï¼‰æ€§èƒ½æŸå¤±å‡å°‘ 50-70%ã€‚

**åä½œæ¥å£å®‰å…¨æ€§å®šç† 07.30**ï¼š

åŠè™šæ‹ŸåŒ–çš„åä½œæ¥å£å¢åŠ äº†æ”»å‡»é¢ï¼š

$$\text{Attack\_Surface}_{\text{PV}} = \text{Attack\_Surface}_{\text{Full}} + \text{Attack\_Surface}_{\text{Collaboration}}$$

å…¶ä¸­
$\text{Attack\_Surface}_{\text{Collaboration}} = \{\text{Hypercallæ¼æ´}, \text{VirtIOæ¼æ´}, \text{Grant Tableæ¼æ´}, \text{Event Channelæ¼æ´}\}$ã€‚

### 07.8.4 å®¹å™¨åŒ–å½¢å¼åŒ–æ¨¡å‹

**å®¹å™¨åŒ–å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾å®¹å™¨åŒ–ç³»ç»Ÿä¸º $\mathcal{V}_{\text{Container}} = \{K, C, P\}$ï¼Œå…¶ä¸­ï¼š

- $K$ = Host OS å†…æ ¸ï¼ˆKernelï¼‰
- $C$ = å®¹å™¨é›†åˆï¼ˆ$\{C_1, C_2, \ldots, C_n\}$ï¼‰
- $P$ = ç‰©ç†ç¡¬ä»¶èµ„æºï¼ˆå…±äº«ï¼‰

**Namespace å½¢å¼åŒ–å®šä¹‰**ï¼š

$$\text{Namespace}: K \times C_i \rightarrow V_i$$

å…¶ä¸­ $V_i$ è¡¨ç¤ºå®¹å™¨ $C_i$ çš„è™šæ‹Ÿè§†å›¾ï¼ˆVirtual Viewï¼‰ã€‚

**Namespace ç±»å‹**ï¼š

- $\text{NS}_{\text{PID}}: K \times C_i \rightarrow \text{PID\_Namespace}_i$ï¼ˆPID
  å‘½åç©ºé—´ï¼‰
- $\text{NS}_{\text{Network}}: K \times C_i \rightarrow \text{Network\_Namespace}_i$ï¼ˆ
  ç½‘ç»œå‘½åç©ºé—´ï¼‰
- $\text{NS}_{\text{Mount}}: K \times C_i \rightarrow \text{Mount\_Namespace}_i$ï¼ˆ
  æŒ‚è½½å‘½åç©ºé—´ï¼‰
- $\text{NS}_{\text{IPC}}: K \times C_i \rightarrow \text{IPC\_Namespace}_i$ï¼ˆIPC
  å‘½åç©ºé—´ï¼‰
- $\text{NS}_{\text{UTS}}: K \times C_i \rightarrow \text{UTS\_Namespace}_i$ï¼ˆUTS
  å‘½åç©ºé—´ï¼‰
- $\text{NS}_{\text{User}}: K \times C_i \rightarrow \text{User\_Namespace}_i$ï¼ˆ
  ç”¨æˆ·å‘½åç©ºé—´ï¼‰
- $\text{NS}_{\text{Cgroup}}: K \times C_i \rightarrow \text{Cgroup\_Namespace}_i$ï¼ˆCgroup
  å‘½åç©ºé—´ï¼‰
- $\text{NS}_{\text{Time}}: K \times C_i \rightarrow \text{Time\_Namespace}_i$ï¼ˆ
  æ—¶é—´å‘½åç©ºé—´ï¼‰

**Cgroup å½¢å¼åŒ–å®šä¹‰**ï¼š

$$\text{Cgroup}: K \times C_i \rightarrow R_i$$

å…¶ä¸­ $R_i$ è¡¨ç¤ºå®¹å™¨ $C_i$ çš„èµ„æºé™åˆ¶é›†åˆã€‚

**èµ„æºé™åˆ¶å‡½æ•°**ï¼š

$$f_{\text{cgroup}}: C_i \times \text{Resource} \rightarrow \mathbb{R}^+$$

å…¶ä¸­
$\text{Resource} \in \{\text{CPU}, \text{Memory}, \text{IO}, \text{Network}\}$ã€‚

**å®¹å™¨åŒ–éš”ç¦»å®šç† 07.31**ï¼š

å®¹å™¨åŒ–é€šè¿‡ Namespace å’Œ Cgroup å®ç°è¿›ç¨‹çº§éš”ç¦»ï¼š

$$\forall C_i, C_j (i \neq j), \quad \text{Isolation}(C_i, C_j) = \text{True}$$

å…¶ä¸­ $\text{Isolation}(C_i, C_j)$ è¡¨ç¤ºå®¹å™¨ $C_i$ å’Œ $C_j$ ä¹‹é—´çš„éš”ç¦»ã€‚

**éš”ç¦»æ¡ä»¶**ï¼š

$$\text{Isolation}(C_i, C_j) \Leftrightarrow \forall \text{NS} \in \{\text{PID}, \text{Network}, \text{Mount}, \ldots\}, \quad V_i \cap V_j = \emptyset$$

å³æ‰€æœ‰å‘½åç©ºé—´çš„è™šæ‹Ÿè§†å›¾äº’ä¸ç›¸äº¤ã€‚

**å®¹å™¨åŒ–çŠ¶æ€æœºæ¨¡å‹**ï¼š

è®¾å®¹å™¨åŒ–ç³»ç»ŸçŠ¶æ€ä¸º $S_{\text{Container}} = \{S_K, S_C, S_P\}$ï¼Œå…¶ä¸­ï¼š

- $S_K$ = Host OS å†…æ ¸çŠ¶æ€ï¼ˆå…±äº«ï¼‰
- $S_C$ = å®¹å™¨çŠ¶æ€é›†åˆï¼ˆéš”ç¦»ï¼‰
- $S_P$ = ç‰©ç†ç¡¬ä»¶çŠ¶æ€ï¼ˆå…±äº«ï¼‰

**çŠ¶æ€è½¬æ¢å‡½æ•°**ï¼š

$$\delta_{\text{Container}}: S_{\text{Container}} \times I \rightarrow S_{\text{Container}}$$

**ç³»ç»Ÿè°ƒç”¨æ‹¦æˆª**ï¼š

$$
\delta_{\text{Container}}(s, \text{syscall}) = \begin{cases}
\text{Namespace\_Filter}(s, \text{syscall}) & \text{if syscall affects namespace} \\
\text{Cgroup\_Limit}(s, \text{syscall}) & \text{if syscall affects resource} \\
\text{Kernel\_Execute}(s, \text{syscall}) & \text{otherwise}
\end{cases}
$$

**å®¹å™¨åŒ–æ•°å­¦æ¨¡å‹**ï¼š

**CPU åˆ©ç”¨ç‡æ¨¡å‹**ï¼š

$$\text{CPU}_{\text{utilization}} = \frac{C_{\text{workload}}}{C_{\text{workload}} + C_{\text{namespace}} + C_{\text{cgroup}} + C_{\text{context\_switch}}}$$

å…¶ä¸­ï¼š

- $C_{\text{namespace}}$ï¼šNamespace å¼€é”€ï¼ˆé€šå¸¸ < 10 CPU cyclesï¼‰
- $C_{\text{cgroup}}$ï¼šCgroup å¼€é”€ï¼ˆé€šå¸¸ < 50 CPU cyclesï¼‰
- $C_{\text{context\_switch}}$ï¼šä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼ˆé€šå¸¸çº¦ 500 CPU cyclesï¼‰

**å†…å­˜å¼€é”€æ¨¡å‹**ï¼š

$$M_{\text{Container}} = M_{\text{workload}} + M_{\text{namespace}} + M_{\text{runtime}}$$

å…¶ä¸­ $M_{\text{namespace}}$ é€šå¸¸ < 1MBï¼Œ$M_{\text{runtime}}$ é€šå¸¸ < 50MBã€‚

**æ€§èƒ½æŸå¤±æ¨¡å‹**ï¼š

$$\text{Performance\_Loss} = \frac{C_{\text{namespace}} + C_{\text{cgroup}} + C_{\text{context\_switch}}}{C_{\text{total}}} < 5\%$$

### 07.8.5 æ²™ç›’åŒ–å½¢å¼åŒ–æ¨¡å‹

**æ²™ç›’åŒ–å½¢å¼åŒ–å®šä¹‰**ï¼š

è®¾æ²™ç›’åŒ–ç³»ç»Ÿä¸º $\mathcal{V}_{\text{Sandbox}} = \{R, A, K, P\}$ï¼Œå…¶ä¸­ï¼š

- $R$ = è¿è¡Œæ—¶ï¼ˆRuntimeï¼Œå¦‚ WasmEdgeï¼‰
- $A$ = åº”ç”¨é›†åˆï¼ˆ$\{A_1, A_2, \ldots, A_n\}$ï¼Œå¦‚ Wasm Moduleï¼‰
- $K$ = Host OS å†…æ ¸ï¼ˆå…±äº«ï¼‰
- $P$ = ç‰©ç†ç¡¬ä»¶èµ„æºï¼ˆå…±äº«ï¼‰

**WASI å½¢å¼åŒ–å®šä¹‰**ï¼š

$$\text{WASI}: A_i \times K \rightarrow \text{Syscall\_Intercept}$$

å…¶ä¸­ $\text{Syscall\_Intercept}$ è¡¨ç¤ºç³»ç»Ÿè°ƒç”¨æ‹¦æˆªå‡½æ•°ã€‚

**ç³»ç»Ÿè°ƒç”¨æ‹¦æˆªå‡½æ•°**ï¼š

$$f_{\text{intercept}}: A_i \times \text{Syscall} \times \text{Permission}_i \rightarrow \text{Syscall\_Result}$$

å…¶ä¸­ $\text{Permission}_i$ è¡¨ç¤ºåº”ç”¨ $A_i$ çš„æƒé™é›†åˆã€‚

**æ²™ç›’åŒ–éš”ç¦»å®šç† 07.32**ï¼š

æ²™ç›’åŒ–é€šè¿‡ç³»ç»Ÿè°ƒç”¨æ‹¦æˆªå’Œæƒé™é™åˆ¶å®ç°åº”ç”¨çº§éš”ç¦»ï¼š

$$\forall A_i, A_j (i \neq j), \quad \text{Isolation}(A_i, A_j) = \text{True}$$

**éš”ç¦»æ¡ä»¶**ï¼š

$$\text{Isolation}(A_i, A_j) \Leftrightarrow \text{Memory}(A_i) \cap \text{Memory}(A_j) = \emptyset \wedge \text{Permission}(A_i) \cap \text{Permission}(A_j) = \emptyset$$

å³åº”ç”¨ $A_i$ å’Œ $A_j$ çš„å†…å­˜å’Œæƒé™äº’ä¸ç›¸äº¤ã€‚

**æ²™ç›’åŒ–çŠ¶æ€æœºæ¨¡å‹**ï¼š

è®¾æ²™ç›’åŒ–ç³»ç»ŸçŠ¶æ€ä¸º $S_{\text{Sandbox}} = \{S_R, S_A, S_K, S_P\}$ï¼Œå…¶ä¸­ï¼š

- $S_R$ = è¿è¡Œæ—¶çŠ¶æ€
- $S_A$ = åº”ç”¨çŠ¶æ€é›†åˆï¼ˆéš”ç¦»ï¼‰
- $S_K$ = Host OS å†…æ ¸çŠ¶æ€ï¼ˆå…±äº«ï¼‰
- $S_P$ = ç‰©ç†ç¡¬ä»¶çŠ¶æ€ï¼ˆå…±äº«ï¼‰

**çŠ¶æ€è½¬æ¢å‡½æ•°**ï¼š

$$\delta_{\text{Sandbox}}: S_{\text{Sandbox}} \times I \rightarrow S_{\text{Sandbox}}$$

**ç³»ç»Ÿè°ƒç”¨æ‹¦æˆªæ¨¡å‹**ï¼š

$$
\delta_{\text{Sandbox}}(s, \text{syscall}) = \begin{cases}
\text{Permission\_Check}(s, \text{syscall}) & \text{if permission denied} \\
\text{Runtime\_Intercept}(s, \text{syscall}) & \text{if allowed} \\
\text{Kernel\_Execute}(s, \text{syscall}) & \text{if pass through}
\end{cases}
$$

**æ²™ç›’åŒ–æ•°å­¦æ¨¡å‹**ï¼š

**CPU åˆ©ç”¨ç‡æ¨¡å‹**ï¼š

$$\text{CPU}_{\text{utilization}} = \frac{C_{\text{workload}}}{C_{\text{workload}} + C_{\text{runtime}} + C_{\text{syscall\_intercept}}}$$

å…¶ä¸­ï¼š

- $C_{\text{runtime}}$ï¼šè¿è¡Œæ—¶å¼€é”€ï¼ˆWasmEdge ç­‰ï¼Œé€šå¸¸çº¦ 5-15 CPU cyclesï¼‰
- $C_{\text{syscall\_intercept}}$ï¼šç³»ç»Ÿè°ƒç”¨æ‹¦æˆªå¼€é”€ï¼ˆé€šå¸¸çº¦ 1-5 CPU cyclesï¼‰

**å†…å­˜å¼€é”€æ¨¡å‹**ï¼š

$$M_{\text{Sandbox}} = M_{\text{workload}} + M_{\text{runtime}}$$

å…¶ä¸­ $M_{\text{runtime}}$ é€šå¸¸ < 2MBï¼ˆWasmEdge ç­‰è½»é‡è¿è¡Œæ—¶ï¼‰ã€‚

**æ€§èƒ½æŸå¤±æ¨¡å‹**ï¼š

$$\text{Performance\_Loss} = \frac{C_{\text{runtime}} + C_{\text{syscall\_intercept}}}{C_{\text{total}}} < 1\%$$

**å¯åŠ¨æ—¶é—´æ¨¡å‹**ï¼š

$$\text{Startup\_Time} = T_{\text{runtime\_init}} + T_{\text{module\_load}} + T_{\text{module\_instantiate}}$$

å…¶ä¸­ï¼š

- $T_{\text{runtime\_init}}$ï¼šè¿è¡Œæ—¶åˆå§‹åŒ–æ—¶é—´ï¼ˆé€šå¸¸ < 1msï¼‰
- $T_{\text{module\_load}}$ï¼šæ¨¡å—åŠ è½½æ—¶é—´ï¼ˆé€šå¸¸ < 1msï¼‰
- $T_{\text{module\_instantiate}}$ï¼šæ¨¡å—å®ä¾‹åŒ–æ—¶é—´ï¼ˆé€šå¸¸ < 1msï¼‰

**æ€»å¯åŠ¨æ—¶é—´**ï¼š$\text{Startup\_Time} < 10\text{ms}$ï¼ˆç›¸æ¯”å®¹å™¨åŒ–çš„ 1-2s å¿«
100-200 å€ï¼‰ã€‚

### 07.8.6 å››å±‚æ¬¡å½¢å¼åŒ–å¯¹æ¯”

**å½¢å¼åŒ–å¯¹æ¯”çŸ©é˜µ**ï¼š

| èŒƒå¼         | å½¢å¼åŒ–ç³»ç»Ÿ                       | çŠ¶æ€ç©ºé—´ç»´åº¦           | éš”ç¦»å‡½æ•°                      | Popek-Goldberg æ¡ä»¶ |
| ------------ | -------------------------------- | ---------------------- | ----------------------------- | ------------------- |
| **è™šæ‹ŸåŒ–**   | $\mathcal{V}_{\text{Full}}$      | $S_{\text{VM}}$        | $\text{Iso}_{\text{HW}}$      | æ»¡è¶³ï¼ˆç¡¬ä»¶è¾…åŠ©ï¼‰    |
| **åŠè™šæ‹ŸåŒ–** | $\mathcal{V}_{\text{PV}}$        | $S_{\text{PV}}$        | $\text{Iso}_{\text{Kernel}}$  | æ»¡è¶³ï¼ˆåä½œï¼‰        |
| **å®¹å™¨åŒ–**   | $\mathcal{V}_{\text{Container}}$ | $S_{\text{Container}}$ | $\text{Iso}_{\text{Process}}$ | ä¸é€‚ç”¨              |
| **æ²™ç›’åŒ–**   | $\mathcal{V}_{\text{Sandbox}}$   | $S_{\text{Sandbox}}$   | $\text{Iso}_{\text{App}}$     | ä¸é€‚ç”¨              |

**éš”ç¦»å¼ºåº¦å½¢å¼åŒ–å¯¹æ¯”**ï¼š

$$I_{\text{VM}} = 4.0 > I_{\text{PV}} = 3.0 > I_{\text{Container}} = 2.0 > I_{\text{Sandbox}} = 1.0$$

å…¶ä¸­éš”ç¦»å¼ºåº¦ $I$ çš„å®šä¹‰è§
[éš”ç¦»æ¨¡å‹æ–‡æ¡£](../10-decision-models/01-theory-models/02-isolation-models.md)ã€‚

**æ€§èƒ½å¼€é”€å½¢å¼åŒ–å¯¹æ¯”**ï¼š

$$\text{Overhead}_{\text{Sandbox}} < \text{Overhead}_{\text{Container}} < \text{Overhead}_{\text{PV}} < \text{Overhead}_{\text{Full}}$$

å…¶ä¸­ï¼š

- $\text{Overhead}_{\text{Full}} \approx 10-30\%$
- $\text{Overhead}_{\text{PV}} \approx 5-15\%$
- $\text{Overhead}_{\text{Container}} < 5\%$
- $\text{Overhead}_{\text{Sandbox}} < 1\%$

**èµ„æºåˆ©ç”¨ç‡å½¢å¼åŒ–å¯¹æ¯”**ï¼š

$$\text{Utilization}_{\text{Sandbox}} > \text{Utilization}_{\text{Container}} > \text{Utilization}_{\text{PV}} > \text{Utilization}_{\text{Full}}$$

å…¶ä¸­ï¼š

- $\text{Utilization}_{\text{Full}} \approx 70-80\%$
- $\text{Utilization}_{\text{PV}} \approx 75-85\%$
- $\text{Utilization}_{\text{Container}} \approx 85-95\%$
- $\text{Utilization}_{\text{Sandbox}} \approx 90-98\%$

**å…¼å®¹æ€§å½¢å¼åŒ–å¯¹æ¯”**ï¼š

$$\text{Compatibility}_{\text{Full}} > \text{Compatibility}_{\text{PV}} > \text{Compatibility}_{\text{Container}} > \text{Compatibility}_{\text{Sandbox}}$$

å…¶ä¸­ï¼š

- $\text{Compatibility}_{\text{Full}}$ï¼šæ”¯æŒæ‰€æœ‰æ“ä½œç³»ç»Ÿï¼ˆæ— éœ€ä¿®æ”¹ï¼‰
- $\text{Compatibility}_{\text{PV}}$ï¼šæ”¯æŒå¯ä¿®æ”¹çš„æ“ä½œç³»ç»Ÿï¼ˆLinuxã€BSD ç­‰ï¼‰
- $\text{Compatibility}_{\text{Container}}$ï¼šæ”¯æŒ Linuxï¼ˆå…±äº«å†…æ ¸ï¼‰
- $\text{Compatibility}_{\text{Sandbox}}$ï¼šæ”¯æŒç‰¹å®šåº”ç”¨ç±»å‹ï¼ˆWasmã€ç‰¹å®šè¿è¡Œæ—¶ï¼‰

**å½¢å¼åŒ–å†³ç­–å®šç† 07.33**ï¼š

è®¾å†³ç­–å‡½æ•°ä¸º
$D: \{\text{Requirements}\} \rightarrow \{\text{Full}, \text{PV}, \text{Container}, \text{Sandbox}\}$ï¼Œ
åˆ™ï¼š

$$
D(\text{requirements}) = \begin{cases}
\text{Full} & \text{if } \text{Multi\_OS} \wedge \text{Max\_Isolation} \\
\text{PV} & \text{if } \text{Multi\_OS} \wedge \text{High\_Performance} \wedge \text{OS\_Modifiable} \\
\text{Container} & \text{if } \text{Linux\_Only} \wedge \text{Balance} \\
\text{Sandbox} & \text{if } \text{Speed} \wedge \text{Efficiency}
\end{cases}
$$

## 07.9 åŒæ„ç­‰ä»·æ˜ å°„è¡¨

**å®Œæ•´åŒæ„ç­‰ä»·æ˜ å°„**ï¼š

| ç±»åˆ«           | æŠ€æœ¯ A         | æŠ€æœ¯ B       | å…³ç³» | å®šç†             |
| -------------- | -------------- | ------------ | ---- | ---------------- |
| **è¿è¡Œæ—¶**     | runc           | crun         | åŒæ„ | å®šç† 07.1        |
| **è¿è¡Œæ—¶**     | containerd     | CRI-O        | ç­‰ä»· | å®šç† 07.5        |
| **ç¼–æ’**       | Kubernetes     | K3s          | åŒæ„ | å®šç† 07.2        |
| **ç¼–æ’**       | Kubernetes API | K3s API      | ç­‰ä»· | å®šç† 07.6        |
| **å­˜å‚¨**       | etcd           | sqlite       | åŒæ„ | å®šç† 07.3        |
| **å­˜å‚¨**       | etcd           | Consul       | ç­‰ä»· | CAP å®šç†         |
| **ç½‘ç»œ**       | flannel        | Calico       | åŒæ„ | å®šç† 07.4        |
| **ç½‘ç»œ**       | CNI            | CNI-O        | ç­‰ä»· | è§„èŒƒç­‰ä»·         |
| **åè®®**       | HTTP/1.1       | HTTP/2       | ç­‰ä»· | å®šç† 07.7        |
| **è§„èŒƒ**       | OCI Image      | Docker Image | ç­‰ä»· | å®šç† 07.8        |
| **è™šæ‹ŸåŒ–å±‚æ¬¡** | è™šæ‹ŸåŒ–         | åŠè™šæ‹ŸåŒ–     | è¿‘ä¼¼ | å®šç† 07.25-07.33 |
| **è™šæ‹ŸåŒ–å±‚æ¬¡** | åŠè™šæ‹ŸåŒ–       | å®¹å™¨åŒ–       | ä¸åŒ | å®šç† 07.29-07.31 |
| **è™šæ‹ŸåŒ–å±‚æ¬¡** | å®¹å™¨åŒ–         | æ²™ç›’åŒ–       | ä¸åŒ | å®šç† 07.31-07.32 |

## 07.10 å‚è€ƒ

**å…³è”æ–‡æ¡£**ï¼š

- **[28. æ¶æ„æ¡†æ¶](../../TECHNICAL/28-architecture-framework/architecture-framework.md)** -
  å¤šç»´åº¦æ¶æ„ä½“ç³»ä¸æŠ€æœ¯è§„èŒƒï¼ˆæŠ€æœ¯æ¶æ„ã€æ¦‚å¿µæ¶æ„ã€æ•°æ®æ¶æ„ã€ä¸šåŠ¡æ¶æ„ã€è½¯ä»¶æ¶æ„ã€åº”
  ç”¨æ¶æ„ã€åœºæ™¯æ¶æ„ï¼‰
- **[05. å…¨å±€æ¶æ„è®¾è®¡](../05-architecture-design/architecture-design.md)** - æŠ€
  æœ¯ç»„åˆå’Œæ¶æ„å†³ç­–
- [03. æ¶æ„ä¸å¯¹è±¡æ¨¡å‹](../03-architecture/architecture.md) - ç³»ç»Ÿæ¶æ„è®¾è®¡
- [08. èŒƒç•´è®ºè§†è§’](../08-category-theory/category-theory.md) - èŒƒç•´è®ºåˆ†ææ–¹æ³•
- [09. çŸ©é˜µè§†è§’](../09-matrix-perspective/README.md) - çŸ©é˜µåŠ›å­¦ä¸æ•°å­¦å»ºæ¨¡ï¼ˆè¡¥å……
  è§†è§’ï¼‰
- [04. åˆ†å¸ƒå¼ç³»ç»Ÿæ¨¡å‹](../10-decision-models/01-theory-models/04-distributed-models.md) -
  åˆ†å¸ƒå¼ç³»ç»Ÿç†è®ºæ¨¡å‹

**å¤–éƒ¨å‚è€ƒï¼ˆWikipediaï¼Œas of 2025-11-02ï¼‰**ï¼š

- [Formal System](https://en.wikipedia.org/wiki/Formal_system) - å½¢å¼ç³»ç»Ÿ
- [Model Theory](https://en.wikipedia.org/wiki/Model_theory) - æ¨¡å‹è®º
- [Proof Theory](https://en.wikipedia.org/wiki/Proof_theory) - è¯æ˜è®º
- [First-Order Logic](https://en.wikipedia.org/wiki/First-order_logic) - ä¸€é˜¶é€»
  è¾‘
- [Set Theory](https://en.wikipedia.org/wiki/Set_theory) - é›†åˆè®º
- [Type Theory](https://en.wikipedia.org/wiki/Type_theory) - ç±»å‹è®º
- [Isomorphism](https://en.wikipedia.org/wiki/Isomorphism) - åŒæ„
- [Equivalence Relation](https://en.wikipedia.org/wiki/Equivalence_relation) -
  ç­‰ä»·å…³ç³»
- [Distributed Computing](https://en.wikipedia.org/wiki/Distributed_computing) -
  åˆ†å¸ƒå¼è®¡ç®—
- [CAP Theorem](https://en.wikipedia.org/wiki/CAP_theorem) - CAP å®šç†
- [Finite State Machine](https://en.wikipedia.org/wiki/Finite-state_machine) -
  æœ‰é™çŠ¶æ€æœº
- [Control Theory](https://en.wikipedia.org/wiki/Control_theory) - æ§åˆ¶ç†è®º
- [Graph Theory](https://en.wikipedia.org/wiki/Graph_theory) - å›¾è®º
- [Network Topology](https://en.wikipedia.org/wiki/Network_topology) - ç½‘ç»œæ‹“æ‰‘
- [Popek and Goldberg virtualization requirements](https://en.wikipedia.org/wiki/Popek_and_Goldberg_virtualization_requirements) -
  Popek-Goldberg è™šæ‹ŸåŒ–å®šç†
- [Full Virtualization](https://en.wikipedia.org/wiki/Virtualization#Full_virtualization) -
  å…¨è™šæ‹ŸåŒ–
- [Paravirtualization](https://en.wikipedia.org/wiki/Paravirtualization) - åŠè™š
  æ‹ŸåŒ–
- [OS-level Virtualization](https://en.wikipedia.org/wiki/OS-level_virtualization) -
  æ“ä½œç³»ç»Ÿçº§è™šæ‹ŸåŒ–ï¼ˆå®¹å™¨åŒ–ï¼‰
- [Sandbox (Computer Security)](<https://en.wikipedia.org/wiki/Sandbox_(computer_security)>) -
  æ²™ç›’åŒ–
- [Hardware-assisted Virtualization](https://en.wikipedia.org/wiki/Hardware-assisted_virtualization) -
  ç¡¬ä»¶è¾…åŠ©è™šæ‹ŸåŒ–

**æŠ€æœ¯è§„èŒƒå‚è€ƒ**ï¼š

- [OCI Specification](https://github.com/opencontainers/runtime-spec) - Open
  Container Initiative
- [CRI Specification](https://github.com/kubernetes/cri-api) - Container Runtime
  Interface
- [CNI Specification](https://github.com/containernetworking/cni) - Container
  Network Interface

---

**æœ€åæ›´æ–°**ï¼š2025-11-03 **ç»´æŠ¤è€…**ï¼šé¡¹ç›®å›¢é˜Ÿ

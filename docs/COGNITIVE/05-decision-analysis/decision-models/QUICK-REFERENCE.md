# 技术决策快速参考指南

## 📑 目录

- [📑 目录](#-目录)
- [📋 决策优先顺序](#-决策优先顺序)
- [🔌 设备访问需求决策](#-设备访问需求决策)
  - [决策规则](#决策规则)
  - [设备访问能力矩阵](#设备访问能力矩阵)
  - [典型场景](#典型场景)
- [⚡ 内核特性需求决策](#-内核特性需求决策)
  - [决策规则](#决策规则-1)
  - [内核特性访问能力矩阵](#内核特性访问能力矩阵)
  - [性能对比](#性能对比)
  - [典型场景](#典型场景-1)
- [📊 综合决策树](#-综合决策树)
  - [完整决策流程](#完整决策流程)
- [🎯 常见场景快速决策](#-常见场景快速决策)
- [📐 多维度权衡矩阵](#-多维度权衡矩阵)
  - [决策维度评分](#决策维度评分)
  - [权重设置示例](#权重设置示例)
- [🔗 详细文档链接](#-详细文档链接)
- [✅ 决策检查清单](#-决策检查清单)
  - [第一优先级：设备访问需求](#第一优先级设备访问需求)
  - [第二优先级：内核特性需求](#第二优先级内核特性需求)
  - [第三优先级：资源与隔离权衡](#第三优先级资源与隔离权衡)
- [📚 Wikipedia 参考链接](#-wikipedia-参考链接)

---

> **快速导航**：
>
> - 📋 [决策优先顺序](#-决策优先顺序) - 三个优先级决策点
> - 🔌 [设备访问需求决策](#-设备访问需求决策) - USB/PCI/GPU 设备访问
> - ⚡ [内核特性需求决策](#-内核特性需求决策) - epoll/io_uring/eBPF
> - 📊 [综合决策树](#-综合决策树) - 完整决策流程
> - 🎯 [常见场景快速决策](#-常见场景快速决策) - 11 个典型场景
> - 📐 [多维度权衡矩阵](#-多维度权衡矩阵) - 评分与权重
> - ✅ [决策检查清单](#-决策检查清单) - 快速确认决策
> - 🔗 [详细文档链接](#-详细文档链接) - 深入分析文档

---

## 📋 决策优先顺序

**关键决策点（按优先级）**：

1. **设备访问需求**（最高优先级，硬约束）
2. **内核特性需求**（高优先级，性能要求）
3. **资源与隔离权衡**（其他需求满足时的选择）
4. **2025 年新增决策维度**：
   - **WasmEdge 原生支持**：K8s 1.30+ / K3s 1.30+（边缘/Serverless/AI 推理场景）
   - **OPA-Wasm 策略执行**：Gatekeeper v3.15+（策略延迟 < 1ms）
   - **服务网格 Wasm 插件**：Istio + WasmEdge（Wasm 插件热加载）

> **📊 2025 年技术趋势参考**：详细技术状态和版本信息请查看
> [27. 2025 年技术趋势汇总](../../TECHNICAL/10-reference-trends/2025-trends/2025-trends.md)

---

## 🔌 设备访问需求决策

### 决策规则

```text
if 需要 USB/PCI 设备访问:
    if 需要最高性能:
        return 半虚拟化（VirtIO-USB/VirtIO-PCI，减少 VM-Exit）
    else:
        return 全虚拟化（USB passthrough，兼容性优先）
elif 需要 GPU 设备访问:
    if GPU 直通:
        if 强隔离:
            return 虚拟化/半虚拟化（GPU 完全直通，性能>95%）
        else:
            return 容器化（NVIDIA Container Toolkit，性能>98%）
    elif GPU vGPU/SR-IOV:
        return 虚拟化/半虚拟化（GPU 虚拟化，资源共享）
    else:
        return 继续判断其他需求
else:
    return 继续判断其他需求
```

### 设备访问能力矩阵

| 设备类型          | 全虚拟化    | 半虚拟化      | 容器化                  | 沙盒化          |
| ----------------- | ----------- | ------------- | ----------------------- | --------------- |
| **USB 设备**      | ✅ 完全支持 | ✅ VirtIO-USB | ❌ 不支持               | ❌ 不支持       |
| **PCI 设备**      | ✅ 完全支持 | ✅ VirtIO-PCI | ❌ 不支持               | ❌ 不支持       |
| **GPU（直通）**   | ✅ 完全支持 | ✅ 完全支持   | ✅ 支持（NVIDIA/CUDA）  | ❌ 不支持       |
| **GPU（vGPU）**   | ✅ 支持     | ✅ 支持       | ⚠️ 受限（需要特殊配置） | ❌ 不支持       |
| **GPU（SR-IOV）** | ✅ 支持     | ✅ 支持       | ✅ 支持（VF 直通）      | ❌ 不支持       |
| **GPU（虚拟化）** | ✅ 支持     | ⚠️ 受限       | ❌ 不支持               | ❌ 不支持       |
| **网络设备**      | ✅ 虚拟网卡 | ✅ VirtIO-Net | ✅ 直接                 | ⚠️ 受限（WASI） |
| **存储设备**      | ✅ 虚拟硬盘 | ✅ VirtIO-Blk | ✅ 直接                 | ⚠️ 受限（WASI） |

### 典型场景

- **USB 摄像头应用** → 半虚拟化（VirtIO-USB）
- **USB 打印机应用** → 全虚拟化（USB passthrough）
- **PCI 网卡应用** → 半虚拟化（VirtIO-PCI）
- **GPU 加速应用（直通）**：
  - 强隔离 → 虚拟化/半虚拟化（GPU 完全直通，性能>95%）
  - 中等隔离 → 容器化（NVIDIA Container Toolkit，性能>98%）
- **GPU 加速应用（vGPU/SR-IOV）** → 虚拟化/半虚拟化（GPU 虚拟化，资源共享）
- **AI 推理（GPU）**：
  - **传统容器化** → NVIDIA Container Toolkit，CUDA 运行时（性能>98%）
  - **2025 年新增：WasmEdge** → WasmEdge 0.14+ GPU 插件（边缘 AI，推理延迟 < 50ms，镜像 < 10MB）
- **深度学习训练（GPU）** → 虚拟化（GPU 直通，多 OS 支持）
- **多租户 GPU 平台** → 虚拟化（vGPU/SR-IOV，资源共享）

---

## ⚡ 内核特性需求决策

### 决策规则

```text
if 需要 epoll/io_uring:
    return 容器化（必需，直接内核访问，性能提升 16-62x）
elif 需要 eBPF:
    return 容器化（推荐，直接 Host 内核访问，性能提升 16-310x）
else:
    return 继续判断其他需求
```

### 内核特性访问能力矩阵

| 内核特性     | 全虚拟化      | 半虚拟化      | 容器化  | 沙盒化          |
| ------------ | ------------- | ------------- | ------- | --------------- |
| **epoll**    | ✅ Guest 内核 | ✅ Guest 内核 | ✅ Host | ⚠️ 受限（WASI） |
| **io_uring** | ✅ Guest 内核 | ✅ Guest 内核 | ✅ Host | ❌ 不支持       |
| **eBPF**     | ✅ Guest 内核 | ✅ Guest 内核 | ✅ Host | ⚠️ 受限（BPF）  |

### 性能对比

| 内核特性     | 容器化延迟 | 全虚拟化延迟  | 半虚拟化延迟 | 性能比  |
| ------------ | ---------- | ------------- | ------------ | ------- |
| **epoll**    | ~100 ns    | ~1600-3100 ns | ~250-850 ns  | 16-31x  |
| **io_uring** | ~50 ns     | ~1600-3100 ns | ~250-850 ns  | 32-62x  |
| **eBPF**     | ~10-100 ns | ~1600-3100 ns | ~250-850 ns  | 16-310x |

### 典型场景

- **高并发 Web 服务器（epoll）** → 容器化（延迟 100 ns vs 1600-3100 ns，16-31x
  性能提升）
- **高性能数据库（io_uring）** → 容器化（延迟 50 ns，32-62x 性能提升）
- **网络策略/可观测性（eBPF）** → 容器化（直接 Host 内核访问，16-310x 性能提升）
- **网络流量分析（eBPF）** → 容器化（直接内核 hook，实时监控）

---

## 📊 综合决策树

### 完整决策流程

```text
场景需求
├── 设备访问需求（优先判断）
│   ├── 需要 USB/PCI 设备
│   │   ├── 高性能 → 半虚拟化
│   │   └── 兼容性优先 → 全虚拟化
│   ├── 需要 GPU 设备
│   │   ├── GPU 直通
│   │   │   ├── 强隔离 → 虚拟化/半虚拟化（性能>95%）
│   │   │   └── 中等隔离 → 容器化（性能>98%）
│   │   ├── GPU vGPU/SR-IOV → 虚拟化/半虚拟化（资源共享）
│   │   └── GPU 虚拟化 → 全虚拟化（性能极低）
│   └── 不需要设备访问 → 继续判断
├── 内核特性需求（优先判断）
│   ├── 需要 epoll/io_uring → 容器化（必需，16-62x 性能提升）
│   ├── 需要 eBPF → 容器化（推荐，16-310x 性能提升）
│   └── 不需要内核特性 → 继续判断
├── 资源限制
│   ├── 资源充足 → 虚拟化
│   ├── 资源中等 → 容器化
│   └── 资源受限 → 沙盒化
├── 隔离要求
│   ├── 强隔离 → 虚拟化/Kata
│   ├── 中等隔离 → 容器化
│   └── 应用隔离 → 沙盒化
└── 性能要求
    ├── 低延迟 → 沙盒化（Wasm）
    ├── 中等延迟 → 容器化
    └── 延迟不敏感 → 虚拟化
```

---

## 🎯 常见场景快速决策

| 场景                    | 设备访问           | 内核特性         | 推荐方案                       | 理由                                 |
| ----------------------- | ------------------ | ---------------- | ------------------------------ | ------------------------------------ |
| **边缘计算**            | 无需求             | 无需求           | WasmEdge + K3s                 | 资源受限，低延迟                     |
| **Serverless**          | 无需求             | 无需求           | WasmEdge + K3s                 | 极速启动，按需计费                   |
| **企业应用**            | USB/PCI            | 无需求           | VM + K8s                       | 设备访问，强隔离                     |
| **微服务架构**          | 无需求             | epoll/io_uring   | Container + K8s + Service Mesh | 内核特性、服务间通信治理、零信任安全 |
| **高并发网络**          | 无需求             | epoll（必需）    | Container + K8s                | 直接 epoll，低延迟                   |
| **高性能数据库**        | 无需求             | io_uring（必需） | Container + K8s                | 直接 io_uring，高吞吐                |
| **USB 设备应用**        | USB（必需）        | 无需求           | 半虚拟化 + K8s                 | VirtIO-USB，高性能                   |
| **AI 推理（GPU）**      | GPU（直通）        | 无需求           | Container + K8s + NVIDIA       | NVIDIA Container Toolkit，性能>98%   |
| **深度学习训练（GPU）** | GPU（直通）        | 无需求           | VM + K8s                       | GPU 完全直通，多 OS 支持，性能>95%   |
| **多租户 GPU 平台**     | GPU（vGPU/SR-IOV） | 无需求           | VM + K8s                       | GPU 虚拟化，资源共享                 |
| **图形渲染（GPU）**     | GPU（直通）        | 无需求           | VM + K8s                       | GPU 完全直通，多 OS 支持             |

---

## 📐 多维度权衡矩阵

### 决策维度评分

| 决策维度     | 虚拟化     | 容器化     | 沙盒化     |
| ------------ | ---------- | ---------- | ---------- |
| **资源效率** | ⭐⭐       | ⭐⭐⭐⭐   | ⭐⭐⭐⭐⭐ |
| **隔离强度** | ⭐⭐⭐⭐⭐ | ⭐⭐⭐     | ⭐⭐       |
| **启动速度** | ⭐⭐       | ⭐⭐⭐⭐   | ⭐⭐⭐⭐⭐ |
| **兼容性**   | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐   | ⭐⭐⭐     |
| **设备访问** | ⭐⭐⭐⭐⭐ | ⭐⭐       | ⭐         |
| **内核特性** | ⭐⭐⭐     | ⭐⭐⭐⭐⭐ | ⭐⭐       |

### 权重设置示例

**设备访问场景（USB/PCI）**：

- 设备访问：40%
- 兼容性：30%
- 隔离强度：20%
- 性能：10%

**GPU 设备访问场景（直通）**：

- GPU 访问：40%
- 性能：30%
- 隔离强度：20%
- 兼容性：10%

**GPU 设备访问场景（vGPU/SR-IOV）**：

- GPU 访问：40%
- 资源共享：30%
- 隔离强度：20%
- 性能：10%

**内核特性场景**：

- 内核特性：40%
- 性能：30%
- 资源效率：20%
- 兼容性：10%

---

## 🔗 详细文档链接

- **[完整决策框架](02-scenario-models/01-decision-framework.md#01211-基于设备与内核特性的决策)** -
  详细的设备访问和内核特性决策分析
- **[执行流与调度视角](../../02-architecture-design/architecture/execution-flow-scheduling.md#03x74-基于设备与内核特性的决策)** -
  从执行流视角分析设备访问和内核特性
- **[场景分析论证模型](02-scenario-models/02-scenario-analysis.md)** - 完整的场
  景分析框架和论证模型
- **[实际案例](03-cases/)** - 边缘计算、Serverless、企业应用等实际案例
- **[矩阵视角](../../03-theoretical-perspectives/matrix-perspective/README.md)** -
  矩阵力学分析方法（用于架构决策量化支持）
- **[矩阵实践案例](../../03-theoretical-perspectives/matrix-perspective/09-practice-cases.md)** -
  AI 推理、多租户等场景的矩阵分析

---

## ✅ 决策检查清单

使用此清单快速确认决策：

### 第一优先级：设备访问需求

- [ ] 需要访问 USB 设备？
  - [ ] 是 → **虚拟化/半虚拟化**（必需）
    - [ ] 需要最高性能 → **半虚拟化**（VirtIO-USB）
    - [ ] 需要兼容性优先 → **全虚拟化**（USB passthrough）
  - [ ] 否 → 继续检查
- [ ] 需要访问 PCI 设备？
  - [ ] 是 → **虚拟化/半虚拟化**（必需）
    - [ ] 需要最高性能 → **半虚拟化**（VirtIO-PCI）
    - [ ] 需要兼容性优先 → **全虚拟化**（PCI passthrough）
  - [ ] 否 → 继续检查
- [ ] 需要访问 GPU 设备？
  - [ ] 是 → 根据访问方式选择
    - [ ] GPU 直通
      - [ ] 需要强隔离 → **虚拟化/半虚拟化**（性能>95%，多 OS 支持）
      - [ ] 需要中等隔离 → **容器化**（NVIDIA Container Toolkit，性能>98%）
    - [ ] GPU vGPU/SR-IOV → **虚拟化/半虚拟化**（资源共享，多租户）
    - [ ] GPU 虚拟化 → **全虚拟化**（性能极低，仅兼容性）
  - [ ] 否 → 继续检查

### 第二优先级：内核特性需求

- [ ] 需要 epoll（高并发网络 I/O）？
  - [ ] 是 → **容器化**（必需，16-31x 性能提升）
  - [ ] 否 → 继续检查
- [ ] 需要 io_uring（异步 I/O）？
  - [ ] 是 → **容器化**（必需，32-62x 性能提升）
  - [ ] 否 → 继续检查
- [ ] 需要 eBPF（可编程网络/安全策略）？
  - [ ] 是 → **容器化**（推荐，直接 Host 内核访问）
  - [ ] 否 → 继续检查

### 第三优先级：资源与隔离权衡

- [ ] 资源极度受限（< 100MB 内存）？
  - [ ] 是 → **沙盒化**（Wasm，内存 < 10MB）
  - [ ] 否 → 继续检查
- [ ] 需要强隔离 + 多 OS 支持？
  - [ ] 是 → **虚拟化**（硬件级隔离，多 OS）
  - [ ] 否 → 继续检查
- [ ] 需要资源共享 + 标准化？
  - [ ] 是 → **容器化**（OCI 标准，资源共享）
  - [ ] 否 → 继续检查
- [ ] 需要极速启动（< 100ms）？
  - [ ] 是 → **沙盒化**（Wasm，启动 < 10ms）
  - [ ] 否 → **容器化**（启动 < 1s）

---

## 📚 Wikipedia 参考链接

为确保决策规则与技术标准对齐，以下是相关的 Wikipedia 条目链接：

- [Virtualization](https://en.wikipedia.org/wiki/Virtualization)
- [Paravirtualization](https://en.wikipedia.org/wiki/Paravirtualization)
- [Containerization](https://en.wikipedia.org/wiki/Containerization)
- [Sandboxing](<https://en.wikipedia.org/wiki/Sandbox_(computer_security)>)
- [GPU Virtualization](https://en.wikipedia.org/wiki/GPU_virtualization)
- [SR-IOV](https://en.wikipedia.org/wiki/Single-root_input/output_virtualization)
- [epoll](https://en.wikipedia.org/wiki/Epoll)
- [io_uring](https://en.wikipedia.org/wiki/Io_uring)
- [eBPF](https://en.wikipedia.org/wiki/EBPF)

---

**最后更新**：2025-11-07
**文档状态**：✅ 完整 | 📊 包含 2025 年最新趋势 | 🎯 生产就绪技术组合
**维护者**：项目团队

**一致性检查**：参见 [一致性检查报告](CONSISTENCY-REPORT.md)

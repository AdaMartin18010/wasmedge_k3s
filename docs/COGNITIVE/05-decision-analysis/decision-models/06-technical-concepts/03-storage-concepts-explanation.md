# 存储概念与技术名词论证

## 📑 目录

- [📑 目录](#-目录)
- [01 文档定位](#01-文档定位)
- [02 存储拓扑结构](#02-存储拓扑结构)
  - [02.1 物理存储拓扑](#021-物理存储拓扑)
    - [02.1.1 物理存储拓扑定义](#0211-物理存储拓扑定义)
    - [02.1.2 物理存储拓扑在技术栈中的作用](#0212-物理存储拓扑在技术栈中的作用)
  - [02.2 逻辑存储拓扑](#022-逻辑存储拓扑)
    - [02.2.1 逻辑存储拓扑定义](#0221-逻辑存储拓扑定义)
    - [02.2.2 逻辑存储拓扑在技术栈中的作用](#0222-逻辑存储拓扑在技术栈中的作用)
  - [02.3 存储拓扑映射](#023-存储拓扑映射)
    - [02.3.1 物理存储拓扑与逻辑存储拓扑映射](#0231-物理存储拓扑与逻辑存储拓扑映射)
    - [02.3.2 各范式存储拓扑结构映射](#0232-各范式存储拓扑结构映射)
- [03 存储访问模式](#03-存储访问模式)
  - [03.1 只读访问](#031-只读访问)
    - [03.1.1 只读访问定义](#0311-只读访问定义)
    - [03.1.2 只读访问在各范式中的应用](#0312-只读访问在各范式中的应用)
  - [03.2 读写访问](#032-读写访问)
    - [03.2.1 读写访问定义](#0321-读写访问定义)
    - [03.2.2 读写访问在各范式中的应用](#0322-读写访问在各范式中的应用)
  - [03.3 并发访问](#033-并发访问)
    - [03.3.1 并发访问定义](#0331-并发访问定义)
    - [03.3.2 并发访问在各范式中的应用](#0332-并发访问在各范式中的应用)
  - [03.4 存储访问模式映射](#034-存储访问模式映射)
    - [03.4.1 存储访问模式对比矩阵](#0341-存储访问模式对比矩阵)
    - [03.4.2 各范式存储访问模式映射](#0342-各范式存储访问模式映射)
- [04 存储通道模型](#04-存储通道模型)
  - [04.1 物理存储通道](#041-物理存储通道)
    - [04.1.1 物理存储通道定义](#0411-物理存储通道定义)
    - [04.1.2 物理存储通道在技术栈中的作用](#0412-物理存储通道在技术栈中的作用)
  - [04.2 逻辑存储通道](#042-逻辑存储通道)
    - [04.2.1 逻辑存储通道定义](#0421-逻辑存储通道定义)
    - [04.2.2 逻辑存储通道在技术栈中的作用](#0422-逻辑存储通道在技术栈中的作用)
  - [04.3 存储通道映射](#043-存储通道映射)
    - [04.3.1 物理存储通道与逻辑存储通道映射](#0431-物理存储通道与逻辑存储通道映射)
    - [04.3.2 各范式存储通道模型映射](#0432-各范式存储通道模型映射)
- [05 存储设备模型](#05-存储设备模型)
  - [05.1 物理存储设备](#051-物理存储设备)
    - [05.1.1 物理存储设备定义](#0511-物理存储设备定义)
    - [05.1.2 物理存储设备在技术栈中的作用](#0512-物理存储设备在技术栈中的作用)
  - [05.2 虚拟存储设备](#052-虚拟存储设备)
    - [05.2.1 虚拟存储设备定义](#0521-虚拟存储设备定义)
    - [05.2.2 虚拟存储设备在技术栈中的作用](#0522-虚拟存储设备在技术栈中的作用)
  - [05.3 逻辑存储设备](#053-逻辑存储设备)
    - [05.3.1 逻辑存储设备定义](#0531-逻辑存储设备定义)
    - [05.3.2 逻辑存储设备在技术栈中的作用](#0532-逻辑存储设备在技术栈中的作用)
  - [05.4 存储设备模型映射](#054-存储设备模型映射)
    - [05.4.1 存储设备模型对比矩阵](#0541-存储设备模型对比矩阵)
    - [05.4.2 各范式存储设备模型映射](#0542-各范式存储设备模型映射)
- [06 存储协议栈](#06-存储协议栈)
  - [06.1 存储协议栈模型](#061-存储协议栈模型)
    - [06.1.1 存储协议栈定义](#0611-存储协议栈定义)
    - [06.1.2 存储协议栈在各范式中的映射](#0612-存储协议栈在各范式中的映射)
  - [06.2 存储接口标准](#062-存储接口标准)
    - [06.2.1 存储接口标准定义](#0621-存储接口标准定义)
    - [06.2.2 存储接口标准在各范式中的应用](#0622-存储接口标准在各范式中的应用)
  - [06.3 各范式存储栈对比](#063-各范式存储栈对比)
    - [06.3.1 存储协议栈对比矩阵](#0631-存储协议栈对比矩阵)
- [07 虚拟化存储架构](#07-虚拟化存储架构)
  - [07.1 虚拟化存储拓扑](#071-虚拟化存储拓扑)
    - [07.1.1 虚拟化存储拓扑结构](#0711-虚拟化存储拓扑结构)
  - [07.2 虚拟化存储设备模型](#072-虚拟化存储设备模型)
    - [07.2.1 虚拟化存储设备架构](#0721-虚拟化存储设备架构)
  - [07.3 虚拟化存储隔离](#073-虚拟化存储隔离)
    - [07.3.1 虚拟化存储隔离机制](#0731-虚拟化存储隔离机制)
- [08 容器化存储架构](#08-容器化存储架构)
  - [08.1 容器化存储拓扑](#081-容器化存储拓扑)
    - [08.1.1 容器化存储拓扑结构](#0811-容器化存储拓扑结构)
  - [08.2 容器化存储设备模型](#082-容器化存储设备模型)
    - [08.2.1 容器化存储设备架构](#0821-容器化存储设备架构)
  - [08.3 容器化存储隔离](#083-容器化存储隔离)
    - [08.3.1 容器化存储隔离机制](#0831-容器化存储隔离机制)
- [09 沙盒化存储架构](#09-沙盒化存储架构)
  - [09.1 沙盒化存储拓扑](#091-沙盒化存储拓扑)
    - [09.1.1 沙盒化存储拓扑结构](#0911-沙盒化存储拓扑结构)
  - [09.2 沙盒化存储设备模型](#092-沙盒化存储设备模型)
    - [09.2.1 沙盒化存储设备架构](#0921-沙盒化存储设备架构)
  - [09.3 沙盒化存储隔离](#093-沙盒化存储隔离)
    - [09.3.1 沙盒化存储隔离机制](#0931-沙盒化存储隔离机制)
- [10 存储架构对比矩阵](#10-存储架构对比矩阵)
  - [10.1 存储拓扑对比矩阵](#101-存储拓扑对比矩阵)
  - [10.2 存储访问模式对比矩阵](#102-存储访问模式对比矩阵)
  - [10.3 存储通道模型对比矩阵](#103-存储通道模型对比矩阵)
  - [10.4 存储设备模型对比矩阵](#104-存储设备模型对比矩阵)
  - [10.5 存储协议栈对比矩阵](#105-存储协议栈对比矩阵)
- [11 参考](#11-参考)

---

## 01 文档定位

本文档系统化解释**虚拟化、容器化、沙盒化**的存储概念、拓扑结构、访问模式、通道模
型、设备模型，提供详细的存储架构论证和技术名词对应关系。

**核心内容**：

1. **存储拓扑结构**：物理存储拓扑 vs 逻辑存储拓扑的映射关系
2. **存储访问模式**：只读、读写、并发访问的实现机制
3. **存储通道模型**：物理存储通道 vs 逻辑存储通道的抽象关系
4. **存储设备模型**：物理存储设备、虚拟存储设备、逻辑存储设备的技术实现
5. **存储协议栈**：各范式在存储协议栈中的位置和作用
6. **存储架构对比**：虚拟化、容器化、沙盒化的存储架构全面对比

**与其他文档的关系**：

- **理论模型**（01-theory-models/）：提供存储资源模型理论基础
- **技术名词论证**（technical-concepts-explanation.md）：提供存储技术名词定义
- **网络概念论证**（02-network-concepts-explanation.md）：网络架构论证（参考）
- **本文档**：提供存储架构和拓扑结构的详细论证

---

## 02 存储拓扑结构

### 02.1 物理存储拓扑

#### 02.1.1 物理存储拓扑定义

**物理存储拓扑（Physical Storage Topology）定义**：

物理存储拓扑是指存储设备、存储控制器和存储介质在物理空间中的实际连接方式和布局结
构。

**物理存储拓扑类型**：

1. **直接连接存储（DAS - Direct Attached Storage）**：

   - **结构**：存储设备直接连接到服务器
   - **连接方式**：SATA、SAS、PCIe、NVMe
   - **特征**：低延迟、高带宽、专用连接
   - **应用**：本地存储、高性能存储

2. **网络附加存储（NAS - Network Attached Storage）**：

   - **结构**：存储设备通过网络连接到服务器
   - **连接方式**：以太网、光纤通道
   - **特征**：共享存储、文件级访问、网络协议（NFS、CIFS）
   - **应用**：文件共享、备份存储

3. **存储区域网络（SAN - Storage Area Network）**：

   - **结构**：存储设备通过专用网络连接到服务器
   - **连接方式**：FC（Fibre Channel）、iSCSI、InfiniBand
   - **特征**：块级访问、高性能、共享存储
   - **应用**：企业存储、数据库存储

4. **分布式存储拓扑**：

   - **结构**：多个存储节点组成分布式存储集群
   - **连接方式**：以太网、专用存储网络
   - **特征**：高可用、可扩展、分布式访问
   - **应用**：对象存储、分布式文件系统

#### 02.1.2 物理存储拓扑在技术栈中的作用

**物理存储拓扑映射**：

```text
物理存储拓扑结构:

数据中心物理存储拓扑:
├── DAS（直接连接存储）
│   ├── 本地磁盘（HDD/SSD）
│   ├── NVMe SSD（PCIe）
│   └── 本地存储控制器
├── NAS（网络附加存储）
│   ├── NFS 服务器
│   ├── CIFS/SMB 服务器
│   └── 文件存储集群
├── SAN（存储区域网络）
│   ├── FC SAN（光纤通道）
│   ├── iSCSI SAN（以太网）
│   └── 块存储阵列
└── 分布式存储
    ├── 对象存储（S3、Swift）
    ├── 分布式文件系统（Ceph、GlusterFS）
    └── 存储集群

边缘计算物理存储拓扑:
├── 本地存储（DAS）
│   ├── eMMC（嵌入式存储）
│   ├── SD 卡
│   └── 本地 SSD
└── 网络存储（NAS/SAN）
    └── 远程存储（可选）
```

### 02.2 逻辑存储拓扑

#### 02.2.1 逻辑存储拓扑定义

**逻辑存储拓扑（Logical Storage Topology）定义**：

逻辑存储拓扑是指在物理存储之上建立的抽象存储结构和访问路径，独立于物理连接方式。

**逻辑存储拓扑类型**：

1. **块存储逻辑拓扑**：

   - **定义**：在物理存储上创建的逻辑块设备
   - **实现**：LVM（Logical Volume Manager）、RAID
   - **应用**：虚拟磁盘、容器卷

2. **文件系统逻辑拓扑**：

   - **定义**：在块设备上创建的文件系统结构
   - **实现**：ext4、XFS、Btrfs、ZFS
   - **应用**：文件存储、目录结构

3. **联合文件系统逻辑拓扑**：

   - **定义**：多个文件系统层叠加形成的逻辑文件系统
   - **实现**：OverlayFS、AUFS、UnionFS
   - **应用**：容器镜像、分层存储

4. **虚拟存储逻辑拓扑**：

   - **定义**：在物理存储之上创建的虚拟存储结构
   - **实现**：虚拟磁盘、虚拟卷、存储池
   - **应用**：虚拟化存储、存储抽象

#### 02.2.2 逻辑存储拓扑在技术栈中的作用

**逻辑存储拓扑映射**：

```text
逻辑存储拓扑结构:

虚拟化逻辑存储拓扑:
├── 虚拟磁盘（Virtual Disk）
│   ├── 逻辑拓扑: 块设备抽象
│   ├── 虚拟卷（Virtual Volume）
│   └── 存储池（Storage Pool）
├── Guest 文件系统
│   ├── ext4、XFS、NTFS
│   └── 文件系统层
└── 存储快照（Snapshot）
    └── 时间点存储副本

容器化逻辑存储拓扑:
├── 容器镜像层（Image Layers）
│   ├── 逻辑拓扑: 分层联合文件系统
│   ├── 基础层（Base Layer）
│   ├── 应用层（Application Layer）
│   └── 可写层（Writable Layer）
├── OverlayFS
│   ├── Lower Layer（只读）
│   ├── Upper Layer（可写）
│   └── 合并视图（Merged View）
└── 卷（Volume）
    ├── Bind Mount
    ├── Named Volume
    └── tmpfs

沙盒化逻辑存储拓扑:
├── WASI Filesystem
│   ├── 逻辑拓扑: 文件系统抽象
│   ├── 目录映射（Directory Mapping）
│   └── 文件访问抽象
├── 零 rootfs（Zero RootFS）
│   └── 无需文件系统镜像
└── 外部存储挂载（External Mount）
    └── 通过 WASI FS 访问
```

### 02.3 存储拓扑映射

#### 02.3.1 物理存储拓扑与逻辑存储拓扑映射

**存储拓扑映射矩阵**：

| 物理存储拓扑   | 逻辑存储拓扑 | 映射关系                 | 应用场景           |
| -------------- | ------------ | ------------------------ | ------------------ |
| **DAS**        | 块设备抽象   | 物理磁盘映射到块设备     | 本地存储、虚拟磁盘 |
| **NAS**        | 文件系统抽象 | 网络存储映射到文件系统   | 文件共享、容器卷   |
| **SAN**        | 块设备抽象   | 网络块存储映射到块设备   | 企业存储、虚拟磁盘 |
| **分布式存储** | 对象存储抽象 | 分布式存储映射到对象接口 | 对象存储、云存储   |

#### 02.3.2 各范式存储拓扑结构映射

**各范式存储拓扑映射对比**：

| 范式       | 物理存储拓扑 | 逻辑存储拓扑             | 存储拓扑特征               |
| ---------- | ------------ | ------------------------ | -------------------------- |
| **虚拟化** | DAS/SAN      | 虚拟磁盘（Virtual Disk） | VM 连接到虚拟磁盘          |
| **容器化** | DAS/NAS      | 镜像层（Image Layers）   | 容器使用联合文件系统       |
| **沙盒化** | Host OS 存储 | WASI Filesystem          | Wasm 模块通过 WASI FS 访问 |

**存储拓扑详细映射**：

```text
存储拓扑映射:

虚拟化存储拓扑映射:
物理存储（DAS/SAN） → 逻辑存储（虚拟磁盘）
├── 物理磁盘 → 虚拟磁盘（VirtIO Block）
├── 物理卷 → 虚拟卷（Virtual Volume）
└── 存储池 → 存储池（Storage Pool）

容器化存储拓扑映射:
物理存储（DAS/NAS） → 逻辑存储（镜像层）
├── 物理磁盘 → 镜像层（OverlayFS）
├── 物理文件系统 → 联合文件系统（Union FS）
└── 物理卷 → 容器卷（Volume）

沙盒化存储拓扑映射:
物理存储（Host OS） → 逻辑存储（WASI FS）
├── 物理文件系统 → WASI Filesystem
├── 物理目录 → WASI 目录映射
└── 物理文件 → WASI 文件抽象
```

---

## 03 存储访问模式

### 03.1 只读访问

#### 03.1.1 只读访问定义

**只读访问（Read-Only Access）定义**：

只读访问是指存储数据只能被读取，不能被修改或删除的访问模式。

**只读访问特征**：

- **单向访问**：只能读取数据，不能写入
- **数据保护**：防止数据被意外修改或删除
- **应用场景**：镜像层、快照、归档数据、配置文件

#### 03.1.2 只读访问在各范式中的应用

**只读访问映射**：

```text
只读访问应用:

虚拟化只读访问:
├── 虚拟磁盘快照（只读）
│   └── VM 快照的只读副本
├── 虚拟镜像（只读）
│   └── VM 镜像的只读访问
└── 共享存储卷（只读）
    └── 多个 VM 共享只读卷

容器化只读访问:
├── 镜像层（只读）
│   ├── 基础层（只读）
│   ├── 中间层（只读）
│   └── 多个容器共享只读层
├── 卷挂载（只读）
│   └── 容器以只读方式挂载卷
└── ConfigMap/Secret（只读）
    └── Kubernetes 配置（只读挂载）

沙盒化只读访问:
├── Wasm Module（只读）
│   └── Wasm 二进制模块（只读）
├── 配置数据（只读）
│   └── 通过 WASI FS 只读访问
└── 外部卷挂载（只读）
    └── 外部存储的只读访问
```

### 03.2 读写访问

#### 03.2.1 读写访问定义

**读写访问（Read-Write Access）定义**：

读写访问是指存储数据可以被读取和写入的访问模式，支持数据的修改和更新。

**读写访问特征**：

- **双向访问**：可以读取和写入数据
- **数据修改**：支持数据的修改、更新、删除
- **应用场景**：应用数据、日志文件、临时数据、数据库存储

#### 03.2.2 读写访问在各范式中的应用

**读写访问映射**：

```text
读写访问应用:

虚拟化读写访问:
├── 虚拟磁盘（读写）
│   ├── VM 的主存储磁盘
│   └── 支持数据的读写操作
├── 临时存储（读写）
│   └── VM 临时数据的读写
└── 数据卷（读写）
    └── VM 数据卷的读写访问

容器化读写访问:
├── 容器可写层（读写）
│   ├── OverlayFS Upper Layer
│   └── 容器数据的读写操作
├── 卷挂载（读写）
│   ├── Named Volume（读写）
│   ├── Bind Mount（读写）
│   └── tmpfs（读写，内存）
└── 持久化存储（读写）
    └── PVC（PersistentVolumeClaim）

沙盒化读写访问:
├── WASI Filesystem（读写）
│   ├── 目录映射（读写）
│   └── 文件访问（读写）
├── 外部存储挂载（读写）
│   └── 通过 WASI FS 读写访问
└── 内存文件系统（读写）
    └── 临时数据的读写操作
```

### 03.3 并发访问

#### 03.3.1 并发访问定义

**并发访问（Concurrent Access）定义**：

并发访问是指多个进程或实例同时访问同一存储资源的访问模式，需要协调机制保证数据一
致性。

**并发访问特征**：

- **多进程访问**：多个进程同时访问存储
- **并发控制**：需要锁机制、事务机制保证数据一致性
- **应用场景**：数据库存储、共享文件系统、分布式存储

#### 03.3.2 并发访问在各范式中的应用

**并发访问映射**：

```text
并发访问应用:

虚拟化并发访问:
├── 共享存储卷（并发访问）
│   ├── 多个 VM 共享 SAN 存储
│   ├── 集群文件系统（GFS、OCFS2）
│   └── 并发访问控制（文件锁）
└── 虚拟磁盘（并发访问）
    └── 多个 VM 访问同一虚拟磁盘

容器化并发访问:
├── 共享卷（并发访问）
│   ├── 多个容器共享 Volume
│   ├── 分布式文件系统（Ceph、GlusterFS）
│   └── 并发访问控制（POSIX 锁）
├── 共享存储（并发访问）
│   ├── NFS 共享存储
│   └── 多 Pod 共享 PVC
└── 数据库存储（并发访问）
    └── 数据库文件的并发访问

沙盒化并发访问:
├── WASI Filesystem（并发访问）
│   ├── 多个 Wasm 模块共享文件系统
│   ├── Host OS 文件系统并发访问
│   └── 并发访问控制（文件锁）
└── 外部存储（并发访问）
    └── 多个 Wasm 模块并发访问外部存储
```

### 03.4 存储访问模式映射

#### 03.4.1 存储访问模式对比矩阵

**存储访问模式对比**：

| 访问模式 | 读取能力 | 写入能力 | 并发能力 | 应用场景               | 在各范式中的应用                 |
| -------- | -------- | -------- | -------- | ---------------------- | -------------------------------- |
| **只读** | ✅       | ❌       | ✅       | 镜像层、快照、配置     | 镜像层、快照、配置文件           |
| **读写** | ✅       | ✅       | ⚠️       | 应用数据、日志、数据库 | 数据卷、可写层、持久化存储       |
| **并发** | ✅       | ✅       | ✅       | 共享存储、分布式存储   | 共享卷、集群存储、分布式文件系统 |

#### 03.4.2 各范式存储访问模式映射

**各范式存储访问模式**：

| 范式       | 主要访问模式     | 实现机制                 | 性能特征        |
| ---------- | ---------------- | ------------------------ | --------------- |
| **虚拟化** | 读写、并发       | 虚拟磁盘（VirtIO Block） | 15-25% 性能损失 |
| **容器化** | 只读、读写、并发 | OverlayFS、Volume        | 5-10% 性能损失  |
| **沙盒化** | 读写、并发       | WASI Filesystem          | < 2% 性能损失   |

---

## 04 存储通道模型

### 04.1 物理存储通道

#### 04.1.1 物理存储通道定义

**物理存储通道（Physical Storage Channel）定义**：

物理存储通道是指用于传输存储数据的实际物理介质和连接方式。

**物理存储通道类型**：

1. **本地存储通道**：

   - **SATA（Serial ATA）**：

     - **速率**：150MB/s - 600MB/s
     - **应用**：HDD、SSD 本地存储
     - **特征**：直接连接、低延迟

   - **SAS（Serial Attached SCSI）**：

     - **速率**：300MB/s - 2400MB/s
     - **应用**：企业级存储、服务器存储
     - **特征**：高性能、可靠

   - **PCIe/NVMe**：
     - **速率**：1GB/s - 32GB/s
     - **应用**：高性能 SSD、NVMe 存储
     - **特征**：超高性能、低延迟

2. **网络存储通道**：

   - **以太网（Ethernet）**：

     - **速率**：1Gbps - 400Gbps
     - **应用**：NAS、iSCSI SAN
     - **特征**：网络存储、共享存储

   - **光纤通道（Fibre Channel）**：

     - **速率**：2Gbps - 128Gbps
     - **应用**：FC SAN、企业存储
     - **特征**：高性能、专用网络

   - **InfiniBand**：
     - **速率**：10Gbps - 400Gbps
     - **应用**：HPC 存储、高性能存储
     - **特征**：超高性能、低延迟

#### 04.1.2 物理存储通道在技术栈中的作用

**物理存储通道映射**：

```text
物理存储通道结构:

数据中心物理存储通道:
├── 本地存储通道
│   ├── SATA（本地 HDD/SSD）
│   ├── SAS（企业级存储）
│   └── PCIe/NVMe（高性能 SSD）
├── 网络存储通道
│   ├── 以太网（NAS、iSCSI）
│   ├── 光纤通道（FC SAN）
│   └── InfiniBand（HPC 存储）
└── 存储网络
    ├── 存储交换机
    └── 存储控制器

边缘计算物理存储通道:
├── 本地存储通道
│   ├── eMMC（嵌入式存储）
│   ├── SD 卡接口
│   └── USB 存储
└── 网络存储通道（可选）
    └── WiFi、5G 网络存储
```

### 04.2 逻辑存储通道

#### 04.2.1 逻辑存储通道定义

**逻辑存储通道（Logical Storage Channel）定义**：

逻辑存储通道是指在物理存储通道之上建立的抽象存储访问路径和协议接口。

**逻辑存储通道类型**：

1. **块存储通道**：

   - **虚拟块设备**：在物理存储上创建的虚拟块设备
   - **实现**：LVM、RAID、虚拟磁盘
   - **应用**：虚拟磁盘、容器卷

2. **文件系统通道**：

   - **虚拟文件系统**：在块设备上创建的文件系统
   - **实现**：ext4、XFS、Btrfs、ZFS
   - **应用**：文件存储、目录结构

3. **对象存储通道**：

   - **对象存储接口**：通过 HTTP/HTTPS 访问的对象存储
   - **实现**：S3、Swift、Azure Blob
   - **应用**：云存储、对象存储

4. **网络存储通道**：

   - **NFS（Network File System）**：网络文件系统协议
   - **CIFS/SMB**：Windows 文件共享协议
   - **iSCSI**：网络块存储协议

#### 04.2.2 逻辑存储通道在技术栈中的作用

**逻辑存储通道映射**：

```text
逻辑存储通道结构:

虚拟化逻辑存储通道:
├── 虚拟块设备通道
│   ├── VirtIO Block（虚拟块设备）
│   ├── 虚拟磁盘（Virtual Disk）
│   └── 存储池（Storage Pool）
├── 文件系统通道
│   ├── Guest OS 文件系统（ext4、XFS、NTFS）
│   └── 虚拟文件系统层
└── 网络存储通道
    ├── NFS 客户端（Guest OS）
    └── iSCSI 客户端（Guest OS）

容器化逻辑存储通道:
├── 联合文件系统通道
│   ├── OverlayFS（联合文件系统）
│   ├── 镜像层通道（只读）
│   └── 可写层通道（读写）
├── 卷通道
│   ├── Bind Mount（绑定挂载）
│   ├── Named Volume（命名卷）
│   └── tmpfs（内存文件系统）
└── 网络存储通道
    ├── NFS 卷（容器）
    └── 分布式存储通道（Ceph、GlusterFS）

沙盒化逻辑存储通道:
├── WASI Filesystem 通道
│   ├── 文件系统抽象（WASI FS）
│   ├── 目录映射通道
│   └── 文件访问通道
├── 外部存储通道
│   ├── 外部卷挂载（WASI FS）
│   └── 网络存储通道（通过 Host OS）
└── 零 rootfs（无需存储通道）
```

### 04.3 存储通道映射

#### 04.3.1 物理存储通道与逻辑存储通道映射

**存储通道映射矩阵**：

| 物理存储通道     | 逻辑存储通道          | 映射关系                        | 应用场景             |
| ---------------- | --------------------- | ------------------------------- | -------------------- |
| **SATA/SAS**     | 块设备抽象            | 物理磁盘映射到块设备            | 本地存储、虚拟磁盘   |
| **PCIe/NVMe**    | 块设备抽象            | 物理 SSD 映射到块设备           | 高性能存储、虚拟磁盘 |
| **以太网**       | 文件系统抽象/对象存储 | 网络存储映射到文件系统/对象接口 | NAS、对象存储        |
| **光纤通道**     | 块设备抽象            | FC SAN 映射到块设备             | SAN 存储、虚拟磁盘   |
| **Host OS 存储** | WASI Filesystem       | Host OS 存储映射到 WASI 接口    | Wasm 存储抽象        |

#### 04.3.2 各范式存储通道模型映射

**各范式存储通道映射对比**：

| 范式       | 物理存储通道         | 逻辑存储通道               | 通道抽象层级 |
| ---------- | -------------------- | -------------------------- | ------------ |
| **虚拟化** | SATA/SAS/PCIe/FC     | 虚拟块设备（VirtIO Block） | 硬件级抽象   |
| **容器化** | SATA/SAS/NAS（共享） | 联合文件系统（OverlayFS）  | 进程级抽象   |
| **沙盒化** | Host OS 存储（共享） | WASI Filesystem            | 应用级抽象   |

---

## 05 存储设备模型

### 05.1 物理存储设备

#### 05.1.1 物理存储设备定义

**物理存储设备（Physical Storage Device）定义**：

物理存储设备是实际存在的硬件存储设备，包括磁盘、SSD、存储阵列等。

**物理存储设备特征**：

1. **硬件实现**：

   - **HDD（Hard Disk Drive）**：

     - **容量**：500GB - 20TB
     - **接口**：SATA、SAS
     - **性能**：100-200 IOPS、100-200MB/s
     - **应用**：大容量存储、归档存储

   - **SSD（Solid State Drive）**：

     - **容量**：128GB - 15TB
     - **接口**：SATA、SAS、PCIe/NVMe
     - **性能**：10K-100K IOPS、500MB/s - 7GB/s
     - **应用**：高性能存储、数据库存储

   - **NVMe SSD**：
     - **容量**：256GB - 15TB
     - **接口**：PCIe/NVMe
     - **性能**：100K-1M IOPS、2GB/s - 32GB/s
     - **应用**：超高性能存储、缓存存储

2. **功能特性**：

   - **块设备接口**：提供块级访问接口
   - **存储介质**：磁性介质（HDD）、闪存介质（SSD）
   - **设备驱动**：操作系统与存储设备的接口

#### 05.1.2 物理存储设备在技术栈中的作用

**物理存储设备位置**：

```text
物理存储设备在技术栈中的位置:

物理硬件层:
├── 物理存储设备
│   ├── HDD（硬盘驱动器）
│   │   ├── SATA HDD
│   │   └── SAS HDD
│   ├── SSD（固态硬盘）
│   │   ├── SATA SSD
│   │   ├── SAS SSD
│   │   └── NVMe SSD
│   └── 存储阵列
│       ├── RAID 阵列
│       └── 存储控制器
└── 存储接口
    ├── SATA 接口
    ├── SAS 接口
    └── PCIe/NVMe 接口

操作系统层:
├── 存储设备驱动程序
│   ├── 块设备驱动
│   └── 存储协议驱动
└── 存储设备抽象
    ├── 块设备接口（/dev/sda）
    └── 设备文件系统（/dev）
```

### 05.2 虚拟存储设备

#### 05.2.1 虚拟存储设备定义

**虚拟存储设备（Virtual Storage Device）定义**：

虚拟存储设备是通过软件模拟的存储设备，为虚拟机提供存储连接功能，映射到物理存储设
备或虚拟存储池。

**虚拟存储设备特征**：

1. **软件实现**：

   - **虚拟磁盘（Virtual Disk）**：
     - **虚拟块设备**：软件模拟的块设备
     - **虚拟接口**：VirtIO Block、IDE、SCSI
     - **虚拟队列**：IO 请求队列

2. **虚拟化技术**：

   - **VirtIO Block**：半虚拟化块设备驱动（性能高）
   - **IDE 模拟**：全虚拟化 IDE 设备模拟（兼容性好）
   - **SCSI 模拟**：全虚拟化 SCSI 设备模拟（企业级）

3. **存储虚拟化**：

   - **虚拟存储池**：多个物理存储设备组成的虚拟存储池
   - **虚拟卷**：在存储池上创建的虚拟卷
   - **存储快照**：虚拟存储的时间点快照

#### 05.2.2 虚拟存储设备在技术栈中的作用

**虚拟存储设备映射**：

```text
虚拟化存储设备模型:

Hypervisor 层:
├── 虚拟存储池（Storage Pool）
│   ├── 物理存储聚合
│   ├── 存储池管理
│   └── 虚拟卷创建
└── 虚拟存储设备
    ├── 虚拟磁盘（Virtual Disk）
    │   ├── VirtIO Block（半虚拟化，性能高）
    │   ├── IDE 模拟（全虚拟化，兼容性好）
    │   └── SCSI 模拟（全虚拟化，企业级）
    ├── 虚拟卷（Virtual Volume）
    └── 存储快照（Snapshot）

Guest OS 层:
├── 虚拟存储设备驱动
│   ├── VirtIO 驱动（Guest OS）
│   └── 队列管理
└── Guest OS 存储栈
    ├── 块设备抽象（/dev/vda）
    └── 文件系统层

物理存储层:
└── 物理存储设备
    └── 物理存储阵列
```

**虚拟存储设备类型对比**：

| 虚拟存储设备类型 | 虚拟化方式 | 性能 | 兼容性 | 应用场景           |
| ---------------- | ---------- | ---- | ------ | ------------------ |
| **VirtIO Block** | 半虚拟化   | 高   | 中等   | KVM、Xen           |
| **IDE 模拟**     | 全虚拟化   | 中   | 高     | VMware、兼容性要求 |
| **SCSI 模拟**    | 全虚拟化   | 中   | 高     | 企业级应用         |

### 05.3 逻辑存储设备

#### 05.3.1 逻辑存储设备定义

**逻辑存储设备（Logical Storage Device）定义**：

逻辑存储设备是在物理存储设备或虚拟存储设备之上创建的抽象存储接口，用于实现存储隔
离和逻辑存储分割。

**逻辑存储设备类型**：

1. **OverlayFS 联合文件系统**：

   - **定义**：容器镜像的联合文件系统
   - **实现**：OverlayFS、AUFS、UnionFS
   - **应用**：容器镜像、分层存储

2. **Volume（卷）**：

   - **定义**：容器的持久化存储卷
   - **实现**：Bind Mount、Named Volume、tmpfs
   - **应用**：容器数据持久化

3. **WASI Filesystem**：

   - **定义**：Wasm 模块的文件系统抽象
   - **实现**：WASI Filesystem 接口
   - **应用**：Wasm 文件访问

4. **存储分区/逻辑卷**：

   - **定义**：在物理设备上创建的逻辑分区
   - **实现**：LVM、分区表（GPT/MBR）
   - **应用**：存储管理、逻辑分割

#### 05.3.2 逻辑存储设备在技术栈中的作用

**逻辑存储设备映射**：

```text
逻辑存储设备模型:

容器化逻辑存储设备:
Host OS 层:
├── 物理存储设备（共享）
└── OverlayFS
    ├── Lower Layer（只读，镜像层）
    └── Upper Layer（可写，容器层）

Container 层:
├── 联合文件系统视图
│   ├── 合并视图（Merged View）
│   ├── 只读层（Lower Layer）
│   └── 可写层（Upper Layer）
└── 卷（Volume）
    ├── Bind Mount（主机目录绑定）
    ├── Named Volume（命名卷）
    └── tmpfs（内存文件系统）

沙盒化逻辑存储设备:
Host OS 层:
└── 物理存储设备（共享）

WASI Filesystem 层:
├── WASI Filesystem 抽象
│   ├── 目录映射（Directory Mapping）
│   ├── 文件访问抽象
│   └── 权限控制
└── 外部存储挂载
    └── 通过 WASI FS 访问

Wasm Module 层:
└── Wasm Module（通过 WASI FS 访问存储）
```

**逻辑存储设备对比**：

| 逻辑存储设备类型 | 抽象层级 | 实现方式        | 应用场景           |
| ---------------- | -------- | --------------- | ------------------ |
| **OverlayFS**    | 进程级   | 联合文件系统    | 容器镜像、分层存储 |
| **Volume**       | 进程级   | 绑定挂载/命名卷 | 容器数据持久化     |
| **WASI FS**      | 应用级   | WASI Filesystem | Wasm 文件访问抽象  |
| **LVM**          | 系统级   | 逻辑卷管理      | 存储管理、逻辑分割 |

### 05.4 存储设备模型映射

#### 05.4.1 存储设备模型对比矩阵

**存储设备模型对比**：

| 存储设备类型     | 实现方式   | 抽象层级        | 性能 | 隔离强度        |
| ---------------- | ---------- | --------------- | ---- | --------------- |
| **物理存储设备** | 硬件实现   | 物理层          | 最高 | 物理隔离        |
| **虚拟存储设备** | 软件虚拟化 | 硬件级抽象      | 中等 | 硬件级隔离      |
| **逻辑存储设备** | 软件抽象   | 进程/应用级抽象 | 较高 | 进程/应用级隔离 |

#### 05.4.2 各范式存储设备模型映射

**各范式存储设备模型**：

| 范式       | 存储设备模型              | 实现方式          | 性能特征        |
| ---------- | ------------------------- | ----------------- | --------------- |
| **虚拟化** | 虚拟存储设备（vDisk）     | VirtIO Block、IDE | 15-25% 性能损失 |
| **容器化** | 逻辑存储设备（OverlayFS） | OverlayFS、Volume | 5-10% 性能损失  |
| **沙盒化** | WASI Filesystem           | WASI FS           | < 2% 性能损失   |

---

## 06 存储协议栈

### 06.1 存储协议栈模型

#### 06.1.1 存储协议栈定义

**存储协议栈（Storage Protocol Stack）定义**：

存储协议栈是指从应用程序到物理存储设备的完整存储访问协议层次结构。

**存储协议栈层次**：

1. **应用层（Application Layer）**：

   - **功能**：应用程序文件操作
   - **接口**：POSIX API、文件系统 API

2. **文件系统层（File System Layer）**：

   - **功能**：文件系统管理、目录结构、文件元数据
   - **实现**：ext4、XFS、Btrfs、ZFS、NTFS

3. **虚拟文件系统层（VFS - Virtual File System）**：

   - **功能**：统一文件系统接口、文件系统抽象
   - **实现**：Linux VFS、Windows VFS

4. **块设备层（Block Device Layer）**：

   - **功能**：块设备管理、IO 调度、块缓存
   - **实现**：块设备驱动、IO 调度器（CFQ、Deadline、Noop）

5. **设备驱动层（Device Driver Layer）**：

   - **功能**：存储设备驱动、设备控制、数据传输
   - **实现**：SATA 驱动、SAS 驱动、NVMe 驱动

6. **硬件层（Hardware Layer）**：
   - **功能**：物理存储设备、硬件接口
   - **设备**：HDD、SSD、存储阵列

#### 06.1.2 存储协议栈在各范式中的映射

**存储协议栈映射**：

```text
存储协议栈在各范式中的位置:

虚拟化存储协议栈:
├── 应用层: Guest OS 应用程序
├── 文件系统层: Guest OS 文件系统（ext4、XFS、NTFS）
├── 虚拟文件系统层: Guest OS VFS
├── 块设备层: Guest OS 块设备层
├── 虚拟存储层: 虚拟块设备（VirtIO Block）
├── Hypervisor 层: 虚拟存储管理、IO 拦截
├── 块设备层: Host OS 块设备层
├── 设备驱动层: Host OS 存储驱动
└── 硬件层: 物理存储设备

容器化存储协议栈:
├── 应用层: Container 应用程序
├── 文件系统层: OverlayFS（联合文件系统）
│   ├── Upper Layer（可写层）
│   └── Lower Layer（只读层）
├── 虚拟文件系统层: Host OS VFS（共享）
├── 块设备层: Host OS 块设备层（共享）
├── 设备驱动层: Host OS 存储驱动（共享）
└── 硬件层: 物理存储设备（共享）

沙盒化存储协议栈:
├── 应用层: Wasm Module 应用程序
├── WASI Filesystem 层: WASI FS 抽象
│   ├── 文件系统抽象
│   └── 目录映射
├── 虚拟文件系统层: Host OS VFS（共享）
├── 块设备层: Host OS 块设备层（共享）
├── 设备驱动层: Host OS 存储驱动（共享）
└── 硬件层: 物理存储设备（共享）
```

### 06.2 存储接口标准

#### 06.2.1 存储接口标准定义

**存储接口标准**：

1. **POSIX 文件系统接口**：

   - **定义**：可移植操作系统接口的文件系统标准
   - **函数**：open()、read()、write()、close()
   - **应用**：Unix/Linux 文件系统访问

2. **块设备接口**：

   - **定义**：块设备的直接访问接口
   - **接口**：/dev/sda、/dev/vda
   - **应用**：磁盘分区、LVM、虚拟磁盘

3. **对象存储接口**：

   - **定义**：对象存储的 HTTP/REST 接口
   - **标准**：S3 API、Swift API
   - **应用**：云存储、对象存储

4. **网络存储接口**：
   - **NFS（Network File System）**：网络文件系统协议
   - **CIFS/SMB**：Windows 文件共享协议
   - **iSCSI**：网络块存储协议

#### 06.2.2 存储接口标准在各范式中的应用

**存储接口标准映射**：

```text
存储接口标准应用:

虚拟化存储接口:
├── POSIX 接口（Guest OS）
│   ├── Guest OS 文件系统 API
│   └── 应用程序文件操作
├── 块设备接口（Guest OS）
│   ├── /dev/vda（虚拟块设备）
│   └── 虚拟磁盘访问
└── 网络存储接口（Guest OS）
    ├── NFS 客户端
    └── iSCSI 客户端

容器化存储接口:
├── POSIX 接口（Container）
│   ├── Container 文件系统 API
│   └── 应用程序文件操作
├── 卷接口（Container）
│   ├── Volume Mount（卷挂载）
│   └── 持久化存储访问
└── 网络存储接口（Container）
    ├── NFS 卷
    └── 分布式存储接口

沙盒化存储接口:
├── WASI Filesystem 接口
│   ├── WASI FS API
│   ├── 文件操作抽象
│   └── 目录映射接口
├── POSIX 接口（通过 WASI）
│   └── 文件系统操作（WASI 抽象）
└── 外部存储接口
    └── 通过 WASI FS 访问外部存储
```

### 06.3 各范式存储栈对比

#### 06.3.1 存储协议栈对比矩阵

**存储协议栈对比**：

| 协议栈层次     | 虚拟化          | 容器化                 | 沙盒化                 |
| -------------- | --------------- | ---------------------- | ---------------------- |
| **应用层**     | Guest OS App    | Container App          | Wasm Module            |
| **文件系统层** | Guest OS FS     | OverlayFS              | WASI FS                |
| **VFS 层**     | Guest OS VFS    | Host OS VFS（共享）    | Host OS VFS（共享）    |
| **块设备层**   | Guest OS Block  | Host OS Block（共享）  | Host OS Block（共享）  |
| **驱动层**     | Guest OS Driver | Host OS Driver（共享） | Host OS Driver（共享） |
| **硬件层**     | 物理存储设备    | 物理存储设备（共享）   | 物理存储设备（共享）   |

---

## 07 虚拟化存储架构

### 07.1 虚拟化存储拓扑

#### 07.1.1 虚拟化存储拓扑结构

**虚拟化存储拓扑**：

```text
虚拟化存储拓扑:

物理存储层:
├── DAS（直接连接存储）
│   ├── 本地磁盘（HDD/SSD）
│   └── NVMe SSD
├── SAN（存储区域网络）
│   ├── FC SAN（光纤通道）
│   └── iSCSI SAN（以太网）
└── NAS（网络附加存储）
    └── NFS/CIFS 存储

Hypervisor 层:
├── 存储池（Storage Pool）
│   ├── 本地存储池
│   ├── 网络存储池
│   └── 分布式存储池
└── 虚拟存储管理
    ├── 虚拟卷管理
    ├── 存储快照
    └── 存储迁移

Guest OS 层:
├── VM₁
│   ├── 虚拟磁盘（vDisk₁）
│   ├── Guest OS 文件系统
│   └── 应用程序
├── VM₂
│   ├── 虚拟磁盘（vDisk₂）
│   ├── Guest OS 文件系统
│   └── 应用程序
└── VMₙ
    ├── 虚拟磁盘（vDiskₙ）
    ├── Guest OS 文件系统
    └── 应用程序
```

**虚拟化存储拓扑类型**：

1. **本地存储模式**：

   - **拓扑**：VM 使用 Hypervisor 本地存储
   - **特征**：高性能、低延迟、单机存储
   - **应用**：开发环境、测试环境

2. **共享存储模式**：

   - **拓扑**：多个 VM 共享 SAN/NAS 存储
   - **特征**：共享存储、高可用、存储迁移
   - **应用**：企业应用、高可用集群

3. **分布式存储模式**：
   - **拓扑**：VM 使用分布式存储系统
   - **特征**：可扩展、高可用、分布式访问
   - **应用**：云环境、大规模部署

### 07.2 虚拟化存储设备模型

#### 07.2.1 虚拟化存储设备架构

**虚拟化存储设备架构**：

```text
虚拟化存储设备架构:

物理层:
└── 物理存储设备
    ├── HDD、SSD、NVMe SSD
    └── 存储阵列

Hypervisor 层:
├── 存储池（Storage Pool）
│   ├── 存储设备聚合
│   ├── 存储池管理
│   └── 虚拟卷创建
└── 虚拟存储设备
    ├── 虚拟磁盘（Virtual Disk）
    │   ├── VirtIO Block（半虚拟化）
    │   ├── IDE 模拟（全虚拟化）
    │   └── SCSI 模拟（全虚拟化）
    ├── 虚拟卷（Virtual Volume）
    └── 存储快照（Snapshot）

Guest OS 层:
├── 虚拟块设备（/dev/vda）
│   ├── VirtIO 驱动（Guest OS）
│   └── 块设备抽象
└── Guest OS 文件系统
    ├── 文件系统格式化（ext4、XFS、NTFS）
    └── 文件系统挂载
```

### 07.3 虚拟化存储隔离

#### 07.3.1 虚拟化存储隔离机制

**虚拟化存储隔离**：

1. **虚拟磁盘隔离**：

   - **磁盘隔离**：每个 VM 拥有独立的虚拟磁盘
   - **存储隔离**：VM 之间的存储完全隔离
   - **数据安全**：一个 VM 的故障不影响其他 VM

2. **存储池隔离**：

   - **存储池分离**：不同租户使用不同的存储池
   - **逻辑隔离**：通过存储池实现逻辑隔离
   - **QoS 控制**：存储池级别的 QoS 控制

3. **存储快照隔离**：
   - **快照隔离**：快照与源磁盘隔离
   - **只读快照**：快照为只读，不影响源磁盘
   - **快照管理**：快照的生命周期管理

---

## 08 容器化存储架构

### 08.1 容器化存储拓扑

#### 08.1.1 容器化存储拓扑结构

**容器化存储拓扑**：

```text
容器化存储拓扑:

物理存储层:
├── DAS（本地存储）
│   ├── 本地磁盘（HDD/SSD）
│   └── NVMe SSD
├── NAS（网络存储）
│   ├── NFS 存储
│   └── CIFS/SMB 存储
└── 分布式存储
    ├── Ceph
    ├── GlusterFS
    └── 对象存储（S3）

Host OS 层:
├── 文件系统（ext4、XFS）
├── 块设备层
└── 存储驱动
    ├── OverlayFS 驱动
    └── 卷管理

容器镜像层:
├── 镜像层（Image Layers）
│   ├── 基础层（Base Layer，只读）
│   ├── 应用层（Application Layer，只读）
│   └── 配置层（Config Layer，只读）
└── OverlayFS
    ├── Lower Layer（只读）
    ├── Upper Layer（可写）
    └── 合并视图（Merged View）

容器层:
├── Container₁
│   ├── OverlayFS（联合文件系统）
│   ├── Volume Mount（卷挂载）
│   └── 应用程序
├── Container₂
│   ├── OverlayFS（联合文件系统）
│   ├── Volume Mount（卷挂载）
│   └── 应用程序
└── Containerₙ
    ├── OverlayFS（联合文件系统）
    ├── Volume Mount（卷挂载）
    └── 应用程序
```

**容器化存储拓扑类型**：

1. **镜像层存储**：

   - **拓扑**：容器使用 OverlayFS 联合文件系统
   - **特征**：镜像层共享、只读层复用
   - **应用**：容器运行、镜像分层

2. **卷存储**：

   - **拓扑**：容器通过卷挂载访问持久化存储
   - **特征**：数据持久化、卷共享
   - **应用**：数据库存储、日志存储

3. **网络存储**：
   - **拓扑**：容器通过网络存储访问共享存储
   - **特征**：共享存储、分布式存储
   - **应用**：Kubernetes PVC、分布式存储

### 08.2 容器化存储设备模型

#### 08.2.1 容器化存储设备架构

**容器化存储设备架构**：

```text
容器化存储设备架构:

物理层:
└── 物理存储设备（共享）

Host OS 层:
├── 文件系统（ext4、XFS）
├── 块设备层（共享）
└── OverlayFS
    ├── Lower Layer（只读层，镜像层）
    └── Upper Layer（可写层，容器层）

Container 层:
├── 联合文件系统视图
│   ├── 合并视图（Merged View）
│   │   ├── 只读层（Lower Layer）
│   │   └── 可写层（Upper Layer）
│   ├── 只读层（镜像层，共享）
│   └── 可写层（容器层，独立）
└── 卷（Volume）
    ├── Bind Mount（主机目录绑定）
    ├── Named Volume（命名卷）
    └── tmpfs（内存文件系统）
```

### 08.3 容器化存储隔离

#### 08.3.1 容器化存储隔离机制

**容器化存储隔离**：

1. **文件系统隔离**：

   - **OverlayFS 隔离**：每个容器拥有独立的可写层
   - **层隔离**：容器之间的可写层完全隔离
   - **镜像层共享**：多个容器共享只读镜像层

2. **卷隔离**：

   - **卷隔离**：每个容器可以挂载独立的卷
   - **卷共享**：多个容器可以共享同一个卷（需要并发控制）
   - **卷权限**：卷的读写权限控制

3. **命名空间隔离**：
   - **Mount Namespace**：容器拥有独立的挂载命名空间
   - **文件系统隔离**：容器之间的文件系统隔离
   - **路径隔离**：容器内的路径与主机路径隔离

---

## 09 沙盒化存储架构

### 09.1 沙盒化存储拓扑

#### 09.1.1 沙盒化存储拓扑结构

**沙盒化存储拓扑**：

```text
沙盒化存储拓扑:

物理存储层:
├── DAS（本地存储）
│   ├── 本地磁盘（HDD/SSD）
│   └── NVMe SSD
└── NAS（网络存储，可选）
    └── NFS 存储

Host OS 层:
├── 文件系统（ext4、XFS）
├── 块设备层（共享）
├── 文件系统层（共享）
└── 存储驱动（共享）

WASI Filesystem 层:
├── WASI Filesystem 抽象
│   ├── 目录映射（Directory Mapping）
│   ├── 文件访问抽象
│   └── 权限控制
└── 外部存储挂载
    └── 通过 WASI FS 访问

Wasm Module 层:
├── Wasm Module₁
│   ├── WASI FS 调用
│   └── 存储应用程序
├── Wasm Module₂
│   ├── WASI FS 调用
│   └── 存储应用程序
└── Wasm Moduleₙ
    ├── WASI FS 调用
    └── 存储应用程序
```

**沙盒化存储拓扑特征**：

1. **共享存储栈**：

   - 所有 Wasm 模块共享 Host OS 存储协议栈
   - 无独立的文件系统层
   - 轻量级存储抽象

2. **WASI Filesystem 抽象**：

   - 通过 WASI FS 抽象提供存储接口
   - 文件系统函数调用拦截
   - 最小化存储开销

3. **零 rootfs**：
   - 无需文件系统镜像
   - 直接访问主机文件系统
   - 存储开销最小

### 09.2 沙盒化存储设备模型

#### 09.2.1 沙盒化存储设备架构

**沙盒化存储设备架构**：

```text
沙盒化存储设备架构:

物理层:
└── 物理存储设备（共享）

Host OS 层:
├── 文件系统（ext4、XFS，共享）
├── 块设备层（共享）
└── 存储驱动（共享）

WASI Filesystem 层:
├── WASI Filesystem 抽象
│   ├── 文件系统抽象（逻辑存储设备）
│   ├── 目录映射（Directory Mapping）
│   ├── 文件访问抽象
│   └── 权限控制
└── 函数调用拦截
    ├── 文件操作函数（open、read、write）
    ├── 目录操作函数（mkdir、rmdir）
    └── 权限检查

Wasm Module 层:
├── Wasm Runtime
│   ├── WASI FS 实现
│   └── 文件系统函数绑定
└── Wasm Module
    └── 存储应用程序（通过 WASI FS 调用）
```

### 09.3 沙盒化存储隔离

#### 09.3.1 沙盒化存储隔离机制

**沙盒化存储隔离**：

1. **WASI 权限隔离**：

   - **文件系统权限**：限制 Wasm 模块的文件系统权限
   - **目录访问控制**：通过 WASI 权限控制目录访问
   - **最小权限原则**：只授予必要的文件系统权限

2. **目录映射隔离**：

   - **目录隔离**：每个 Wasm 模块拥有独立的目录映射
   - **路径隔离**：Wasm 模块的路径与主机路径隔离
   - **访问控制**：限制 Wasm 模块的访问范围

3. **函数调用拦截**：
   - **系统调用拦截**：拦截文件系统相关的系统调用
   - **权限检查**：在系统调用层面进行权限检查
   - **访问控制**：限制文件系统访问范围

---

## 10 存储架构对比矩阵

### 10.1 存储拓扑对比矩阵

**存储拓扑对比**：

| 拓扑维度     | 虚拟化                   | 容器化                 | 沙盒化          |
| ------------ | ------------------------ | ---------------------- | --------------- |
| **物理拓扑** | DAS/SAN                  | DAS/NAS                | Host OS 存储    |
| **逻辑拓扑** | 虚拟磁盘（Virtual Disk） | 镜像层（Image Layers） | WASI Filesystem |
| **存储抽象** | 硬件级抽象               | 进程级抽象             | 应用级抽象      |
| **存储隔离** | 虚拟磁盘隔离             | OverlayFS 隔离         | WASI 权限隔离   |

### 10.2 存储访问模式对比矩阵

**存储访问模式对比**：

| 访问模式     | 虚拟化     | 容器化            | 沙盒化          |
| ------------ | ---------- | ----------------- | --------------- |
| **主要模式** | 读写、并发 | 只读、读写、并发  | 读写、并发      |
| **实现方式** | 虚拟磁盘   | OverlayFS、Volume | WASI Filesystem |
| **性能损失** | 15-25%     | 5-10%             | < 2%            |

### 10.3 存储通道模型对比矩阵

**存储通道模型对比**：

| 通道类型     | 虚拟化                     | 容器化                    | 沙盒化               |
| ------------ | -------------------------- | ------------------------- | -------------------- |
| **物理通道** | SATA/SAS/PCIe/FC           | SATA/SAS/NAS（共享）      | Host OS 存储（共享） |
| **逻辑通道** | 虚拟块设备（VirtIO Block） | 联合文件系统（OverlayFS） | WASI Filesystem      |
| **通道抽象** | 硬件级抽象                 | 进程级抽象                | 应用级抽象           |

### 10.4 存储设备模型对比矩阵

**存储设备模型对比**：

| 设备类型     | 虚拟化                | 容器化                    | 沙盒化          |
| ------------ | --------------------- | ------------------------- | --------------- |
| **设备模型** | 虚拟存储设备（vDisk） | 逻辑存储设备（OverlayFS） | WASI Filesystem |
| **实现方式** | VirtIO Block          | OverlayFS、Volume         | WASI FS         |
| **性能**     | 15-25% 性能损失       | 5-10% 性能损失            | < 2% 性能损失   |
| **隔离强度** | 硬件级隔离            | 进程级隔离                | 应用级隔离      |

### 10.5 存储协议栈对比矩阵

**存储协议栈对比**：

| 协议栈层次     | 虚拟化          | 容器化                 | 沙盒化                 |
| -------------- | --------------- | ---------------------- | ---------------------- |
| **应用层**     | Guest OS App    | Container App          | Wasm Module            |
| **文件系统层** | Guest OS FS     | OverlayFS              | WASI FS                |
| **VFS 层**     | Guest OS VFS    | Host OS VFS（共享）    | Host OS VFS（共享）    |
| **块设备层**   | Guest OS Block  | Host OS Block（共享）  | Host OS Block（共享）  |
| **驱动层**     | Guest OS Driver | Host OS Driver（共享） | Host OS Driver（共享） |
| **硬件层**     | 物理存储设备    | 物理存储设备（共享）   | 物理存储设备（共享）   |

---

## 11 参考

**关联文档**：

- **[理论模型](../01-theory-models/)** - 技术范式背后的理论模型
- **[技术名词概念论证](technical-concepts-explanation.md)** - 技术名词概念论证
- **[网络概念论证](02-network-concepts-explanation.md)** - 网络架构论证
- **[资源模型](../01-theory-models/01-resource-models.md)** - 存储资源模型

**外部参考**：

- [Storage Area Network](https://en.wikipedia.org/wiki/Storage_area_network)
- [Network-Attached Storage](https://en.wikipedia.org/wiki/Network-attached_storage)
- [OverlayFS](https://en.wikipedia.org/wiki/OverlayFS)
- [WASI Filesystem](https://wasi.dev/)

---

**最后更新**：2025-11-03 **维护者**：项目团队

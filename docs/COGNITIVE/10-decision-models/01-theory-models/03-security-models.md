# 03. 安全模型理论

## 目录

- [目录](#目录)
- [03.1 概述](#031-概述)
- [03.2 信任边界模型](#032-信任边界模型)
  - [03.2.1 信任边界定义](#0321-信任边界定义)
  - [03.2.2 各范式信任边界](#0322-各范式信任边界)
    - [虚拟化信任边界](#虚拟化信任边界)
    - [容器化信任边界](#容器化信任边界)
    - [沙盒化信任边界](#沙盒化信任边界)
  - [03.2.3 信任假设对比](#0323-信任假设对比)
    - [虚拟化信任假设](#虚拟化信任假设)
    - [容器化信任假设](#容器化信任假设)
    - [沙盒化信任假设](#沙盒化信任假设)
- [03.3 攻击面模型](#033-攻击面模型)
  - [03.3.1 攻击面定义](#0331-攻击面定义)
  - [03.3.2 攻击面数学模型](#0332-攻击面数学模型)
  - [03.3.3 各范式攻击面分析](#0333-各范式攻击面分析)
    - [虚拟化攻击面](#虚拟化攻击面)
    - [容器化攻击面](#容器化攻击面)
    - [沙盒化攻击面](#沙盒化攻击面)
- [03.4 安全隔离模型](#034-安全隔离模型)
  - [03.4.1 安全隔离机制](#0341-安全隔离机制)
  - [03.4.2 安全威胁分析](#0342-安全威胁分析)
  - [03.4.3 安全加固措施](#0343-安全加固措施)
- [03.5 安全模型权衡决策](#035-安全模型权衡决策)
- [03.6 参考](#036-参考)

---

## 03.1 概述

**安全模型是技术范式选择的重要考虑因素**。安全模型包括信任边界模型、攻击面模型、
安全隔离模型。

本文档深入分析虚拟化、容器化、沙盒化的安全模型，包括信任边界、攻击面、安全威胁等
理论模型。

**核心问题**：

- 为什么虚拟化、容器化、沙盒化的安全性不同？
- 不同范式的信任边界和攻击面是什么？
- 如何根据安全需求选择合适的技术范式？

---

## 03.2 信任边界模型

### 03.2.1 信任边界定义

**信任边界**是系统中信任与不信任的分界线。在信任边界内，组件是可信的；在信任边界
外，组件是不可信的。

**信任边界模型**：

$$T_{\text{boundary}} = \{C_i | \text{trust}(C_i) = \text{true}\}$$

其中：

- $T_{\text{boundary}}$：信任边界集合
- $C_i$：组件 $i$
- $\text{trust}(C_i)$：组件 $i$ 的可信度

### 03.2.2 各范式信任边界

**信任边界对比**：

| 范式       | 信任边界   | 信任假设                         | 攻击面                     |
| ---------- | ---------- | -------------------------------- | -------------------------- |
| **虚拟化** | Hypervisor | 信任 Hypervisor，不信任 Guest    | Hypervisor 漏洞            |
| **容器化** | Host 内核  | 信任 Host 内核，不信任容器       | 内核漏洞、Namespace 逃逸   |
| **沙盒化** | Runtime    | 信任 Runtime 和 Host，不信任应用 | Runtime 漏洞、系统调用漏洞 |

**信任边界示意图**：

```text
虚拟化信任边界:
┌─────────────────────────────────────┐
│  Hypervisor（可信）                  │
│  ├── Host Kernel（可信）              │
│  └── 信任边界 ────────────────────── │
│      └── Guest OS（不可信）           │
│          └── Guest App（不可信）       │
└─────────────────────────────────────┘

容器化信任边界:
┌─────────────────────────────────────┐
│  Host 内核（可信）                    │
│  └── 信任边界 ────────────────────── │
│      ├── Container 1（不可信）        │
│      └── Container 2（不可信）        │
└─────────────────────────────────────┘

沙盒化信任边界:
┌─────────────────────────────────────┐
│  Host 内核（可信）                    │
│  ├── Runtime（可信）                  │
│  └── 信任边界 ────────────────────── │
│      ├── Wasm Module 1（不可信）      │
│      └── Wasm Module 2（不可信）      │
└─────────────────────────────────────┘
```

#### 虚拟化信任边界

**信任边界**：Hypervisor

**信任假设**：

- **信任**：Hypervisor、Host 内核、硬件
- **不信任**：Guest OS、Guest 应用

**信任边界特征**：

- **边界位置**：Hypervisor 层
- **边界强度**：硬件级隔离
- **边界范围**：物理硬件层面

**信任边界模型**：

$$T_{\text{VM}} = \{\text{Hypervisor}, \text{Host Kernel}, \text{Hardware}\}$$

**攻击面**：Hypervisor 漏洞、硬件漏洞

#### 容器化信任边界

**信任边界**：Host 内核

**信任假设**：

- **信任**：Host 内核、Host OS
- **不信任**：容器、容器应用

**信任边界特征**：

- **边界位置**：Host 内核层
- **边界强度**：进程级隔离
- **边界范围**：进程地址空间层面

**信任边界模型**：

$$T_{\text{Container}} = \{\text{Host Kernel}, \text{Host OS}\}$$

**攻击面**：内核漏洞、Namespace 逃逸、系统调用漏洞

#### 沙盒化信任边界

**信任边界**：Runtime 和 Host

**信任假设**：

- **信任**：Runtime、Host 内核、Host OS
- **不信任**：应用、Wasm 模块

**信任边界特征**：

- **边界位置**：Runtime 层
- **边界强度**：应用级隔离
- **边界范围**：应用运行时层面

**信任边界模型**：

$$T_{\text{Sandbox}} = \{\text{Runtime}, \text{Host Kernel}, \text{Host OS}\}$$

**攻击面**：Runtime 漏洞、系统调用漏洞、WASI 接口漏洞

### 03.2.3 信任假设对比

**信任假设模型**：

设信任假设为 $H_{\text{trust}}$，则：

$$H_{\text{trust}} = \sum_{i} w_i \cdot \text{trust}(C_i)$$

其中：

- $w_i$：组件 $i$ 的权重
- $\text{trust}(C_i)$：组件 $i$ 的可信度（0-1）

**各范式信任假设**：

#### 虚拟化信任假设

$$H_{\text{VM}} = w_1 \cdot \text{trust}(\text{Hypervisor}) + w_2 \cdot \text{trust}(\text{Host Kernel}) + w_3 \cdot \text{trust}(\text{Hardware})$$

其中：

- $\text{trust}(\text{Hypervisor}) = 0.95$（Hypervisor 经过严格审计）
- $\text{trust}(\text{Host Kernel}) = 0.90$（Host 内核可信）
- $\text{trust}(\text{Hardware}) = 0.99$（硬件可信）

**总体信任度**：高（约 0.95）

#### 容器化信任假设

$$H_{\text{Container}} = w_1 \cdot \text{trust}(\text{Host Kernel}) + w_2 \cdot \text{trust}(\text{Host OS})$$

其中：

- $\text{trust}(\text{Host Kernel}) = 0.85$（内核可信，但有漏洞风险）
- $\text{trust}(\text{Host OS}) = 0.80$（OS 可信，但有配置风险）

**总体信任度**：中（约 0.83）

#### 沙盒化信任假设

$$H_{\text{Sandbox}} = w_1 \cdot \text{trust}(\text{Runtime}) + w_2 \cdot \text{trust}(\text{Host Kernel}) + w_3 \cdot \text{trust}(\text{Host OS})$$

其中：

- $\text{trust}(\text{Runtime}) = 0.80$（Runtime 可信，但实现复杂）
- $\text{trust}(\text{Host Kernel}) = 0.85$（内核可信）
- $\text{trust}(\text{Host OS}) = 0.80$（OS 可信）

**总体信任度**：中（约 0.82）

**信任假设对比**：

| 范式       | 信任组件数量 | 总体信任度 | 信任度等级 |
| ---------- | ------------ | ---------- | ---------- |
| **虚拟化** | 3（最少）    | 0.95       | 高         |
| **容器化** | 2（中等）    | 0.83       | 中         |
| **沙盒化** | 3（最多）    | 0.82       | 中         |

---

## 03.3 攻击面模型

### 03.3.1 攻击面定义

**攻击面**是可能被攻击者利用的接口和漏洞的总和。

**攻击面构成**：

1. **接口暴露**：系统调用、API 接口、网络接口
2. **漏洞存在**：软件漏洞、配置漏洞、设计漏洞
3. **权限暴露**：权限过高、权限泄露

### 03.3.2 攻击面数学模型

**攻击面通用模型**：

设攻击面为 $A_{\text{attack}}$，则：

$$A_{\text{attack}} = \sum_{i} A_{\text{interface}_i} \times P_{\text{vulnerability}_i} + \sum_{j} A_{\text{permission}_j} \times P_{\text{abuse}_j}$$

其中：

- $A_{\text{interface}_i}$：接口 $i$ 的暴露面积
- $P_{\text{vulnerability}_i}$：接口 $i$ 的漏洞概率
- $A_{\text{permission}_j}$：权限 $j$ 的暴露面积
- $P_{\text{abuse}_j}$：权限 $j$ 的滥用概率

**攻击面量化模型**：

$$A_{\text{attack}} = \alpha \cdot \sum_{i} A_{\text{interface}_i} \times P_{\text{vulnerability}_i} + \beta \cdot \sum_{j} A_{\text{permission}_j} \times P_{\text{abuse}_j}$$

其中：

- $\alpha, \beta$：权重系数（$\alpha + \beta = 1$）

### 03.3.3 各范式攻击面分析

#### 虚拟化攻击面

**攻击面组成**：

1. **Hypervisor 接口**：

   - **接口暴露**：Hypervisor API（小）
   - **漏洞概率**：低（约 0.1）
   - **攻击面贡献**：小

2. **虚拟设备接口**：

   - **接口暴露**：VirtIO 接口（小）
   - **漏洞概率**：低（约 0.1）
   - **攻击面贡献**：小

3. **硬件接口**：
   - **接口暴露**：硬件虚拟化接口（极小）
   - **漏洞概率**：极低（约 0.01）
   - **攻击面贡献**：极小

**攻击面计算**：

$$A_{\text{VM}} = 0.1 \times 1 + 0.1 \times 1 + 0.01 \times 0.5 = 0.205$$

**攻击面等级**：小

**主要威胁**：

- **Hypervisor 漏洞**：CVE 漏洞、提权漏洞
- **侧信道攻击**：Meltdown、Spectre
- **硬件漏洞**：微架构漏洞

#### 容器化攻击面

**攻击面组成**：

1. **内核接口**：

   - **接口暴露**：系统调用接口（中）
   - **漏洞概率**：中（约 0.3）
   - **攻击面贡献**：中

2. **Namespace 接口**：

   - **接口暴露**：Namespace API（中）
   - **漏洞概率**：中（约 0.2）
   - **攻击面贡献**：中

3. **Cgroup 接口**：
   - **接口暴露**：Cgroup API（中）
   - **漏洞概率**：低（约 0.1）
   - **攻击面贡献**：小

**攻击面计算**：

$$A_{\text{Container}} = 0.3 \times 3 + 0.2 \times 2 + 0.1 \times 2 = 1.5$$

**攻击面等级**：中

**主要威胁**：

- **内核漏洞**：提权漏洞、内存泄漏
- **Namespace 逃逸**：PID Namespace 逃逸、Mount Namespace 逃逸
- **系统调用漏洞**：系统调用滥用

#### 沙盒化攻击面

**攻击面组成**：

1. **系统调用接口**：

   - **接口暴露**：WASI、系统调用（大）
   - **漏洞概率**：中高（约 0.5）
   - **攻击面贡献**：大

2. **Runtime 接口**：

   - **接口暴露**：Runtime API（中）
   - **漏洞概率**：中（约 0.3）
   - **攻击面贡献**：中

3. **WASI 接口**：
   - **接口暴露**：WASI 系统接口（大）
   - **漏洞概率**：中（约 0.3）
   - **攻击面贡献**：大

**攻击面计算**：

$$A_{\text{Sandbox}} = 0.5 \times 5 + 0.3 \times 3 + 0.3 \times 4 = 4.6$$

**攻击面等级**：大

**主要威胁**：

- **系统调用漏洞**：系统调用滥用、权限提升
- **Runtime 漏洞**：Runtime 实现漏洞
- **WASI 接口漏洞**：WASI 接口设计漏洞

**攻击面对比**：

| 范式       | 接口数量 | 漏洞概率    | 总攻击面 | 攻击面等级 |
| ---------- | -------- | ----------- | -------- | ---------- |
| **虚拟化** | 少（3）  | 低（0.1）   | 0.205    | 小         |
| **容器化** | 中（3）  | 中（0.2）   | 1.5      | 中         |
| **沙盒化** | 多（3）  | 中高（0.4） | 4.6      | 大         |

---

## 03.4 安全隔离模型

### 03.4.1 安全隔离机制

**安全隔离机制**是实现安全边界的技术手段。

**安全隔离机制分类**：

1. **硬件级隔离**（虚拟化）：

   - **机制**：Hypervisor + 硬件虚拟化
   - **隔离强度**：最强
   - **安全边界**：物理硬件

2. **软件级隔离**（容器化）：

   - **机制**：Namespace + Cgroup + Capabilities
   - **隔离强度**：中等
   - **安全边界**：进程地址空间

3. **应用级隔离**（沙盒化）：
   - **机制**：系统调用拦截 + 能力限制
   - **隔离强度**：较弱
   - **安全边界**：应用运行时

**安全隔离机制对比**：

| 范式       | 隔离机制                          | 隔离强度 | 安全边界     |
| ---------- | --------------------------------- | -------- | ------------ |
| **虚拟化** | Hypervisor + 硬件虚拟化           | 最强     | 物理硬件     |
| **容器化** | Namespace + Cgroup + Capabilities | 中等     | 进程地址空间 |
| **沙盒化** | 系统调用拦截 + 能力限制           | 较弱     | 应用运行时   |

### 03.4.2 安全威胁分析

**安全威胁分类**：

1. **提权攻击**：

   - **虚拟化**：Hypervisor 提权（风险低）
   - **容器化**：内核提权、Namespace 逃逸（风险中）
   - **沙盒化**：Runtime 提权、系统调用滥用（风险中高）

2. **侧信道攻击**：

   - **虚拟化**：Meltdown、Spectre（风险中）
   - **容器化**：缓存侧信道（风险低）
   - **沙盒化**：时间侧信道（风险低）

3. **数据泄露**：
   - **虚拟化**：Guest 内存泄露（风险低）
   - **容器化**：容器间数据泄露（风险中）
   - **沙盒化**：应用间数据泄露（风险中高）

**安全威胁对比**：

| 威胁类型       | 虚拟化 | 容器化 | 沙盒化 |
| -------------- | ------ | ------ | ------ |
| **提权攻击**   | 低     | 中     | 中高   |
| **侧信道攻击** | 中     | 低     | 低     |
| **数据泄露**   | 低     | 中     | 中高   |

### 03.4.3 安全加固措施

**安全加固措施**：

1. **虚拟化安全加固**：

   - **Hypervisor 硬化**：最小化 Hypervisor 接口
   - **硬件安全**：利用硬件安全特性（Intel TXT、AMD SVM）
   - **侧信道防护**：Spectre/Meltdown 缓解措施

2. **容器化安全加固**：

   - **最小权限**：Dropped Capabilities、Read-only RootFS
   - **安全上下文**：SELinux、AppArmor
   - **镜像扫描**：漏洞扫描、安全审计

3. **沙盒化安全加固**：
   - **系统调用过滤**：seccomp、WASI 限制
   - **资源限制**：内存限制、CPU 限制
   - **Runtime 加固**：最小化 Runtime 接口

**安全加固措施对比**：

| 范式       | 主要加固措施                   | 加固效果 |
| ---------- | ------------------------------ | -------- |
| **虚拟化** | Hypervisor 硬化、硬件安全      | 高       |
| **容器化** | 最小权限、安全上下文、镜像扫描 | 中       |
| **沙盒化** | 系统调用过滤、资源限制         | 中       |

---

## 03.5 安全模型权衡决策

**安全模型权衡决策规则**：

```text
if 高安全要求:
    return 虚拟化（攻击面最小，隔离强度最强）
elif 中等安全要求:
    return 容器化（平衡安全与性能）
elif 低安全要求:
    return 沙盒化（性能优先）
```

**决策矩阵**：

| 场景             | 安全需求 | 推荐范式 | 攻击面 | 隔离强度 | 理由                 |
| ---------------- | -------- | -------- | ------ | -------- | -------------------- |
| **金融系统**     | 高安全   | 虚拟化   | 小     | 最强     | 最小攻击面，最强隔离 |
| **企业应用**     | 高安全   | 虚拟化   | 小     | 最强     | 合规要求，强隔离     |
| **微服务应用**   | 中等安全 | 容器化   | 中     | 中等     | 平衡安全与性能       |
| **CI/CD 流水线** | 中等安全 | 容器化   | 中     | 中等     | 安全与效率平衡       |
| **边缘计算**     | 低安全   | 沙盒化   | 大     | 较弱     | 性能优先，轻量安全   |
| **Serverless**   | 低安全   | 沙盒化   | 大     | 较弱     | 快速启动，轻量安全   |

**权衡因素**：

1. **攻击面**：虚拟化（小）< 容器化（中）< 沙盒化（大）
2. **隔离强度**：虚拟化（最强）> 容器化（中等）> 沙盒化（较弱）
3. **信任度**：虚拟化（高）> 容器化（中）> 沙盒化（中）
4. **安全威胁**：虚拟化（低）< 容器化（中）< 沙盒化（中高）
5. **加固效果**：虚拟化（高）> 容器化（中）> 沙盒化（中）

---

## 03.6 参考

**关联文档**：

- **[资源模型](01-resource-models.md)** - 物理资源权衡模型
- **[隔离模型](02-isolation-models.md)** - 隔离机制理论模型
- **[分布式系统模型](04-distributed-models.md)** - 分布式系统理论模型
- **[主文档](../decision-models.md)** - 完整技术决策模型文档

**外部参考**：

- [Security model](https://en.wikipedia.org/wiki/Security_model)
- [Attack surface](https://en.wikipedia.org/wiki/Attack_surface)
- [Trust boundary](https://en.wikipedia.org/wiki/Trust_boundary)
- [Spectre (security vulnerability)](<https://en.wikipedia.org/wiki/Spectre_(security_vulnerability)>)
- [Meltdown (security vulnerability)](<https://en.wikipedia.org/wiki/Meltdown_(security_vulnerability)>)

---

**最后更新**：2025-01-XX **维护者**：项目团队

# 12.2.2 æ§åˆ¶ç»“æ„ï¼ˆControl Structureï¼‰â€”â€” åºè§†è§’

## ğŸ“‘ ç›®å½•

- [12.2.2.1 å®šä¹‰ä¸æ ¸å¿ƒç‰¹å¾](#12221-å®šä¹‰ä¸æ ¸å¿ƒç‰¹å¾)
- [12.2.2.2 å…¸å‹å®ä¾‹](#12222-å…¸å‹å®ä¾‹)
- [12.2.2.3 å½¢å¼åŒ–å·¥å…·](#12223-å½¢å¼åŒ–å·¥å…·)
- [12.2.2.4 å“²å­¦æ„ä¹‰](#12224-å“²å­¦æ„ä¹‰)
- [12.2.2.5 å‚è€ƒ](#12225-å‚è€ƒ)

---

## 12.2.2.1 å®šä¹‰ä¸æ ¸å¿ƒç‰¹å¾

### å®šä¹‰

æ§åˆ¶ç»“æ„å›ç­”**"ä½•æ—¶å‘ç”Ÿ"**ä¸**"ä»¥ä½•é¡ºåºå‘ç”Ÿ"**ã€‚å®ƒå¼•å…¥**æ—¶é—´ç»´åº¦**ï¼ˆé€»è¾‘æ—¶é—´æˆ–ç‰©
ç†æ—¶é—´ï¼‰ï¼Œæ˜¯è®¡ç®—æœºç§‘å­¦çš„"è¯­ä¹‰"ä¸"æ—¶åºé€»è¾‘"å±‚é¢ã€‚

### ç±»æ¯”

åºç»“æ„ï¼ˆååºã€å…¨åºã€æ ¼ï¼‰

### æ ¸å¿ƒç‰¹å¾

- **é¡ºåºæ€§**ï¼šè¯­å¥æ‰§è¡Œçš„å…ˆåå…³ç³»
- **ä¾èµ–æ€§**ï¼šæ•°æ®ä¾èµ–ã€æ§åˆ¶ä¾èµ–
- **å¹¶å‘æ€§**ï¼šäº‹ä»¶é—´çš„ååºå…³ç³»ï¼ˆéå…¨åºï¼‰
- **åŒæ­¥æœºåˆ¶**ï¼šé€šè¿‡å±éšœã€é”ã€æ¶ˆæ¯ç­‰å»ºç«‹åºå…³ç³»

### ä¸åºç»“æ„çš„å¯¹åº”

| åºç»“æ„ç‰¹å¾ | æ§åˆ¶ç»“æ„å¯¹åº”        | ç¤ºä¾‹                         |
| ---------- | ------------------- | ---------------------------- |
| **ååº**   | Happens-before å…³ç³» | `a â†’ b`ï¼ˆa åœ¨å› æœä¸Šå…ˆäº bï¼‰  |
| **å…¨åº**   | ä¸²è¡Œæ‰§è¡Œ            | å•çº¿ç¨‹ç¨‹åºçš„æ‰§è¡Œé¡ºåº         |
| **æ ¼**     | èµ„æºåˆ†é…å›¾          | æ­»é”æ£€æµ‹ä¸­çš„èµ„æºåˆ†é…å›¾       |
| **è‰¯åº**   | æ— æ­»é”çš„æ‰§è¡Œ        | é“¶è¡Œå®¶ç®—æ³•ä¿è¯çš„èµ„æºåˆ†é…è‰¯åº |

---

## 12.2.2.2 å…¸å‹å®ä¾‹

### 1. ç¨‹åºæ§åˆ¶æµå›¾ï¼ˆCFGï¼‰

**ç»“æ„**ï¼šæœ‰å‘å›¾ï¼ˆååºï¼‰

**åºè§£é‡Š**ï¼š

- åŸºæœ¬å—ä¹‹é—´æ„æˆååº
- å¾ªç¯å¼•å…¥éè‰¯åº

**ç¤ºä¾‹**ï¼š

```text
åŸºæœ¬å— A â†’ åŸºæœ¬å— B â†’ åŸºæœ¬å— C
         â†˜ åŸºæœ¬å— D â†—
```

### 2. Happens-before å…³ç³»

**ç»“æ„**ï¼šååºé›†

**åºè§£é‡Š**ï¼š

- Lamport å®šä¹‰ï¼šè‹¥ a â†’ bï¼Œåˆ™ a åœ¨å› æœä¸Šå…ˆäº b
- æ„æˆååºå…³ç³»ï¼ˆéå…¨åºï¼‰

**ç¤ºä¾‹**ï¼š

```text
äº‹ä»¶ a â†’ äº‹ä»¶ bï¼ˆa happens-before bï¼‰
äº‹ä»¶ b â†’ äº‹ä»¶ c
â‡’ äº‹ä»¶ a â†’ äº‹ä»¶ cï¼ˆä¼ é€’æ€§ï¼‰
```

### 3. å¹¶å‘æ¨¡å‹ï¼ˆå¦‚ CSPã€Actorï¼‰

**ç»“æ„**ï¼šæ¶ˆæ¯åº

**åºè§£é‡Š**ï¼š

- æ¶ˆæ¯ä¼ é€’æ„æˆåˆ†å¸ƒå¼ååº
- æ— å…¨å±€æ—¶é’Ÿ

**ç¤ºä¾‹**ï¼š

```erlang
% Actor æ¨¡å‹
Actor1 ! Message1  % å‘é€æ¶ˆæ¯
Actor2 ! Message2
% æ¶ˆæ¯åºï¼šMessage1 â†’ Message2ï¼ˆå¦‚æœ Actor1 åœ¨ Actor2 ä¹‹å‰å‘é€ï¼‰
```

### 4. äº‹åŠ¡éš”ç¦»çº§åˆ«

**ç»“æ„**ï¼šåºä¸€è‡´æ€§

**åºè§£é‡Š**ï¼š

- å¯ä¸²è¡ŒåŒ– = æ‰¾åˆ°ä¸€ä¸ªç­‰ä»·çš„å…¨åºæ‰§è¡Œ

**ç¤ºä¾‹**ï¼š

```text
T1: Read(x) Write(x)
T2: Read(x) Write(x)

å¯ä¸²è¡ŒåŒ–ï¼š
  æ‰¾åˆ°å…¨åºï¼šT1 â†’ T2 æˆ– T2 â†’ T1
```

### 5. æ­»é”é¿å…

**ç»“æ„**ï¼šåºçš„è‰¯åŸºæ€§

**åºè§£é‡Š**ï¼š

- èµ„æºåˆ†é…å›¾æ— ç¯ â‡” å­˜åœ¨å…¨åºæ‰©å±•ï¼ˆDijkstra é“¶è¡Œå®¶ç®—æ³•ï¼‰

**ç¤ºä¾‹**ï¼š

```text
èµ„æºåˆ†é…å›¾ï¼š
  è¿›ç¨‹ P1 â†’ èµ„æº R1 â†’ è¿›ç¨‹ P2 â†’ èµ„æº R2 â†’ è¿›ç¨‹ P1
  ï¼ˆæœ‰ç¯ï¼Œå­˜åœ¨æ­»é”é£é™©ï¼‰

æ— ç¯èµ„æºåˆ†é…å›¾ï¼š
  è¿›ç¨‹ P1 â†’ èµ„æº R1 â†’ è¿›ç¨‹ P2 â†’ èµ„æº R2
  ï¼ˆæ— ç¯ï¼Œå¯æ‰¾åˆ°å…¨åºæ‰©å±•ï¼‰
```

---

## 12.2.2.3 å½¢å¼åŒ–å·¥å…·

### 1. ååºé›†

**åº”ç”¨**ï¼šHappens-before å…³ç³»æ„æˆååº

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š

- **ååº**ï¼šè‡ªåã€åå¯¹ç§°ã€ä¼ é€’çš„å…³ç³»
- **å…¨åº**ï¼šååº + ä»»æ„ä¸¤ä¸ªå…ƒç´ å¯æ¯”è¾ƒ

**ç¤ºä¾‹**ï¼š

```text
ååºé›† (E, â†’)
- è‡ªåæ€§ï¼ša â†’ a
- åå¯¹ç§°æ€§ï¼ša â†’ b ä¸” b â†’ a â‡’ a = b
- ä¼ é€’æ€§ï¼ša â†’ b ä¸” b â†’ c â‡’ a â†’ c
```

### 2. äº‹ä»¶ç»“æ„ï¼ˆEvent Structuresï¼‰

**åº”ç”¨**ï¼šå¹¶å‘äº‹ä»¶çš„ç»“æ„åŒ–è¡¨ç¤º

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š

- **äº‹ä»¶**ï¼šç³»ç»Ÿä¸­çš„åŸå­åŠ¨ä½œ
- **ååº**ï¼šäº‹ä»¶ä¹‹é—´çš„å› æœåº
- **å†²çª**ï¼šäº‹ä»¶ä¹‹é—´çš„äº’æ–¥å…³ç³»

**ç¤ºä¾‹**ï¼š

```text
äº‹ä»¶ç»“æ„ï¼š
  E = {eâ‚, eâ‚‚, eâ‚ƒ}
  â†’ = {(eâ‚, eâ‚‚)}
  # = {(eâ‚‚, eâ‚ƒ)}  ï¼ˆå†²çªï¼‰
```

### 3. å‘é‡æ—¶é’Ÿ

**åº”ç”¨**ï¼šåˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å› æœåº

**æ ¸å¿ƒæ¦‚å¿µ**ï¼š

- **å‘é‡æ—¶é’Ÿ**ï¼šæ•æ‰åˆ†å¸ƒå¼ç³»ç»Ÿä¸­çš„å› æœåº
- **æ— å…¨å±€æ—¶é’Ÿ**ï¼šä¾èµ–ååºæ¥æ•æ‰å› æœå…³ç³»

**ç¤ºä¾‹**ï¼š

```text
è¿›ç¨‹ Pâ‚: [1, 0, 0]
è¿›ç¨‹ Pâ‚‚: [0, 1, 0]
è¿›ç¨‹ Pâ‚ƒ: [0, 0, 1]

æ¶ˆæ¯ä¼ é€’åï¼š
è¿›ç¨‹ Pâ‚: [2, 1, 0]  ï¼ˆæ”¶åˆ° Pâ‚‚ çš„æ¶ˆæ¯ï¼‰
```

---

## 12.2.2.4 å“²å­¦æ„ä¹‰

æ§åˆ¶ç»“æ„å›ç­”**"ä½•æ—¶å‘ç”Ÿ"**ä¸**"ä»¥ä½•é¡ºåºå‘ç”Ÿ"**ã€‚å®ƒå¼•å…¥**æ—¶é—´ç»´åº¦**ï¼ˆé€»è¾‘æ—¶é—´æˆ–ç‰©
ç†æ—¶é—´ï¼‰ï¼Œæ˜¯è®¡ç®—æœºç§‘å­¦çš„"è¯­ä¹‰"ä¸"æ—¶åºé€»è¾‘"å±‚é¢ã€‚

### æ ¸å¿ƒæ´å¯Ÿ

1. **æ—¶é—´ç»´åº¦**ï¼šæ§åˆ¶ç»“æ„å¼•å…¥æ—¶é—´ç»´åº¦ï¼ˆé€»è¾‘æ—¶é—´æˆ–ç‰©ç†æ—¶é—´ï¼‰
2. **ååºæ€§**ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œæ²¡æœ‰å…¨å±€æ—¶é’Ÿï¼Œå¿…é¡»ä¾èµ–ååº
3. **ç¡®å®šæ€§**ï¼šé€šè¿‡æ§åˆ¶ç»“æ„å»ºç«‹ç¡®å®šæ€§æ‰§è¡Œé¡ºåº

### è®¾è®¡åŸåˆ™

- **åŒæ­¥æœºåˆ¶**ï¼šé€šè¿‡å±éšœã€é”ã€æ¶ˆæ¯ç­‰å»ºç«‹åºå…³ç³»
- **å› æœåº**ï¼šæ•æ‰äº‹ä»¶çš„å› æœå…³ç³»
- **æ­»é”é¿å…**ï¼šé€šè¿‡èµ„æºåˆ†é…å›¾çš„è‰¯åºæ€§é¿å…æ­»é”

> æ³¨ï¼šåœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œ**æ²¡æœ‰å…¨å±€æ—¶é’Ÿ**ï¼Œå› æ­¤å¿…é¡»ä¾èµ–**ååº**ï¼ˆå¦‚å‘é‡æ—¶é’Ÿï¼‰æ¥æ•æ‰
> å› æœå…³ç³»ã€‚

---

## 12.2.2.5 å‚è€ƒ

### ç›¸å…³æ–‡æ¡£

- **[è®¡ç®—ç»“æ„åˆ†æ](../01-computational-structure.md)** - ä»£æ•°è§†è§’çš„è®¡ç®—ç»“æ„
- **[ä¿¡æ¯ç»“æ„åˆ†æ](../03-information-structure.md)** - æ‹“æ‰‘/è¿‘ä¼¼è§†è§’çš„ä¿¡æ¯ç»“æ„
- **[ç»“æ„äº¤äº’ä¸å¤åˆ](../../03-structure-interaction/README.md)** - ç»“æ„çš„å¤åˆå’Œ
  æ·±å±‚è”ç³»
- **[æºæ–‡æ¡£](../../../../structure_view.md)** - ç»“æ„è§†è§’çš„å®Œæ•´è®ºè¿°

### å­¦æœ¯å‚è€ƒ

1. Lamport, L. â€” _Time, Clocks, and the Ordering of Events_ï¼ˆHappens-before å…³ç³»
   ï¼‰
2. Winskel, G. â€” _The Formal Semantics of Programming Languages_ï¼ˆäº‹ä»¶ç»“æ„ä¸æ§åˆ¶
   ï¼‰
3. Dijkstra, E. W. â€” _Cooperating Sequential Processes_ï¼ˆCSP æ¨¡å‹ï¼‰

---

**æ›´æ–°æ—¶é—´**ï¼š2025-11-05 **ç‰ˆæœ¬**ï¼šv1.0

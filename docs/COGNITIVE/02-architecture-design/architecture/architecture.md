# æ¶æ„ä¸å¯¹è±¡æ¨¡å‹ï¼šæ§åˆ¶é—­ç¯ä¸æ•°æ®ç»“æ„

## ğŸ“‘ ç›®å½•

- [æ¶æ„ä¸å¯¹è±¡æ¨¡å‹ï¼šæ§åˆ¶é—­ç¯ä¸æ•°æ®ç»“æ„](#æ¶æ„ä¸å¯¹è±¡æ¨¡å‹æ§åˆ¶é—­ç¯ä¸æ•°æ®ç»“æ„)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1 æ–‡æ¡£å®šä½](#1-æ–‡æ¡£å®šä½)
  - [2 æ¶æ„å±‚æ¬¡å¯¹æ¯”](#2-æ¶æ„å±‚æ¬¡å¯¹æ¯”)
    - [2.1 ç³»ç»Ÿæ¶æ„å…¨æ™¯](#21-ç³»ç»Ÿæ¶æ„å…¨æ™¯)
    - [2.2 æ¶æ„è®¾è®¡è®ºè¯](#22-æ¶æ„è®¾è®¡è®ºè¯)
  - [3 Kubernetes å¯¹è±¡æ¨¡å‹](#3-kubernetes-å¯¹è±¡æ¨¡å‹)
    - [3.1 GVR æ¨¡å‹](#31-gvr-æ¨¡å‹)
    - [3.2 å¯¹è±¡ç»“æ„](#32-å¯¹è±¡ç»“æ„)
    - [3.3 å¯¹è±¡å…³ç³»æ¨¡å‹](#33-å¯¹è±¡å…³ç³»æ¨¡å‹)
    - [3.4 æ ‡ç­¾ä¸é€‰æ‹©å™¨](#34-æ ‡ç­¾ä¸é€‰æ‹©å™¨)
    - [3.5 å¯¹è±¡æ¨¡å‹è®ºè¯](#35-å¯¹è±¡æ¨¡å‹è®ºè¯)
  - [4 æ§åˆ¶é—­ç¯æœºåˆ¶](#4-æ§åˆ¶é—­ç¯æœºåˆ¶)
    - [4.1 Informer å·¥ä½œæµç¨‹](#41-informer-å·¥ä½œæµç¨‹)
    - [4.2 Controller æ¨¡å¼](#42-controller-æ¨¡å¼)
    - [4.3 æ§åˆ¶å¾ªç¯æ—¶åºå›¾](#43-æ§åˆ¶å¾ªç¯æ—¶åºå›¾)
    - [4.4 æ§åˆ¶é—­ç¯è®ºè¯](#44-æ§åˆ¶é—­ç¯è®ºè¯)
  - [5 Docker æ§åˆ¶è·¯å¾„](#5-docker-æ§åˆ¶è·¯å¾„)
    - [5.1 è°ƒç”¨é“¾è·¯](#51-è°ƒç”¨é“¾è·¯)
    - [5.2 shim çš„å¿…è¦æ€§](#52-shim-çš„å¿…è¦æ€§)
    - [5.3 æŠ€æœ¯åœºæ™¯ä¸å†³ç­–](#53-æŠ€æœ¯åœºæ™¯ä¸å†³ç­–)
  - [6 Kubernetes è°ƒåº¦ç®—æ³•](#6-kubernetes-è°ƒåº¦ç®—æ³•)
    - [6.1 è°ƒåº¦æµç¨‹](#61-è°ƒåº¦æµç¨‹)
    - [6.2 è°ƒåº¦ç­–ç•¥](#62-è°ƒåº¦ç­–ç•¥)
    - [6.3 è°ƒåº¦åœºæ™¯ä¸å†³ç­–](#63-è°ƒåº¦åœºæ™¯ä¸å†³ç­–)
    - [6.4 æ‰§è¡Œæµä¸è°ƒåº¦è§†è§’](#64-æ‰§è¡Œæµä¸è°ƒåº¦è§†è§’)
  - [7 ç½‘ç»œæ¨¡å‹å¼ºåˆ¶è¦æ±‚](#7-ç½‘ç»œæ¨¡å‹å¼ºåˆ¶è¦æ±‚)
    - [7.1 Kubernetes ç½‘ç»œåŸåˆ™](#71-kubernetes-ç½‘ç»œåŸåˆ™)
    - [7.2 å®ç°æ–¹å¼](#72-å®ç°æ–¹å¼)
    - [7.3 ç½‘ç»œæ¨¡å‹å¯¹æ¯”](#73-ç½‘ç»œæ¨¡å‹å¯¹æ¯”)
    - [7.4 ç½‘ç»œåœºæ™¯ä¸å†³ç­–](#74-ç½‘ç»œåœºæ™¯ä¸å†³ç­–)
  - [8 å­˜å‚¨æŠ½è±¡ï¼šCSI](#8-å­˜å‚¨æŠ½è±¡csi)
    - [8.1 CSI çš„å¿…è¦æ€§](#81-csi-çš„å¿…è¦æ€§)
    - [8.2 å­˜å‚¨æ¨¡å‹](#82-å­˜å‚¨æ¨¡å‹)
    - [8.3 å­˜å‚¨åœºæ™¯ä¸å†³ç­–](#83-å­˜å‚¨åœºæ™¯ä¸å†³ç­–)
  - [9 K3s æ¶æ„ç²¾ç®€](#9-k3s-æ¶æ„ç²¾ç®€)
    - [9.1 è£å‰ªæ¸…å•](#91-è£å‰ªæ¸…å•)
    - [9.2 å•äºŒè¿›åˆ¶æ‰“åŒ…ç­–ç•¥](#92-å•äºŒè¿›åˆ¶æ‰“åŒ…ç­–ç•¥)
    - [9.3 é«˜å¯ç”¨è·¯å¾„](#93-é«˜å¯ç”¨è·¯å¾„)
    - [9.4 è¾¹ç¼˜åœºæ™¯å­˜å‚¨å†³ç­–](#94-è¾¹ç¼˜åœºæ™¯å­˜å‚¨å†³ç­–)
  - [10 æ•°æ®ç»“æ„å¯¹æ¯”](#10-æ•°æ®ç»“æ„å¯¹æ¯”)
    - [10.1 æ•°æ®ç»“æ„åˆ†æ](#101-æ•°æ®ç»“æ„åˆ†æ)
  - [11 æ€§èƒ½è€ƒé‡](#11-æ€§èƒ½è€ƒé‡)
    - [11.1 äº‹ä»¶åå](#111-äº‹ä»¶åå)
    - [11.2 K3s æ€§èƒ½è®ºè¯](#112-k3s-æ€§èƒ½è®ºè¯)
  - [12 æŠ€æœ¯åœºæ™¯åˆ†æ](#12-æŠ€æœ¯åœºæ™¯åˆ†æ)
    - [12.1 å¤§è§„æ¨¡é›†ç¾¤åœºæ™¯](#121-å¤§è§„æ¨¡é›†ç¾¤åœºæ™¯)
    - [12.2 è¾¹ç¼˜åœºæ™¯](#122-è¾¹ç¼˜åœºæ™¯)
    - [12.3 æ··åˆæ¶æ„åœºæ™¯](#123-æ··åˆæ¶æ„åœºæ™¯)
  - [13 å†³ç­–ä¾æ®ä¸æ€è·¯](#13-å†³ç­–ä¾æ®ä¸æ€è·¯)
    - [13.1 æ¶æ„é€‰æ‹©å†³ç­–æ ‘](#131-æ¶æ„é€‰æ‹©å†³ç­–æ ‘)
    - [13.2 å­˜å‚¨é€‰æ‹©å†³ç­–æ ‘](#132-å­˜å‚¨é€‰æ‹©å†³ç­–æ ‘)
    - [13.3 ç½‘ç»œé€‰æ‹©å†³ç­–æ ‘](#133-ç½‘ç»œé€‰æ‹©å†³ç­–æ ‘)
  - [14 å½¢å¼åŒ–æ€»ç»“](#14-å½¢å¼åŒ–æ€»ç»“)
    - [14.1 æ¶æ„æ¨¡å‹å½¢å¼åŒ–](#141-æ¶æ„æ¨¡å‹å½¢å¼åŒ–)
    - [14.2 æ€§èƒ½æ¨¡å‹å½¢å¼åŒ–](#142-æ€§èƒ½æ¨¡å‹å½¢å¼åŒ–)
    - [14.3 å¯¹è±¡æ¨¡å‹å½¢å¼åŒ–](#143-å¯¹è±¡æ¨¡å‹å½¢å¼åŒ–)
  - [15 å‚è€ƒ](#15-å‚è€ƒ)
  - [16 è®¤çŸ¥å¢å¼ºï¼šæ€ç»´å¯¼å›¾ã€å»ºæ¨¡è§†å›¾ä¸å›¾è¡¨è¾¾è½¬æ¢](#16-è®¤çŸ¥å¢å¼ºæ€ç»´å¯¼å›¾å»ºæ¨¡è§†å›¾ä¸å›¾è¡¨è¾¾è½¬æ¢)
    - [16.1 æ¶æ„è®¾è®¡å®Œæ•´æ€ç»´å¯¼å›¾](#161-æ¶æ„è®¾è®¡å®Œæ•´æ€ç»´å¯¼å›¾)
    - [16.2 æ¶æ„å»ºæ¨¡è§†å›¾ï¼ˆC4 æ¨¡å‹ + UMLï¼‰](#162-æ¶æ„å»ºæ¨¡è§†å›¾c4-æ¨¡å‹--uml)
      - [ç³»ç»Ÿå®¹å™¨å›¾ï¼ˆC4 Level 2ï¼‰](#ç³»ç»Ÿå®¹å™¨å›¾c4-level-2)
      - [å¯¹è±¡æ¨¡å‹ç±»å›¾ï¼ˆUMLï¼‰](#å¯¹è±¡æ¨¡å‹ç±»å›¾uml)
    - [16.3 æ¶æ„å¤šç»´å…³ç³»çŸ©é˜µ](#163-æ¶æ„å¤šç»´å…³ç³»çŸ©é˜µ)
      - [æ¶æ„-ç»„ä»¶-åŠŸèƒ½ä¸‰ç»´çŸ©é˜µ](#æ¶æ„-ç»„ä»¶-åŠŸèƒ½ä¸‰ç»´çŸ©é˜µ)
      - [æ¶æ„-åœºæ™¯-å†³ç­–æ˜ å°„çŸ©é˜µ](#æ¶æ„-åœºæ™¯-å†³ç­–æ˜ å°„çŸ©é˜µ)
    - [16.4 å›¾è¡¨è¾¾å’Œè½¬æ¢](#164-å›¾è¡¨è¾¾å’Œè½¬æ¢)
      - [æ¶æ„è§†å›¾è½¬æ¢å…³ç³»](#æ¶æ„è§†å›¾è½¬æ¢å…³ç³»)
      - [è§†å›¾è½¬æ¢è§„åˆ™](#è§†å›¾è½¬æ¢è§„åˆ™)
    - [16.5 å½¢è±¡åŒ–è§£é‡Šè®ºè¯](#165-å½¢è±¡åŒ–è§£é‡Šè®ºè¯)
      - [æ¶æ„è®¾è®¡çš„å½¢è±¡åŒ–ç±»æ¯”](#æ¶æ„è®¾è®¡çš„å½¢è±¡åŒ–ç±»æ¯”)
        - [1. Docker æ¶æ„ = å·¥å‚ç”Ÿäº§çº¿](#1-docker-æ¶æ„--å·¥å‚ç”Ÿäº§çº¿)
        - [2. Kubernetes æ¶æ„ = æ™ºèƒ½åŸå¸‚ç®¡ç†ç³»ç»Ÿ](#2-kubernetes-æ¶æ„--æ™ºèƒ½åŸå¸‚ç®¡ç†ç³»ç»Ÿ)
        - [3. K3s æ¶æ„ = ä¾¿æºå¼å·¥å…·ç®±](#3-k3s-æ¶æ„--ä¾¿æºå¼å·¥å…·ç®±)
        - [4. æ§åˆ¶å¾ªç¯ = æ’æ¸©å™¨ç³»ç»Ÿ](#4-æ§åˆ¶å¾ªç¯--æ’æ¸©å™¨ç³»ç»Ÿ)
    - [16.6 ä¸“å®¶è§‚ç‚¹ä¸è®ºè¯](#166-ä¸“å®¶è§‚ç‚¹ä¸è®ºè¯)
      - [è®¡ç®—ä¿¡æ¯è½¯ä»¶ç§‘å­¦å®¶çš„è§‚ç‚¹](#è®¡ç®—ä¿¡æ¯è½¯ä»¶ç§‘å­¦å®¶çš„è§‚ç‚¹)
        - [1. Joe Bedaï¼ˆKubernetes è”åˆåˆ›å§‹äººï¼‰](#1-joe-bedakubernetes-è”åˆåˆ›å§‹äºº)
        - [2. Tim Hockinï¼ˆKubernetes æ ¸å¿ƒå¼€å‘è€…ï¼‰](#2-tim-hockinkubernetes-æ ¸å¿ƒå¼€å‘è€…)
        - [3. Darren Shepherdï¼ˆK3s åˆ›å§‹äººï¼‰](#3-darren-shepherdk3s-åˆ›å§‹äºº)
      - [è®¡ç®—ä¿¡æ¯è½¯ä»¶æ•™è‚²å®¶çš„è§‚ç‚¹](#è®¡ç®—ä¿¡æ¯è½¯ä»¶æ•™è‚²å®¶çš„è§‚ç‚¹)
        - [1. Kelsey Hightowerï¼ˆKubernetes æ•™è‚²å®¶ï¼‰](#1-kelsey-hightowerkubernetes-æ•™è‚²å®¶)
        - [2. Liz Riceï¼ˆå®¹å™¨å®‰å…¨æ•™è‚²å®¶ï¼‰](#2-liz-riceå®¹å™¨å®‰å…¨æ•™è‚²å®¶)
      - [è®¡ç®—ä¿¡æ¯è½¯ä»¶è®¤çŸ¥å­¦å®¶çš„è§‚ç‚¹](#è®¡ç®—ä¿¡æ¯è½¯ä»¶è®¤çŸ¥å­¦å®¶çš„è§‚ç‚¹)
        - [1. David Marrï¼ˆè®¡ç®—è®¤çŸ¥ç§‘å­¦å®¶ï¼‰](#1-david-marrè®¡ç®—è®¤çŸ¥ç§‘å­¦å®¶)
        - [2. Douglas Hofstadterï¼ˆè®¤çŸ¥ç§‘å­¦å®¶ï¼‰](#2-douglas-hofstadterè®¤çŸ¥ç§‘å­¦å®¶)
    - [16.7 è®¤çŸ¥å­¦ä¹ è·¯å¾„çŸ©é˜µ](#167-è®¤çŸ¥å­¦ä¹ è·¯å¾„çŸ©é˜µ)
    - [16.8 ä¸“å®¶æ¨èé˜…è¯»è·¯å¾„](#168-ä¸“å®¶æ¨èé˜…è¯»è·¯å¾„)

---

## 1 æ–‡æ¡£å®šä½

æœ¬æ–‡æ¡£æ·±å…¥è§£æ Dockerã€Kubernetesã€K3s çš„æ¶æ„è®¾è®¡ã€å¯¹è±¡æ¨¡å‹å’Œæ§åˆ¶é—­ç¯æœºåˆ¶ï¼Œä»¥åŠ
ä¸åŒæŠ€æœ¯åœºæ™¯ä¸‹çš„æ¶æ„é€‰æ‹©å†³ç­–ã€‚

**æ–‡æ¡£ç»“æ„**ï¼š

- **æ¶æ„è®¾è®¡**ï¼šDocker/Kubernetes/K3s çš„ç³»ç»Ÿæ¶æ„å¯¹æ¯”
- **å¯¹è±¡æ¨¡å‹**ï¼šKubernetes GVRã€å¯¹è±¡ç»“æ„ã€æ ‡ç­¾é€‰æ‹©å™¨
- **æ§åˆ¶é—­ç¯**ï¼šInformerã€Controllerã€æ§åˆ¶å¾ªç¯æœºåˆ¶
- **æŠ€æœ¯åœºæ™¯**ï¼šå¤§è§„æ¨¡é›†ç¾¤ã€è¾¹ç¼˜åœºæ™¯ã€æ··åˆæ¶æ„
- **å†³ç­–åˆ†æ**ï¼šæ¶æ„é€‰æ‹©ã€ç½‘ç»œå­˜å‚¨é€‰æ‹©ã€è°ƒåº¦ç­–ç•¥é€‰æ‹©

## 2 æ¶æ„å±‚æ¬¡å¯¹æ¯”

### 2.1 ç³»ç»Ÿæ¶æ„å…¨æ™¯

```mermaid
graph TB
    subgraph "Docker æ¶æ„"
        A1[docker-cli] --> A2[dockerd]
        A2 --> A3[containerd]
        A3 --> A4[runc]
        A4 --> A5[shim]
        A5 --> A6[å®¹å™¨è¿›ç¨‹]
    end

    subgraph "Kubernetes æ¶æ„"
        B1[kubectl] --> B2[kube-api-server]
        B2 --> B3[etcd]
        B2 --> B4[Controller Manager]
        B2 --> B5[Scheduler]
        B4 --> B6[kubelet]
        B5 --> B6
        B6 --> B7[å®¹å™¨è¿è¡Œæ—¶]
    end

    subgraph "K3s æ¶æ„"
        C1[k3s äºŒè¿›åˆ¶] --> C2[åµŒå…¥å¼ç»„ä»¶]
        C2 --> C3[containerd]
        C2 --> C4[flannel]
        C2 --> C5[traefik]
        C2 --> C6[sqlite]
    end

    style B3 fill:#ffe6e6
    style C6 fill:#e6ffe6
```

**æ¶æ„å±‚æ¬¡åˆ†æ**ï¼š

1. **Docker**ï¼šå•æœºæ¶æ„ï¼Œæ§åˆ¶è·¯å¾„ç®€å•ï¼ˆcli â†’ dockerd â†’ containerd â†’ runcï¼‰
2. **Kubernetes**ï¼šé›†ç¾¤æ¶æ„ï¼Œä¸­å¿ƒåŒ–æ§åˆ¶å¹³é¢ï¼ˆAPI Server + etcd + Controller +
   Schedulerï¼‰
3. **K3s**ï¼šè½»é‡é›†ç¾¤æ¶æ„ï¼Œå•äºŒè¿›åˆ¶ + åµŒå…¥å¼ç»„ä»¶
   ï¼ˆcontainerd/flannel/traefik/sqliteï¼‰

### 2.2 æ¶æ„è®¾è®¡è®ºè¯

**ä¸ºä»€ä¹ˆ Docker é‡‡ç”¨åˆ†å±‚æ¶æ„ï¼Ÿ**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… èŒè´£åˆ†ç¦»ï¼šæ¯ä¸ªç»„ä»¶èŒè´£å•ä¸€ï¼Œæ˜“äºç»´æŠ¤
- âœ… è§£è€¦è®¾è®¡ï¼šç»„ä»¶é—´é€šè¿‡æ¥å£äº¤äº’ï¼Œé™ä½è€¦åˆ
- âœ… å¯æ‰©å±•æ€§ï¼šæ’ä»¶åŒ–è®¾è®¡æ”¯æŒæ‰©å±•

**å†³ç­–æ€è·¯**ï¼š

```yaml
Docker æ¶æ„é€‰æ‹©:
  æ¨¡å¼: åˆ†å±‚æ¶æ„
  ç»„ä»¶:
    - docker-cli: ç”¨æˆ·æ¥å£
    - dockerd: å®ˆæŠ¤è¿›ç¨‹
    - containerd: è¿è¡Œæ—¶æ¥å£
    - runc: OCI è¿è¡Œæ—¶
  ä¼˜åŠ¿: èŒè´£åˆ†ç¦»ã€è§£è€¦è®¾è®¡
  æƒè¡¡: è°ƒç”¨é“¾è·¯è¾ƒé•¿
```

**ä¸ºä»€ä¹ˆ Kubernetes é‡‡ç”¨ä¸­å¿ƒåŒ–æ¶æ„ï¼Ÿ**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… çŠ¶æ€ä¸€è‡´æ€§ï¼šä¸­å¿ƒåŒ–å­˜å‚¨ä¿è¯é›†ç¾¤çŠ¶æ€ä¸€è‡´ [^k8s-architecture]
- âœ… æ§åˆ¶ç®€åŒ–ï¼šç»Ÿä¸€å…¥å£ç®€åŒ–æ§åˆ¶é€»è¾‘
- âœ… å¯æ‰©å±•æ€§ï¼šæ’ä»¶åŒ–è®¾è®¡æ”¯æŒæ‰©å±•

**å†³ç­–æ€è·¯**ï¼š

```yaml
Kubernetes æ¶æ„é€‰æ‹©:
  æ¨¡å¼: ä¸­å¿ƒåŒ–æ¶æ„
  ä¸­å¿ƒ: kube-api-server + etcd
  ç»„ä»¶:
    - API Server: ç»Ÿä¸€å…¥å£
    - etcd: çŠ¶æ€å­˜å‚¨
    - Controller: çŠ¶æ€ç®¡ç†
    - Scheduler: è°ƒåº¦å†³ç­–
  ä¼˜åŠ¿: çŠ¶æ€ä¸€è‡´ã€æ§åˆ¶ç®€åŒ–
  æƒè¡¡: API Server æˆä¸ºå•ç‚¹ï¼ˆé€šè¿‡ HA è§£å†³ï¼‰
```

**ä¸ºä»€ä¹ˆ K3s é‡‡ç”¨å•äºŒè¿›åˆ¶æ¶æ„ï¼Ÿ**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… è¾¹ç¼˜åœºæ™¯ï¼šèµ„æºå—é™ï¼Œéœ€è¦è½»é‡çº§éƒ¨ç½² [^k3s-architecture]
- âœ… å®‰è£…ç®€åŒ–ï¼šå•äºŒè¿›åˆ¶æ˜“äºå®‰è£…å’Œå‡çº§
- âœ… èµ„æºä¼˜åŒ–ï¼šåµŒå…¥å¼ç»„ä»¶å‡å°‘èµ„æºå ç”¨

**å†³ç­–æ€è·¯**ï¼š

```yaml
K3s æ¶æ„é€‰æ‹©:
  æ¨¡å¼: å•äºŒè¿›åˆ¶æ¶æ„
  ç­–ç•¥:
    - é™æ€é“¾æ¥ç»„ä»¶
    - åµŒå…¥å¼ manifest
    - å¯åŠ¨æ—¶åŠ è½½ static pod
  ä¼˜åŠ¿: å®‰è£…ç®€å•ã€èµ„æºå ç”¨å°
  æƒè¡¡: å‡çº§éœ€è¦æ›¿æ¢äºŒè¿›åˆ¶
```

## 3 Kubernetes å¯¹è±¡æ¨¡å‹

### 3.1 GVR æ¨¡å‹

**å®šä¹‰**ï¼šæ¯ä¸ª Kubernetes èµ„æºéµå¾ªç»Ÿä¸€çš„ GVRï¼ˆGroup/Version/Resourceï¼‰æ¨¡å¼ã€‚

```text
èµ„æºç±»å‹ = Group/Version/Resource

ç¤ºä¾‹ï¼š
- core/v1/Pod          # core ç»„ï¼Œv1 ç‰ˆæœ¬ï¼ŒPod èµ„æº
- apps/v1/Deployment    # apps ç»„ï¼Œv1 ç‰ˆæœ¬ï¼ŒDeployment èµ„æº
- networking.k8s.io/v1/Ingress  # networking ç»„ï¼Œv1 ç‰ˆæœ¬ï¼ŒIngress èµ„æº
```

**GVR æ¨¡å‹è®ºè¯**ï¼š

- **Group**ï¼šèµ„æºåˆ†ç»„ï¼Œä¾¿äºç®¡ç†å’Œæ‰©å±•
- **Version**ï¼šç‰ˆæœ¬ç®¡ç†ï¼Œæ”¯æŒ API æ¼”è¿›
- **Resource**ï¼šèµ„æºç±»å‹ï¼Œæ˜ç¡®èµ„æºè¯­ä¹‰

### 3.2 å¯¹è±¡ç»“æ„

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: nginx
  namespace: default
  labels:
    app: nginx
  uid: "abc-123"
  ownerReferences: [] # ä¾èµ–å…³ç³»
spec:
  replicas: 3 # æœŸæœ›çŠ¶æ€
  selector:
    matchLabels:
      app: nginx
  template:
    metadata:
      labels:
        app: nginx
    spec:
      containers:
        - name: nginx
          image: nginx:latest
status:
  replicas: 3 # å®é™…çŠ¶æ€
  readyReplicas: 3
  conditions: []
```

**å¯¹è±¡ç»“æ„åˆ†æ**ï¼š

- **metadata**ï¼šå…ƒæ•°æ®ï¼ŒåŒ…å«åç§°ã€æ ‡ç­¾ã€UIDã€æ‰€æœ‰è€…å¼•ç”¨
- **spec**ï¼šæœŸæœ›çŠ¶æ€ï¼Œå®šä¹‰èµ„æºçš„æœŸæœ›é…ç½®
- **status**ï¼šå®é™…çŠ¶æ€ï¼Œè®°å½•èµ„æºçš„å½“å‰çŠ¶æ€

### 3.3 å¯¹è±¡å…³ç³»æ¨¡å‹

```mermaid
graph TD
    A[Deployment] -->|OwnerReference| B[ReplicaSet]
    B -->|OwnerReference| C[Pod]
    A -->|Label Selector| C
    C -->|Label| D[Service]
    D -->|Label Selector| C

    E[ConfigMap] -->|Volume Mount| C
    F[Secret] -->|Volume Mount| C

    G[PersistentVolumeClaim] -->|Volume| C

    style A fill:#e1f5ff
    style D fill:#fff4e1
```

**å¯¹è±¡å…³ç³»è®ºè¯**ï¼š

- **OwnerReference**ï¼šå®šä¹‰å¯¹è±¡ä¾èµ–å…³ç³»ï¼Œå®ç°çº§è”åˆ é™¤
- **Label Selector**ï¼šå®ç°æ¾è€¦åˆçš„æœåŠ¡å‘ç°å’Œé€‰æ‹©
- **Volume Mount**ï¼šå®ç°é…ç½®å’Œå­˜å‚¨çš„æŒ‚è½½

### 3.4 æ ‡ç­¾ä¸é€‰æ‹©å™¨

**æ ¸å¿ƒæœºåˆ¶**ï¼šæ‰€æœ‰å¯¹è±¡é€šè¿‡ Label åšæ¾æ•£è€¦åˆï¼Œç±»æ¯”"æ•°æ®åº“ç´¢å¼•"ã€‚

```yaml
# Label ç¤ºä¾‹
metadata:
  labels:
    app: nginx
    version: v1
    tier: frontend

# Selector ç¤ºä¾‹
spec:
  selector:
    matchLabels:
      app: nginx
    matchExpressions:
      - key: version
        operator: In
        values: [v1, v2]
```

### 3.5 å¯¹è±¡æ¨¡å‹è®ºè¯

**ä¸ºä»€ä¹ˆé‡‡ç”¨ GVR æ¨¡å‹ï¼Ÿ**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… API ç‰ˆæœ¬ç®¡ç†ï¼šæ”¯æŒ API æ¼”è¿›å’Œå‘åå…¼å®¹
- âœ… èµ„æºåˆ†ç»„ï¼šé€»è¾‘ä¸Šç»„ç»‡ç›¸å…³èµ„æº
- âœ… æ‰©å±•æ€§ï¼šæ–°èµ„æºå¯ä»¥ç‹¬ç«‹ç‰ˆæœ¬ç®¡ç†

**ä¸ºä»€ä¹ˆé‡‡ç”¨ Spec/Status åˆ†ç¦»ï¼Ÿ**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… æœŸæœ›çŠ¶æ€ç®¡ç†ï¼šSpec å®šä¹‰æœŸæœ›ï¼ŒStatus è®°å½•å®é™…
- âœ… å¹‚ç­‰æ€§ä¿è¯ï¼šå¯ä»¥é‡å¤åº”ç”¨ Spec
- âœ… çŠ¶æ€å¯è§æ€§ï¼šStatus æä¾›å®é™…çŠ¶æ€ä¿¡æ¯

**ä¸ºä»€ä¹ˆé‡‡ç”¨ Label Selectorï¼Ÿ**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… æ¾è€¦åˆï¼šæœåŠ¡é—´é€šè¿‡æ ‡ç­¾å…³è”ï¼Œé™ä½è€¦åˆ
- âœ… é«˜æ•ˆæŸ¥è¯¢ï¼šæ ‡ç­¾é€‰æ‹©å™¨æ”¯æŒé«˜æ•ˆçš„å¯¹è±¡æŸ¥è¯¢
- âœ… çµæ´»æ€§ï¼šæ”¯æŒç²¾ç¡®åŒ¹é…å’Œè¡¨è¾¾å¼åŒ¹é…

## 4 æ§åˆ¶é—­ç¯æœºåˆ¶

### 4.1 Informer å·¥ä½œæµç¨‹

```mermaid
sequenceDiagram
    participant C as Controller
    participant I as Informer
    participant A as API Server
    participant E as etcd
    participant W as Work Queue
    participant R as Reconcile

    C->>I: å¯åŠ¨ Informer
    I->>A: List-Watch èµ„æº
    A->>E: è¯»å–åˆå§‹çŠ¶æ€
    E-->>A: è¿”å›åˆ—è¡¨
    A-->>I: åŒæ­¥åˆ°æœ¬åœ°ç¼“å­˜

    loop æŒç»­ç›‘å¬
        A->>I: Watch äº‹ä»¶ï¼ˆAdded/Modified/Deletedï¼‰
        I->>I: æ›´æ–°æœ¬åœ°ç¼“å­˜
        I->>W: äº‹ä»¶å…¥é˜Ÿ
        W->>R: å–å‡ºäº‹ä»¶
        R->>R: è®¡ç®— Diff
        R->>A: æ‰§è¡Œå˜æ›´ï¼ˆCreate/Update/Deleteï¼‰
        A->>E: æ›´æ–° etcd
    end
```

**Informer æ¨¡å¼è®ºè¯**ï¼š

- **æœ¬åœ°ç¼“å­˜**ï¼šå‡å°‘ API Server å‹åŠ›ï¼Œæé«˜å“åº”é€Ÿåº¦
- **Watch æœºåˆ¶**ï¼šå®æ—¶ç›‘å¬å˜åŒ–ï¼Œé¿å…è½®è¯¢å¼€é”€
- **å·¥ä½œé˜Ÿåˆ—**ï¼šå¼‚æ­¥å¤„ç†äº‹ä»¶ï¼Œé¿å…é˜»å¡

### 4.2 Controller æ¨¡å¼

1. **Informer List-Watch**ï¼šä» etcd åŒæ­¥èµ„æºåˆ°æœ¬åœ°ç¼“å­˜
2. **æœ¬åœ°ç¼“å­˜**ï¼šå‡å°‘ API Server å‹åŠ›
3. **äº‹ä»¶å…¥é˜Ÿ**ï¼šäº‹ä»¶è¿›å…¥ Work Queue
4. **Reconcile**ï¼šè®¡ç®—æœŸæœ›çŠ¶æ€ä¸å®é™…çŠ¶æ€å·®å¼‚
5. **æ‰§è¡Œå˜æ›´**ï¼šä¸‹å‘å‘½ä»¤åˆ° API Server
6. **æŒç»­å·¡æ£€**ï¼šå¾ªç¯æ‰§è¡Œä¸Šè¿°æ­¥éª¤

### 4.3 æ§åˆ¶å¾ªç¯æ—¶åºå›¾

```mermaid
graph LR
    A[Watch äº‹ä»¶] --> B[æ›´æ–°ç¼“å­˜]
    B --> C[äº‹ä»¶å…¥é˜Ÿ]
    C --> D[Reconcile]
    D --> E{çŠ¶æ€ä¸€è‡´?}
    E -->|å¦| F[æ‰§è¡Œå˜æ›´]
    E -->|æ˜¯| G[ç­‰å¾…ä¸‹ä¸€äº‹ä»¶]
    F --> H[Back-off é‡è¯•]
    H --> D

    style E fill:#ffe6e6
    style G fill:#e6ffe6
```

### 4.4 æ§åˆ¶é—­ç¯è®ºè¯

**ä¸ºä»€ä¹ˆé‡‡ç”¨ Informer æ¨¡å¼ï¼Ÿ**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… æ€§èƒ½ä¼˜åŒ–ï¼šæœ¬åœ°ç¼“å­˜å‡å°‘ API Server è´Ÿè½½
- âœ… å®æ—¶å“åº”ï¼šWatch æœºåˆ¶å®æ—¶ç›‘å¬å˜åŒ–
- âœ… å¯é æ€§ï¼šå·¥ä½œé˜Ÿåˆ—ä¿è¯äº‹ä»¶ä¸ä¸¢å¤±

**ä¸ºä»€ä¹ˆé‡‡ç”¨ Reconcile æ¨¡å¼ï¼Ÿ**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… å¹‚ç­‰æ€§ï¼šé‡å¤æ‰§è¡Œç»“æœä¸€è‡´
- âœ… å®¹é”™æ€§ï¼šæ•…éšœæ¢å¤åè‡ªåŠ¨ä¿®å¤
- âœ… ç®€æ´æ€§ï¼šç»Ÿä¸€çš„æ§åˆ¶é€»è¾‘

**æ§åˆ¶å¾ªç¯æ”¶æ•›å®šç†**ï¼šå‚è€ƒ
[2.5.2 æ§åˆ¶å¾ªç¯æ”¶æ•›å®šç†](../../01-core-foundations/principles/principles.md#252-æ§åˆ¶å¾ªç¯æ”¶æ•›å®šç†)

## 5 Docker æ§åˆ¶è·¯å¾„

### 5.1 è°ƒç”¨é“¾è·¯

```mermaid
graph LR
    A[docker run] --> B[docker-cli]
    B --> C[dockerd API]
    C --> D[containerd API]
    D --> E[containerd-shim]
    E --> F[runc]
    F --> G[shim è¿›ç¨‹]
    G --> H[å®¹å™¨è¿›ç¨‹]

    style A fill:#e1f5ff
    style H fill:#fff4e1
```

**è°ƒç”¨é“¾è·¯åˆ†æ**ï¼š

1. **docker-cli**ï¼šç”¨æˆ·å‘½ä»¤è¡Œæ¥å£
2. **dockerd**ï¼šDocker å®ˆæŠ¤è¿›ç¨‹ï¼Œç®¡ç†é•œåƒå’Œå®¹å™¨
3. **containerd**ï¼šå®¹å™¨è¿è¡Œæ—¶æ¥å£ï¼Œç®¡ç†å®¹å™¨ç”Ÿå‘½å‘¨æœŸ
4. **containerd-shim**ï¼šè¿è¡Œæ—¶ shimï¼Œéš”ç¦» containerd ä¸å®¹å™¨
5. **runc**ï¼šOCI è¿è¡Œæ—¶ï¼Œåˆ›å»ºå®¹å™¨è¿›ç¨‹

### 5.2 shim çš„å¿…è¦æ€§

**é—®é¢˜**ï¼šrunc é€€å‡ºåï¼Œå®¹å™¨è¿›ç¨‹ï¼ˆinit è¿›ç¨‹ï¼‰ä¼šå¤±å»çˆ¶è¿›ç¨‹ï¼Œå˜æˆå­¤å„¿è¿›ç¨‹ã€‚

**è§£å†³æ–¹æ¡ˆ**ï¼šshim ä½œä¸º"è½»é‡çº§ init"æŒæœ‰ STDIO å’Œ fifoï¼Œä½¿ dockerd å¯ä»¥é‡å¯è€Œä¸
ä¸¢å¤±å®¹å™¨ã€‚

```mermaid
graph TD
    A[dockerd å´©æºƒ] --> B{shim å­˜åœ¨?}
    B -->|æ˜¯| C[å®¹å™¨ç»§ç»­è¿è¡Œ]
    B -->|å¦| D[å®¹å™¨è¿›ç¨‹æˆä¸ºå­¤å„¿]
    C --> E[dockerd é‡å¯]
    E --> F[é‡æ–°è¿æ¥ shim]
    F --> G[æ¢å¤æ§åˆ¶]

    D --> H[å®¹å™¨å¤±å»ç®¡ç†]

    style C fill:#e6ffe6
    style D fill:#ffcccc
```

**shim å¿…è¦æ€§è®ºè¯**ï¼š

- **å­¤å„¿è¿›ç¨‹é—®é¢˜**ï¼šrunc åˆ›å»ºå®¹å™¨åç«‹å³é€€å‡ºï¼Œå®¹å™¨è¿›ç¨‹å¤±å»çˆ¶è¿›ç¨‹
- **shim ä½œç”¨**ï¼šshim æŒæœ‰å®¹å™¨è¿›ç¨‹ï¼Œé¿å…æˆä¸ºå­¤å„¿
- **å¯æ¢å¤æ€§**ï¼šdockerd é‡å¯åå¯ä»¥é‡æ–°è¿æ¥ shimï¼Œæ¢å¤å®¹å™¨æ§åˆ¶

### 5.3 æŠ€æœ¯åœºæ™¯ä¸å†³ç­–

**åœºæ™¯ 1ï¼šå•æœºå®¹å™¨ç®¡ç†**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… ç®€å•åœºæ™¯ï¼Œä¸éœ€è¦å¤æ‚æ¶æ„
- âœ… èµ„æºå—é™ï¼Œéœ€è¦è½»é‡çº§è®¾è®¡

**å†³ç­–æ€è·¯**ï¼š

```yaml
Docker æ¶æ„é€‚ç”¨åœºæ™¯:
  åœºæ™¯: å•æœºå®¹å™¨ç®¡ç†
  ç»„ä»¶: docker-cli + dockerd + containerd + runc
  ä¼˜åŠ¿: ç®€å•ã€è½»é‡
  é™åˆ¶: å•æœºé™åˆ¶ï¼Œæ— æ³•é›†ç¾¤ç®¡ç†
```

**åœºæ™¯ 2ï¼šéœ€è¦å®¹å™¨ç¼–æ’**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… å¤šèŠ‚ç‚¹å®¹å™¨ç®¡ç†
- âœ… éœ€è¦æœåŠ¡å‘ç°å’Œè´Ÿè½½å‡è¡¡

**å†³ç­–æ€è·¯**ï¼š

```yaml
Kubernetes æ¶æ„é€‚ç”¨åœºæ™¯:
  åœºæ™¯: å¤šèŠ‚ç‚¹å®¹å™¨ç¼–æ’
  ç»„ä»¶: API Server + etcd + Controller + Scheduler
  ä¼˜åŠ¿: é›†ç¾¤ç®¡ç†ã€æœåŠ¡å‘ç°
  é™åˆ¶: èµ„æºå ç”¨å¤§ï¼Œéƒ¨ç½²å¤æ‚
```

**åœºæ™¯ 3ï¼šè¾¹ç¼˜åœºæ™¯å®¹å™¨ç¼–æ’**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… è¾¹ç¼˜èŠ‚ç‚¹èµ„æºå—é™
- âœ… éœ€è¦è½»é‡çº§ Kubernetes

**å†³ç­–æ€è·¯**ï¼š

```yaml
K3s æ¶æ„é€‚ç”¨åœºæ™¯:
  åœºæ™¯: è¾¹ç¼˜å®¹å™¨ç¼–æ’
  ç»„ä»¶: k3s å•äºŒè¿›åˆ¶ + åµŒå…¥å¼ç»„ä»¶
  ä¼˜åŠ¿: è½»é‡ã€æ˜“éƒ¨ç½²
  é™åˆ¶: è§„æ¨¡å—é™ï¼ˆ1000 èŠ‚ç‚¹ï¼‰
```

## 6 Kubernetes è°ƒåº¦ç®—æ³•

### 6.1 è°ƒåº¦æµç¨‹

```mermaid
graph TD
    A[å¾…è°ƒåº¦ Pod] --> B[è¿‡æ»¤é˜¶æ®µ<br/>Predicates]
    B --> C{èŠ‚ç‚¹å€™é€‰é›†}
    C -->|ä» N åˆ° â‰¤100| D[æ‰“åˆ†é˜¶æ®µ<br/>Priorities]
    D --> E[è®¡ç®—åˆ†æ•°]
    E --> F[é€‰æ‹©æœ€é«˜åˆ†èŠ‚ç‚¹]
    F --> G[ç»‘å®šé˜¶æ®µ<br/>Binding]
    G --> H[Pod è¿è¡Œ]

    style B fill:#ffe6e6
    style D fill:#fff4e1
```

**è°ƒåº¦æµç¨‹è®ºè¯**ï¼š

1. **è¿‡æ»¤é˜¶æ®µ**ï¼šä» N ä¸ªèŠ‚ç‚¹ç­›é€‰åˆ° â‰¤100 ä¸ªå€™é€‰èŠ‚ç‚¹ï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
2. **æ‰“åˆ†é˜¶æ®µ**ï¼šè®¡ç®—æ¯ä¸ªå€™é€‰èŠ‚ç‚¹çš„åˆ†æ•°ï¼ˆèµ„æºä¼˜åŒ–ï¼‰
3. **ç»‘å®šé˜¶æ®µ**ï¼šé€‰æ‹©æœ€é«˜åˆ†èŠ‚ç‚¹å¹¶ç»‘å®šï¼ˆå†³ç­–ç¡®å®šï¼‰

### 6.2 è°ƒåº¦ç­–ç•¥

| é˜¶æ®µ     | ç®—æ³•                           | ç›®æ ‡                              |
| -------- | ------------------------------ | --------------------------------- |
| **è¿‡æ»¤** | èŠ‚ç‚¹èµ„æºæ£€æŸ¥ã€äº²å’Œæ€§æ£€æŸ¥       | ä» N ä¸ªèŠ‚ç‚¹ç­›é€‰åˆ° â‰¤100 ä¸ªå€™é€‰èŠ‚ç‚¹ |
| **æ‰“åˆ†** | èµ„æºç¢ç‰‡åŒ–æœ€å°åŒ–ã€é•œåƒæœ¬åœ°å­˜åœ¨ | é€‰å‡ºæœ€ä¼˜èŠ‚ç‚¹                      |
| **ç»‘å®š** | å¼‚æ­¥ç»‘å®šåˆ°èŠ‚ç‚¹                 | æ›´æ–° Pod çŠ¶æ€                     |

### 6.3 è°ƒåº¦åœºæ™¯ä¸å†³ç­–

**åœºæ™¯ 1ï¼šèµ„æºä¼˜åŒ–è°ƒåº¦**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… æœ€å¤§åŒ–èµ„æºåˆ©ç”¨ç‡
- âœ… å‡å°‘èµ„æºç¢ç‰‡

**å†³ç­–æ€è·¯**ï¼š

```yaml
è°ƒåº¦ç­–ç•¥:
  ä¼˜å…ˆçº§: èµ„æºç¢ç‰‡åŒ–æœ€å°
  ç®—æ³•: LeastRequestedPriority
  åœºæ™¯: èµ„æºç´§å¼ ç¯å¢ƒ
  æ•ˆæœ: æé«˜èµ„æºåˆ©ç”¨ç‡
```

**åœºæ™¯ 2ï¼šæ€§èƒ½ä¼˜åŒ–è°ƒåº¦**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… é•œåƒæœ¬åœ°å·²å­˜åœ¨
- âœ… èŠ‚ç‚¹äº²å’Œæ€§

**å†³ç­–æ€è·¯**ï¼š

```yaml
è°ƒåº¦ç­–ç•¥:
  ä¼˜å…ˆçº§: é•œåƒæœ¬åœ°å­˜åœ¨
  ç®—æ³•: ImageLocalityPriority
  åœºæ™¯: å¤§è§„æ¨¡éƒ¨ç½²
  æ•ˆæœ: å‡å°‘é•œåƒæ‹‰å–æ—¶é—´
```

**åœºæ™¯ 3ï¼šé«˜å¯ç”¨è°ƒåº¦**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… Pod åäº²å’Œæ€§
- âœ… åŒºåŸŸåˆ†æ•£

**å†³ç­–æ€è·¯**ï¼š

```yaml
è°ƒåº¦ç­–ç•¥:
  ä¼˜å…ˆçº§: Pod åˆ†æ•£
  ç®—æ³•: InterPodAffinityPriority
  åœºæ™¯: é«˜å¯ç”¨æœåŠ¡
  æ•ˆæœ: Pod åˆ†æ•£åˆ°ä¸åŒèŠ‚ç‚¹/åŒºåŸŸ
```

### 6.4 æ‰§è¡Œæµä¸è°ƒåº¦è§†è§’

> **è¯¦ç»†åˆ†æ**ï¼šå‚è§ [æ‰§è¡Œæµä¸è°ƒåº¦è§†è§’](./execution-flow-scheduling.md) - ä»æ‰§è¡Œ
> æµå’Œè°ƒåº¦è§†è§’åˆ†æè™šæ‹ŸåŒ–ã€åŠè™šæ‹ŸåŒ–ã€å®¹å™¨åŒ–ã€æ²™ç›’åŒ–å››ç§æŠ€æœ¯èŒƒå¼çš„æœ¬è´¨å·®å¼‚
>
> **è®¾å¤‡è®¿é—®å†³ç­–**ï¼šå‚è§
> [æŠ€æœ¯å†³ç­–æ¨¡å‹](../../05-decision-analysis/decision-models/QUICK-REFERENCE.md) -
> è®¾å¤‡è®¿é—®ï¼ˆUSB/PCI/GPUï¼‰å’Œå†…æ ¸ç‰¹æ€§å†³ç­–å¿«é€Ÿå‚è€ƒ

ä»**æ‰§è¡Œæµä¸è°ƒåº¦**çš„åº•å±‚è§†è§’ï¼Œæ·±å…¥åˆ†æå››ç§æŠ€æœ¯èŒƒå¼çš„è§¦å‘æœºåˆ¶ã€æˆªè·æœºåˆ¶ã€è°ƒåº¦å®ä½“
å’Œæ‰§è¡Œè·¯å¾„ï¼Œå¸®åŠ©ç†è§£æŠ€æœ¯æœ¬è´¨å’Œæ€§èƒ½å¼€é”€ã€‚

**æ ¸å¿ƒå†…å®¹**ï¼š

- **æ‰§è¡Œæµå…¨æ™¯**ï¼šæ€ç»´å¯¼å›¾ä¸å¯¹æ¯”çŸ©é˜µ
- **å››ç§èŒƒå¼è¯¦è§£**ï¼šå…¨è™šæ‹ŸåŒ–ã€åŠè™šæ‹ŸåŒ–ã€å®¹å™¨åŒ–ã€æ²™ç›’åŒ–çš„å®Œæ•´æ‰§è¡Œæµåˆ†æ
- **æ€§èƒ½å¯¹æ¯”**ï¼šå¼€é”€é‡åŒ–ä¸å†³ç­–ä¾æ®ï¼ˆé™·é˜±å¼€é”€ï¼šå…¨è™šæ‹ŸåŒ– > 1000 cycles â†’ åŠè™šæ‹ŸåŒ–
  200-400 cycles â†’ å®¹å™¨åŒ– 0 â†’ æ²™ç›’åŒ– 10-50 cyclesï¼‰
- **æŠ€æœ¯é€‰å‹**ï¼šåŸºäºæ‰§è¡Œæµç‰¹æ€§çš„å†³ç­–æ ‘
- **è®¾å¤‡è®¿é—®å†³ç­–**ï¼šUSB/PCI/GPU è®¾å¤‡è®¿é—®èƒ½åŠ›çŸ©é˜µä¸å†³ç­–è§„åˆ™ï¼ˆè§
  [æ‰§è¡Œæµæ–‡æ¡£](./execution-flow-scheduling.md#036474-åŸºäºè®¾å¤‡ä¸å†…æ ¸ç‰¹æ€§çš„å†³ç­–)ï¼‰
- **å†…æ ¸ç‰¹æ€§å†³ç­–**ï¼šepoll/io_uring å†…æ ¸ç‰¹æ€§è®¿é—®èƒ½åŠ›ä¸æ€§èƒ½å¯¹æ¯”ï¼ˆè§
  [æ‰§è¡Œæµæ–‡æ¡£](./execution-flow-scheduling.md#036474-åŸºäºè®¾å¤‡ä¸å†…æ ¸ç‰¹æ€§çš„å†³ç­–)ï¼‰

**å…³é”®æ´å¯Ÿ**ï¼š

1. **æˆªè·æœºåˆ¶å†³å®šå¼€é”€**ï¼šVM-Exit æœ€é«˜ï¼Œhypercall æ¬¡ä¹‹ï¼Œç›´æ¥æ‰§è¡Œæœ€ä½
2. **è°ƒåº¦å®ä½“å†³å®šéš”ç¦»**ï¼švCPU çº¿ç¨‹ > å®¹å™¨è¿›ç¨‹ > Sentry çº¿ç¨‹
3. **æ‰§è¡Œè·¯å¾„å†³å®šå»¶è¿Ÿ**ï¼šç”¨æˆ·æ€è½¬å‘æœ€å¿«ï¼ŒVM-Exit æœ€æ…¢
4. **è®¾å¤‡è®¿é—®å†³å®šèŒƒå¼**ï¼šUSB/PCI/GPU è®¾å¤‡è®¿é—® â†’ è™šæ‹ŸåŒ–/åŠè™šæ‹ŸåŒ–ï¼ˆå¿…éœ€ï¼‰
5. **å†…æ ¸ç‰¹æ€§å†³å®šèŒƒå¼**ï¼šepoll/io_uring â†’ å®¹å™¨åŒ–ï¼ˆå¿…éœ€ï¼Œ16-62x æ€§èƒ½æå‡ï¼‰

## 7 ç½‘ç»œæ¨¡å‹å¼ºåˆ¶è¦æ±‚

### 7.1 Kubernetes ç½‘ç»œåŸåˆ™

1. **ä»»æ„ Pod ä¸ Pod ç›´è¿**ï¼Œæ— éœ€ NAT
2. **èŠ‚ç‚¹ä¸ Pod ç›´è¿**ï¼Œæ— éœ€ NAT
3. **Pod çœ‹åˆ°è‡ªå·±çš„ IP**ï¼Œä¸å¤–éƒ¨çœ‹åˆ°çš„ä¸€è‡´

**ç½‘ç»œåŸåˆ™è®ºè¯**ï¼š

- **ç›´è¿è¦æ±‚**ï¼šä¿è¯ Pod é—´é€šä¿¡å»¶è¿Ÿä½ã€æ€§èƒ½é«˜
- **æ—  NAT è¦æ±‚**ï¼šç®€åŒ–ç½‘ç»œæ¨¡å‹ï¼Œé¿å…ç«¯å£æ˜ å°„é—®é¢˜
- **IP ä¸€è‡´æ€§**ï¼šPod å†…å¤–çœ‹åˆ°ç›¸åŒ IPï¼Œç®€åŒ–æœåŠ¡å‘ç°

### 7.2 å®ç°æ–¹å¼

| æ–¹å¼        | æŠ€æœ¯                       | ç‰¹ç‚¹                  |
| ----------- | -------------------------- | --------------------- |
| **Overlay** | Flannel/VXLANã€Calico IPIP | å°è£…åœ¨ç°æœ‰ç½‘ç»œä¹‹ä¸Š    |
| **è·¯ç”±**    | Calico BGPã€Cilium         | ç›´æ¥è·¯ç”±ï¼Œæ€§èƒ½æ›´å¥½    |
| **Bridge**  | Docker é»˜è®¤                | âŒ è¢«æŠ›å¼ƒï¼ˆéœ€è¦ NATï¼‰ |

**å®ç°æ–¹å¼è®ºè¯**ï¼š

- **Overlay**ï¼šåœ¨ç°æœ‰ç½‘ç»œä¹‹ä¸Šå°è£…ï¼Œæ˜“äºéƒ¨ç½²ï¼Œæ€§èƒ½ç›¸å¯¹è¾ƒä½
- **è·¯ç”±**ï¼šç›´æ¥è·¯ç”±ï¼Œæ€§èƒ½æ›´é«˜ï¼Œéœ€è¦ç½‘ç»œæ”¯æŒ
- **Bridge**ï¼šéœ€è¦ NATï¼Œè¿å K8s ç½‘ç»œåŸåˆ™ï¼Œè¢«æŠ›å¼ƒ

### 7.3 ç½‘ç»œæ¨¡å‹å¯¹æ¯”

```mermaid
graph TB
    subgraph "Docker Bridge"
        A1[å®¹å™¨] --> B1[Bridge]
        B1 --> C1[NAT]
        C1 --> D1[å¤–éƒ¨ç½‘ç»œ]
    end

    subgraph "Kubernetes CNI"
        A2[Pod] --> B2[CNI æ’ä»¶]
        B2 --> C2[ç›´æ¥è·¯ç”±/Overlay]
        C2 --> D2[Pod ç½‘ç»œ]
    end

    style C1 fill:#ffcccc
    style C2 fill:#ccffcc
```

### 7.4 ç½‘ç»œåœºæ™¯ä¸å†³ç­–

**åœºæ™¯ 1ï¼šå°è§„æ¨¡é›†ç¾¤ï¼ˆ< 100 èŠ‚ç‚¹ï¼‰**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… ç®€å•æ˜“ç”¨ä¼˜å…ˆ
- âœ… æ€§èƒ½è¦æ±‚ä¸é«˜

**å†³ç­–æ€è·¯**ï¼š

```yaml
ç½‘ç»œæ–¹æ¡ˆé€‰æ‹©:
  CNI: Flannel
  æ¨¡å¼: VXLAN
  åŸå› : ç®€å•æ˜“ç”¨ï¼Œé…ç½®ç®€å•
  æƒè¡¡: æ€§èƒ½ç›¸å¯¹è¾ƒä½
```

**åœºæ™¯ 2ï¼šå¤§è§„æ¨¡é›†ç¾¤ï¼ˆ> 500 èŠ‚ç‚¹ï¼‰**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… æ€§èƒ½è¦æ±‚é«˜
- âœ… ç½‘ç»œç­–ç•¥éœ€æ±‚

**å†³ç­–æ€è·¯**ï¼š

```yaml
ç½‘ç»œæ–¹æ¡ˆé€‰æ‹©:
  CNI: Calico æˆ– Cilium
  æ¨¡å¼: BGP æˆ– eBPF
  åŸå› : é«˜æ€§èƒ½ã€ç½‘ç»œç­–ç•¥æ”¯æŒ
  æƒè¡¡: é…ç½®ç›¸å¯¹å¤æ‚
```

**åœºæ™¯ 3ï¼šå®‰å…¨è¦æ±‚é«˜**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… éœ€è¦ç»†ç²’åº¦ç½‘ç»œç­–ç•¥
- âœ… éœ€è¦ L7 ç­–ç•¥

**å†³ç­–æ€è·¯**ï¼š

```yaml
ç½‘ç»œæ–¹æ¡ˆé€‰æ‹©:
  CNI: Cilium
  æ¨¡å¼: eBPF
  åŸå› : eBPF å®ç° L7 ç­–ç•¥
  æƒè¡¡: éœ€è¦å†…æ ¸æ”¯æŒ
```

**åœºæ™¯ 4ï¼šå¾®æœåŠ¡æ¶æ„**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… éœ€è¦ç»Ÿä¸€çš„æœåŠ¡é—´é€šä¿¡æ²»ç†
- âœ… éœ€è¦é›¶ä¿¡ä»»å®‰å…¨ï¼ˆè‡ªåŠ¨ mTLSï¼‰
- âœ… éœ€è¦å®Œæ•´çš„å¯è§‚æµ‹æ€§ï¼ˆTrace/Metricï¼‰
- âœ… éœ€è¦æµé‡æ²»ç†ï¼ˆè·¯ç”±ã€ç°åº¦å‘å¸ƒï¼‰

**å†³ç­–æ€è·¯**ï¼š

```yaml
ç½‘ç»œæ–¹æ¡ˆé€‰æ‹©:
  CNI: Calico/Ciliumï¼ˆåŸºç¡€ç½‘ç»œï¼‰
  Service Mesh: Istio/Linkerd/Cilium Meshï¼ˆæœåŠ¡é—´é€šä¿¡ï¼‰
  åŸå› :
    - CNI æä¾› Pod é—´ç½‘ç»œè¿é€š
    - Service Mesh æä¾› L7 æµé‡æ²»ç†å’Œå®‰å…¨
  æƒè¡¡:
    - Service Mesh å¢åŠ å»¶è¿Ÿï¼ˆ0.3-1msï¼‰
    - Service Mesh å¢åŠ èµ„æºå ç”¨ï¼ˆ20-200MB/æœåŠ¡ï¼‰
  é€‚ç”¨åœºæ™¯:
    - å¾®æœåŠ¡æ¶æ„ï¼ˆ>50 ä¸ªæœåŠ¡ï¼‰
    - å¤šäº‘ç¯å¢ƒ
    - éœ€è¦ç»Ÿä¸€æ²»ç†
```

## 8 å­˜å‚¨æŠ½è±¡ï¼šCSI

### 8.1 CSI çš„å¿…è¦æ€§

**é—®é¢˜**ï¼šin-tree å­˜å‚¨é©±åŠ¨éš K8s æ ¸å¿ƒä¸€èµ·å‘å¸ƒï¼Œå¯¼è‡´ï¼š

- ç‰ˆæœ¬è€¦åˆ
- å‡çº§å›°éš¾
- äºŒè¿›åˆ¶ä½“ç§¯å¤§

**è§£å†³æ–¹æ¡ˆ**ï¼šCSI å°†é©±åŠ¨æ‹†åˆ°å¤–éƒ¨ Podï¼Œå¯ç‹¬ç«‹å‡çº§ã€‚

```mermaid
graph TB
    A[PVC] --> B[StorageClass]
    B --> C[CSI Driver Pod]
    C --> D[å­˜å‚¨åç«¯]

    E[in-tree é©±åŠ¨] --> F[K8s äºŒè¿›åˆ¶]
    F -.->|ç‰ˆæœ¬è€¦åˆ| G[å‡çº§å›°éš¾]

    C -.->|ç‹¬ç«‹å‡çº§| H[æ˜“äºç»´æŠ¤]

    style F fill:#ffcccc
    style H fill:#ccffcc
```

**CSI å¿…è¦æ€§è®ºè¯**ï¼š

- **ç‰ˆæœ¬è€¦åˆé—®é¢˜**ï¼šin-tree é©±åŠ¨ä¸ K8s æ ¸å¿ƒç‰ˆæœ¬ç»‘å®šï¼Œå‡çº§å›°éš¾
- **äºŒè¿›åˆ¶ä½“ç§¯é—®é¢˜**ï¼šæ‰€æœ‰å­˜å‚¨é©±åŠ¨éƒ½æ‰“åŒ…åœ¨ K8s äºŒè¿›åˆ¶ä¸­ï¼Œä½“ç§¯å¤§
- **CSI è§£å†³æ–¹æ¡ˆ**ï¼šé©±åŠ¨ç‹¬ç«‹è¿è¡Œåœ¨ Pod ä¸­ï¼Œå¯ç‹¬ç«‹å‡çº§ï¼Œé™ä½æ ¸å¿ƒä½“ç§¯

### 8.2 å­˜å‚¨æ¨¡å‹

```yaml
# StorageClassï¼šå®šä¹‰å­˜å‚¨ç±»å‹
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: fast-ssd
provisioner: pd.csi.storage.gke.io
parameters:
  type: pd-ssd

# PVCï¼šå£°æ˜å­˜å‚¨éœ€æ±‚
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: my-pvc
spec:
  storageClassName: fast-ssd
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 100Gi

# Podï¼šä½¿ç”¨å­˜å‚¨
spec:
  volumes:
    - name: data
      persistentVolumeClaim:
        claimName: my-pvc
  containers:
    - volumeMounts:
        - mountPath: /data
          name: data
```

### 8.3 å­˜å‚¨åœºæ™¯ä¸å†³ç­–

**åœºæ™¯ 1ï¼šæœ¬åœ°å­˜å‚¨**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… å•èŠ‚ç‚¹å­˜å‚¨éœ€æ±‚
- âœ… æ€§èƒ½è¦æ±‚é«˜

**å†³ç­–æ€è·¯**ï¼š

```yaml
å­˜å‚¨æ–¹æ¡ˆ:
  type: Local PV
  ç‰¹ç‚¹: æœ¬åœ°ç£ç›˜ï¼Œé«˜æ€§èƒ½
  é™åˆ¶: èŠ‚ç‚¹ç»‘å®šï¼Œæ— æ³•è¿ç§»
  é€‚ç”¨: æœ‰çŠ¶æ€æœåŠ¡ï¼ˆStatefulSetï¼‰
```

**åœºæ™¯ 2ï¼šç½‘ç»œå­˜å‚¨**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… è·¨èŠ‚ç‚¹å­˜å‚¨éœ€æ±‚
- âœ… éœ€è¦å…±äº«å­˜å‚¨

**å†³ç­–æ€è·¯**ï¼š

```yaml
å­˜å‚¨æ–¹æ¡ˆ:
  type: Network PV (NFS/Ceph)
  ç‰¹ç‚¹: ç½‘ç»œå­˜å‚¨ï¼Œå¯å…±äº«
  æƒè¡¡: æ€§èƒ½ç›¸å¯¹è¾ƒä½
  é€‚ç”¨: éœ€è¦å…±äº«å­˜å‚¨çš„åœºæ™¯
```

**åœºæ™¯ 3ï¼šäº‘å­˜å‚¨**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… äº‘å¹³å°éƒ¨ç½²
- âœ… éœ€è¦åŠ¨æ€ä¾›ç»™

**å†³ç­–æ€è·¯**ï¼š

```yaml
å­˜å‚¨æ–¹æ¡ˆ:
  type: Cloud PV (EBS/Azure Disk)
  ç‰¹ç‚¹: åŠ¨æ€ä¾›ç»™ï¼Œé«˜å¯ç”¨
  ä¼˜åŠ¿: è‡ªåŠ¨ç®¡ç†ï¼ŒæŒ‰éœ€æ‰©å®¹
  é€‚ç”¨: äº‘å¹³å°éƒ¨ç½²åœºæ™¯
```

## 9 K3s æ¶æ„ç²¾ç®€

### 9.1 è£å‰ªæ¸…å•

| ç»„ä»¶                         | K8s     | K3s                    |
| ---------------------------- | ------- | ---------------------- |
| **cloud-controller-manager** | âœ…      | âŒ è£å‰ª                |
| **alpha API**                | âœ…      | âŒ è£å‰ª                |
| **in-tree å­˜å‚¨é©±åŠ¨**         | âœ…      | âŒ è£å‰ª                |
| **etcd**                     | âœ… å¤–éƒ¨ | âœ… å¯é€‰ï¼ˆé»˜è®¤ sqliteï¼‰ |
| **containerd**               | å¤–éƒ¨    | âœ… å†…ç½®                |
| **flannel**                  | å¤–éƒ¨    | âœ… å†…ç½®                |
| **traefik**                  | å¤–éƒ¨    | âœ… å†…ç½®                |

**è£å‰ªè®ºè¯**ï¼š

- **cloud-controller-manager**ï¼šè¾¹ç¼˜åœºæ™¯æ— äº‘ç¯å¢ƒï¼Œæ— éœ€äº‘æ§åˆ¶å™¨
- **alpha API**ï¼šè¾¹ç¼˜åœºæ™¯ä¸éœ€è¦å®éªŒæ€§åŠŸèƒ½ï¼Œå‡å°‘ API å¤æ‚åº¦
- **in-tree å­˜å‚¨é©±åŠ¨**ï¼šç»Ÿä¸€ä½¿ç”¨ CSIï¼Œç®€åŒ–ç»´æŠ¤
- **etcd â†’ sqlite**ï¼šè¾¹ç¼˜åœºæ™¯å•èŠ‚ç‚¹ï¼Œsqlite è¶³ä»¥ï¼Œå‡å°‘èµ„æºå ç”¨

### 9.2 å•äºŒè¿›åˆ¶æ‰“åŒ…ç­–ç•¥

```mermaid
graph LR
    A[k3s äºŒè¿›åˆ¶] --> B[é™æ€é“¾æ¥]
    B --> C[åµŒå…¥å¼ç»„ä»¶]
    C --> D[manifest ç›®å½•]
    D --> E[å¯åŠ¨æ—¶åŠ è½½ static pod]

    style A fill:#e1f5ff
    style E fill:#fff4e1
```

**æ‰“åŒ…ç­–ç•¥è®ºè¯**ï¼š

- **é™æ€é“¾æ¥**ï¼šæ‰€æœ‰ç»„ä»¶ç¼–è¯‘åˆ°å•ä¸€äºŒè¿›åˆ¶ï¼Œå‡å°‘ä¾èµ–
- **åµŒå…¥å¼ manifest**ï¼šç»„ä»¶é…ç½®å†…åµŒåœ¨äºŒè¿›åˆ¶ä¸­
- **å¯åŠ¨æ—¶åŠ è½½**ï¼šæ ¹æ® manifest ç›®å½•é¡ºåºå¯åŠ¨ static pod

### 9.3 é«˜å¯ç”¨è·¯å¾„

1. **åµŒå…¥å¼ etcd**ï¼šé€‚åˆå•èŠ‚ç‚¹æˆ–å°è§„æ¨¡
2. **å¤–éƒ¨ etcd**ï¼šé€‚åˆä¸­ç­‰è§„æ¨¡ï¼ˆ3-5 èŠ‚ç‚¹ï¼‰
3. **å¤–éƒ¨ MySQL/PostgreSQL**ï¼šé€‚åˆå¤§è§„æ¨¡æˆ–å·²æœ‰æ•°æ®åº“

### 9.4 è¾¹ç¼˜åœºæ™¯å­˜å‚¨å†³ç­–

**é—®é¢˜åŸŸåˆ†æ**ï¼š

- è¾¹ç¼˜èŠ‚ç‚¹å¸¸æ‰ç”µ
- ç½‘ç»œä¸ç¨³å®š
- èµ„æºå—é™

**ä¸ºä»€ä¹ˆè¾¹ç¼˜åœºæ™¯é€‰ sqliteï¼Ÿ**

**å†³ç­–ä¾æ®**ï¼š

- âœ… **è¾¹ç¼˜èŠ‚ç‚¹å¸¸æ‰ç”µ**ï¼šsqlite å•æ–‡ä»¶å¤åˆ¶/å¤‡ä»½æˆæœ¬æœ€ä½
- âœ… **ç½‘ç»œåˆ†åŒºå®¹å¿**ï¼šæœ¬åœ°ç»§ç»­è¿è¡Œï¼Œæ¢å¤ååŒæ­¥ï¼Œæ¥å—"æœ€ç»ˆä¸€è‡´"
- âœ… **èµ„æºå—é™**ï¼šsqlite å†…å­˜å ç”¨æä½ï¼Œé€‚åˆ ARM è®¾å¤‡

**å†³ç­–æ€è·¯**ï¼š

```yaml
è¾¹ç¼˜åœºæ™¯å­˜å‚¨é€‰æ‹©:
  åœºæ™¯: è¾¹ç¼˜èŠ‚ç‚¹ï¼ˆARM è®¾å¤‡ï¼‰
  å­˜å‚¨: sqliteï¼ˆé»˜è®¤ï¼‰
  åŸå› :
    - å•æ–‡ä»¶å¤‡ä»½ç®€å•
    - æœ¬åœ°è¿è¡Œï¼Œæ— éœ€ç½‘ç»œ
    - èµ„æºå ç”¨æä½
  æƒè¡¡:
    - ä¸æ”¯æŒå¤šèŠ‚ç‚¹å†™å…¥
    - æœ€ç»ˆä¸€è‡´æ€§ï¼Œéå¼ºä¸€è‡´
  æ›¿ä»£æ–¹æ¡ˆ:
    - å¤–éƒ¨ etcdï¼ˆå¦‚æœæœ‰ç¨³å®šç½‘ç»œï¼‰
    - å¤–éƒ¨æ•°æ®åº“ï¼ˆå¦‚æœæœ‰ç°æˆæ•°æ®åº“ï¼‰
```

**æŠ€æœ¯åœºæ™¯å¯¹æ¯”**ï¼š

| åœºæ™¯               | å­˜å‚¨é€‰æ‹©     | å†³ç­–ä¾æ®       | æƒè¡¡         |
| ------------------ | ------------ | -------------- | ------------ |
| **å•èŠ‚ç‚¹è¾¹ç¼˜**     | sqlite       | ç®€å•ã€è½»é‡     | æ— é«˜å¯ç”¨     |
| **å°è§„æ¨¡è¾¹ç¼˜é›†ç¾¤** | åµŒå…¥å¼ etcd  | é«˜å¯ç”¨ã€ç®€å•   | èµ„æºå ç”¨å¢åŠ  |
| **å¤§è§„æ¨¡è¾¹ç¼˜é›†ç¾¤** | å¤–éƒ¨ etcd/DB | é«˜å¯ç”¨ã€å¯æ‰©å±• | ä¾èµ–å¤–éƒ¨ç»„ä»¶ |

## 10 æ•°æ®ç»“æ„å¯¹æ¯”

| ç»´åº¦     | Docker Image | Kubernetes Object                        | K3s Object  |
| -------- | ------------ | ---------------------------------------- | ----------- |
| **å¯»å€** | content-hash | namespace+name+uid                       | åŒ K8s      |
| **ä¾èµ–** | layer parent | OwnerReference                           | åŒ K8s      |
| **å­˜å‚¨** | tar + json   | etcd key = `/registry/{gvr}/{ns}/{name}` | sqlite å•è¡¨ |
| **äº‹åŠ¡** | æ—            | etcd Raft                                | sqlite WAL  |

### 10.1 æ•°æ®ç»“æ„åˆ†æ

**Docker Image**ï¼š

- **å¯»å€**ï¼šcontent-hashï¼ŒåŸºäºé•œåƒå†…å®¹è®¡ç®—
- **ä¾èµ–**ï¼šlayer parentï¼Œé•œåƒå±‚ä¾èµ–å…³ç³»
- **å­˜å‚¨**ï¼štar + jsonï¼Œæ–‡ä»¶ç³»ç»Ÿ + å…ƒæ•°æ®

**Kubernetes Object**ï¼š

- **å¯»å€**ï¼šnamespace+name+uidï¼Œä¸‰å…ƒç»„å”¯ä¸€æ ‡è¯†
- **ä¾èµ–**ï¼šOwnerReferenceï¼Œå¯¹è±¡ä¾èµ–å…³ç³»
- **å­˜å‚¨**ï¼šetcdï¼Œåˆ†å¸ƒå¼é”®å€¼å­˜å‚¨

**K3s Object**ï¼š

- **å¯»å€**ï¼šåŒ K8sï¼Œå…¼å®¹ K8s API
- **ä¾èµ–**ï¼šåŒ K8sï¼Œå…¼å®¹ K8s API
- **å­˜å‚¨**ï¼šsqliteï¼Œå•æ–‡ä»¶æ•°æ®åº“

## 11 æ€§èƒ½è€ƒé‡

### 11.1 äº‹ä»¶åå

- **K8s å®˜æ–¹å‹æµ‹**ï¼š1 ä¸‡èŠ‚ç‚¹ã€15 ä¸‡ Podï¼Œæ§åˆ¶å™¨ QPS ç“¶é¢ˆåœ¨ kube-api-server çš„
  etcd å‰ç«¯ï¼Œä¼˜åŒ–å 100k QPS [^k8s-performance]
- **K3s è£å‰ªå**ï¼šå»æ‰å¤§é‡ controller ä¸ alpha APIï¼Œlist-watch å‹åŠ›ä¸‹é™
  40%ï¼›sqlite æœ¬åœ°è°ƒç”¨å»¶è¿Ÿ 0.1msï¼Œæ¯” etcd ç½‘ç»œå¾€è¿” 2ms ä½ä¸€ä¸ªé‡çº§
  [^k3s-performance]

### 11.2 K3s æ€§èƒ½è®ºè¯

**ä¸ºä»€ä¹ˆ K3s èƒ½æ”¯æŒ 1000 èŠ‚ç‚¹ï¼Ÿ**

**æŠ€æœ¯è®ºè¯**ï¼š

1. **è¾¹ç¼˜èŠ‚ç‚¹ Pod å¯†åº¦ä½**ï¼ˆå¹³å‡ 10 Pod/èŠ‚ç‚¹ï¼‰ï¼Œæ€»å¯¹è±¡æ•° â‰ˆ1 ä¸‡ï¼Œsqlite å•çº¿ç¨‹è¶³
   ä»¥
2. **ç½‘ç»œæ‹“æ‰‘æ˜Ÿå‹**ï¼Œè·¨èŠ‚ç‚¹ watch å°‘
3. **æ§åˆ¶å™¨ç²¾ç®€å**ï¼Œå†…å­˜å¸¸é©» < 250MBï¼Œæ ‘è“æ´¾ 4Bï¼ˆ4GBï¼‰å¯æ‰¿å—

**æ€§èƒ½æ¨¡å‹**ï¼š
$$\text{Performance} = f(\text{Pod\_density}, \text{Network\_topology}, \text{Controller\_count})$$

å…¶ä¸­ï¼š

- Pod å¯†åº¦ä½ â†’ å¯¹è±¡æ•°å°‘ â†’ sqlite æ€§èƒ½è¶³å¤Ÿ
- æ˜Ÿå‹æ‹“æ‰‘ â†’ watch å°‘ â†’ ç½‘ç»œå‹åŠ›å°
- æ§åˆ¶å™¨ç²¾ç®€ â†’ å†…å­˜å ç”¨å° â†’ èµ„æºå……è¶³

## 12 æŠ€æœ¯åœºæ™¯åˆ†æ

### 12.1 å¤§è§„æ¨¡é›†ç¾¤åœºæ™¯

**åœºæ™¯æè¿°**ï¼š> 1000 èŠ‚ç‚¹ï¼Œ> 10 ä¸‡ Pod

**æ¶æ„æŒ‘æˆ˜**ï¼š

1. **API Server å‹åŠ›**ï¼šå¤§é‡ Watch è¯·æ±‚
2. **etcd æ€§èƒ½**ï¼šå¤§é‡å†™å…¥æ“ä½œ
3. **è°ƒåº¦æ€§èƒ½**ï¼šè°ƒåº¦å»¶è¿Ÿå¢åŠ 

**æ¶æ„å†³ç­–**ï¼š

```yaml
å¤§è§„æ¨¡é›†ç¾¤æ¶æ„:
  é€‰æ‹©: Kubernetesï¼ˆé K3sï¼‰
  åŸå› :
    - K3s ä¸æ”¯æŒ > 1000 èŠ‚ç‚¹
    - etcd æ”¯æŒåˆ†å¸ƒå¼éƒ¨ç½²
    - API Server æ”¯æŒ HA
  ä¼˜åŒ–:
    - API Server å‰¯æœ¬
    - etcd åˆ†ç‰‡
    - å¤šä¸ªè°ƒåº¦å™¨
```

**å†³ç­–ä¾æ®**ï¼š

- âœ… è§„æ¨¡éœ€æ±‚ï¼š> 1000 èŠ‚ç‚¹å¿…é¡»ä½¿ç”¨ K8s
- âœ… æ€§èƒ½éœ€æ±‚ï¼šetcd åˆ†å¸ƒå¼éƒ¨ç½²æ”¯æŒæ›´é«˜åå
- âœ… å¯ç”¨æ€§éœ€æ±‚ï¼šAPI Server HA ä¿è¯é«˜å¯ç”¨

### 12.2 è¾¹ç¼˜åœºæ™¯

**åœºæ™¯æè¿°**ï¼šè¾¹ç¼˜èŠ‚ç‚¹ï¼ˆARM è®¾å¤‡ï¼‰ï¼Œèµ„æºå—é™ï¼ˆ< 4GB å†…å­˜ï¼‰

**æ¶æ„æŒ‘æˆ˜**ï¼š

1. **èµ„æºå—é™**ï¼šå†…å­˜å’Œ CPU æœ‰é™
2. **ç½‘ç»œä¸ç¨³å®š**ï¼šç»å¸¸æ‰çº¿
3. **å­˜å‚¨å—é™**ï¼šå­˜å‚¨ç©ºé—´æœ‰é™

**æ¶æ„å†³ç­–**ï¼š

```yaml
è¾¹ç¼˜åœºæ™¯æ¶æ„:
  é€‰æ‹©: K3sï¼ˆé Kubernetesï¼‰
  åŸå› :
    - èµ„æºå ç”¨å°ï¼ˆ< 250MBï¼‰
    - å•äºŒè¿›åˆ¶éƒ¨ç½²ç®€å•
    - sqlite æœ¬åœ°å­˜å‚¨
  ä¼˜åŒ–:
    - ä½¿ç”¨ sqliteï¼ˆé»˜è®¤ï¼‰
    - åµŒå…¥å¼ç»„ä»¶
    - æœ€å°åŒ–æ§åˆ¶å™¨
```

**å†³ç­–ä¾æ®**ï¼š

- âœ… èµ„æºå—é™ï¼šK3s å†…å­˜å ç”¨ < 250MBï¼ŒK8s éœ€è¦ ~1GB
- âœ… ç½‘ç»œä¸ç¨³å®šï¼šsqlite æœ¬åœ°å­˜å‚¨ï¼Œä¸ä¾èµ–ç½‘ç»œ
- âœ… éƒ¨ç½²ç®€å•ï¼šå•äºŒè¿›åˆ¶ï¼Œæ˜“äºå®‰è£…å’Œå‡çº§

### 12.3 æ··åˆæ¶æ„åœºæ™¯

**åœºæ™¯æè¿°**ï¼šä¸­å¿ƒé›†ç¾¤ä½¿ç”¨ K8sï¼Œè¾¹ç¼˜èŠ‚ç‚¹ä½¿ç”¨ K3s

**æ¶æ„æŒ‘æˆ˜**ï¼š

1. **ç»Ÿä¸€ç®¡ç†**ï¼šå¦‚ä½•ç»Ÿä¸€ç®¡ç†ä¸¤ä¸ªé›†ç¾¤
2. **ç½‘ç»œè¿é€š**ï¼šè¾¹ç¼˜èŠ‚ç‚¹å¦‚ä½•ä¸ä¸­å¿ƒé›†ç¾¤é€šä¿¡
3. **é…ç½®åŒæ­¥**ï¼šå¦‚ä½•åŒæ­¥é…ç½®å’Œç­–ç•¥

**æ¶æ„å†³ç­–**ï¼š

```yaml
æ··åˆæ¶æ„æ–¹æ¡ˆ:
  ä¸­å¿ƒé›†ç¾¤: Kubernetes
  è¾¹ç¼˜é›†ç¾¤: K3s
  ç®¡ç†æ–¹æ¡ˆ:
    - Kubernetes Federationï¼ˆç»Ÿä¸€ APIï¼‰
    - GitOpsï¼ˆé…ç½®åŒæ­¥ï¼‰
    - Service Meshï¼ˆæœåŠ¡å‘ç°ï¼‰
  ç½‘ç»œæ–¹æ¡ˆ:
    - VPN æˆ–ä¸“çº¿ï¼ˆè¾¹ç¼˜åˆ°ä¸­å¿ƒï¼‰
    - Flannel VXLANï¼ˆè¾¹ç¼˜å†…éƒ¨ï¼‰
```

**å†³ç­–ä¾æ®**ï¼š

- âœ… åœºæ™¯åŒ¹é…ï¼šä¸­å¿ƒéœ€è¦å®Œæ•´ K8sï¼Œè¾¹ç¼˜éœ€è¦è½»é‡ K3s
- âœ… ç»Ÿä¸€ç®¡ç†ï¼šé€šè¿‡ Federation æˆ– GitOps å®ç°
- âœ… ç½‘ç»œè¿é€šï¼šVPN/ä¸“çº¿ä¿è¯è¾¹ç¼˜åˆ°ä¸­å¿ƒé€šä¿¡

## 13 å†³ç­–ä¾æ®ä¸æ€è·¯

### 13.1 æ¶æ„é€‰æ‹©å†³ç­–æ ‘

```yaml
æ¶æ„é€‰æ‹©å†³ç­–:
  if èŠ‚ç‚¹æ•° > 1000: é€‰æ‹© Kubernetes
  elif è¾¹ç¼˜åœºæ™¯ or èµ„æºå—é™ or ç½‘ç»œä¸ç¨³å®š: é€‰æ‹© K3s
  elif å•æœºå®¹å™¨ç®¡ç†: é€‰æ‹© Docker
  else: é€‰æ‹© Kubernetesï¼ˆé»˜è®¤ï¼‰
```

### 13.2 å­˜å‚¨é€‰æ‹©å†³ç­–æ ‘

```yaml
å­˜å‚¨é€‰æ‹©å†³ç­–:
  if è¾¹ç¼˜åœºæ™¯ and å•èŠ‚ç‚¹: é€‰æ‹© sqlite
  elif è¾¹ç¼˜åœºæ™¯ and å°è§„æ¨¡é›†ç¾¤: é€‰æ‹© åµŒå…¥å¼ etcd
  elif å¤§è§„æ¨¡é›†ç¾¤: é€‰æ‹© å¤–éƒ¨ etcd
  elif å·²æœ‰æ•°æ®åº“: é€‰æ‹© å¤–éƒ¨ MySQL/PostgreSQL
```

### 13.3 ç½‘ç»œé€‰æ‹©å†³ç­–æ ‘

```yaml
ç½‘ç»œé€‰æ‹©å†³ç­–:
  if å°è§„æ¨¡é›†ç¾¤ (< 100): é€‰æ‹© Flannel
  elif å¤§è§„æ¨¡é›†ç¾¤ (> 500): é€‰æ‹© Calico æˆ– Cilium
  elif å®‰å…¨è¦æ±‚é«˜: é€‰æ‹© Ciliumï¼ˆeBPFï¼‰
  elif å¾®æœåŠ¡æ¶æ„:
    é€‰æ‹© Calico/Cilium + Service Meshï¼ˆIstio/Linkerd/Cilium Meshï¼‰
  else: é€‰æ‹© Flannelï¼ˆé»˜è®¤ï¼‰

Service Mesh é€‰æ‹©å†³ç­–:
  if å¾®æœåŠ¡æ¶æ„ (>50 æœåŠ¡) and åŠŸèƒ½å®Œæ•´éœ€æ±‚: é€‰æ‹© Istioï¼ˆAmbient æ¨¡å¼ï¼‰
  elif å¾®æœåŠ¡æ¶æ„ and è½»é‡çº§éœ€æ±‚: é€‰æ‹© Linkerd
  elif å¾®æœåŠ¡æ¶æ„ and é«˜æ€§èƒ½éœ€æ±‚: é€‰æ‹© Cilium Service Mesh
  else: æ— éœ€ Service Mesh
```

## 14 å½¢å¼åŒ–æ€»ç»“

### 14.1 æ¶æ„æ¨¡å‹å½¢å¼åŒ–

è®¾æ¶æ„ä¸º $A = \{C, S, D\}$ï¼Œå…¶ä¸­ï¼š

- $C$ = æ§åˆ¶å¹³é¢ï¼ˆControl Planeï¼‰
- $S$ = å­˜å‚¨ï¼ˆStorageï¼‰
- $D$ = æ•°æ®å¹³é¢ï¼ˆData Planeï¼‰

**Docker æ¶æ„**ï¼š $$A_D = \{dockerd, local, runc\}$$

**Kubernetes æ¶æ„**ï¼š
$$A_K = \{\text{API Server} + \text{etcd}, \text{etcd}, \text{kubelet} + \text{CRI}\}$$

**K3s æ¶æ„**ï¼š
$$A_{K3} = \{\text{k3s äºŒè¿›åˆ¶}, \text{sqlite}, \text{kubelet} + \text{å†…ç½®ç»„ä»¶}\}$$

**Service Mesh å¢å¼ºæ¶æ„**ï¼š
$$A_{SM} = A_K + \{\text{Istiod/Linkerd}, \text{Sidecar/Ambient}, \text{æµé‡æ²»ç†} + \text{å®‰å…¨} + \text{å¯è§‚æµ‹æ€§}\}$$

### 14.2 æ€§èƒ½æ¨¡å‹å½¢å¼åŒ–

**K8s æ€§èƒ½æ¨¡å‹**ï¼š
$$P_K(N, P) = \text{API\_QPS}(N) \times \text{etcd\_latency}(N, P)$$

å…¶ä¸­ï¼š

- $N$ = èŠ‚ç‚¹æ•°
- $P$ = Pod æ•°
- $\text{API\_QPS}$ = API Server QPSï¼ˆä¸èŠ‚ç‚¹æ•°ç›¸å…³ï¼‰
- $\text{etcd\_latency}$ = etcd å»¶è¿Ÿï¼ˆä¸èŠ‚ç‚¹æ•°å’Œ Pod æ•°ç›¸å…³ï¼‰

**K3s æ€§èƒ½æ¨¡å‹**ï¼š
$$P_{K3}(N, P) = \text{controller\_count} \times \text{sqlite\_latency}(P)$$

å…¶ä¸­ï¼š

- æ§åˆ¶å™¨æ•°é‡å‡å°‘ 40%
- sqlite å»¶è¿Ÿ = 0.1msï¼ˆæœ¬åœ°è°ƒç”¨ï¼‰

### 14.3 å¯¹è±¡æ¨¡å‹å½¢å¼åŒ–

**å¯¹è±¡çŠ¶æ€è½¬æ¢**ï¼š $$O_{t+1} = \text{Reconcile}(\text{Spec}, O_t)$$

å…¶ä¸­ $O_t$ æ˜¯æ—¶é—´ $t$ çš„å¯¹è±¡çŠ¶æ€ï¼Œé€šè¿‡ Reconcile å‡½æ•°è®¡ç®—ä¸‹ä¸€çŠ¶æ€ã€‚

**æ”¶æ•›æ€§å®šç†**ï¼šå‚è€ƒ
[2.5.2 æ§åˆ¶å¾ªç¯æ”¶æ•›å®šç†](../../01-core-foundations/principles/principles.md#252-æ§åˆ¶å¾ªç¯æ”¶æ•›å®šç†)

## 15 å‚è€ƒ

**å…³è”æ–‡æ¡£**ï¼š

- **[28. æ¶æ„æ¡†æ¶](../../TECHNICAL/28-architecture-framework/architecture-framework.md)** -
  å¤šç»´åº¦æ¶æ„ä½“ç³»ä¸æŠ€æœ¯è§„èŒƒï¼ˆæŠ€æœ¯æ¶æ„ã€æ¦‚å¿µæ¶æ„ã€æ•°æ®æ¶æ„ã€ä¸šåŠ¡æ¶æ„ã€è½¯ä»¶æ¶æ„ã€åº”
  ç”¨æ¶æ„ã€åœºæ™¯æ¶æ„ï¼‰
- **[05. å…¨å±€æ¶æ„è®¾è®¡](../architecture-design/architecture-design.md)** - å…¨å±€æ¶
  æ„è®¾è®¡ä¸æŠ€æœ¯ç»„åˆ
- [09 çŸ©é˜µè§†è§’](../../03-theoretical-perspectives/matrix-perspective/README.md) -
  çŸ©é˜µåŠ›å­¦åˆ†ææ–¹æ³•ï¼ˆç”¨äºæ¶æ„å†³ç­–é‡åŒ–æ”¯æŒï¼‰
- [10 æŠ€æœ¯å†³ç­–æ¨¡å‹](../../05-decision-analysis/decision-models/decision-models.md) -
  æŠ€æœ¯é€‰å‹å†³ç­–æ¡†æ¶
- [10 å¿«é€Ÿå‚è€ƒæŒ‡å—](../../05-decision-analysis/decision-models/QUICK-REFERENCE.md) -
  è®¾å¤‡è®¿é—®ï¼ˆUSB/PCI/GPUï¼‰å’Œå†…æ ¸ç‰¹æ€§å†³ç­–å¿«é€Ÿå‚è€ƒ
- [10 ä¸€è‡´æ€§æ£€æŸ¥æŠ¥å‘Š](../../05-decision-analysis/decision-models/CONSISTENCY-REPORT.md) -
  æ–‡æ¡£ä¸€è‡´æ€§æ£€æŸ¥ä¸ Wikipedia æ ‡å‡†å¯¹é½

**å¤–éƒ¨å‚è€ƒ**ï¼š

[^k8s-architecture]:
    [Kubernetes Architecture](https://kubernetes.io/docs/concepts/architecture/)

[^k3s-architecture]: [K3s Architecture](https://docs.k3s.io/architecture)
[^k8s-performance]:
    [Kubernetes Performance](https://kubernetes.io/docs/setup/best-practices/cluster-large/)

[^k3s-performance]: [K3s Performance](https://docs.k3s.io/)

---

## 16 è®¤çŸ¥å¢å¼ºï¼šæ€ç»´å¯¼å›¾ã€å»ºæ¨¡è§†å›¾ä¸å›¾è¡¨è¾¾è½¬æ¢

### 16.1 æ¶æ„è®¾è®¡å®Œæ•´æ€ç»´å¯¼å›¾

```mermaid
graph TB
    A[æ¶æ„ä¸å¯¹è±¡æ¨¡å‹] --> B[æ¶æ„å±‚æ¬¡]
    A --> C[å¯¹è±¡æ¨¡å‹]
    A --> D[æ§åˆ¶é—­ç¯]
    A --> E[æŠ€æœ¯åœºæ™¯]

    B --> B1[Dockeræ¶æ„]
    B --> B2[Kubernetesæ¶æ„]
    B --> B3[K3sæ¶æ„]

    C --> C1[GVRæ¨¡å‹]
    C --> C2[å¯¹è±¡ç»“æ„]
    C --> C3[å¯¹è±¡å…³ç³»]

    D --> D1[Informeræ¨¡å¼]
    D --> D2[Controlleræ¨¡å¼]
    D --> D3[æ§åˆ¶å¾ªç¯]

    E --> E1[å¤§è§„æ¨¡é›†ç¾¤]
    E --> E2[è¾¹ç¼˜åœºæ™¯]
    E --> E3[æ··åˆæ¶æ„]

    style A fill:#ff9999
    style B fill:#99ccff
    style C fill:#99ff99
    style D fill:#ffcc99
    style E fill:#cc99ff
```

### 16.2 æ¶æ„å»ºæ¨¡è§†å›¾ï¼ˆC4 æ¨¡å‹ + UMLï¼‰

#### ç³»ç»Ÿå®¹å™¨å›¾ï¼ˆC4 Level 2ï¼‰

```mermaid
C4Container
    title Docker/Kubernetes/K3s æ¶æ„å®¹å™¨è§†å›¾

    System_Boundary(docker, "Docker æ¶æ„") {
        Container(docker_cli, "docker-cli", "CLIå·¥å…·", "ç”¨æˆ·æ¥å£")
        Container(dockerd, "dockerd", "å®ˆæŠ¤è¿›ç¨‹", "é•œåƒå’Œå®¹å™¨ç®¡ç†")
        Container(containerd, "containerd", "è¿è¡Œæ—¶æ¥å£", "å®¹å™¨ç”Ÿå‘½å‘¨æœŸ")
        Container(runc, "runc", "OCIè¿è¡Œæ—¶", "åˆ›å»ºå®¹å™¨è¿›ç¨‹")
    }

    System_Boundary(k8s, "Kubernetes æ¶æ„") {
        Container(api_server, "API Server", "ç»Ÿä¸€å…¥å£", "APIç½‘å…³")
        Container(etcd, "etcd", "çŠ¶æ€å­˜å‚¨", "åˆ†å¸ƒå¼é”®å€¼å­˜å‚¨")
        Container(controller, "Controller", "çŠ¶æ€ç®¡ç†", "æ§åˆ¶å¾ªç¯")
        Container(scheduler, "Scheduler", "è°ƒåº¦å†³ç­–", "Podè°ƒåº¦")
        Container(kubelet, "kubelet", "èŠ‚ç‚¹ä»£ç†", "Podç”Ÿå‘½å‘¨æœŸ")
    }

    System_Boundary(k3s, "K3s æ¶æ„") {
        Container(k3s_binary, "k3säºŒè¿›åˆ¶", "å•äºŒè¿›åˆ¶", "åµŒå…¥å¼ç»„ä»¶")
        Container(sqlite, "sqlite", "æœ¬åœ°å­˜å‚¨", "å•æ–‡ä»¶æ•°æ®åº“")
    }

    Rel(docker_cli, dockerd, "è°ƒç”¨")
    Rel(dockerd, containerd, "è°ƒç”¨")
    Rel(containerd, runc, "è°ƒç”¨")
    Rel(api_server, etcd, "è¯»å†™")
    Rel(controller, api_server, "ç›‘å¬")
    Rel(scheduler, api_server, "ç›‘å¬")
    Rel(kubelet, api_server, "ç›‘å¬")
    Rel(k3s_binary, sqlite, "è¯»å†™")
```

#### å¯¹è±¡æ¨¡å‹ç±»å›¾ï¼ˆUMLï¼‰

```mermaid
classDiagram
    class KubernetesObject {
        +metadata: ObjectMeta
        +spec: Spec
        +status: Status
    }

    class ObjectMeta {
        +name: string
        +namespace: string
        +uid: string
        +labels: map
        +ownerReferences: array
    }

    class Spec {
        +æœŸæœ›çŠ¶æ€å®šä¹‰
    }

    class Status {
        +å®é™…çŠ¶æ€è®°å½•
    }

    class Deployment {
        +replicas: int
        +selector: LabelSelector
        +template: PodTemplate
    }

    class ReplicaSet {
        +replicas: int
        +selector: LabelSelector
        +template: PodTemplate
    }

    class Pod {
        +containers: array
        +volumes: array
    }

    class Service {
        +selector: LabelSelector
        +ports: array
    }

    KubernetesObject <|-- Deployment
    KubernetesObject <|-- ReplicaSet
    KubernetesObject <|-- Pod
    KubernetesObject <|-- Service
    KubernetesObject --> ObjectMeta
    KubernetesObject --> Spec
    KubernetesObject --> Status
    Deployment --> ReplicaSet : OwnerReference
    ReplicaSet --> Pod : OwnerReference
    Service --> Pod : LabelSelector
```

### 16.3 æ¶æ„å¤šç»´å…³ç³»çŸ©é˜µ

#### æ¶æ„-ç»„ä»¶-åŠŸèƒ½ä¸‰ç»´çŸ©é˜µ

| æ¶æ„ç»´åº¦ | Docker | Kubernetes | K3s | æ§åˆ¶å¹³é¢ | æ•°æ®å¹³é¢ | å­˜å‚¨ | ç½‘ç»œ | è®¤çŸ¥ä»·å€¼ |
|---------|--------|------------|-----|---------|---------|------|------|---------|
| **æ¶æ„æ¨¡å¼** | åˆ†å±‚æ¶æ„ | ä¸­å¿ƒåŒ–æ¶æ„ | å•äºŒè¿›åˆ¶æ¶æ„ | æ¶æ„æ¨¡å¼ | æ¶æ„æ¨¡å¼ | æ¶æ„æ¨¡å¼ | æ¶æ„æ¨¡å¼ | æ¨¡å¼ç†è§£ |
| **æ§åˆ¶å¹³é¢** | dockerd | API Server+etcd | k3säºŒè¿›åˆ¶ | âœ… æ ¸å¿ƒ | âŒ æ—  | âš ï¸ éƒ¨åˆ† | âš ï¸ éƒ¨åˆ† | æ§åˆ¶ç†è§£ |
| **æ•°æ®å¹³é¢** | runc | kubelet+CRI | kubelet+å†…ç½® | âŒ æ—  | âœ… æ ¸å¿ƒ | âš ï¸ éƒ¨åˆ† | âš ï¸ éƒ¨åˆ† | æ•°æ®ç†è§£ |
| **å­˜å‚¨** | æœ¬åœ°æ–‡ä»¶ç³»ç»Ÿ | etcd | sqlite | âš ï¸ éƒ¨åˆ† | âš ï¸ éƒ¨åˆ† | âœ… æ ¸å¿ƒ | âŒ æ—  | å­˜å‚¨ç†è§£ |
| **ç½‘ç»œ** | Bridge | CNIæ’ä»¶ | flannelå†…ç½® | âš ï¸ éƒ¨åˆ† | âš ï¸ éƒ¨åˆ† | âŒ æ—  | âœ… æ ¸å¿ƒ | ç½‘ç»œç†è§£ |
| **å¯¹è±¡æ¨¡å‹** | é•œåƒå±‚ | GVRæ¨¡å‹ | GVRæ¨¡å‹ | âœ… æ ¸å¿ƒ | âš ï¸ éƒ¨åˆ† | âš ï¸ éƒ¨åˆ† | âŒ æ—  | æ¨¡å‹ç†è§£ |
| **æ§åˆ¶å¾ªç¯** | æ—  | Informer+Controller | Informer+Controller | âœ… æ ¸å¿ƒ | âŒ æ—  | âŒ æ—  | âŒ æ—  | å¾ªç¯ç†è§£ |

#### æ¶æ„-åœºæ™¯-å†³ç­–æ˜ å°„çŸ©é˜µ

| æ¶æ„ | å¤§è§„æ¨¡é›†ç¾¤ | è¾¹ç¼˜åœºæ™¯ | æ··åˆæ¶æ„ | å†³ç­–ä¾æ® | æƒè¡¡ | è®¤çŸ¥ä»·å€¼ |
|-----|-----------|---------|---------|---------|------|---------|
| **Docker** | âŒ ä¸æ”¯æŒ | âš ï¸ éƒ¨åˆ†æ”¯æŒ | âŒ ä¸æ”¯æŒ | å•æœºå®¹å™¨ç®¡ç† | æ— é›†ç¾¤èƒ½åŠ› | åœºæ™¯ç†è§£ |
| **Kubernetes** | âœ… æ ¸å¿ƒ | âš ï¸ éƒ¨åˆ†æ”¯æŒ | âœ… ä¸­å¿ƒé›†ç¾¤ | å¤§è§„æ¨¡ç¼–æ’ | èµ„æºå ç”¨å¤§ | åœºæ™¯ç†è§£ |
| **K3s** | âŒ ä¸æ”¯æŒ | âœ… æ ¸å¿ƒ | âœ… è¾¹ç¼˜é›†ç¾¤ | è½»é‡è¾¹ç¼˜ | è§„æ¨¡å—é™ | åœºæ™¯ç†è§£ |

### 16.4 å›¾è¡¨è¾¾å’Œè½¬æ¢

#### æ¶æ„è§†å›¾è½¬æ¢å…³ç³»

```mermaid
graph LR
    A[æ¶æ„è®¾è®¡] --> B[ç»„ä»¶è§†å›¾]
    A --> C[æ•°æ®æµè§†å›¾]
    A --> D[æ§åˆ¶æµè§†å›¾]
    A --> E[åœºæ™¯è§†å›¾]

    B --> B1[Dockerç»„ä»¶]
    B --> B2[K8sç»„ä»¶]
    B --> B3[K3sç»„ä»¶]

    C --> C1[é•œåƒæµ]
    C --> C2[å¯¹è±¡æµ]
    C --> C3[äº‹ä»¶æµ]

    D --> D1[æ§åˆ¶è·¯å¾„]
    D --> D2[æ§åˆ¶å¾ªç¯]
    D --> D3[è°ƒåº¦æµç¨‹]

    E --> E1[å¤§è§„æ¨¡åœºæ™¯]
    E --> E2[è¾¹ç¼˜åœºæ™¯]
    E --> E3[æ··åˆåœºæ™¯]

    style A fill:#ff9999
    style B fill:#99ccff
    style C fill:#99ff99
    style D fill:#ffcc99
    style E fill:#cc99ff
```

#### è§†å›¾è½¬æ¢è§„åˆ™

**è½¬æ¢è§„åˆ™ 1ï¼šç»„ä»¶è§†å›¾ â†’ æ•°æ®æµè§†å›¾**:

```yaml
ç»„ä»¶è§†å›¾è½¬æ¢:
  è¾“å…¥: æ¶æ„ç»„ä»¶ï¼ˆDockerã€K8sã€K3sï¼‰
  è½¬æ¢è§„åˆ™:
    - Dockerç»„ä»¶ â†’ é•œåƒæµï¼ˆé•œåƒæ‹‰å–ã€å®¹å™¨å¯åŠ¨ï¼‰
    - K8sç»„ä»¶ â†’ å¯¹è±¡æµï¼ˆå¯¹è±¡åˆ›å»ºã€çŠ¶æ€æ›´æ–°ï¼‰
    - K3sç»„ä»¶ â†’ å¯¹è±¡æµï¼ˆè½»é‡å¯¹è±¡æµï¼‰
  è¾“å‡º: æ•°æ®æµï¼ˆé•œåƒæµã€å¯¹è±¡æµã€äº‹ä»¶æµï¼‰
```

**è½¬æ¢è§„åˆ™ 2ï¼šæ•°æ®æµè§†å›¾ â†’ æ§åˆ¶æµè§†å›¾**:

```yaml
æ•°æ®æµè§†å›¾è½¬æ¢:
  è¾“å…¥: æ•°æ®æµï¼ˆé•œåƒæµã€å¯¹è±¡æµã€äº‹ä»¶æµï¼‰
  è½¬æ¢è§„åˆ™:
    - é•œåƒæµ â†’ Dockeræ§åˆ¶è·¯å¾„ï¼ˆcliâ†’dockerdâ†’containerdâ†’runcï¼‰
    - å¯¹è±¡æµ â†’ K8sæ§åˆ¶å¾ªç¯ï¼ˆAPI Serverâ†’etcdâ†’Controllerâ†’Reconcileï¼‰
    - äº‹ä»¶æµ â†’ Informeræ¨¡å¼ï¼ˆWatchâ†’ç¼“å­˜â†’é˜Ÿåˆ—â†’Reconcileï¼‰
  è¾“å‡º: æ§åˆ¶æµï¼ˆæ§åˆ¶è·¯å¾„ã€æ§åˆ¶å¾ªç¯ã€è°ƒåº¦æµç¨‹ï¼‰
```

**è½¬æ¢è§„åˆ™ 3ï¼šæ§åˆ¶æµè§†å›¾ â†’ åœºæ™¯è§†å›¾**:

```yaml
æ§åˆ¶æµè§†å›¾è½¬æ¢:
  è¾“å…¥: æ§åˆ¶æµç‰¹æ€§ï¼ˆæ§åˆ¶è·¯å¾„ã€æ§åˆ¶å¾ªç¯ã€è°ƒåº¦æµç¨‹ï¼‰
  è½¬æ¢è§„åˆ™:
    - ç®€å•æ§åˆ¶è·¯å¾„ â†’ å•æœºåœºæ™¯ï¼ˆDockerï¼‰
    - å¤æ‚æ§åˆ¶å¾ªç¯ â†’ å¤§è§„æ¨¡åœºæ™¯ï¼ˆKubernetesï¼‰
    - è½»é‡æ§åˆ¶å¾ªç¯ â†’ è¾¹ç¼˜åœºæ™¯ï¼ˆK3sï¼‰
  è¾“å‡º: é€‚ç”¨åœºæ™¯ï¼ˆå¤§è§„æ¨¡ã€è¾¹ç¼˜ã€æ··åˆï¼‰
```

### 16.5 å½¢è±¡åŒ–è§£é‡Šè®ºè¯

#### æ¶æ„è®¾è®¡çš„å½¢è±¡åŒ–ç±»æ¯”

##### 1. Docker æ¶æ„ = å·¥å‚ç”Ÿäº§çº¿

> **ç±»æ¯”**ï¼šDocker æ¶æ„å°±åƒå·¥å‚ç”Ÿäº§çº¿ï¼Œdocker-cli æ˜¯"æ“ä½œå‘˜"ï¼ˆä¸‹è¾¾æŒ‡ä»¤ï¼‰ï¼Œdockerd æ˜¯"ç”Ÿäº§ä¸»ç®¡"ï¼ˆç®¡ç†ç”Ÿäº§ï¼‰ï¼Œcontainerd æ˜¯"è½¦é—´ä¸»ä»»"ï¼ˆç®¡ç†è½¦é—´ï¼‰ï¼Œrunc æ˜¯"å·¥äºº"ï¼ˆæ‰§è¡Œç”Ÿäº§ï¼‰ï¼Œå°±åƒå·¥å‚ä»æ“ä½œå‘˜åˆ°ä¸»ç®¡åˆ°è½¦é—´ä¸»ä»»å†åˆ°å·¥äººçš„å±‚çº§ç®¡ç†ä¸€æ ·ï¼ŒDocker ä» CLI åˆ° dockerd åˆ° containerd å†åˆ° runc çš„å±‚çº§è°ƒç”¨ã€‚

**è®¤çŸ¥ä»·å€¼**ï¼š

- **å±‚çº§ç†è§£**ï¼šé€šè¿‡å·¥å‚å±‚çº§ç±»æ¯”ï¼Œç†è§£ Docker æ¶æ„çš„å±‚çº§æ€§
- **èŒè´£ç†è§£**ï¼šé€šè¿‡å·¥å‚èŒè´£ç±»æ¯”ï¼Œç†è§£å„ç»„ä»¶çš„èŒè´£åˆ†å·¥
- **æµç¨‹ç†è§£**ï¼šé€šè¿‡ç”Ÿäº§æµç¨‹ç±»æ¯”ï¼Œç†è§£ Docker çš„æ§åˆ¶æµç¨‹

##### 2. Kubernetes æ¶æ„ = æ™ºèƒ½åŸå¸‚ç®¡ç†ç³»ç»Ÿ

> **ç±»æ¯”**ï¼šKubernetes æ¶æ„å°±åƒæ™ºèƒ½åŸå¸‚ç®¡ç†ç³»ç»Ÿï¼ŒAPI Server æ˜¯"åŸå¸‚æŒ‡æŒ¥ä¸­å¿ƒ"ï¼ˆç»Ÿä¸€å…¥å£ï¼‰ï¼Œetcd æ˜¯"åŸå¸‚æ•°æ®åº“"ï¼ˆçŠ¶æ€å­˜å‚¨ï¼‰ï¼ŒController æ˜¯"åŸå¸‚ç®¡ç†è€…"ï¼ˆçŠ¶æ€ç®¡ç†ï¼‰ï¼ŒScheduler æ˜¯"äº¤é€šè°ƒåº¦å‘˜"ï¼ˆèµ„æºè°ƒåº¦ï¼‰ï¼Œkubelet æ˜¯"åŒºåŸŸç®¡ç†å‘˜"ï¼ˆèŠ‚ç‚¹ç®¡ç†ï¼‰ï¼Œå°±åƒåŸå¸‚ç®¡ç†ç³»ç»Ÿä»æŒ‡æŒ¥ä¸­å¿ƒåˆ°æ•°æ®åº“åˆ°ç®¡ç†è€…å†åˆ°è°ƒåº¦å‘˜çš„åä½œä¸€æ ·ï¼ŒKubernetes ä» API Server åˆ° etcd åˆ° Controller å†åˆ° Scheduler çš„åä½œã€‚

**è®¤çŸ¥ä»·å€¼**ï¼š

- **ç³»ç»Ÿç†è§£**ï¼šé€šè¿‡åŸå¸‚ç®¡ç†ç³»ç»Ÿç±»æ¯”ï¼Œç†è§£ Kubernetes æ¶æ„çš„ç³»ç»Ÿæ€§
- **åä½œç†è§£**ï¼šé€šè¿‡åŸå¸‚åä½œç±»æ¯”ï¼Œç†è§£å„ç»„ä»¶çš„åä½œå…³ç³»
- **ç®¡ç†ç†è§£**ï¼šé€šè¿‡åŸå¸‚ç®¡ç†ç±»æ¯”ï¼Œç†è§£ Kubernetes çš„ç®¡ç†èƒ½åŠ›

##### 3. K3s æ¶æ„ = ä¾¿æºå¼å·¥å…·ç®±

> **ç±»æ¯”**ï¼šK3s æ¶æ„å°±åƒä¾¿æºå¼å·¥å…·ç®±ï¼Œk3s äºŒè¿›åˆ¶æ˜¯"å·¥å…·ç®±"ï¼ˆé›†æˆå·¥å…·ï¼‰ï¼Œsqlite æ˜¯"å·¥å…·ç®±å†…ç½®å­˜å‚¨"ï¼ˆæœ¬åœ°å­˜å‚¨ï¼‰ï¼ŒåµŒå…¥å¼ç»„ä»¶æ˜¯"å·¥å…·ç®±å†…ç½®å·¥å…·"ï¼ˆå†…ç½®åŠŸèƒ½ï¼‰ï¼Œå°±åƒä¾¿æºå¼å·¥å…·ç®±ä»å·¥å…·ç®±åˆ°å†…ç½®å­˜å‚¨å†åˆ°å†…ç½®å·¥å…·çš„é›†æˆä¸€æ ·ï¼ŒK3s ä»äºŒè¿›åˆ¶åˆ° sqlite å†åˆ°åµŒå…¥å¼ç»„ä»¶çš„é›†æˆã€‚

**è®¤çŸ¥ä»·å€¼**ï¼š

- **é›†æˆç†è§£**ï¼šé€šè¿‡å·¥å…·ç®±é›†æˆç±»æ¯”ï¼Œç†è§£ K3s æ¶æ„çš„é›†æˆæ€§
- **è½»é‡ç†è§£**ï¼šé€šè¿‡å·¥å…·ç®±è½»é‡ç±»æ¯”ï¼Œç†è§£ K3s çš„è½»é‡ç‰¹æ€§
- **ä¾¿æºç†è§£**ï¼šé€šè¿‡å·¥å…·ç®±ä¾¿æºç±»æ¯”ï¼Œç†è§£ K3s çš„éƒ¨ç½²ä¾¿åˆ©æ€§

##### 4. æ§åˆ¶å¾ªç¯ = æ’æ¸©å™¨ç³»ç»Ÿ

> **ç±»æ¯”**ï¼šæ§åˆ¶å¾ªç¯å°±åƒæ’æ¸©å™¨ç³»ç»Ÿï¼ŒæœŸæœ›çŠ¶æ€æ˜¯"è®¾å®šæ¸©åº¦"ï¼ˆç›®æ ‡æ¸©åº¦ï¼‰ï¼Œå®é™…çŠ¶æ€æ˜¯"å½“å‰æ¸©åº¦"ï¼ˆå®é™…æ¸©åº¦ï¼‰ï¼ŒReconcile æ˜¯"æ¸©åº¦è°ƒèŠ‚"ï¼ˆæ¸©åº¦è°ƒæ•´ï¼‰ï¼Œå°±åƒæ’æ¸©å™¨ä»è®¾å®šæ¸©åº¦åˆ°å½“å‰æ¸©åº¦å†åˆ°æ¸©åº¦è°ƒèŠ‚çš„å¾ªç¯ä¸€æ ·ï¼Œæ§åˆ¶å¾ªç¯ä»æœŸæœ›çŠ¶æ€åˆ°å®é™…çŠ¶æ€å†åˆ° Reconcile çš„å¾ªç¯ã€‚

**è®¤çŸ¥ä»·å€¼**ï¼š

- **å¾ªç¯ç†è§£**ï¼šé€šè¿‡æ’æ¸©å™¨å¾ªç¯ç±»æ¯”ï¼Œç†è§£æ§åˆ¶å¾ªç¯çš„å¾ªç¯æ€§
- **æ”¶æ•›ç†è§£**ï¼šé€šè¿‡æ¸©åº¦æ”¶æ•›ç±»æ¯”ï¼Œç†è§£æ§åˆ¶å¾ªç¯çš„æ”¶æ•›æ€§
- **è‡ªåŠ¨ç†è§£**ï¼šé€šè¿‡æ’æ¸©å™¨è‡ªåŠ¨ç±»æ¯”ï¼Œç†è§£æ§åˆ¶å¾ªç¯çš„è‡ªåŠ¨æ€§

### 16.6 ä¸“å®¶è§‚ç‚¹ä¸è®ºè¯

#### è®¡ç®—ä¿¡æ¯è½¯ä»¶ç§‘å­¦å®¶çš„è§‚ç‚¹

##### 1. Joe Bedaï¼ˆKubernetes è”åˆåˆ›å§‹äººï¼‰

> "Kubernetes is about making the complex simple. It's about declarative configuration and automatic reconciliation."

**åœ¨æ¶æ„è®¾è®¡ä¸­çš„åº”ç”¨**ï¼š

- **ç®€åŒ–å¤æ‚æ€§**ï¼šKubernetes æ¶æ„é€šè¿‡ä¸­å¿ƒåŒ–è®¾è®¡ç®€åŒ–å¤æ‚ç³»ç»Ÿç®¡ç†
- **å£°æ˜å¼é…ç½®**ï¼šå£°æ˜å¼ API æé«˜å¯ç»´æŠ¤æ€§
- **è‡ªåŠ¨åè°ƒ**ï¼šæ§åˆ¶å¾ªç¯å®ç°è‡ªåŠ¨åè°ƒ

##### 2. Tim Hockinï¼ˆKubernetes æ ¸å¿ƒå¼€å‘è€…ï¼‰

> "The control loop is the heart of Kubernetes. It's what makes Kubernetes declarative and self-healing."

**åœ¨æ¶æ„è®¾è®¡ä¸­çš„åº”ç”¨**ï¼š

- **æ§åˆ¶å¾ªç¯æ ¸å¿ƒ**ï¼šæ§åˆ¶å¾ªç¯æ˜¯ Kubernetes æ¶æ„çš„æ ¸å¿ƒ
- **è‡ªæ„ˆèƒ½åŠ›**ï¼šæ§åˆ¶å¾ªç¯å®ç°è‡ªæ„ˆèƒ½åŠ›
- **æœŸæœ›çŠ¶æ€**ï¼šæ§åˆ¶å¾ªç¯é©±åŠ¨æœŸæœ›çŠ¶æ€

##### 3. Darren Shepherdï¼ˆK3s åˆ›å§‹äººï¼‰

> "K3s is Kubernetes made simple. We want to make Kubernetes accessible to everyone, especially in resource-constrained environments."

**åœ¨æ¶æ„è®¾è®¡ä¸­çš„åº”ç”¨**ï¼š

- **ç®€åŒ–æ¶æ„**ï¼šK3s é€šè¿‡å•äºŒè¿›åˆ¶ç®€åŒ–æ¶æ„
- **èµ„æºä¼˜åŒ–**ï¼šK3s ä¼˜åŒ–èµ„æºå ç”¨
- **è¾¹ç¼˜æ”¯æŒ**ï¼šK3s æ”¯æŒè¾¹ç¼˜åœºæ™¯

#### è®¡ç®—ä¿¡æ¯è½¯ä»¶æ•™è‚²å®¶çš„è§‚ç‚¹

##### 1. Kelsey Hightowerï¼ˆKubernetes æ•™è‚²å®¶ï¼‰

> "Understanding Kubernetes is about understanding the control loop. Once you understand the control loop, everything else makes sense."

**æ•™è‚²ä»·å€¼**ï¼š

- **æ§åˆ¶å¾ªç¯**ï¼šç†è§£æ§åˆ¶å¾ªç¯æ˜¯ç†è§£ Kubernetes æ¶æ„çš„å…³é”®
- **æ ¸å¿ƒæ¦‚å¿µ**ï¼šæ§åˆ¶å¾ªç¯æ˜¯ Kubernetes çš„æ ¸å¿ƒæ¦‚å¿µ
- **å­¦ä¹ è·¯å¾„**ï¼šä»æ§åˆ¶å¾ªç¯å¼€å§‹å­¦ä¹  Kubernetes

##### 2. Liz Riceï¼ˆå®¹å™¨å®‰å…¨æ•™è‚²å®¶ï¼‰

> "Container security is about understanding the isolation boundaries. Each technology provides different levels of isolation."

**æ•™è‚²ä»·å€¼**ï¼š

- **éš”ç¦»è¾¹ç•Œ**ï¼šç†è§£éš”ç¦»è¾¹ç•Œæ˜¯ç†è§£å®¹å™¨æ¶æ„çš„å…³é”®
- **å±‚æ¬¡ç†è§£**ï¼šä¸åŒæ¶æ„æä¾›ä¸åŒå±‚æ¬¡çš„éš”ç¦»
- **æ¶æ„ç†è§£**ï¼šé€šè¿‡éš”ç¦»è¾¹ç•Œç†è§£æ¶æ„è®¾è®¡

#### è®¡ç®—ä¿¡æ¯è½¯ä»¶è®¤çŸ¥å­¦å®¶çš„è§‚ç‚¹

##### 1. David Marrï¼ˆè®¡ç®—è®¤çŸ¥ç§‘å­¦å®¶ï¼‰

> "Understanding complex systems requires understanding them at multiple levels: computation, algorithm, and implementation."

**è®¤çŸ¥ä»·å€¼**ï¼š

- **å¤šå±‚æ¬¡ç†è§£**ï¼šç†è§£å¤æ‚æ¶æ„éœ€è¦åœ¨å¤šä¸ªå±‚æ¬¡ä¸Šç†è§£
- **æ¶æ„å±‚æ¬¡**ï¼šæ¶æ„å±‚æ˜¯ç†è§£æŠ€æœ¯æ ˆçš„é‡è¦å±‚æ¬¡
- **ç³»ç»Ÿç†è§£**ï¼šé€šè¿‡æ¶æ„å±‚ç†è§£æŠ€æœ¯æ ˆçš„ç³»ç»Ÿæ€§

##### 2. Douglas Hofstadterï¼ˆè®¤çŸ¥ç§‘å­¦å®¶ï¼‰

> "Analogy is the core of cognition. Understanding new concepts through analogy helps us build mental models."

**è®¤çŸ¥ä»·å€¼**ï¼š

- **ç±»æ¯”æ ¸å¿ƒ**ï¼šç±»æ¯”æ˜¯è®¤çŸ¥çš„æ ¸å¿ƒ
- **æ¶æ„ç†è§£**ï¼šé€šè¿‡ç±»æ¯”ç†è§£æ¶æ„æ¦‚å¿µ
- **æ¨¡å‹æ„å»º**ï¼šé€šè¿‡ç±»æ¯”æ„å»ºæ¶æ„çš„å¿ƒç†æ¨¡å‹

### 16.7 è®¤çŸ¥å­¦ä¹ è·¯å¾„çŸ©é˜µ

| å­¦ä¹ é˜¶æ®µ | æ ¸å¿ƒæ¶æ„ | å½¢è±¡åŒ–ç†è§£ | æŠ€æœ¯ç†è§£ | å®è·µåº”ç”¨ | è®¤çŸ¥ç›®æ ‡ |
|---------|---------|-----------|---------|---------|---------|
| **å…¥é—¨** | Dockeræ¶æ„ | å·¥å‚ç”Ÿäº§çº¿ç±»æ¯” | åˆ†å±‚æ¶æ„ | å•æœºéƒ¨ç½² | å»ºç«‹åŸºç¡€ |
| **è¿›é˜¶** | Kubernetesæ¶æ„ | æ™ºèƒ½åŸå¸‚ç±»æ¯” | ä¸­å¿ƒåŒ–æ¶æ„ | é›†ç¾¤ç®¡ç† | ç†è§£æ¶æ„ |
| **é«˜çº§** | K3sæ¶æ„ | ä¾¿æºå·¥å…·ç®±ç±»æ¯” | å•äºŒè¿›åˆ¶æ¶æ„ | è¾¹ç¼˜éƒ¨ç½² | æŒæ¡æ¶æ„ |

### 16.8 ä¸“å®¶æ¨èé˜…è¯»è·¯å¾„

**è®¡ç®—ä¿¡æ¯è½¯ä»¶ç§‘å­¦å®¶æ¨èè·¯å¾„**ï¼š

1. **æ¶æ„æ¼”è¿›**ï¼šä» Docker åˆ° Kubernetes åˆ° K3s çš„æ¶æ„æ¼”è¿›
2. **å¯¹è±¡æ¨¡å‹**ï¼šç†è§£ Kubernetes å¯¹è±¡æ¨¡å‹çš„è®¾è®¡
3. **æ§åˆ¶å¾ªç¯**ï¼šç†è§£æ§åˆ¶å¾ªç¯çš„å®ç°æœºåˆ¶
4. **æ¶æ„å†³ç­–**ï¼šç†è§£æ¶æ„å†³ç­–çš„ä¾æ®å’Œæ€è·¯

**è®¡ç®—ä¿¡æ¯è½¯ä»¶æ•™è‚²å®¶æ¨èè·¯å¾„**ï¼š

1. **å½¢è±¡åŒ–ç†è§£**ï¼šé€šè¿‡å·¥å‚ç”Ÿäº§çº¿ã€æ™ºèƒ½åŸå¸‚ã€ä¾¿æºå·¥å…·ç®±ç­‰ç±»æ¯”ï¼Œå»ºç«‹ç›´è§‚ç†è§£
2. **æ¸è¿›å­¦ä¹ **ï¼šä»ç®€å•æ¶æ„å¼€å§‹ï¼Œé€æ­¥å­¦ä¹ å¤æ‚æ¶æ„
3. **å®è·µç»“åˆ**ï¼šç»“åˆå®é™…æ¡ˆä¾‹ï¼Œç†è§£æ¶æ„åº”ç”¨
4. **æ€ç»´è®­ç»ƒ**ï¼šé€šè¿‡æ¶æ„å­¦ä¹ ï¼Œè®­ç»ƒç³»ç»Ÿæ€§æ€ç»´èƒ½åŠ›

**è®¡ç®—ä¿¡æ¯è½¯ä»¶è®¤çŸ¥å­¦å®¶æ¨èè·¯å¾„**ï¼š

1. **è®¤çŸ¥æ¨¡å¼**ï¼šè¯†åˆ«æ¶æ„è®¾è®¡ä¸­çš„è®¤çŸ¥æ¨¡å¼
2. **ç±»æ¯”ç†è§£**ï¼šé€šè¿‡ç±»æ¯”ç†è§£æ¶æ„æ¦‚å¿µ
3. **æ¨¡å‹æ„å»º**ï¼šæ„å»ºæ¶æ„çš„å¿ƒç†æ¨¡å‹
4. **è®¤çŸ¥æå‡**ï¼šé€šè¿‡æ¶æ„å­¦ä¹ ï¼Œæå‡è®¤çŸ¥èƒ½åŠ›

> å®Œæ•´å‚è€ƒåˆ—è¡¨è§ [REFERENCES.md](../REFERENCES.md)
>
> ---
>
> ## 2025 å¹´æœ€æ–°å®è·µ
>
> ### æ¶æ„ä¸å¯¹è±¡æ¨¡å‹åº”ç”¨æœ€ä½³å®è·µï¼ˆ2025ï¼‰
>
> **2025 å¹´è¶‹åŠ¿**ï¼šKubernetes å¯¹è±¡æ¨¡å‹ã€æ§åˆ¶é—­ç¯æœºåˆ¶åœ¨äº‘åŸç”Ÿæ¶æ„è®¾è®¡ä¸­çš„æ·±åº¦åº”ç”¨
>
> **å®è·µè¦ç‚¹**ï¼š
>
> - **å¯¹è±¡æ¨¡å‹è®¾è®¡**ï¼šä½¿ç”¨ GVR æ¨¡å‹è¿›è¡Œå¯¹è±¡æ¨¡å‹è®¾è®¡
> - **æ§åˆ¶é—­ç¯**ï¼šä½¿ç”¨ Informer å’Œ Controller æ¨¡å¼å®ç°æ§åˆ¶é—­ç¯
> - **æ¶æ„è®¾è®¡**ï¼šä½¿ç”¨æ§åˆ¶é—­ç¯æœºåˆ¶è¿›è¡Œæ¶æ„è®¾è®¡
>
> **ä»£ç ç¤ºä¾‹**ï¼š
>
> ```go
> // 2025 å¹´ Kubernetes æ§åˆ¶é—­ç¯å·¥å…·
> type ControllerTool struct {
>     informer cache.SharedInformer
>     controller cache.Controller
>     handler ResourceHandler
> }
>
> func (c *ControllerTool) Start(ctx context.Context) error {
>     // å¯åŠ¨ Informer
>     go c.informer.Run(ctx.Done())
>     // ç­‰å¾…ç¼“å­˜åŒæ­¥
>     if !cache.WaitForCacheSync(ctx.Done(), c.informer.HasSynced) {
>         return fmt.Errorf("failed to sync cache")
>     }
>     // å¯åŠ¨ Controller
>     return c.controller.Run(ctx.Done())
> }
> ```
>
> ## å®é™…åº”ç”¨æ¡ˆä¾‹
>
> ### æ¡ˆä¾‹ 1ï¼šKubernetes æ§åˆ¶é—­ç¯æ¶æ„è®¾è®¡ï¼ˆ2025ï¼‰
>
> **åœºæ™¯**ï¼šä½¿ç”¨ Kubernetes æ§åˆ¶é—­ç¯æœºåˆ¶è¿›è¡Œæ¶æ„è®¾è®¡
>
> **å®ç°æ–¹æ¡ˆ**ï¼š
>
> ```go
> // Kubernetes æ§åˆ¶é—­ç¯æ¶æ„è®¾è®¡
> tool := &ControllerTool{
>     informer: informerFactory.Core().V1().Pods().Informer(),
>     controller: controller.NewController(informer, handler),
> }
>
> // å¯åŠ¨æ§åˆ¶é—­ç¯
> ctx := context.Background()
> if err := tool.Start(ctx); err != nil {
>     log.Fatal(err)
> }
> ```
>
> **æ•ˆæœ**ï¼š
>
> - æ§åˆ¶é—­ç¯ï¼šåŸºäº Informer å’Œ Controller çš„æ§åˆ¶é—­ç¯ï¼Œä¿è¯ç³»ç»Ÿä¸€è‡´æ€§
> - å¯¹è±¡æ¨¡å‹ï¼šä½¿ç”¨ GVR æ¨¡å‹è¿›è¡Œå¯¹è±¡æ¨¡å‹è®¾è®¡ï¼Œæé«˜è®¾è®¡è§„èŒƒæ€§
> - æ¶æ„è®¾è®¡ï¼šä½¿ç”¨æ§åˆ¶é—­ç¯æœºåˆ¶è¿›è¡Œæ¶æ„è®¾è®¡ï¼Œæé«˜æ¶æ„å¯é æ€§
>
> ---
>
> **æœ€åæ›´æ–°**ï¼š2025-11-15
> **æ–‡æ¡£çŠ¶æ€**ï¼šâœ… å®Œæ•´ | ğŸ“Š åŒ…å«æ€ç»´å¯¼å›¾ã€å»ºæ¨¡è§†å›¾ã€å¤šç»´çŸ©é˜µã€å›¾è¡¨è¾¾è½¬æ¢ã€å½¢è±¡åŒ–è§£é‡Šè®ºè¯ã€ä¸“å®¶è§‚ç‚¹
> **ç»´æŠ¤è€…**ï¼šé¡¹ç›®å›¢é˜Ÿ
>
> **ğŸ“Š 2025 å¹´æŠ€æœ¯è¶‹åŠ¿å‚è€ƒ**ï¼šè¯¦ç»†æŠ€æœ¯çŠ¶æ€å’Œç‰ˆæœ¬ä¿¡æ¯è¯·æŸ¥çœ‹
> [27. 2025 å¹´æŠ€æœ¯è¶‹åŠ¿æ±‡æ€»](../../TECHNICAL/10-reference-trends/2025-trends/2025-trends.md)

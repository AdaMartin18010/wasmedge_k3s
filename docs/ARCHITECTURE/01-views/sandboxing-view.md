# æ²™ç›’åŒ–è§†è§’

## ğŸ“‘ ç›®å½•

- [ğŸ“‘ ç›®å½•](#-ç›®å½•)
- [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [1.1 æ ¸å¿ƒæ€æƒ³](#11-æ ¸å¿ƒæ€æƒ³)
- [2. æ²™ç›’åŒ–çš„"å‰ªè£"ä½œç”¨](#2-æ²™ç›’åŒ–çš„å‰ªè£ä½œç”¨)
  - [æ ¸å¿ƒä½œç”¨](#æ ¸å¿ƒä½œç”¨)
- [2. å±‚çº§æ¨¡å‹ä¸­çš„ä½ç½®](#2-å±‚çº§æ¨¡å‹ä¸­çš„ä½ç½®)
- [3. æ²™ç›’åŒ–çš„å½¢å¼åŒ–æè¿°](#3-æ²™ç›’åŒ–çš„å½¢å¼åŒ–æè¿°)
  - [3.1 æ²™ç›’å®šä¹‰](#31-æ²™ç›’å®šä¹‰)
  - [3.2 èƒ½åŠ›é—­åŒ…](#32-èƒ½åŠ›é—­åŒ…)
- [4. æ²™ç›’æŠ€æœ¯åˆ†ç±»](#4-æ²™ç›’æŠ€æœ¯åˆ†ç±»)
  - [4.1 ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤](#41-ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤)
    - [Seccomp (Secure Computing)](#seccomp-secure-computing)
    - [Seccomp-BPF](#seccomp-bpf)
  - [4.2 ç”¨æˆ·æ€å†…æ ¸](#42-ç”¨æˆ·æ€å†…æ ¸)
    - [gVisor](#gvisor)
    - [Firecracker](#firecracker)
  - [4.3 WebAssembly (WASI)](#43-webassembly-wasi)
    - [WASM + WASI](#wasm--wasi)
  - [4.4 æ–‡ä»¶ç³»ç»Ÿéš”ç¦»](#44-æ–‡ä»¶ç³»ç»Ÿéš”ç¦»)
    - [Landlock](#landlock)
    - [AppArmor / SELinux](#apparmor--selinux)
- [5. æ²™ç›’åŒ– vs å®¹å™¨åŒ–](#5-æ²™ç›’åŒ–-vs-å®¹å™¨åŒ–)
- [6. æ²™ç›’ä¸ OPA çš„ç»„åˆ](#6-æ²™ç›’ä¸-opa-çš„ç»„åˆ)
  - [6.1 åŒå±‚é—¸é—¨](#61-åŒå±‚é—¸é—¨)
  - [6.2 å½¢å¼åŒ–æè¿°](#62-å½¢å¼åŒ–æè¿°)
  - [6.3 å®è¯](#63-å®è¯)
- [7. æ²™ç›’ä¸ Service Mesh çš„ç»„åˆ](#7-æ²™ç›’ä¸-service-mesh-çš„ç»„åˆ)
  - [7.1 ç»Ÿä¸€å®‰å…¨æ¨¡å‹](#71-ç»Ÿä¸€å®‰å…¨æ¨¡å‹)
  - [7.2 ç»„åˆæ–¹å¼](#72-ç»„åˆæ–¹å¼)
- [8. å…¸å‹æ¡ˆä¾‹](#8-å…¸å‹æ¡ˆä¾‹)
  - [8.1 ä»£ç æ‰§è¡Œæ²™ç›’](#81-ä»£ç æ‰§è¡Œæ²™ç›’)
  - [8.2 CI/CD æ²™ç›’](#82-cicd-æ²™ç›’)
  - [8.3 å¤šç§Ÿæˆ· SaaS](#83-å¤šç§Ÿæˆ·-saas)
- [9. 2025 å¹´æ²™ç›’åŒ–è¶‹åŠ¿](#9-2025-å¹´æ²™ç›’åŒ–è¶‹åŠ¿)
  - [9.1 æœºå¯†å®¹å™¨](#91-æœºå¯†å®¹å™¨)
  - [9.2 eBPF å¢å¼º](#92-ebpf-å¢å¼º)
  - [9.3 WebAssembly è¿è¡Œæ—¶](#93-webassembly-è¿è¡Œæ—¶)
- [10. å®‰å…¨åŸºå‡†](#10-å®‰å…¨åŸºå‡†)
  - [10.1 CIS Docker Benchmark](#101-cis-docker-benchmark)
  - [10.2 Kubernetes Pod Security Standards](#102-kubernetes-pod-security-standards)
- [12. æœ€ä½³å®è·µ](#12-æœ€ä½³å®è·µ)
  - [12.1 æ²™ç›’è®¾è®¡åŸåˆ™](#121-æ²™ç›’è®¾è®¡åŸåˆ™)
  - [12.2 å®‰å…¨ç­–ç•¥](#122-å®‰å…¨ç­–ç•¥)
  - [12.3 å®æ–½æ­¥éª¤](#123-å®æ–½æ­¥éª¤)
- [13. å‚è€ƒèµ„æº](#13-å‚è€ƒèµ„æº)

---

## 1. æ¦‚è¿°

æœ¬æ–‡æ¡£ä»**æ²™ç›’åŒ–**è§†è§’é˜è¿°æ¶æ„è®¾è®¡ï¼Œè¯´æ˜æ²™ç›’åŒ–å¦‚ä½•é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤å’Œæœ€å°æƒé™åŸåˆ™
ï¼Œå°†å®¹å™¨å†…è¿›ç¨‹æŠ½è±¡ä¸ºå®‰å…¨è¿›ç¨‹ï¼Œè®©æ¶æ„å¸ˆèšç„¦å®‰å…¨ç­–ç•¥ã€‚

### 1.1 æ ¸å¿ƒæ€æƒ³

> **æ²™ç›’åŒ–é€šè¿‡ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤å’Œæœ€å°æƒé™åŸåˆ™ï¼Œå°†å®¹å™¨å†…è¿›ç¨‹æŠ½è±¡ä¸ºå®‰å…¨è¿›ç¨‹ï¼Œå®ç°èƒ½åŠ›é—­
> åŒ…å’Œå¯è¯æ˜å®‰å…¨æ€§ï¼Œè®©æ¶æ„å¸ˆèšç„¦å®‰å…¨ç­–ç•¥è€Œéç³»ç»Ÿè°ƒç”¨ç»†èŠ‚**

---

## 2. æ²™ç›’åŒ–çš„"å‰ªè£"ä½œç”¨

**æ²™ç›’åŒ–**å¯¹å®¹å™¨å†…éƒ¨è¿›ç¨‹è¿›è¡Œè¿›ä¸€æ­¥éš”ç¦»ï¼ŒæŠŠ**å®¹å™¨å†…è¿›ç¨‹**æŠ½è±¡æˆ**å®‰å…¨è¿›ç¨‹**ï¼Œè®©æ¶
æ„å¸ˆèšç„¦**å®‰å…¨ç­–ç•¥**è€Œéç³»ç»Ÿè°ƒç”¨ç»†èŠ‚ã€‚

### æ ¸å¿ƒä½œç”¨

1. **ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤**ï¼šåªå…è®¸å¿…è¦çš„ç³»ç»Ÿè°ƒç”¨
2. **æ–‡ä»¶ç³»ç»Ÿéš”ç¦»**ï¼šé™åˆ¶æ–‡ä»¶è®¿é—®èŒƒå›´
3. **ç½‘ç»œè®¿é—®æ§åˆ¶**ï¼šç»†ç²’åº¦ç½‘ç»œç­–ç•¥
4. **æœ€å°æƒé™åŸåˆ™**ï¼šåªæˆäºˆæœ€å°å¿…è¦æƒé™

## 2. å±‚çº§æ¨¡å‹ä¸­çš„ä½ç½®

| å±‚çº§        | ä¸»è¦èŒè´£                   | å…¸å‹æŠ€æœ¯                    | å…³æ³¨ç‚¹ï¼ˆè¢«è£å‰ªï¼‰  | è®©æ¶æ„å¸ˆèšç„¦   |
| ----------- | -------------------------- | --------------------------- | ----------------- | -------------- |
| **Sandbox** | ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤ã€æ–‡ä»¶ç³»ç»Ÿéš”ç¦» | seccompâ€‘bpf, Landlock, eBPF | è¿›ç¨‹æƒé™ã€IO è®¿é—® | å®‰å…¨æ¨¡å‹ã€åˆè§„ |

## 3. æ²™ç›’åŒ–çš„å½¢å¼åŒ–æè¿°

### 3.1 æ²™ç›’å®šä¹‰

| ç»“æ„     | å®šä¹‰             | å½¢å¼åŒ–                           | å…³é”®å±æ€§             |
| -------- | ---------------- | -------------------------------- | -------------------- |
| **æ²™ç›’** | å¯¹è¿›ç¨‹çš„å®‰å…¨çº¦æŸ | **S = âŸ¨filters, eBPF programsâŸ©** | **æœ€å°æƒé™ã€å¯ç¼–ç¨‹** |

å…¶ä¸­ï¼š

- filtersï¼šç³»ç»Ÿè°ƒç”¨è¿‡æ»¤å™¨ï¼ˆseccompï¼‰
- eBPF programsï¼šåŠ¨æ€å®‰å…¨ç­–ç•¥

### 3.2 èƒ½åŠ›é—­åŒ…

**å…³é”®å¼•ç† L2**ï¼š

> æ²™ç›’å®‰å…¨è¾¹ç•Œ = æœ€å°èƒ½åŠ›é—­åŒ…å³
>
> ```text
> Capability(Î£â‚ƒ) = âˆ©{Syscalláµ¢ | uáµ¢ éœ€è¦}
> ```
>
> ä¸” |Capability| â‰¤ 35 æ¡ç³»ç»Ÿè°ƒç”¨ï¼ˆGoogle ç”Ÿäº§æ•°æ®ï¼‰

## 4. æ²™ç›’æŠ€æœ¯åˆ†ç±»

### 4.1 ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤

#### Seccomp (Secure Computing)

```json
{
  "defaultAction": "SCMP_ACT_ERRNO",
  "syscalls": [
    {
      "names": ["read", "write", "open"],
      "action": "SCMP_ACT_ALLOW"
    }
  ]
}
```

#### Seccomp-BPF

- **åŠ¨æ€è¿‡æ»¤**ï¼šåŸºäº eBPF ç¨‹åº
- **æ¡ä»¶æ‰§è¡Œ**ï¼šæ ¹æ®å‚æ•°åŠ¨æ€å†³ç­–
- **æ€§èƒ½ä¼˜åŒ–**ï¼šJIT ç¼–è¯‘

### 4.2 ç”¨æˆ·æ€å†…æ ¸

#### gVisor

- **Go ç”¨æˆ·æ€å†…æ ¸**ï¼šæŠŠ Linux ABI é‡ç¼–è¯‘åˆ° Goï¼ˆsentryï¼‰
- **æœ€å°æ”»å‡»é¢**ï¼šåªæš´éœ² 137 ä¸ªç³»ç»Ÿè°ƒç”¨
- **æ€§èƒ½å¼€é”€**ï¼š~10-20% é¢å¤–å»¶è¿Ÿ

#### Firecracker

- **è½»é‡ VMM**ï¼š< 100 kLoCï¼Œå†…å­˜ < 5 MBï¼Œå¯åŠ¨ < 125 ms
- **å¾® VM**ï¼šæ¯ä¸ª VM åªè¿è¡Œä¸€ä¸ªè¿›ç¨‹
- **AWS Lambda**ï¼šåº•å±‚ä½¿ç”¨ Firecracker

### 4.3 WebAssembly (WASI)

#### WASM + WASI

- **æŒ‡ä»¤çº§å¯ç§»æ¤**ï¼šè·¨å¹³å°è¿è¡Œ
- **èƒ½åŠ›ä»¤ç‰Œæ¨¡å‹**ï¼šæœ€å°æƒé™
- **WasmEdge**ï¼šäº‘åŸç”Ÿ WebAssembly è¿è¡Œæ—¶

### 4.4 æ–‡ä»¶ç³»ç»Ÿéš”ç¦»

#### Landlock

- **æ–‡ä»¶ç³»ç»Ÿè®¿é—®æ§åˆ¶**ï¼šåŸºäºè·¯å¾„çš„æƒé™
- **å†…æ ¸çº§éš”ç¦»**ï¼šLinux 5.13+
- **ç»†ç²’åº¦æ§åˆ¶**ï¼šè¯»ã€å†™ã€æ‰§è¡Œæƒé™

#### AppArmor / SELinux

- **å¼ºåˆ¶è®¿é—®æ§åˆ¶ï¼ˆMACï¼‰**ï¼šåŸºäºç­–ç•¥çš„è®¿é—®æ§åˆ¶
- **é…ç½®æ–‡ä»¶**ï¼šå®šä¹‰å…è®¸çš„æ“ä½œ
- **å®¡è®¡**ï¼šè®°å½•æ‰€æœ‰è®¿é—®å°è¯•

## 5. æ²™ç›’åŒ– vs å®¹å™¨åŒ–

| ç»´åº¦            | å®¹å™¨åŒ–               | æ²™ç›’åŒ–                 |
| --------------- | -------------------- | ---------------------- |
| **éš”ç¦»çº§åˆ«**    | OS è¿›ç¨‹çº§            | è¿›ç¨‹ + syscall å±‚      |
| **èµ„æºå¼€é”€**    | ä½ï¼ˆå…±äº«å†…æ ¸ï¼‰       | ä½ï¼ˆä¸å®¹å™¨åŒçº§ï¼‰       |
| **å¯åŠ¨æ—¶é—´**    | < 1 s                | < 1 s                  |
| **å®‰å…¨æ¨¡å‹**    | éš”ç¦»ã€æ–‡ä»¶ç³»ç»Ÿ       | æœ€å°æƒé™ã€åŠ¨æ€è¿‡æ»¤     |
| **ç½‘ç»œæ¨¡å‹**    | CNI, OverlayFS       | ä¸å®¹å™¨å…±äº«ï¼Œç»†ç²’åº¦è¿‡æ»¤ |
| **ç›‘æ§/å¯è§‚æµ‹** | cAdvisor, Prometheus | eBPF metrics, BPFtrace |
| **é€‚ç”¨åœºæ™¯**    | å¾®æœåŠ¡ã€CI/CD        | ä»£ç æ²™ç›’ã€æ¶æ„éš”ç¦»     |

## 6. æ²™ç›’ä¸ OPA çš„ç»„åˆ

### 6.1 åŒå±‚é—¸é—¨

```text
ç¼–è¯‘æœŸï¼ˆOPAï¼‰ â†’ è¿è¡ŒæœŸï¼ˆSeccomp-BPFï¼‰
     â†“              â†“
é™æ€ç­–ç•¥æ£€æŸ¥    åŠ¨æ€ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤
```

### 6.2 å½¢å¼åŒ–æè¿°

```text
Capability(u) = { c | c âˆˆ seccomp-white-list }
                 âˆ© { c | OPA(admission, image-labels) âŠ¢ allow(c) }
```

### 6.3 å®è¯

- **Google Cloud Run 2024 Q1**ï¼šé›¶ syscall-escapeï¼ˆæ€»é‡ 3.7Ã—10Â¹â° å®¹å™¨ï¼‰
- **è¿è§„é•œåƒåœ¨ CI é˜¶æ®µå³è¢«æ‹’ç»**ï¼Œæ— éœ€è¿è¡Œæ—¶æ‹¦æˆª

## 7. æ²™ç›’ä¸ Service Mesh çš„ç»„åˆ

### 7.1 ç»Ÿä¸€å®‰å…¨æ¨¡å‹

```text
Sandbox (æœ€å°æƒé™) + Service Mesh (mTLS)
         â†“
   ç»Ÿä¸€å®‰å…¨è¾¹ç•Œ
```

### 7.2 ç»„åˆæ–¹å¼

- **æ²™ç›’å±‚**ï¼šæ§åˆ¶è¿›ç¨‹ç³»ç»Ÿè°ƒç”¨
- **Service Mesh å±‚**ï¼šæ§åˆ¶ç½‘ç»œæµé‡åŠ å¯†
- **OPA å±‚**ï¼šç»Ÿä¸€ç­–ç•¥å†³ç­–

## 8. å…¸å‹æ¡ˆä¾‹

### 8.1 ä»£ç æ‰§è¡Œæ²™ç›’

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: sandbox
spec:
  securityContext:
    seccompProfile:
      type: RuntimeDefault
  containers:
    - name: app
      securityContext:
        allowPrivilegeEscalation: false
        capabilities:
          drop:
            - ALL
```

### 8.2 CI/CD æ²™ç›’

- **GitHub Actions**ï¼šä½¿ç”¨ Firecracker éš”ç¦»
- **GitLab Runner**ï¼šä½¿ç”¨ Docker + seccomp
- **Jenkins**ï¼šä½¿ç”¨ Kubernetes Pod æ¨¡æ¿

### 8.3 å¤šç§Ÿæˆ· SaaS

- **æ¯ä¸ªç§Ÿæˆ·ç‹¬ç«‹æ²™ç›’**ï¼šgVisor éš”ç¦»
- **ç»Ÿä¸€ç­–ç•¥**ï¼šOPA ç®¡ç†
- **å®¡è®¡**ï¼šè®°å½•æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨

## 9. 2025 å¹´æ²™ç›’åŒ–è¶‹åŠ¿

### 9.1 æœºå¯†å®¹å™¨

- **Intel SGX**ï¼šå¯ä¿¡æ‰§è¡Œç¯å¢ƒ
- **AMD SEV**ï¼šå†…å­˜åŠ å¯†
- **æœºå¯†è®¡ç®—**ï¼šæ•°æ®åœ¨è¿è¡Œæ—¶åŠ å¯†

### 9.2 eBPF å¢å¼º

- **Cilium**ï¼šeBPF é©±åŠ¨çš„ç½‘ç»œå’Œå®‰å…¨
- **Falco**ï¼šeBPF é©±åŠ¨çš„è¿è¡Œæ—¶å®‰å…¨
- **Bpftrace**ï¼šåŠ¨æ€è¿½è¸ª

### 9.3 WebAssembly è¿è¡Œæ—¶

- **WasmEdge**ï¼šäº‘åŸç”Ÿ WebAssembly
- **WASI**ï¼šç³»ç»Ÿæ¥å£æ ‡å‡†åŒ–
- **è¾¹ç¼˜è®¡ç®—**ï¼šè½»é‡çº§æ²™ç›’

## 10. å®‰å…¨åŸºå‡†

### 10.1 CIS Docker Benchmark

- **é•œåƒå®‰å…¨**ï¼šæœ€å°åŒ–é•œåƒã€æ—  root ç”¨æˆ·
- **è¿è¡Œæ—¶å®‰å…¨**ï¼šseccompã€AppArmor
- **ç½‘ç»œå®‰å…¨**ï¼šé˜²ç«å¢™è§„åˆ™

### 10.2 Kubernetes Pod Security Standards

- **Restricted**ï¼šæœ€ä¸¥æ ¼ç­–ç•¥
- **Baseline**ï¼šæœ€å°å®‰å…¨ç­–ç•¥
- **Privileged**ï¼šæ— é™åˆ¶ï¼ˆä¸æ¨èï¼‰

## 12. æœ€ä½³å®è·µ

### 12.1 æ²™ç›’è®¾è®¡åŸåˆ™

1. **æœ€å°æƒé™**ï¼šåªæˆäºˆæœ€å°å¿…è¦æƒé™
2. **èƒ½åŠ›é—­åŒ…**ï¼šåªå…è®¸å¿…è¦çš„ç³»ç»Ÿè°ƒç”¨ï¼ˆâ‰¤35 æ¡ï¼‰
3. **åŠ¨æ€ç­–ç•¥**ï¼šä½¿ç”¨ eBPF å®ç°åŠ¨æ€å®‰å…¨ç­–ç•¥
4. **å¯è§‚æµ‹æ€§**ï¼šè®°å½•æ‰€æœ‰ç³»ç»Ÿè°ƒç”¨ï¼Œæ”¯æŒå®¡è®¡

### 12.2 å®‰å…¨ç­–ç•¥

1. **åˆ†å±‚ç­–ç•¥**ï¼šç¼–è¯‘æœŸï¼ˆOPAï¼‰+ è¿è¡ŒæœŸï¼ˆSeccomp-BPFï¼‰
2. **ç­–ç•¥æµ‹è¯•**ï¼šCI/CD ä¸­è‡ªåŠ¨æµ‹è¯•å®‰å…¨ç­–ç•¥
3. **ç­–ç•¥ç‰ˆæœ¬åŒ–**ï¼šä½¿ç”¨ Git ç®¡ç†å®‰å…¨ç­–ç•¥ç‰ˆæœ¬
4. **ç­–ç•¥å®¡è®¡**ï¼šå®šæœŸå®¡è®¡å®‰å…¨ç­–ç•¥ï¼Œç¡®ä¿åˆè§„

### 12.3 å®æ–½æ­¥éª¤

1. **è¯„ä¼°é˜¶æ®µ**ï¼šåˆ†æåº”ç”¨éœ€è¦çš„ç³»ç»Ÿè°ƒç”¨
2. **è®¾è®¡é˜¶æ®µ**ï¼šè®¾è®¡æœ€å°èƒ½åŠ›é—­åŒ…
3. **å®æ–½é˜¶æ®µ**ï¼šé…ç½® Seccomp å’Œ eBPF ç­–ç•¥
4. **éªŒè¯é˜¶æ®µ**ï¼šæµ‹è¯•å’ŒéªŒè¯å®‰å…¨ç­–ç•¥

---

## 13. å‚è€ƒèµ„æº

- **seccomp**ï¼š<https://www.kernel.org/doc/Documentation/prctl/seccomp_filter.txt>
- **AppArmor**ï¼š<https://apparmor.net/>
- **SELinux**ï¼š<https://selinuxproject.org/>
- **seccomp-bpf**ï¼š<https://www.kernel.org/doc/Documentation/prctl/seccomp_filter.txt>
- **eBPF**ï¼š<https://ebpf.io/>
- **Firecracker**ï¼š<https://firecracker-microvm.github.io/>
- **gVisor æ–‡æ¡£**ï¼š<https://gvisor.dev/docs/>
- **WasmEdge æ–‡æ¡£**ï¼š<https://wasmedge.org/docs/>
- **ç›¸å…³æ–‡æ¡£**ï¼š
  - `02-virtualization-containerization-sandboxing/03-sandboxing-abstraction.md` -
    æ²™ç›’åŒ–æŠ½è±¡è¯¦ç»†è¯´æ˜
  - `02-layers/sandbox-layer.md` - æ²™ç›’å±‚è¯¦ç»†è¯´æ˜
  - `04-opa-policy-governance/03-capability-closure.md` - èƒ½åŠ›é—­åŒ…è¯¦ç»†è¯´æ˜

---

**æ›´æ–°æ—¶é—´**ï¼š2025-11-04 **ç‰ˆæœ¬**ï¼šv1.0 **å‚è€ƒ**ï¼š`architecture_view.md` ç¬¬
2.1-2.8 èŠ‚ï¼Œæ²™ç›’åŒ–è§†è§’éƒ¨åˆ†

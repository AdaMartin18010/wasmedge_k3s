# å¯¹"æ¶æ„å…³æ³¨é¢†åŸŸ"çš„è¿›ä¸€æ­¥èšç„¦

## ğŸ“‘ ç›®å½•

- [ğŸ“‘ ç›®å½•](#-ç›®å½•)
- [1. æ¦‚è¿°](#1-æ¦‚è¿°)
  - [1.1 æ ¸å¿ƒæ€æƒ³](#11-æ ¸å¿ƒæ€æƒ³)
  - [1.2 å‰ªè£æ•ˆæœ](#12-å‰ªè£æ•ˆæœ)
- [2. ä¸šåŠ¡å»ºæ¨¡èšç„¦](#2-ä¸šåŠ¡å»ºæ¨¡èšç„¦)
- [3. å®‰å…¨ç­–ç•¥èšç„¦](#3-å®‰å…¨ç­–ç•¥èšç„¦)
- [4. æ€§èƒ½ä¸å¼¹æ€§èšç„¦](#4-æ€§èƒ½ä¸å¼¹æ€§èšç„¦)
- [5. ç›‘æ§ä¸å‘Šè­¦èšç„¦](#5-ç›‘æ§ä¸å‘Šè­¦èšç„¦)
- [6. å¤šç§Ÿæˆ·ä¸åˆè§„èšç„¦](#6-å¤šç§Ÿæˆ·ä¸åˆè§„èšç„¦)
- [7. å¯æ‰©å±•æ€§èšç„¦](#7-å¯æ‰©å±•æ€§èšç„¦)
- [8. å‰ªè£æ•ˆæœæ€»ç»“](#8-å‰ªè£æ•ˆæœæ€»ç»“)
- [9. æŠ€æœ¯é€‰å‹å»ºè®®](#9-æŠ€æœ¯é€‰å‹å»ºè®®)
- [10. å®è·µæ¡ˆä¾‹](#10-å®è·µæ¡ˆä¾‹)
- [11. æ€»ç»“](#11-æ€»ç»“)

---

## 1. æ¦‚è¿°

æœ¬æ–‡æ¡£ç³»ç»Ÿé˜è¿°**é€šè¿‡è™šæ‹ŸåŒ–ã€å®¹å™¨åŒ–ã€æ²™ç›’åŒ–ã€Service Meshã€OPA ç­‰æŠ€æœ¯"å‰ªè£"é€šç”¨å…³æ³¨ç‚¹åï¼Œæ¶æ„å¸ˆéœ€è¦èšç„¦çš„æ ¸å¿ƒé¢†åŸŸ**ã€‚è¿™æ˜¯æ¶æ„è®¾è®¡ä»"æŠ€æœ¯ç»†èŠ‚"è½¬å‘"ä¸šåŠ¡ä»·å€¼"çš„å…³é”®è½¬å˜ã€‚

### 1.1 æ ¸å¿ƒæ€æƒ³

> **é€šè¿‡åˆ†å±‚æŠ½è±¡å’Œç»„åˆæ¨¡å¼ï¼ŒæŠŠ"é€šç”¨"ä¸"å¹³å°"å…³æ³¨ç‚¹ä»ä¸šåŠ¡å…³æ³¨ç‚¹ä¸­"åˆ‡"å‡ºå»ï¼Œè®©æ¶æ„å¸ˆåªéœ€èšç„¦é¢†åŸŸä¸šåŠ¡ã€‚æ‰€æœ‰éåŠŸèƒ½æ€§èƒ½åŠ›ï¼ˆå®‰å…¨ã€æ€§èƒ½ã€ç›‘æ§ã€åˆè§„ï¼‰ä»¥å¯ç»„åˆçš„åŸºç¡€è®¾æ–½è¯­ä¹‰è¢«æ— ç¼é›†æˆã€‚**

### 1.2 å‰ªè£æ•ˆæœ

| å…³æ³¨é¢†åŸŸ | åŸå…ˆçš„éš¾ç‚¹ | å‰ªè£åèšç„¦ | å…¸å‹æŠ€æœ¯ / æ¨¡å¼ |
|---------|-----------|-----------|----------------|
| **ä¸šåŠ¡å»ºæ¨¡** | ä¸šåŠ¡é€»è¾‘æ··æ‚äºé…ç½®ã€ç›‘æ§ã€ç½‘ç»œ | ä»…èšç„¦é¢†åŸŸæ¨¡å‹ã€ç”¨ä¾‹ | DDDã€CQRSã€Domain Events |
| **å®‰å…¨ç­–ç•¥** | åœ¨ä¸šåŠ¡å±‚å†™å®‰å…¨ä»£ç  | ç»Ÿä¸€åœ¨æ²™ç®±/ç½‘æ ¼å±‚ | OPA/Gatekeeperã€seccompã€Service-Mesh MTLS |
| **æ€§èƒ½ä¸å¼¹æ€§** | éœ€è¦æ‰‹åŠ¨è°ƒä¼˜ CPUã€å†…å­˜ | è‡ªåŠ¨è°ƒåº¦ã€å¼¹æ€§æ‰©å®¹ | K8s HPAã€Istio Circuit Breaker |
| **ç›‘æ§ä¸å‘Šè­¦** | è‡ªè¡Œå®ç°æ—¥å¿—/æŒ‡æ ‡é‡‡é›† | ç»Ÿä¸€ OpenTelemetry | OpenTelemetry Collector, Prometheus |
| **å¤šç§Ÿæˆ· & åˆè§„** | æ¯ä¸ªæœåŠ¡æ‰‹å·¥åˆ†é… tenant | åœ¨ Kubernetes namespace / Istio tenant policy | Kubernetes RBAC + Gatekeeper |
| **å¯æ‰©å±•æ€§** | å…³æ³¨ä»£ç æ°´å¹³æ‰©å±• | å…³æ³¨æ°´å¹³æ‰©å®¹ + ä¸šåŠ¡æ‹†åˆ† | å¾®æœåŠ¡æ‹†åˆ†ã€Pipelineã€Argo Rollouts |

> **åªå‰©ä¸‹ "ä¸šåŠ¡åŠŸèƒ½ã€ç”¨ä¾‹ã€ä¸šåŠ¡è§„åˆ™ã€æ¥å£å¥‘çº¦" éœ€è¦ç›´æ¥è®¾è®¡ã€‚å…¶ä»–å±‚çš„æŠ€æœ¯å†³ç­–ç”±å¹³å°å›¢é˜Ÿæˆ–å¹³å°æ²»ç†ç»Ÿä¸€åˆ¶å®šã€‚**

---

## 2. ä¸šåŠ¡å»ºæ¨¡èšç„¦

### 2.1 å‰ªè£å‰çš„é—®é¢˜

**ä¼ ç»Ÿæ¶æ„ä¸­**ï¼Œä¸šåŠ¡å»ºæ¨¡é¢ä¸´ä»¥ä¸‹æŒ‘æˆ˜ï¼š

1. **ä¸šåŠ¡é€»è¾‘æ··æ‚**ï¼šä¸šåŠ¡ä»£ç ä¸­æ··æ‚ç€ç½‘ç»œé…ç½®ã€ç›‘æ§åŸ‹ç‚¹ã€å®‰å…¨æ ¡éªŒ
2. **é¢†åŸŸæ¨¡å‹ä¸æ¸…æ™°**ï¼šé¢†åŸŸæ¨¡å‹è¢«åŸºç¡€è®¾æ–½ç»†èŠ‚æ±¡æŸ“
3. **æµ‹è¯•å›°éš¾**ï¼šéœ€è¦å¯åŠ¨å®Œæ•´æŠ€æœ¯æ ˆæ‰èƒ½æµ‹è¯•ä¸šåŠ¡é€»è¾‘

**ç¤ºä¾‹**ï¼ˆå‰ªè£å‰ï¼‰ï¼š

```java
// ä¸šåŠ¡é€»è¾‘ä¸­æ··æ‚ç€ç½‘ç»œã€ç›‘æ§ã€å®‰å…¨ä»£ç 
public class OrderService {
    public void createOrder(Order order) {
        // ä¸šåŠ¡é€»è¾‘
        order.setStatus("PENDING");

        // ç½‘ç»œé…ç½®ï¼ˆä¸åº”è¯¥åœ¨è¿™é‡Œï¼‰
        HttpClient client = new HttpClient();
        client.setTimeout(5000);

        // ç›‘æ§åŸ‹ç‚¹ï¼ˆä¸åº”è¯¥åœ¨è¿™é‡Œï¼‰
        Metrics.counter("order.created").increment();

        // å®‰å…¨æ ¡éªŒï¼ˆä¸åº”è¯¥åœ¨è¿™é‡Œï¼‰
        if (!SecurityContext.hasPermission("CREATE_ORDER")) {
            throw new SecurityException();
        }

        // ä¿å­˜è®¢å•
        orderRepository.save(order);
    }
}
```

### 2.2 å‰ªè£åçš„èšç„¦

**å‰ªè£å**ï¼Œæ¶æ„å¸ˆåªéœ€èšç„¦ï¼š

1. **é¢†åŸŸæ¨¡å‹**ï¼šå®ä½“ã€å€¼å¯¹è±¡ã€èšåˆæ ¹
2. **ç”¨ä¾‹**ï¼šä¸šåŠ¡ç”¨ä¾‹çš„è¾“å…¥è¾“å‡º
3. **ä¸šåŠ¡è§„åˆ™**ï¼šé¢†åŸŸè§„åˆ™å’Œçº¦æŸ
4. **æ¥å£å¥‘çº¦**ï¼šæœåŠ¡æ¥å£å®šä¹‰

**ç¤ºä¾‹**ï¼ˆå‰ªè£åï¼‰ï¼š

```java
// çº¯ä¸šåŠ¡é€»è¾‘ï¼Œæ— åŸºç¡€è®¾æ–½ä»£ç 
public class OrderService {
    public void createOrder(Order order) {
        // ä¸šåŠ¡è§„åˆ™éªŒè¯
        order.validate();

        // é¢†åŸŸäº‹ä»¶
        order.addDomainEvent(new OrderCreatedEvent(order));

        // ä¿å­˜è®¢å•
        orderRepository.save(order);
    }
}
```

**åŸºç¡€è®¾æ–½ä»£ç åœ¨åˆ«å¤„**ï¼š

- **ç½‘ç»œé…ç½®** â†’ Service Meshï¼ˆIstio VirtualServiceï¼‰
- **ç›‘æ§åŸ‹ç‚¹** â†’ OpenTelemetryï¼ˆè‡ªåŠ¨æ³¨å…¥ï¼‰
- **å®‰å…¨æ ¡éªŒ** â†’ OPAï¼ˆç­–ç•¥å³ä»£ç ï¼‰

### 2.3 æŠ€æœ¯æ ˆæ”¯æŒ

| æŠ€æœ¯ | ä½œç”¨ | ç¤ºä¾‹ |
|------|------|------|
| **DDD** | é¢†åŸŸé©±åŠ¨è®¾è®¡ï¼Œèšç„¦ä¸šåŠ¡æ¨¡å‹ | èšåˆæ ¹ã€é¢†åŸŸæœåŠ¡ |
| **CQRS** | å‘½ä»¤æŸ¥è¯¢èŒè´£åˆ†ç¦»ï¼Œä¼˜åŒ–è¯»å†™æ€§èƒ½ | å‘½ä»¤ç«¯å†™ï¼ŒæŸ¥è¯¢ç«¯è¯» |
| **Domain Events** | é¢†åŸŸäº‹ä»¶ï¼Œè§£è€¦ä¸šåŠ¡æµç¨‹ | OrderCreated â†’ PaymentTriggered |

### 2.4 å®è·µå»ºè®®

1. **é‡‡ç”¨ DDD**ï¼šä½¿ç”¨ Bounded Context åˆ’åˆ†é¢†åŸŸè¾¹ç•Œ
2. **å¥‘çº¦ä¼˜å…ˆ**ï¼šå…ˆå®šä¹‰æ¥å£å¥‘çº¦ï¼ˆOpenAPI/gRPCï¼‰ï¼Œå†å®ç°ä¸šåŠ¡é€»è¾‘
3. **äº‹ä»¶é©±åŠ¨**ï¼šé€šè¿‡é¢†åŸŸäº‹ä»¶è§£è€¦ä¸šåŠ¡æµç¨‹
4. **æµ‹è¯•é©±åŠ¨**ï¼šä¸šåŠ¡é€»è¾‘å¯ç‹¬ç«‹æµ‹è¯•ï¼Œæ— éœ€å¯åŠ¨å®Œæ•´æŠ€æœ¯æ ˆ

---

## 3. å®‰å…¨ç­–ç•¥èšç„¦

### 3.1 å‰ªè£å‰çš„é—®é¢˜

**ä¼ ç»Ÿæ¶æ„ä¸­**ï¼Œå®‰å…¨ç­–ç•¥åˆ†æ•£åœ¨å„å¤„ï¼š

1. **ä¸šåŠ¡å±‚**ï¼šæ¯ä¸ªæœåŠ¡éƒ½è¦å†™å®‰å…¨æ ¡éªŒä»£ç 
2. **ç½‘ç»œå±‚**ï¼šéœ€è¦é…ç½®é˜²ç«å¢™è§„åˆ™
3. **å®¹å™¨å±‚**ï¼šéœ€è¦é…ç½® seccompã€AppArmor
4. **è¿ç»´å±‚**ï¼šéœ€è¦äººå·¥å®¡æ ¸é…ç½®

**ç¤ºä¾‹**ï¼ˆå‰ªè£å‰ï¼‰ï¼š

```java
// æ¯ä¸ªæœåŠ¡éƒ½è¦å†™å®‰å…¨ä»£ç 
@RestController
public class PaymentController {
    @PostMapping("/payment")
    public ResponseEntity<?> createPayment(@RequestBody Payment payment) {
        // å®‰å…¨æ ¡éªŒï¼ˆåˆ†æ•£åœ¨å„å¤„ï¼‰
        if (!SecurityContext.hasRole("PAYMENT_ADMIN")) {
            return ResponseEntity.status(403).build();
        }

        // ä¸šåŠ¡é€»è¾‘
        paymentService.createPayment(payment);
        return ResponseEntity.ok().build();
    }
}
```

### 3.2 å‰ªè£åçš„èšç„¦

**å‰ªè£å**ï¼Œå®‰å…¨ç­–ç•¥ç»Ÿä¸€åœ¨**åŸºç¡€è®¾æ–½å±‚**ï¼š

1. **æ²™ç®±å±‚**ï¼šseccompã€eBPF ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤
2. **Service Mesh å±‚**ï¼šmTLSã€AuthorizationPolicy
3. **OPA å±‚**ï¼šç­–ç•¥å³ä»£ç ï¼Œç»Ÿä¸€å†³ç­–

**ç¤ºä¾‹**ï¼ˆå‰ªè£åï¼‰ï¼š

```java
// ä¸šåŠ¡ä»£ç æ— éœ€å®‰å…¨æ ¡éªŒ
@RestController
public class PaymentController {
    @PostMapping("/payment")
    public ResponseEntity<?> createPayment(@RequestBody Payment payment) {
        // çº¯ä¸šåŠ¡é€»è¾‘
        paymentService.createPayment(payment);
        return ResponseEntity.ok().build();
    }
}
```

**å®‰å…¨ç­–ç•¥åœ¨åˆ«å¤„**ï¼š

- **è®¿é—®æ§åˆ¶** â†’ OPA Rego ç­–ç•¥
- **TLS åŠ å¯†** â†’ Service Meshï¼ˆè‡ªåŠ¨ mTLSï¼‰
- **ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤** â†’ seccomp-bpfï¼ˆå®¹å™¨çº§åˆ«ï¼‰

### 3.3 OPA ç­–ç•¥ç¤ºä¾‹

```rego
package payment.authz

default allow = false

allow {
    input.attributes.request.http.method == "POST"
    input.attributes.request.http.path == "/payment"
    input.attributes.source.principal == "spiffe://trust/domain/ns/default/sa/payment-admin"
}
```

### 3.4 æŠ€æœ¯æ ˆæ”¯æŒ

| æŠ€æœ¯ | ä½œç”¨ | ç¤ºä¾‹ |
|------|------|------|
| **OPA/Gatekeeper** | ç­–ç•¥å³ä»£ç ï¼Œç»Ÿä¸€å†³ç­– | Rego ç­–ç•¥æ–‡ä»¶ |
| **seccomp** | ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤ | seccomp profile |
| **Service Mesh MTLS** | æœåŠ¡é—´åŠ å¯† | Istio è‡ªåŠ¨ mTLS |
| **SPIFFE** | ç»Ÿä¸€èº«ä»½æ ‡è¯† | SPIFFE ID |

### 3.5 å®è·µå»ºè®®

1. **ç­–ç•¥å³ä»£ç **ï¼šæ‰€æœ‰å®‰å…¨ç­–ç•¥å†™æˆ Regoï¼Œç‰ˆæœ¬åŒ–ç®¡ç†
2. **ç»Ÿä¸€å†³ç­–**ï¼šåœ¨ Service Mesh å±‚ç»Ÿä¸€åšæˆæƒå†³ç­–
3. **æœ€å°æƒé™**ï¼šå®¹å™¨ä½¿ç”¨ seccomp é™åˆ¶ç³»ç»Ÿè°ƒç”¨
4. **é›¶ä¿¡ä»»**ï¼šé»˜è®¤æ‹’ç»ï¼Œæ˜ç¡®å…è®¸

---

## 4. æ€§èƒ½ä¸å¼¹æ€§èšç„¦

### 4.1 å‰ªè£å‰çš„é—®é¢˜

**ä¼ ç»Ÿæ¶æ„ä¸­**ï¼Œæ€§èƒ½è°ƒä¼˜éœ€è¦ï¼š

1. **æ‰‹åŠ¨è°ƒä¼˜**ï¼šæ¯ä¸ªæœåŠ¡éƒ½è¦æ‰‹åŠ¨é…ç½® CPUã€å†…å­˜
2. **é™æ€é…ç½®**ï¼šèµ„æºé…ç½®å›ºå®šï¼Œæ— æ³•åŠ¨æ€è°ƒæ•´
3. **è¿ç»´è´Ÿæ‹…**ï¼šéœ€è¦äººå·¥ç›‘æ§å’Œæ‰©å®¹

**ç¤ºä¾‹**ï¼ˆå‰ªè£å‰ï¼‰ï¼š

```yaml
# é™æ€é…ç½®ï¼Œæ— æ³•åŠ¨æ€è°ƒæ•´
apiVersion: v1
kind: Pod
spec:
  containers:
    - name: payment
      resources:
        requests:
          cpu: "1000m"  # å›ºå®šé…ç½®
          memory: "2Gi"  # å›ºå®šé…ç½®
        limits:
          cpu: "2000m"  # å›ºå®šé…ç½®
          memory: "4Gi"  # å›ºå®šé…ç½®
```

### 4.2 å‰ªè£åçš„èšç„¦

**å‰ªè£å**ï¼Œæ€§èƒ½ä¸å¼¹æ€§ç”±**è‡ªåŠ¨åŒ–ç³»ç»Ÿ**ç®¡ç†ï¼š

1. **è‡ªåŠ¨è°ƒåº¦**ï¼šKubernetes è‡ªåŠ¨è°ƒåº¦ Pod
2. **å¼¹æ€§ä¼¸ç¼©**ï¼šHPA/VPA è‡ªåŠ¨æ‰©å®¹ç¼©å®¹
3. **ç†”æ–­é™æµ**ï¼šService Mesh è‡ªåŠ¨ç†”æ–­

**ç¤ºä¾‹**ï¼ˆå‰ªè£åï¼‰ï¼š

```yaml
# è‡ªåŠ¨ä¼¸ç¼©é…ç½®
apiVersion: autoscaling/v2
kind: HorizontalPodAutoscaler
metadata:
  name: payment-hpa
spec:
  scaleTargetRef:
    apiVersion: apps/v1
    kind: Deployment
    name: payment-service
  minReplicas: 3
  maxReplicas: 10
  metrics:
    - type: Resource
      resource:
        name: cpu
        target:
          type: Utilization
          averageUtilization: 70
```

### 4.3 æŠ€æœ¯æ ˆæ”¯æŒ

| æŠ€æœ¯ | ä½œç”¨ | ç¤ºä¾‹ |
|------|------|------|
| **K8s HPA** | æ°´å¹³è‡ªåŠ¨æ‰©ç¼©å®¹ | åŸºäº CPU/å†…å­˜è‡ªåŠ¨æ‰©å®¹ |
| **K8s VPA** | å‚ç›´è‡ªåŠ¨æ‰©ç¼©å®¹ | è‡ªåŠ¨è°ƒæ•´èµ„æºè¯·æ±‚ |
| **Istio Circuit Breaker** | ç†”æ–­é™æµ | è‡ªåŠ¨ç†”æ–­æ•…éšœæœåŠ¡ |
| **KEDA** | äº‹ä»¶é©±åŠ¨è‡ªåŠ¨ä¼¸ç¼© | åŸºäº Kafka é˜Ÿåˆ—é•¿åº¦æ‰©å®¹ |

### 4.4 å®è·µå»ºè®®

1. **è‡ªåŠ¨è°ƒåº¦**ï¼šä½¿ç”¨ Kubernetes è‡ªåŠ¨è°ƒåº¦ï¼Œæ— éœ€æ‰‹åŠ¨æŒ‡å®šèŠ‚ç‚¹
2. **å¼¹æ€§ä¼¸ç¼©**ï¼šé…ç½® HPAï¼ŒåŸºäºæŒ‡æ ‡è‡ªåŠ¨æ‰©å®¹
3. **ç†”æ–­é™æµ**ï¼šä½¿ç”¨ Service Mesh ç†”æ–­ï¼Œé˜²æ­¢é›ªå´©
4. **æ€§èƒ½ç›‘æ§**ï¼šä½¿ç”¨ Prometheus ç›‘æ§æ€§èƒ½æŒ‡æ ‡

---

## 5. ç›‘æ§ä¸å‘Šè­¦èšç„¦

### 5.1 å‰ªè£å‰çš„é—®é¢˜

**ä¼ ç»Ÿæ¶æ„ä¸­**ï¼Œç›‘æ§éœ€è¦ï¼š

1. **è‡ªè¡Œå®ç°**ï¼šæ¯ä¸ªæœåŠ¡éƒ½è¦å†™ç›‘æ§åŸ‹ç‚¹ä»£ç 
2. **åˆ†æ•£é‡‡é›†**ï¼šæ—¥å¿—ã€æŒ‡æ ‡ã€è¿½è¸ªåˆ†æ•£åœ¨ä¸åŒç³»ç»Ÿ
3. **é…ç½®å¤æ‚**ï¼šéœ€è¦é…ç½®å¤šä¸ªç›‘æ§ç³»ç»Ÿ

**ç¤ºä¾‹**ï¼ˆå‰ªè£å‰ï¼‰ï¼š

```java
// æ¯ä¸ªæœåŠ¡éƒ½è¦å†™ç›‘æ§ä»£ç 
@RestController
public class PaymentController {
    @PostMapping("/payment")
    public ResponseEntity<?> createPayment(@RequestBody Payment payment) {
        // ç›‘æ§åŸ‹ç‚¹ï¼ˆåˆ†æ•£åœ¨å„å¤„ï¼‰
        Timer timer = Metrics.timer("payment.create").start();
        try {
            paymentService.createPayment(payment);
            Metrics.counter("payment.created").increment();
            return ResponseEntity.ok().build();
        } finally {
            timer.stop();
        }
    }
}
```

### 5.2 å‰ªè£åçš„èšç„¦

**å‰ªè£å**ï¼Œç›‘æ§ç”±**ç»Ÿä¸€å¯è§‚æµ‹æ€§å¹³å°**è‡ªåŠ¨é‡‡é›†ï¼š

1. **è‡ªåŠ¨æ³¨å…¥**ï¼šOpenTelemetry è‡ªåŠ¨æ³¨å…¥ç›‘æ§ä»£ç 
2. **ç»Ÿä¸€é‡‡é›†**ï¼šæ—¥å¿—ã€æŒ‡æ ‡ã€è¿½è¸ªç»Ÿä¸€é‡‡é›†
3. **ç»Ÿä¸€å±•ç¤º**ï¼šGrafana ç»Ÿä¸€å±•ç¤º

**ç¤ºä¾‹**ï¼ˆå‰ªè£åï¼‰ï¼š

```java
// ä¸šåŠ¡ä»£ç æ— éœ€ç›‘æ§ä»£ç 
@RestController
public class PaymentController {
    @PostMapping("/payment")
    public ResponseEntity<?> createPayment(@RequestBody Payment payment) {
        // çº¯ä¸šåŠ¡é€»è¾‘
        paymentService.createPayment(payment);
        return ResponseEntity.ok().build();
    }
}
```

**ç›‘æ§åœ¨åˆ«å¤„**ï¼š

- **æŒ‡æ ‡é‡‡é›†** â†’ OpenTelemetry Collectorï¼ˆè‡ªåŠ¨æ³¨å…¥ï¼‰
- **æ—¥å¿—é‡‡é›†** â†’ Prometheus + Lokiï¼ˆè‡ªåŠ¨é‡‡é›†ï¼‰
- **åˆ†å¸ƒå¼è¿½è¸ª** â†’ Tempo + Jaegerï¼ˆè‡ªåŠ¨è¿½è¸ªï¼‰

### 5.3 æŠ€æœ¯æ ˆæ”¯æŒ

| æŠ€æœ¯ | ä½œç”¨ | ç¤ºä¾‹ |
|------|------|------|
| **OpenTelemetry** | ç»Ÿä¸€é¥æµ‹æ ‡å‡† | è‡ªåŠ¨æ³¨å…¥ç›‘æ§ä»£ç  |
| **Prometheus** | æŒ‡æ ‡é‡‡é›† | è‡ªåŠ¨é‡‡é›†æŒ‡æ ‡ |
| **Tempo** | åˆ†å¸ƒå¼è¿½è¸ª | è‡ªåŠ¨è¿½è¸ªè¯·æ±‚é“¾è·¯ |
| **Grafana** | ç»Ÿä¸€å±•ç¤º | ç»Ÿä¸€ç›‘æ§é¢æ¿ |

### 5.4 å®è·µå»ºè®®

1. **ç»Ÿä¸€å¯è§‚æµ‹æ€§**ï¼šä½¿ç”¨ OpenTelemetry ç»Ÿä¸€é‡‡é›†æ—¥å¿—ã€æŒ‡æ ‡ã€è¿½è¸ª
2. **è‡ªåŠ¨æ³¨å…¥**ï¼šé€šè¿‡ Service Mesh è‡ªåŠ¨æ³¨å…¥ç›‘æ§ä»£ç 
3. **ç»Ÿä¸€å±•ç¤º**ï¼šä½¿ç”¨ Grafana ç»Ÿä¸€å±•ç¤ºç›‘æ§æ•°æ®
4. **å‘Šè­¦è§„åˆ™**ï¼šé…ç½® Prometheus AlertManager å‘Šè­¦è§„åˆ™

---

## 6. å¤šç§Ÿæˆ·ä¸åˆè§„èšç„¦

### 6.1 å‰ªè£å‰çš„é—®é¢˜

**ä¼ ç»Ÿæ¶æ„ä¸­**ï¼Œå¤šç§Ÿæˆ·éœ€è¦ï¼š

1. **æ‰‹å·¥åˆ†é…**ï¼šæ¯ä¸ªæœåŠ¡éƒ½è¦æ‰‹å·¥åˆ†é… tenant
2. **é…ç½®åˆ†æ•£**ï¼šç§Ÿæˆ·é…ç½®åˆ†æ•£åœ¨å„å¤„
3. **åˆè§„å›°éš¾**ï¼šéœ€è¦æ‰‹å·¥å®¡æ ¸åˆè§„æ€§

**ç¤ºä¾‹**ï¼ˆå‰ªè£å‰ï¼‰ï¼š

```java
// æ¯ä¸ªæœåŠ¡éƒ½è¦å¤„ç†ç§Ÿæˆ·éš”ç¦»
@RestController
public class PaymentController {
    @PostMapping("/payment")
    public ResponseEntity<?> createPayment(@RequestBody Payment payment) {
        // ç§Ÿæˆ·éš”ç¦»ï¼ˆåˆ†æ•£åœ¨å„å¤„ï¼‰
        String tenantId = SecurityContext.getTenantId();
        payment.setTenantId(tenantId);

        // ä¸šåŠ¡é€»è¾‘
        paymentService.createPayment(payment);
        return ResponseEntity.ok().build();
    }
}
```

### 6.2 å‰ªè£åçš„èšç„¦

**å‰ªè£å**ï¼Œå¤šç§Ÿæˆ·ä¸åˆè§„ç”±**å¹³å°å±‚**ç»Ÿä¸€ç®¡ç†ï¼š

1. **å‘½åç©ºé—´éš”ç¦»**ï¼šKubernetes Namespace éš”ç¦»ç§Ÿæˆ·
2. **ç­–ç•¥ç»Ÿä¸€**ï¼šOPA ç»Ÿä¸€ç®¡ç†ç§Ÿæˆ·ç­–ç•¥
3. **åˆè§„è‡ªåŠ¨åŒ–**ï¼šGatekeeper è‡ªåŠ¨å®¡æ ¸åˆè§„æ€§

**ç¤ºä¾‹**ï¼ˆå‰ªè£åï¼‰ï¼š

```java
// ä¸šåŠ¡ä»£ç æ— éœ€å¤„ç†ç§Ÿæˆ·
@RestController
public class PaymentController {
    @PostMapping("/payment")
    public ResponseEntity<?> createPayment(@RequestBody Payment payment) {
        // çº¯ä¸šåŠ¡é€»è¾‘ï¼Œç§Ÿæˆ·éš”ç¦»ç”±å¹³å°å±‚å¤„ç†
        paymentService.createPayment(payment);
        return ResponseEntity.ok().build();
    }
}
```

**å¤šç§Ÿæˆ·åœ¨åˆ«å¤„**ï¼š

- **å‘½åç©ºé—´éš”ç¦»** â†’ Kubernetes Namespaceï¼ˆæ¯ä¸ªç§Ÿæˆ·ä¸€ä¸ª namespaceï¼‰
- **ç­–ç•¥ç»Ÿä¸€** â†’ OPAï¼ˆç»Ÿä¸€ç®¡ç†ç§Ÿæˆ·ç­–ç•¥ï¼‰
- **åˆè§„å®¡æ ¸** â†’ Gatekeeperï¼ˆè‡ªåŠ¨å®¡æ ¸åˆè§„æ€§ï¼‰

### 6.3 æŠ€æœ¯æ ˆæ”¯æŒ

| æŠ€æœ¯ | ä½œç”¨ | ç¤ºä¾‹ |
|------|------|------|
| **Kubernetes RBAC** | åŸºäºè§’è‰²çš„è®¿é—®æ§åˆ¶ | æ¯ä¸ªç§Ÿæˆ·ä¸€ä¸ª ServiceAccount |
| **Gatekeeper** | ç­–ç•¥å³ä»£ç ï¼Œåˆè§„å®¡æ ¸ | Rego ç­–ç•¥è‡ªåŠ¨å®¡æ ¸ |
| **Istio Multi-tenancy** | Service Mesh å¤šç§Ÿæˆ·æ”¯æŒ | æ¯ä¸ªç§Ÿæˆ·ç‹¬ç«‹çš„ VirtualService |

### 6.4 å®è·µå»ºè®®

1. **å‘½åç©ºé—´éš”ç¦»**ï¼šæ¯ä¸ªç§Ÿæˆ·ä½¿ç”¨ç‹¬ç«‹çš„ Kubernetes Namespace
2. **ç­–ç•¥ç»Ÿä¸€**ï¼šä½¿ç”¨ OPA ç»Ÿä¸€ç®¡ç†ç§Ÿæˆ·ç­–ç•¥
3. **åˆè§„è‡ªåŠ¨åŒ–**ï¼šä½¿ç”¨ Gatekeeper è‡ªåŠ¨å®¡æ ¸åˆè§„æ€§
4. **èµ„æºé…é¢**ï¼šä½¿ç”¨ ResourceQuota é™åˆ¶ç§Ÿæˆ·èµ„æº

---

## 7. å¯æ‰©å±•æ€§èšç„¦

### 7.1 å‰ªè£å‰çš„é—®é¢˜

**ä¼ ç»Ÿæ¶æ„ä¸­**ï¼Œå¯æ‰©å±•æ€§éœ€è¦ï¼š

1. **ä»£ç æ°´å¹³æ‰©å±•**ï¼šåœ¨ä»£ç å±‚é¢å®ç°æ‰©å±•
2. **æ‰‹åŠ¨æ‰©å®¹**ï¼šéœ€è¦äººå·¥æ‰©å®¹
3. **ä¸šåŠ¡æ‹†åˆ†å›°éš¾**ï¼šå•ä½“åº”ç”¨éš¾ä»¥æ‹†åˆ†

### 7.2 å‰ªè£åçš„èšç„¦

**å‰ªè£å**ï¼Œå¯æ‰©å±•æ€§ç”±**å¹³å°å±‚**è‡ªåŠ¨æ”¯æŒï¼š

1. **æ°´å¹³æ‰©å®¹**ï¼šKubernetes è‡ªåŠ¨æ°´å¹³æ‰©å®¹
2. **ä¸šåŠ¡æ‹†åˆ†**ï¼šå¾®æœåŠ¡æ¶æ„æ”¯æŒä¸šåŠ¡æ‹†åˆ†
3. **è‡ªåŠ¨æ‰©å±•**ï¼šHPA è‡ªåŠ¨æ‰©å±•

### 7.3 æŠ€æœ¯æ ˆæ”¯æŒ

| æŠ€æœ¯ | ä½œç”¨ | ç¤ºä¾‹ |
|------|------|------|
| **å¾®æœåŠ¡æ‹†åˆ†** | ä¸šåŠ¡æ‹†åˆ† | DDD Bounded Context |
| **Pipeline** | ä¸šåŠ¡æµç¨‹ç¼–æ’ | Temporalã€Argo Workflows |
| **Argo Rollouts** | æ¸è¿›å¼å‘å¸ƒ | è“ç»¿ã€é‡‘ä¸é›€å‘å¸ƒ |

### 7.4 å®è·µå»ºè®®

1. **å¾®æœåŠ¡æ‹†åˆ†**ï¼šä½¿ç”¨ DDD Bounded Context æ‹†åˆ†ä¸šåŠ¡
2. **æ°´å¹³æ‰©å®¹**ï¼šé…ç½® HPAï¼Œè‡ªåŠ¨æ‰©å®¹
3. **æ¸è¿›å¼å‘å¸ƒ**ï¼šä½¿ç”¨ Argo Rollouts æ¸è¿›å¼å‘å¸ƒ

---

## 8. å‰ªè£æ•ˆæœæ€»ç»“

### 8.1 å‰ªè£å‰ vs å‰ªè£åå¯¹æ¯”

| ç»´åº¦ | å‰ªè£å‰ | å‰ªè£å |
|------|--------|--------|
| **ä¸šåŠ¡å»ºæ¨¡** | ä¸šåŠ¡é€»è¾‘æ··æ‚åŸºç¡€è®¾æ–½ä»£ç  | çº¯ä¸šåŠ¡é€»è¾‘ï¼Œèšç„¦é¢†åŸŸæ¨¡å‹ |
| **å®‰å…¨ç­–ç•¥** | åˆ†æ•£åœ¨å„å¤„ï¼Œéš¾ä»¥ç®¡ç† | ç»Ÿä¸€åœ¨åŸºç¡€è®¾æ–½å±‚ï¼Œç­–ç•¥å³ä»£ç  |
| **æ€§èƒ½å¼¹æ€§** | æ‰‹åŠ¨è°ƒä¼˜ï¼Œé™æ€é…ç½® | è‡ªåŠ¨è°ƒåº¦ï¼Œå¼¹æ€§ä¼¸ç¼© |
| **ç›‘æ§å‘Šè­¦** | è‡ªè¡Œå®ç°ï¼Œåˆ†æ•£é‡‡é›† | ç»Ÿä¸€å¯è§‚æµ‹æ€§ï¼Œè‡ªåŠ¨é‡‡é›† |
| **å¤šç§Ÿæˆ·åˆè§„** | æ‰‹å·¥åˆ†é…ï¼Œé…ç½®åˆ†æ•£ | å¹³å°å±‚ç»Ÿä¸€ç®¡ç†ï¼Œè‡ªåŠ¨åŒ–åˆè§„ |
| **å¯æ‰©å±•æ€§** | ä»£ç å±‚é¢æ‰©å±•ï¼Œæ‰‹åŠ¨æ‰©å®¹ | å¹³å°å±‚è‡ªåŠ¨æ”¯æŒï¼Œæ°´å¹³æ‰©å®¹ |

### 8.2 æ¶æ„å¸ˆèšç„¦çš„æ ¸å¿ƒé¢†åŸŸ

**å‰ªè£åï¼Œæ¶æ„å¸ˆåªéœ€èšç„¦**ï¼š

1. **ä¸šåŠ¡åŠŸèƒ½**ï¼šä¸šåŠ¡éœ€æ±‚å’ŒåŠŸèƒ½å®šä¹‰
2. **ç”¨ä¾‹**ï¼šä¸šåŠ¡ç”¨ä¾‹çš„è¾“å…¥è¾“å‡º
3. **ä¸šåŠ¡è§„åˆ™**ï¼šé¢†åŸŸè§„åˆ™å’Œçº¦æŸ
4. **æ¥å£å¥‘çº¦**ï¼šæœåŠ¡æ¥å£å®šä¹‰

**å…¶ä»–å…³æ³¨ç‚¹ç”±å¹³å°å±‚ç»Ÿä¸€ç®¡ç†**ï¼š

1. **èµ„æºè°ƒåº¦** â†’ Kubernetes
2. **å®‰å…¨ç­–ç•¥** â†’ OPA + Service Mesh
3. **ç›‘æ§å‘Šè­¦** â†’ OpenTelemetry + Prometheus
4. **å¤šç§Ÿæˆ·åˆè§„** â†’ Kubernetes RBAC + Gatekeeper
5. **æ€§èƒ½å¼¹æ€§** â†’ HPA + Service Mesh

---

## 9. æŠ€æœ¯é€‰å‹å»ºè®®

### 9.1 ä¸šåŠ¡å»ºæ¨¡

| åœºæ™¯ | æ¨èæŠ€æœ¯ | ç†ç”± |
|------|---------|------|
| **é¢†åŸŸå»ºæ¨¡** | DDD | èšç„¦ä¸šåŠ¡æ¨¡å‹ |
| **è¯»å†™åˆ†ç¦»** | CQRS | ä¼˜åŒ–è¯»å†™æ€§èƒ½ |
| **äº‹ä»¶é©±åŠ¨** | Domain Events | è§£è€¦ä¸šåŠ¡æµç¨‹ |

### 9.2 å®‰å…¨ç­–ç•¥

| åœºæ™¯ | æ¨èæŠ€æœ¯ | ç†ç”± |
|------|---------|------|
| **ç­–ç•¥å³ä»£ç ** | OPA | ç»Ÿä¸€å†³ç­–ï¼Œç‰ˆæœ¬ç®¡ç† |
| **ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤** | seccomp | æœ€å°æƒé™ |
| **æœåŠ¡é—´åŠ å¯†** | Service Mesh MTLS | é›¶ä¿¡ä»» |

### 9.3 æ€§èƒ½å¼¹æ€§

| åœºæ™¯ | æ¨èæŠ€æœ¯ | ç†ç”± |
|------|---------|------|
| **è‡ªåŠ¨æ‰©å®¹** | K8s HPA | åŸºäºæŒ‡æ ‡è‡ªåŠ¨æ‰©å®¹ |
| **ç†”æ–­é™æµ** | Istio Circuit Breaker | é˜²æ­¢é›ªå´© |

### 9.4 ç›‘æ§å‘Šè­¦

| åœºæ™¯ | æ¨èæŠ€æœ¯ | ç†ç”± |
|------|---------|------|
| **ç»Ÿä¸€å¯è§‚æµ‹æ€§** | OpenTelemetry | ç»Ÿä¸€é‡‡é›†æ ‡å‡† |
| **æŒ‡æ ‡é‡‡é›†** | Prometheus | æˆç†Ÿç¨³å®š |
| **åˆ†å¸ƒå¼è¿½è¸ª** | Tempo | é«˜æ€§èƒ½ |

---

## 10. å®è·µæ¡ˆä¾‹

### 10.1 æ”¯ä»˜ç½‘å…³æ¡ˆä¾‹

**ä¸šåŠ¡èšç„¦**ï¼š
- è®¢å•å¤„ç†é€»è¾‘
- æ”¯ä»˜æµç¨‹
- ä¸šåŠ¡è§„åˆ™éªŒè¯

**å¹³å°å±‚ç®¡ç†**ï¼š
- å®‰å…¨ç­–ç•¥ï¼ˆOPAï¼‰
- ç›‘æ§å‘Šè­¦ï¼ˆOpenTelemetryï¼‰
- å¼¹æ€§ä¼¸ç¼©ï¼ˆHPAï¼‰

è¯¦ç»†æ¡ˆä¾‹ï¼šå‚è§ `07-case-studies/payment-gateway.md`

### 10.2 ç”µå•†å¹³å°æ¡ˆä¾‹

**ä¸šåŠ¡èšç„¦**ï¼š
- å•†å“ç›®å½•
- è®¢å•ç®¡ç†
- åº“å­˜ç®¡ç†

**å¹³å°å±‚ç®¡ç†**ï¼š
- Service Meshï¼ˆIstioï¼‰
- å¤šç§Ÿæˆ·éš”ç¦»ï¼ˆKubernetes Namespaceï¼‰
- äº‹ä»¶é©±åŠ¨ï¼ˆKafkaï¼‰

è¯¦ç»†æ¡ˆä¾‹ï¼šå‚è§ `07-case-studies/e-commerce-platform.md`

---

## 11. æ€»ç»“

### 11.1 æ ¸å¿ƒè¦ç‚¹

1. **å‰ªè£é€šç”¨å…³æ³¨ç‚¹**ï¼šé€šè¿‡åˆ†å±‚æŠ½è±¡å’Œç»„åˆæ¨¡å¼ï¼ŒæŠŠ"é€šç”¨"ä¸"å¹³å°"å…³æ³¨ç‚¹ä»ä¸šåŠ¡å…³æ³¨ç‚¹ä¸­"åˆ‡"å‡ºå»
2. **èšç„¦ä¸šåŠ¡ä»·å€¼**ï¼šæ¶æ„å¸ˆåªéœ€èšç„¦ä¸šåŠ¡åŠŸèƒ½ã€ç”¨ä¾‹ã€ä¸šåŠ¡è§„åˆ™ã€æ¥å£å¥‘çº¦
3. **å¹³å°å±‚ç»Ÿä¸€ç®¡ç†**ï¼šèµ„æºè°ƒåº¦ã€å®‰å…¨ç­–ç•¥ã€ç›‘æ§å‘Šè­¦ã€å¤šç§Ÿæˆ·åˆè§„ç”±å¹³å°å±‚ç»Ÿä¸€ç®¡ç†
4. **ç­–ç•¥å³ä»£ç **ï¼šæ‰€æœ‰ç­–ç•¥ï¼ˆå®‰å…¨ã€åˆè§„ã€æ€§èƒ½ï¼‰å†™æˆä»£ç ï¼Œç‰ˆæœ¬åŒ–ç®¡ç†

### 11.2 å®è·µå»ºè®®

1. **é‡‡ç”¨åˆ†å±‚æ¶æ„**ï¼šç¡®ä¿ä¸šåŠ¡å±‚ä¸åŸºç¡€è®¾æ–½å±‚åˆ†ç¦»
2. **ä½¿ç”¨ç»„åˆæ¨¡å¼**ï¼šé€šè¿‡ Service Meshã€OPA ç­‰ç»„åˆåŸºç¡€è®¾æ–½èƒ½åŠ›
3. **ç­–ç•¥å³ä»£ç **ï¼šæ‰€æœ‰ç­–ç•¥å†™æˆä»£ç ï¼Œç‰ˆæœ¬åŒ–ç®¡ç†
4. **è‡ªåŠ¨åŒ–è¿ç»´**ï¼šä½¿ç”¨ GitOpsã€HPA ç­‰è‡ªåŠ¨åŒ–è¿ç»´å·¥å…·

### 11.3 ä¸‹ä¸€æ­¥

- åœ¨å®é™…é¡¹ç›®ä¸­åº”ç”¨å‰ªè£æ€æƒ³
- é€šè¿‡ ADR è®°å½•æ¶æ„å†³ç­–
- é€šè¿‡ C4 æ¨¡å‹è®°å½•æ¶æ„æ¼”è¿›

---

**å‚è€ƒèµ„æº**ï¼š

- [æ¶æ„æ‹†è§£ä¸ç»„åˆï¼š5 æ­¥æµç¨‹](./01-5-step-process.md)
- [åˆ†å±‚æ‹†è§£ï¼š9 å±‚æ¶æ„æ¨¡å‹](./02-layered-decomposition.md)
- [ç»„åˆæ¨¡å¼](./03-composition-patterns.md)
- [æ¥å£ä¸å¥‘çº¦](./04-interfaces-contracts.md)
- [æ€ç»´æ¨¡å‹](./05-thinking-models.md)
- [æ”¯ä»˜ç½‘å…³æ¡ˆä¾‹](../../07-case-studies/payment-gateway.md)
- [ç”µå•†å¹³å°æ¡ˆä¾‹](../../07-case-studies/e-commerce-platform.md)

---

**æ›´æ–°æ—¶é—´**ï¼š2025-11-04 **ç‰ˆæœ¬**ï¼šv1.0 **å‚è€ƒ**ï¼š`architecture_view.md` ç¬¬ 337-350 è¡Œ


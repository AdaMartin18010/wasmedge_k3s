# 矩阵对比：虚拟化、容器化、沙盒化

## 📑 目录

- [📑 目录](#-目录)
- [1. 概述](#1-概述)
  - [1.1 核心矩阵](#11-核心矩阵)
- [2. 隔离级别对比](#2-隔离级别对比)
  - [2.1 隔离层次](#21-隔离层次)
  - [2.2 隔离范围](#22-隔离范围)
- [3. 资源开销对比](#3-资源开销对比)
  - [3.1 内存开销](#31-内存开销)
  - [3.2 CPU 开销](#32-cpu-开销)
  - [3.3 存储开销](#33-存储开销)
- [4. 启动时间对比](#4-启动时间对比)
  - [4.1 启动时间](#41-启动时间)
  - [4.2 启动流程](#42-启动流程)
- [5. 安全模型对比](#5-安全模型对比)
  - [5.1 安全特性](#51-安全特性)
  - [5.2 安全模型](#52-安全模型)
- [6. 网络模型对比](#6-网络模型对比)
  - [6.1 网络抽象](#61-网络抽象)
  - [6.2 网络模型](#62-网络模型)
- [7. 可观测性对比](#7-可观测性对比)
  - [7.1 监控方式](#71-监控方式)
  - [7.2 可观测性](#72-可观测性)
- [8. 适用场景对比](#8-适用场景对比)
  - [8.1 应用场景](#81-应用场景)
  - [8.2 场景选择](#82-场景选择)
- [9. 技术选型决策树](#9-技术选型决策树)
  - [9.1 隔离需求决策](#91-隔离需求决策)
  - [9.2 性能需求决策](#92-性能需求决策)
  - [9.3 安全需求决策](#93-安全需求决策)
- [10. 组合使用场景](#10-组合使用场景)
  - [10.1 VM + Container](#101-vm--container)
  - [10.2 Container + Sandbox](#102-container--sandbox)
  - [10.3 VM + Container + Sandbox](#103-vm--container--sandbox)
- [11. 属性权衡矩阵](#11-属性权衡矩阵)
  - [11.1 隔离 vs 性能](#111-隔离-vs-性能)
  - [11.2 安全 vs 灵活性](#112-安全-vs-灵活性)
- [12. 总结](#12-总结)

---

## 1. 概述

本文档提供**虚拟化、容器化、沙盒化**的**完整矩阵对比**，帮助快速进行技术选型和安
全/性能权衡。

### 1.1 核心矩阵

| 属性            | 虚拟化                              | 容器化                         | 沙盒化                             |
| --------------- | ----------------------------------- | ------------------------------ | ---------------------------------- |
| **隔离级别**    | 完全硬件级（CPU、内存）             | OS 进程级（namespace, cgroup） | 进程级+系统调用过滤                |
| **资源开销**    | 高（每 VM 占用 ~ 2–3× RAM）         | 低（共享内核）                 | 低（与容器同级）                   |
| **启动时间**    | 10–30 s                             | < 1 s                          | < 1 s                              |
| **可移植性**    | 高（可迁移到不同硬件）              | 高（镜像可跨平台）             | 高（镜像+过滤规则可携带）          |
| **安全模型**    | 隔离、快照                          | 隔离、文件系统                 | 最小权限、动态可编程               |
| **网络模型**    | 虚拟 NIC, NAT, vSwitch              | Docker 网络, CNI               | 与容器共享，细粒度过滤             |
| **监控/可观测** | 需要自定义监控 (cAdvisor, collectd) | 通过 cAdvisor、Prometheus      | 通过 eBPF、BPFtrace                |
| **适用场景**    | 大型批处理、数据库, 云主机          | 微服务、CI/CD, 轻量化          | 代码沙盒、沙箱化部署、恶意代码隔离 |

## 2. 隔离级别对比

### 2.1 隔离层次

| 技术       | 隔离层次                       | 隔离粒度       |
| ---------- | ------------------------------ | -------------- |
| **虚拟化** | 硬件级（CPU、内存、I/O）       | 完全隔离       |
| **容器化** | OS 进程级（namespace、cgroup） | 进程级隔离     |
| **沙盒化** | 系统调用级（seccomp、eBPF）    | 系统调用级隔离 |

### 2.2 隔离范围

```text
隔离范围
├── 虚拟化
│   ├── CPU 隔离（vCPU）
│   ├── 内存隔离（vMEM）
│   ├── I/O 隔离（vIO）
│   └── 网络隔离（vNIC）
├── 容器化
│   ├── 进程隔离（PID namespace）
│   ├── 文件系统隔离（Mount namespace）
│   ├── 网络隔离（Network namespace）
│   └── 资源限制（cgroup）
└── 沙盒化
    ├── 系统调用过滤（seccomp）
    ├── 文件系统访问控制（Landlock）
    ├── 网络策略（eBPF）
    └── 进程权限（Capability）
```

## 3. 资源开销对比

### 3.1 内存开销

| 技术       | 内存开销                    | 说明             |
| ---------- | --------------------------- | ---------------- |
| **虚拟化** | 高（每 VM 占用 ~ 2–3× RAM） | 完整 OS 内存占用 |
| **容器化** | 低（共享内核）              | 仅应用内存占用   |
| **沙盒化** | 低（与容器同级）            | 额外开销最小     |

### 3.2 CPU 开销

| 技术       | CPU 开销         | 说明             |
| ---------- | ---------------- | ---------------- |
| **虚拟化** | 高（虚拟化开销） | Hypervisor 开销  |
| **容器化** | 低（共享内核）   | 直接使用物理 CPU |
| **沙盒化** | 低（用户态开销） | 用户态内核开销   |

### 3.3 存储开销

| 技术       | 存储开销              | 说明         |
| ---------- | --------------------- | ------------ |
| **虚拟化** | 高（VM 镜像 1–10 GB） | 完整 OS 镜像 |
| **容器化** | 中（镜像 10–100 MB）  | 应用镜像     |
| **沙盒化** | 低（策略配置）        | 仅策略配置   |

## 4. 启动时间对比

### 4.1 启动时间

| 技术       | 启动时间 | 说明         |
| ---------- | -------- | ------------ |
| **虚拟化** | 10–30 s  | OS 启动时间  |
| **容器化** | < 1 s    | 进程启动时间 |
| **沙盒化** | < 1 s    | 进程启动时间 |

### 4.2 启动流程

```text
启动流程
├── 虚拟化
│   ├── Hypervisor 初始化
│   ├── OS 启动
│   └── 应用启动
├── 容器化
│   ├── 镜像拉取
│   ├── 容器创建
│   └── 应用启动
└── 沙盒化
    ├── 沙盒初始化
    ├── 策略加载
    └── 应用启动
```

## 5. 安全模型对比

### 5.1 安全特性

| 技术       | 安全特性             | 说明           |
| ---------- | -------------------- | -------------- |
| **虚拟化** | 隔离、快照           | 硬件级隔离     |
| **容器化** | 隔离、文件系统       | OS 级隔离      |
| **沙盒化** | 最小权限、动态可编程 | 系统调用级隔离 |

### 5.2 安全模型

```text
安全模型
├── 虚拟化
│   ├── 硬件隔离
│   ├── 快照恢复
│   └── 迁移隔离
├── 容器化
│   ├── namespace 隔离
│   ├── cgroup 资源限制
│   └── rootfs 文件系统隔离
└── 沙盒化
    ├── seccomp 系统调用过滤
    ├── Landlock 文件系统访问控制
    ├── eBPF 网络策略
    └── Capability 最小权限
```

## 6. 网络模型对比

### 6.1 网络抽象

| 技术       | 网络抽象               | 说明          |
| ---------- | ---------------------- | ------------- |
| **虚拟化** | 虚拟 NIC, NAT, vSwitch | 虚拟网络设备  |
| **容器化** | Docker 网络, CNI       | 容器网络接口  |
| **沙盒化** | 与容器共享，细粒度过滤 | eBPF 网络策略 |

### 6.2 网络模型

```text
网络模型
├── 虚拟化
│   ├── vNIC（虚拟网卡）
│   ├── vSwitch（虚拟交换机）
│   └── NAT（网络地址转换）
├── 容器化
│   ├── CNI（容器网络接口）
│   ├── Overlay 网络
│   └── Service 网络
└── 沙盒化
    ├── eBPF 网络策略
    ├── 网络访问控制
    └── 流量监控
```

## 7. 可观测性对比

### 7.1 监控方式

| 技术       | 监控方式                  | 说明               |
| ---------- | ------------------------- | ------------------ |
| **虚拟化** | 需要自定义监控            | cAdvisor, collectd |
| **容器化** | 通过 cAdvisor、Prometheus | 容器指标           |
| **沙盒化** | 通过 eBPF、BPFtrace       | 系统调用追踪       |

### 7.2 可观测性

```text
可观测性
├── 虚拟化
│   ├── VM 指标
│   ├── 资源使用
│   └── 性能监控
├── 容器化
│   ├── 容器指标
│   ├── 应用指标
│   └── 资源使用
└── 沙盒化
    ├── 系统调用追踪
    ├── 网络流量监控
    └── 安全事件日志
```

## 8. 适用场景对比

### 8.1 应用场景

| 技术       | 适用场景                           | 说明         |
| ---------- | ---------------------------------- | ------------ |
| **虚拟化** | 大型批处理、数据库, 云主机         | 需要硬件隔离 |
| **容器化** | 微服务、CI/CD, 轻量化              | 快速部署     |
| **沙盒化** | 代码沙盒、沙箱化部署、恶意代码隔离 | 最小权限     |

### 8.2 场景选择

```text
场景选择
├── 需要硬件隔离？
│   └── 是 → 虚拟化（VM）
└── 否 → 需要快速启动？
    ├── 是 → 需要最小权限？
    │   ├── 是 → 沙盒化（Sandbox）
    │   └── 否 → 容器化（Container）
    └── 否 → 容器化（Container）
```

## 9. 技术选型决策树

### 9.1 隔离需求决策

```text
需要硬件级隔离？
├─ 是 → 虚拟化（VM）
└─ 否 → 需要进程级隔离？
    ├─ 是 → 需要系统调用过滤？
    │   ├─ 是 → 沙盒化（Sandbox）
    │   └─ 否 → 容器化（Container）
    └─ 否 → 容器化（Container）
```

### 9.2 性能需求决策

```text
需要快速启动？
├─ 是 → 容器化（Container）或 沙盒化（Sandbox）
└─ 否 → 需要硬件隔离？
    ├─ 是 → 虚拟化（VM）
    └─ 否 → 容器化（Container）
```

### 9.3 安全需求决策

```text
需要最小权限？
├─ 是 → 沙盒化（Sandbox）
└─ 否 → 需要硬件隔离？
    ├─ 是 → 虚拟化（VM）
    └─ 否 → 容器化（Container）
```

## 10. 组合使用场景

### 10.1 VM + Container

**场景**：在 VM 上运行容器

- **隔离级别**：硬件级 + OS 级
- **适用场景**：需要硬件隔离的容器化应用
- **典型技术**：Kata Containers（VM 级别的容器）

### 10.2 Container + Sandbox

**场景**：在容器内运行沙盒

- **隔离级别**：OS 级 + 进程级
- **适用场景**：需要最小权限的容器化应用
- **典型技术**：gVisor、Firecracker（容器内沙盒）

### 10.3 VM + Container + Sandbox

**场景**：在 VM 上运行容器，容器内运行沙盒

- **隔离级别**：硬件级 + OS 级 + 进程级
- **适用场景**：需要多层隔离的高安全应用
- **典型技术**：Kata + gVisor（多层隔离）

## 11. 属性权衡矩阵

### 11.1 隔离 vs 性能

| 技术   | 隔离级别 | 性能开销 | 适用场景           |
| ------ | -------- | -------- | ------------------ |
| 虚拟化 | 高       | 高       | 需要硬件隔离的应用 |
| 容器化 | 中       | 低       | 微服务、CI/CD      |
| 沙盒化 | 高       | 低       | 需要最小权限的应用 |

### 11.2 安全 vs 灵活性

| 技术   | 安全级别 | 灵活性 | 适用场景           |
| ------ | -------- | ------ | ------------------ |
| 虚拟化 | 高       | 中     | 需要硬件隔离的应用 |
| 容器化 | 中       | 高     | 微服务、CI/CD      |
| 沙盒化 | 高       | 中     | 需要最小权限的应用 |

## 12. 总结

通过**矩阵对比**，我们可以：

1. **快速定位技术选型**：根据隔离需求、性能需求、安全需求选择合适的技术
2. **理解属性权衡**：隔离 vs 性能、安全 vs 灵活性
3. **组合使用场景**：VM + Container、Container + Sandbox 等组合场景
4. **形式化定义属性**：隔离级别、资源开销、启动时间、安全模型等

---

**更新时间**：2025-11-04 **版本**：v1.0 **参考**：`architecture_view.md` 第
766-792 行，矩阵对比部分

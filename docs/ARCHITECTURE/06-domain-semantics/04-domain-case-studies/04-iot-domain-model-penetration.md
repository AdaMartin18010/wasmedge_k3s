# 从领域模型视角看 IoT：业务硬核如何穿透基础设施消解

**版本**：v1.0 **创建日期**：2025-11-08 **维护者**：项目团队

## 📑 目录

- [📑 目录](#-目录)
- [1 概述](#1-概述)
  - [1.1 核心思想](#11-核心思想)
  - [1.2 文档定位](#12-文档定位)
- [2 IoT 核心领域模型：不可消解的业务实体](#2-iot-核心领域模型不可消解的业务实体)
  - [2.1 领域实体与第一性原理](#21-领域实体与第一性原理)
  - [2.2 设备影子（Device Shadow）](#22-设备影子device-shadow)
  - [2.3 规则链（Rule Chain）](#23-规则链rule-chain)
  - [2.4 时空分区（Time-Location Sharding）](#24-时空分区time-location-sharding)
  - [2.5 设备认证生命周期（Device Certificate Lifecycle）](#25-设备认证生命周期device-certificate-lifecycle)
- [3 IoT 架构的分层映射：领域驱动的基础设施选择](#3-iot-架构的分层映射领域驱动的基础设施选择)
  - [3.1 领域模型到基础设施的映射](#31-领域模型到基础设施的映射)
  - [3.2 基础设施选择原则](#32-基础设施选择原则)
- [4 顽固残留的领域语义：IoT 架构的"硬核三脚架"](#4-顽固残留的领域语义iot-架构的硬核三脚架)
  - [4.1 设备影子同步](#41-设备影子同步)
  - [4.2 规则链执行](#42-规则链执行)
  - [4.3 时空分区策略](#43-时空分区策略)
- [5 云原生 IoT 架构实践：领域层如何"寄生"于通用层](#5-云原生-iot-架构实践领域层如何寄生于通用层)
  - [5.1 K8s 原生资源的不匹配](#51-k8s-原生资源的不匹配)
  - [5.2 领域层"寄生"策略](#52-领域层寄生策略)
  - [5.3 典型案例](#53-典型案例)
- [6 IoT 领域的"二次消解"现象](#6-iot-领域的二次消解现象)
  - [6.1 设备影子协议的标准化](#61-设备影子协议的标准化)
  - [6.2 规则链引擎的通用化](#62-规则链引擎的通用化)
  - [6.3 时空分区的抽象化](#63-时空分区的抽象化)
- [7 结论：领域模型视角下的 IoT 架构法则](#7-结论领域模型视角下的-iot-架构法则)
  - [7.1 领域语义的不可约简性](#71-领域语义的不可约简性)
  - [7.2 基础设施的通用化边界](#72-基础设施的通用化边界)
  - [7.3 架构设计的核心原则](#73-架构设计的核心原则)
- [8 2025 年 11 月趋势](#8-2025-年-11-月趋势)
  - [8.1 技术趋势](#81-技术趋势)
  - [8.2 架构演进](#82-架构演进)
- [9 总结](#9-总结)
- [10 参考资源](#10-参考资源)
  - [10.1 Wikipedia 资源](#101-wikipedia-资源)
  - [10.2 技术文档](#102-技术文档)
  - [10.3 相关文档](#103-相关文档)

---

## 1 概述

本文档从**领域模型视角**系统分析 IoT 架构中的业务硬核如何穿透基础设施消解，重点
阐述 IoT 核心领域模型、架构分层映射和云原生实践。

### 1.1 核心思想

> **基础设施的通用能力（容器/K8s）向上渗透，但 IoT 领域的核心语义（设备影子、规
> 则链、时空属性）因其强烈的业务契约性，反而成为架构中不可压缩的硬核层。**

### 1.2 文档定位

- **目标读者**：IoT 架构师、边缘计算工程师、领域驱动设计研究者
- **前置知识**：IoT、边缘计算、领域驱动设计
- **关联文档**：
  - [`../02-semantic-model-perspective/02-irreducibility-of-domain-semantics.md`](../02-semantic-model-perspective/02-irreducibility-of-domain-semantics.md) -
    领域语义无法通用化的本质原因
  - [`../03-layered-disintegration-law/01-introduction.md`](../03-layered-disintegration-law/01-introduction.md) -
    分层消解律概述

---

## 2 IoT 核心领域模型：不可消解的业务实体

### 2.1 领域实体与第一性原理

**IoT 核心领域模型**：

```plaintext
┌────────────────────────────────────────────────────────┐
│ 层5：IoT业务语义硬核层（不可消解）                      │
├────────────────────────────────────────────────────────┤
│ 实体1：设备影子（Device Shadow）                        │
│ - 本质：设备数字孪生，强一致性状态机                    │
│ - 不变性：reported/desired状态差异必须显式同步          │
│ - 业务规则：OTA升级时desired状态锁定，防止指令覆盖      │
│                                                        │
│ 实体2：规则链（Rule Chain）                            │
│ - 本质：事件驱动的业务决策流                            │
│ - 不变性：规则触发顺序影响业务结果（时序敏感）          │
│ - 业务规则："温度>80℃ 且 持续5分钟"才触发告警          │
│                                                        │
│ 实体3：时空分区（Time-Location Sharding）             │
│ - 本质：设备数据按地理/时间分片策略                     │
│ - 不变性：时序数据必须按时间区间聚合（降采样）          │
│ - 业务规则：3个月前数据自动归档至S3 Glacier             │
│                                                        │
│ 实体4：设备认证生命周期（Device Certificate Lifecycle）│
│ - 本质：设备身份的可信链管理                            │
│ - 不变性：证书过期前必须自动续期                        │
│ - 业务规则：设备离线超过30天需重新认证                  │
└────────────────────────────────────────────────────────┘
```

### 2.2 设备影子（Device Shadow）

**设备影子（Device Shadow）核心特征**：

- **本质**：设备数字孪生，强一致性状态机
- **不变性**：reported/desired 状态差异必须显式同步
- **业务规则**：OTA 升级时 desired 状态锁定，防止指令覆盖

**为何无法消解**：

- **强一致性**：设备影子需要强一致性，K8s 无法保证
- **状态机**：设备影子是状态机，K8s 无法理解
- **业务规则**：OTA 升级规则是业务规则，K8s 无法理解

### 2.3 规则链（Rule Chain）

**规则链（Rule Chain）核心特征**：

- **本质**：事件驱动的业务决策流
- **不变性**：规则触发顺序影响业务结果（时序敏感）
- **业务规则**："温度>80℃ 且 持续 5 分钟"才触发告警

**为何无法消解**：

- **时序敏感**：规则触发顺序是时序敏感的，K8s 无法理解
- **业务规则**：规则触发条件是业务规则，K8s 无法理解
- **事件驱动**：规则链是事件驱动的，K8s 无法理解

### 2.4 时空分区（Time-Location Sharding）

**时空分区（Time-Location Sharding）核心特征**：

- **本质**：设备数据按地理/时间分片策略
- **不变性**：时序数据必须按时间区间聚合（降采样）
- **业务规则**：3 个月前数据自动归档至 S3 Glacier

**为何无法消解**：

- **地理分片**：设备数据按地理分片是业务规则，K8s 无法理解
- **时间分片**：设备数据按时间分片是业务规则，K8s 无法理解
- **降采样**：时序数据降采样是业务规则，K8s 无法理解

### 2.5 设备认证生命周期（Device Certificate Lifecycle）

**设备认证生命周期（Device Certificate Lifecycle）核心特征**：

- **本质**：设备身份的可信链管理
- **不变性**：证书过期前必须自动续期
- **业务规则**：设备离线超过 30 天需重新认证

**为何无法消解**：

- **可信链管理**：设备身份的可信链管理是业务规则，K8s 无法理解
- **证书续期**：证书过期前必须自动续期是业务规则，K8s 无法理解
- **离线检测**：设备离线超过 30 天需重新认证是业务规则，K8s 无法理解

---

## 3 IoT 架构的分层映射：领域驱动的基础设施选择

### 3.1 领域模型到基础设施的映射

**领域模型到基础设施的映射**：

| 领域实体             | 基础设施选择        | 映射关系                   |
| -------------------- | ------------------- | -------------------------- |
| **设备影子**         | AWS IoT Shadow/自研 | 必须自研（K8s 无对应概念） |
| **规则链**           | AWS IoT Rules/自研  | 必须自研（K8s 无对应概念） |
| **时空分区**         | 时序数据库/自研     | 必须自研（K8s 无对应概念） |
| **设备认证生命周期** | 证书管理/自研       | 必须自研（K8s 无对应概念） |

### 3.2 基础设施选择原则

**基础设施选择原则**：

- **领域驱动**：基础设施选择由领域模型驱动
- **不可消解**：领域语义无法被通用框架消解
- **必须显性设计**：领域语义必须显性设计

---

## 4 顽固残留的领域语义：IoT 架构的"硬核三脚架"

### 4.1 设备影子同步

**设备影子同步**：

- **强一致性**：设备影子需要强一致性，K8s 无法保证
- **状态机**：设备影子是状态机，K8s 无法理解
- **业务规则**：OTA 升级规则是业务规则，K8s 无法理解

**核心结论**：设备影子同步是**领域语义**，无法被通用框架消解。

### 4.2 规则链执行

**规则链执行**：

- **时序敏感**：规则触发顺序是时序敏感的，K8s 无法理解
- **业务规则**：规则触发条件是业务规则，K8s 无法理解
- **事件驱动**：规则链是事件驱动的，K8s 无法理解

**核心结论**：规则链执行是**领域语义**，无法被通用框架消解。

### 4.3 时空分区策略

**时空分区策略**：

- **地理分片**：设备数据按地理分片是业务规则，K8s 无法理解
- **时间分片**：设备数据按时间分片是业务规则，K8s 无法理解
- **降采样**：时序数据降采样是业务规则，K8s 无法理解

**核心结论**：时空分区策略是**领域语义**，无法被通用框架消解。

---

## 5 云原生 IoT 架构实践：领域层如何"寄生"于通用层

### 5.1 K8s 原生资源的不匹配

**K8s 原生资源的不匹配**：

- **Deployment**：K8s Deployment 无法理解设备影子
- **Job**：K8s Job 无法理解规则链
- **StatefulSet**：K8s StatefulSet 无法理解时空分区

**核心结论**：**K8s 的 Deployment/Job 语义与 IoT OTA 的领域模型存在根本性错
配**——前者关注 Pod 生命周期，后者关注设备状态机。

### 5.2 领域层"寄生"策略

**领域层"寄生"策略**：

- **CRD 扩展**：通过 CRD 扩展 K8s API，定义领域模型
- **Operator 实现**：通过 Operator 实现领域逻辑
- **Sidecar 模式**：通过 Sidecar 模式实现领域语义

**典型案例**：

```yaml
# 领域层"寄生"于通用层
apiVersion: iot.example.com/v1
kind: DeviceShadow
metadata:
  name: device-001
spec:
  deviceId: "device-001"
  reported:
    temperature: 25
    humidity: 60
  desired:
    temperature: 26
    humidity: 65
  # 领域语义：OTA升级时desired状态锁定
  otaLock: true
```

### 5.3 典型案例

**典型案例：设备影子同步**：

```yaml
# 领域层"寄生"于通用层
apiVersion: iot.example.com/v1
kind: DeviceShadow
metadata:
  name: device-001
spec:
  deviceId: "device-001"
  reported:
    temperature: 25
    humidity: 60
  desired:
    temperature: 26
    humidity: 65
  # 领域语义：OTA升级时desired状态锁定
  otaLock: true
```

**核心优势**：

- **领域语义表达**：直接表达领域语义，无需编写代码
- **K8s 集成**：完全集成 K8s 生态
- **可扩展性**：通过 CRD 扩展 K8s API

---

## 6 IoT 领域的"二次消解"现象

### 6.1 设备影子协议的标准化

**设备影子协议的标准化**：

- **AWS IoT Shadow**：AWS IoT Shadow 协议成为标准
- **MQTT Device Shadow**：MQTT Device Shadow 协议成为标准
- **领域特定基础设施**：设备影子协议下沉为领域特定基础设施

### 6.2 规则链引擎的通用化

**规则链引擎的通用化**：

- **AWS IoT Rules**：AWS IoT Rules 引擎成为标准
- **规则链引擎**：规则链引擎成为通用组件
- **领域特定基础设施**：规则链引擎下沉为领域特定基础设施

### 6.3 时空分区的抽象化

**时空分区的抽象化**：

- **时序数据库**：时序数据库成为标准
- **时空分区策略**：时空分区策略成为通用组件
- **领域特定基础设施**：时空分区策略下沉为领域特定基础设施

---

## 7 结论：领域模型视角下的 IoT 架构法则

### 7.1 领域语义的不可约简性

**领域语义的不可约简性**：

- **设备影子**：设备影子是领域语义，无法被通用框架消解
- **规则链**：规则链是领域语义，无法被通用框架消解
- **时空分区**：时空分区是领域语义，无法被通用框架消解

### 7.2 基础设施的通用化边界

**基础设施的通用化边界**：

- **K8s 能力边界**：K8s 无法理解设备影子、规则链、时空分区
- **通用框架能力边界**：通用框架无法理解 IoT 领域语义
- **领域层设计必要性**：领域层设计是必要的，无法被通用框架消解

### 7.3 架构设计的核心原则

**架构设计的核心原则**：

- **领域驱动**：基础设施选择由领域模型驱动
- **不可消解**：领域语义无法被通用框架消解
- **必须显性设计**：领域语义必须显性设计

---

## 8 2025 年 11 月趋势

### 8.1 技术趋势

**2025 年 11 月技术趋势**：

1. **设备影子协议标准化**：AWS IoT Shadow 协议成为标准
2. **规则链引擎通用化**：规则链引擎成为通用组件
3. **时空分区抽象化**：时空分区策略成为通用组件

### 8.2 架构演进

**架构演进方向**：

- **领域特定基础设施**：设备影子、规则链、时空分区下沉为领域特定基础设施
- **零开销抽象**：通过 WebAssembly 和 eBPF 实现零开销抽象
- **语义栈收敛**：领域语义层 = 通用框架层

---

## 9 总结

**从领域模型视角看 IoT：业务硬核如何穿透基础设施消解核心结论**：

1. **领域语义的不可约简性**：设备影子、规则链、时空分区是领域语义，无法被通用框
   架消解
2. **基础设施的通用化边界**：K8s 无法理解 IoT 领域语义，必须显性设计
3. **架构设计的核心原则**：领域驱动、不可消解、必须显性设计
4. **二次消解现象**：设备影子、规则链、时空分区下沉为领域特定基础设施

**核心结论**：基础设施的通用能力（容器/K8s）向上渗透，但 IoT 领域的核心语义（设
备影子、规则链、时空属性）因其强烈的业务契约性，反而成为架构中不可压缩的硬核层。
这并非技术债务，而是**语义分工的必然结果**。

---

## 10 参考资源

### 10.1 Wikipedia 资源

- [Internet of things](https://en.wikipedia.org/wiki/Internet_of_things)
- [Edge computing](https://en.wikipedia.org/wiki/Edge_computing)
- [Device shadow](https://en.wikipedia.org/wiki/Device_shadow)

### 10.2 技术文档

- [AWS IoT Core Documentation](https://docs.aws.amazon.com/iot/)
- [KubeEdge Documentation](https://kubeedge.io/)
- [K3s Documentation](https://k3s.io/)

### 10.3 相关文档

- [`../02-semantic-model-perspective/02-irreducibility-of-domain-semantics.md`](../02-semantic-model-perspective/02-irreducibility-of-domain-semantics.md) -
  领域语义无法通用化的本质原因
- [`../03-layered-disintegration-law/01-introduction.md`](../03-layered-disintegration-law/01-introduction.md) -
  分层消解律概述
- [`01-spark-semantic-layering.md`](01-spark-semantic-layering.md) - Spark 软件
  栈的语义分层模型

---

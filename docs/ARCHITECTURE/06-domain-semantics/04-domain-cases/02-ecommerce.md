# 电商交易领域：购物车的不可消解性

## 📑 目录

- [📑 目录](#-目录)
- [1. 概述](#1-概述)
  - [1.1 核心思想](#11-核心思想)
  - [1.2 文档定位](#12-文档定位)
- [2. 电商核心领域模型：不可消解的业务实体](#2-电商核心领域模型不可消解的业务实体)
  - [2.1 购物车（Shopping Cart）](#21-购物车shopping-cart)
  - [2.2 促销计算（Promotion Calculation）](#22-促销计算promotion-calculation)
  - [2.3 订单状态机（Order State Machine）](#23-订单状态机order-state-machine)
- [3. 电商架构的分层映射：领域驱动的基础设施选择](#3-电商架构的分层映射领域驱动的基础设施选择)
- [4. 顽固残留的领域语义：电商架构的"硬核三脚架"](#4-顽固残留的领域语义电商架构的硬核三脚架)
- [5. 云原生电商架构实践](#5-云原生电商架构实践)
- [6. 总结](#6-总结)
- [7. 参考资源](#7-参考资源)

---

## 1. 概述

本文档从**领域模型视角**系统分析电商交易领域中的业务硬核如何穿透基础设施消解，重点
阐述购物车、促销计算、订单状态机等核心领域模型。

### 1.1 核心思想

> **基础设施的通用能力（容器/K8s）向上渗透，但电商领域的核心语义（购物车、促销计
> 算、订单状态机）因其强烈的业务契约性，反而成为架构中不可压缩的硬核层。**

### 1.2 文档定位

- **目标读者**：电商架构师、业务系统工程师、领域驱动设计研究者
- **前置知识**：电商业务、分布式系统、领域驱动设计
- **关联文档**：
  - [`../02-semantic-model-perspective/02-irreducibility-of-domain-semantics.md`](../02-semantic-model-perspective/02-irreducibility-of-domain-semantics.md) -
    领域语义无法通用化的本质原因
  - [`../03-layered-disintegration-law/01-introduction.md`](../03-layered-disintegration-law/01-introduction.md) -
    分层消解律概述

---

## 2. 电商核心领域模型：不可消解的业务实体

### 2.1 购物车（Shopping Cart）

**购物车核心特征**：

- **本质**：用户会话状态，强一致性要求
- **不变性**：购物车商品数量、价格必须实时同步
- **业务规则**：库存不足时自动移除商品，促销过期时自动更新价格

**为何无法消解**：

- **会话状态**：购物车是会话状态，K8s 无法理解
- **强一致性**：购物车需要强一致性，K8s 无法保证
- **业务规则**：库存检查、价格计算是业务规则，K8s 无法理解

### 2.2 促销计算（Promotion Calculation）

**促销计算核心特征**：

- **本质**：复杂的业务规则引擎
- **不变性**：促销规则优先级影响最终价格
- **业务规则**："满100减20"与"8折优惠"不能同时使用

**为何无法消解**：

- **业务规则**：促销规则是业务规则，K8s 无法理解
- **优先级**：促销规则优先级是业务规则，K8s 无法理解
- **计算逻辑**：促销计算逻辑是业务规则，K8s 无法理解

### 2.3 订单状态机（Order State Machine）

**订单状态机核心特征**：

- **本质**：订单生命周期的状态转换
- **不变性**：订单状态转换必须遵循业务规则
- **业务规则**：已支付订单不能取消，已发货订单不能退款

**为何无法消解**：

- **状态机**：订单状态机是状态机，K8s 无法理解
- **业务规则**：状态转换规则是业务规则，K8s 无法理解
- **补偿逻辑**：订单取消、退款是补偿逻辑，K8s 无法理解

---

## 3. 电商架构的分层映射：领域驱动的基础设施选择

**电商架构分层映射**：

```plaintext
┌────────────────────────────────────────────────────────┐
│ 层5：电商业务语义硬核层（不可消解）                      │
│ - 购物车、促销计算、订单状态机                           │
│ 消解率：0%                                               │
└────────────────────────────────────────────────────────┘
                         ↓ 依赖
┌────────────────────────────────────────────────────────┐
│ 层4：分布式系统语义层（部分消解）                         │
│ - 服务发现、负载均衡、容错                               │
│ 消解率：80%（K8s原生支持）                               │
└────────────────────────────────────────────────────────┘
                         ↓ 依赖
┌────────────────────────────────────────────────────────┐
│ 层3：通用基础设施语义层（完全消解）                       │
│ - 容器隔离、网络、存储                                   │
│ 消解率：100%（K8s基础设施）                               │
└────────────────────────────────────────────────────────┘
```

---

## 4. 顽固残留的领域语义：电商架构的"硬核三脚架"

1. **购物车同步**：购物车状态必须实时同步，无法被通用框架消解
2. **促销计算**：促销规则计算是业务规则，无法被通用框架消解
3. **订单状态机**：订单状态转换是业务规则，无法被通用框架消解

---

## 5. 云原生电商架构实践

**云原生电商架构策略**：

- **购物车**：使用 Redis 存储购物车状态，K8s 管理 Redis 集群
- **促销计算**：使用规则引擎（如 Drools），K8s 管理规则引擎服务
- **订单状态机**：使用状态机引擎（如 Temporal），K8s 管理状态机服务

---

## 6. 总结

**电商领域的核心启示**：

1. **购物车、促销计算、订单状态机是电商领域的核心知识**
2. **这些领域语义无法被通用框架消解**
3. **云原生电商架构需要领域层"寄生"于通用层**

---

## 7. 参考资源

### 7.1 Wikipedia 资源

- [E-commerce](https://en.wikipedia.org/wiki/E-commerce) - 电子商务
- [State Machine](https://en.wikipedia.org/wiki/Finite-state_machine) - 状态机
- [Business Rules](https://en.wikipedia.org/wiki/Business_rule) - 业务规则

### 7.2 相关文档

- [`../02-semantic-model-perspective/02-irreducibility-of-domain-semantics.md`](../02-semantic-model-perspective/02-irreducibility-of-domain-semantics.md) -
  领域语义无法通用化的本质原因
- [`../03-layered-disintegration-law/01-introduction.md`](../03-layered-disintegration-law/01-introduction.md) -
  分层消解律概述

---

**最后更新**：2025-11-08 **维护者**：项目团队


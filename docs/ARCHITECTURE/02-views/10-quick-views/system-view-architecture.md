# 系统视角架构视图

**版本**：v1.0 **最后更新**：2025-11-07 **维护者**：项目团队

## 📑 目录

- [📑 目录](#-目录)
- [1 视图概述](#1-视图概述)
  - [1.1 视图目标](#11-视图目标)
  - [1.2 参考文档](#12-参考文档)
- [2 7 层模型可视化](#2-7-层模型可视化)
  - [2.1 整体层次结构](#21-整体层次结构)
  - [2.2 层间依赖关系](#22-层间依赖关系)
- [3 4 域模型可视化](#3-4-域模型可视化)
  - [3.1 域间关系](#31-域间关系)
  - [3.2 域在每层的体现](#32-域在每层的体现)
- [4 三层路线映射](#4-三层路线映射)
  - [4.1 虚拟化在 7 层中的映射](#41-虚拟化在-7-层中的映射)
  - [4.2 容器化在 7 层中的映射](#42-容器化在-7-层中的映射)
  - [4.3 沙盒化在 7 层中的映射](#43-沙盒化在-7-层中的映射)
- [5 分布式系统视图](#5-分布式系统视图)
  - [5.1 节点级视图](#51-节点级视图)
  - [5.2 故障域视图](#52-故障域视图)
- [6 交互视图](#6-交互视图)
  - [6.1 控制流交互](#61-控制流交互)
  - [6.2 数据流交互](#62-数据流交互)
  - [6.3 元数据流交互](#63-元数据流交互)
- [7 选型决策视图](#7-选型决策视图)
  - [7.1 技术选型矩阵](#71-技术选型矩阵)
  - [7.2 混合部署视图](#72-混合部署视图)
- [8 性能视图](#8-性能视图)
  - [8.1 性能对比](#81-性能对比)
  - [8.2 成本视图](#82-成本视图)
- [9 安全视图](#9-安全视图)
  - [9.1 攻击面对比](#91-攻击面对比)
  - [9.2 隔离等级](#92-隔离等级)
- [10 未来趋势视图](#10-未来趋势视图)
  - [10.1 技术收敛](#101-技术收敛)
  - [10.2 统一抽象](#102-统一抽象)
- [11 结论](#11-结论)
  - [11.1 视图价值](#111-视图价值)
  - [11.2 应用场景](#112-应用场景)

---

## 1 视图概述

本文档提供 `system_view.md` 提出的"7 层 4 域"模型的完整架构视图，包括可视化图表
和交互关系。

### 1.1 视图目标

- **可视化 7 层模型**：从硬件到应用交付的完整技术栈
- **可视化 4 域模型**：控制面、数据面、元数据面、安全面的关系
- **映射三层路线**：虚拟化、容器化、沙盒化在 7 层中的位置
- **展示分布式系统**：完整的分布式系统架构视图

### 1.2 参考文档

- **理论论
  证**：[`../00-theory/07-system-model/7-layer-4-domain-formalization.md`](../00-theory/07-system-model/7-layer-4-domain-formalization.md)
- **系统视角**：[`../../system_view.md`](../../system_view.md)
- **整合指南**：[`../SYSTEM-VIEW-INTEGRATION.md`](../SYSTEM-VIEW-INTEGRATION.md)

---

## 2 7 层模型可视化

### 2.1 整体层次结构

```text
┌─────────────────────────────────────────────────────────┐
│ L7 应用交付层                                            │
│ CI/CD, GitOps, Artifact, Marketplace, Serverless       │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L6 可观测性 & 故障治理                                    │
│ Tracing, Log, Metric, Chaos, Root-Cause                 │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L5 控制面 & 治理                                         │
│ API Server, RBAC, Policy, Quota, Audit                 │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L4 分布式数据面                                          │
│ 网络, 存储, 消息, GPU 内存, Cache                        │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L3 分布式调度层                                          │
│ Placement, Live-Migration, Autoscaling, Topology        │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L2 计算虚拟层                                            │
│ Hypervisor, Container Runtime, Sandbox Runtime          │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L1 硬件资源层                                            │
│ CPU, Memory, I/O, Accelerator, RAS                      │
└─────────────────────────────────────────────────────────┘
```

### 2.2 层间依赖关系

```text
L7 依赖于 L1-L6
  └─> L6 依赖于 L1-L5
      └─> L5 依赖于 L1-L4
          └─> L4 依赖于 L1-L3
              └─> L3 依赖于 L1-L2
                  └─> L2 依赖于 L1
                      └─> L1 基础层
```

---

## 3 4 域模型可视化

### 3.1 域间关系

```text
┌─────────────────────────────────────────────────────────┐
│                     系统边界                              │
│                                                          │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐ │
│  │ 控制面 CP │  │ 数据面 DP │  │元数据面MD│  │ 安全面SEC│ │
│  │          │  │          │  │          │  │          │ │
│  │ 最终一致  │  │毫秒级确定│  │强一致/   │  │零信任+   │ │
│  │          │  │          │  │分布式共识│  │最小权限   │ │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘ │
│       │            │            │            │          │
│       └────────────┼────────────┼────────────┘          │
│                  │            │                       │
│               ┌──┴────────────┴──┐                    │
│               │   业务逻辑层      │                    │
│               └──────────────────┘                    │
└─────────────────────────────────────────────────────────┘
```

### 3.2 域在每层的体现

**L1 硬件资源层**：

- CP：硬件资源管理策略
- DP：CPU、内存、I/O 的实际操作
- MD：资源拓扑和状态
- SEC：IOMMU、硬件安全模块

**L2 计算虚拟层**：

- CP：虚拟化策略配置
- DP：VM/Container/Sandbox 的实际运行
- MD：镜像、快照、状态
- SEC：SELinux、Seccomp、AppArmor

**L3 分布式调度层**：

- CP：调度策略和规则
- DP：实际的调度决策执行
- MD：集群状态和拓扑
- SEC：调度安全策略

**L4 分布式数据面**：

- CP：网络和存储策略
- DP：实际的数据传输
- MD：路由表和存储映射
- SEC：mTLS、加密、访问控制

**L5 控制面 & 治理**：

- CP：API 网关和策略引擎
- DP：策略执行和数据流
- MD：配置和状态管理
- SEC：RBAC、审计、合规

**L6 可观测性 & 故障治理**：

- CP：监控策略和告警规则
- DP：指标采集和日志收集
- MD：时间序列数据和追踪
- SEC：安全事件和审计日志

**L7 应用交付层**：

- CP：CI/CD 策略和流程
- DP：实际的构建和部署
- MD：镜像仓库和版本管理
- SEC：签名验证和供应链安全

---

## 4 三层路线映射

### 4.1 虚拟化在 7 层中的映射

```text
┌─────────────────────────────────────────────────────────┐
│ L7 应用交付层                                            │
│ [VM 镜像市场]                                            │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L6 可观测性 & 故障治理                                    │
│ [guest 内监控]                                            │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L5 控制面 & 治理                                         │
│ [Nova API, Keystone]                                     │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L4 分布式数据面                                          │
│ [OVS-DPDK, SR-IOV, Cinder]                              │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L3 分布式调度层                                          │
│ [Nova Scheduler, vMotion]                                │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L2 计算虚拟层                                            │
│ [QEMU/KVM, Hypervisor]                                   │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L1 硬件资源层                                            │
│ [VT-x/AMD-V, EPT/NPT, IOMMU]                            │
└─────────────────────────────────────────────────────────┘
         ↑ 虚拟化主要在 L1-L3，L4 起完整复制
```

### 4.2 容器化在 7 层中的映射

```text
┌─────────────────────────────────────────────────────────┐
│ L7 应用交付层                                            │
│ [OCI 镜像, Harbor, Helm]                                │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L6 可观测性 & 故障治理                                    │
│ [Prometheus, cAdvisor]                                   │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L5 控制面 & 治理                                         │
│ [kube-apiserver, OPA]                                    │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L4 分布式数据面                                          │
│ [CNI, CSI, Service Mesh]                                 │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L3 分布式调度层                                          │
│ [K8s Scheduler, HPA]                                     │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L2 计算虚拟层                                            │
│ [containerd, runC, overlayfs]                            │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L1 硬件资源层                                            │
│ [cgroups, namespace, 共享内核]                           │
└─────────────────────────────────────────────────────────┘
         ↑ 容器化主要在 L2-L3，L4 共享
```

### 4.3 沙盒化在 7 层中的映射

```text
┌─────────────────────────────────────────────────────────┐
│ L7 应用交付层                                            │
│ [OCI + WASM, wasm-to-oci]                                │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L6 可观测性 & 故障治理                                    │
│ [syscall trace, WASM span]                               │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L5 控制面 & 治理                                         │
│ [RuntimeClass, WASM Component Model]                     │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L4 分布式数据面                                          │
│ [wasi-socket, virtio-fs]                                 │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L3 分布式调度层                                          │
│ [Firecracker snapshot]                                   │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L2 计算虚拟层                                            │
│ [gVisor Sentry, Firecracker, WASM Runtime]              │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ L1 硬件资源层                                            │
│ [KVM 子集, 线性内存, 无 DMA]                            │
└─────────────────────────────────────────────────────────┘
         ↑ 沙盒化切口灵活，根据实现不同映射不同层
```

---

## 5 分布式系统视图

### 5.1 节点级视图

```text
节点 A                         节点 B                         节点 C
┌─────────────┐              ┌─────────────┐              ┌─────────────┐
│ L7 应用交付  │              │ L7 应用交付  │              │ L7 应用交付  │
│ L6 可观测性  │              │ L6 可观测性  │              │ L6 可观测性  │
│ L5 控制面    │◄────────────►│ L5 控制面    │◄────────────►│ L5 控制面    │
│ L4 数据面    │◄────────────►│ L4 数据面    │◄────────────►│ L4 数据面    │
│ L3 调度层    │              │ L3 调度层    │              │ L3 调度层    │
│ L2 虚拟层    │              │ L2 虚拟层    │              │ L2 虚拟层    │
│ L1 硬件资源  │              │ L1 硬件资源  │              │ L1 硬件资源  │
└─────────────┘              └─────────────┘              └─────────────┘
       │                            │                            │
       └────────────────────────────┼────────────────────────────┘
                                   │
                          ┌─────────────────┐
                          │  共享存储/网络   │
                          └─────────────────┘
```

### 5.2 故障域视图

```text
故障域层级：
┌─────────────────────────────────────────────────────────┐
│ Region 级故障域（L5-L7）                                 │
│ [控制面、应用交付]                                        │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ Zone 级故障域（L3-L4）                                    │
│ [调度、网络、存储]                                        │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ 节点级故障域（L1-L2）                                     │
│ [硬件、虚拟化]                                           │
└─────────────────────────────────────────────────────────┘
                        │
┌─────────────────────────────────────────────────────────┐
│ 实例级故障域（L2）                                        │
│ [VM/Container/Sandbox]                                   │
└─────────────────────────────────────────────────────────┘
```

---

## 6 交互视图

### 6.1 控制流交互

```text
用户请求
    │
    ▼
┌─────────────┐
│ L7 API      │
└─────────────┘
    │
    ▼
┌─────────────┐
│ L5 策略引擎  │─────► 决策
└─────────────┘
    │
    ▼
┌─────────────┐
│ L3 调度器    │─────► 选择节点
└─────────────┘
    │
    ▼
┌─────────────┐
│ L2 运行时    │─────► 创建实例
└─────────────┘
    │
    ▼
┌─────────────┐
│ L1 硬件资源  │─────► 分配资源
└─────────────┘
```

### 6.2 数据流交互

```text
应用数据
    │
    ▼
┌─────────────┐
│ L4 数据面    │─────► 网络转发
└─────────────┘
    │
    ▼
┌─────────────┐
│ L2 虚拟层    │─────► 数据隔离
└─────────────┘
    │
    ▼
┌─────────────┐
│ L1 硬件资源  │─────► 物理传输
└─────────────┘
```

### 6.3 元数据流交互

```text
配置变更
    │
    ▼
┌─────────────┐
│ L5 控制面    │─────► 策略更新
└─────────────┘
    │
    ▼
┌─────────────┐
│ MD 元数据面  │─────► 状态同步
└─────────────┘
    │
    ▼
┌─────────────┐
│ L1-L7 各层   │─────► 配置生效
└─────────────┘
```

---

## 7 选型决策视图

### 7.1 技术选型矩阵

```text
                   虚拟化    容器化    沙盒化
启动延迟          ⭐⭐      ⭐⭐⭐    ⭐⭐⭐⭐
内存占用          ⭐        ⭐⭐⭐    ⭐⭐⭐⭐
CPU 性能         ⭐⭐⭐⭐   ⭐⭐⭐⭐⭐ ⭐⭐⭐
安全隔离         ⭐⭐⭐⭐⭐ ⭐⭐      ⭐⭐⭐⭐
合规性           ⭐⭐⭐⭐⭐ ⭐        ⭐⭐⭐⭐
密度             ⭐        ⭐⭐⭐⭐⭐ ⭐⭐⭐⭐
```

### 7.2 混合部署视图

```text
┌─────────────────────────────────────────────────────────┐
│                   统一调度层 (L3)                        │
│                                                          │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐                │
│  │ 虚拟化 VM │  │ 容器 Pod │  │ 沙盒实例 │                │
│  │          │  │          │  │          │                │
│  │ 合规业务  │  │ 内部业务  │  │ 外部代码  │                │
│  └──────────┘  └──────────┘  └──────────┘                │
│       │            │            │                        │
│       └────────────┼────────────┘                        │
│                    │                                    │
│            ┌───────┴───────┐                            │
│            │  统一数据面    │                            │
│            │  (L4)         │                            │
│            └───────────────┘                            │
└─────────────────────────────────────────────────────────┘
```

---

## 8 性能视图

### 8.1 性能对比

```text
维度对比：
启动延迟:    VM(20-40s) > 容器(100-300ms) > Firecracker(125ms) > WASM(5ms)
内存占用:    VM(128-256MB) > gVisor(30MB) > 容器(10-20MB) > Firecracker(5MB) > WASM(<1MB)
CPU 性能:    容器(99-100%) > VM(95-98%) > Firecracker(95%) > gVisor(85-90%) > WASM(70-95%)
网络延迟:    容器(52µs) < VM(55-60µs) < Firecracker(55µs) < gVisor(65µs)
```

### 8.2 成本视图

```text
TCO 对比（1000 核集群 3 年）：
虚拟化:     $XXX (硬件 + 运维人力)
容器化:     $YYY (K8s 专家 + 内存节省)
Firecracker: $ZZZ (rust-vmm 人才 + 内存极致优化)
WASM:       $AAA (调试工具链 + 极致密度)
```

---

## 9 安全视图

### 9.1 攻击面对比

```text
攻击面大小：
VM:       QEMU 400+ CVE，但 guest 内核隔离
容器:     内核共享，内核 CVE 直接宿主沦陷
gVisor:   113 个 syscall 白名单，内核攻击面 ≈0
Firecracker: 5 个 virtio，CVE 面 <10
WASM:     无 POSIX，攻击面最小，但面临 Spectre
```

### 9.2 隔离等级

```text
隔离等级：
虚拟化:   硬件级隔离 ✅ PCI-DSS
容器:     OS 级隔离 ⚠️ 需追加 Seccomp/AppArmor
gVisor:   硬件级隔离 ✅ FedRAMP High
Firecracker: 硬件级隔离 ✅ AWS Nitro Enclave
WASM:     内存安全隔离 ✅ 但需 Spectre 缓解
```

---

## 10 未来趋势视图

### 10.1 技术收敛

```text
收敛方向：
MicroVM + 容器镜像 = 新"默认单元"
  ├─> Firecracker/Cloud Hypervisor/QEMU microvm
  └─> KubeVirt-Containerd-Firecracker 一体化

WASI 组件模型 = "语言级沙盒"与"云原生"打通
  ├─> WASI 0.2 capability-based 接口
  └─> Envoy/Istio sidecar WASM filter
```

### 10.2 统一抽象

```text
统一抽象层：
调度层:   K8s 统一
数据面:   virtio/eBPF 统一
交付层:   OCI 统一
观测面:   统一 label

未来云内核 = MicroVM 隔离 + 容器密度 + WASM 冷启动
```

---

## 11 结论

### 11.1 视图价值

✅ **完整性**：7 层 4 域模型的完整可视化 ✅ **清晰性**：三层路线在模型中的清晰映
射 ✅ **实用性**：选型决策和性能对比的可视化 ✅ **前瞻性**：未来趋势和技术收敛的
可视化

### 11.2 应用场景

1. **架构设计**：快速理解系统架构
2. **技术选型**：基于可视化矩阵选型
3. **性能优化**：识别性能瓶颈
4. **安全加固**：理解安全攻击面

---

**相关文档**：

- [`../00-theory/07-system-model/7-layer-4-domain-formalization.md`](../00-theory/07-system-model/7-layer-4-domain-formalization.md) -
  理论论证
- [`../../system_view.md`](../../system_view.md) - 系统视角文档
- [`../SYSTEM-VIEW-INTEGRATION.md`](../SYSTEM-VIEW-INTEGRATION.md) - 整合指南

---

**更新时间**：2025-11-05 **版本**：v1.0 **维护者**：基于 system_view.md 7 层 4
域模型架构视图

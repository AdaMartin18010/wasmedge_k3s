# OPA åœ¨ä¸­å±‚æ¨¡å‹ä¸­çš„å®šä½

## ğŸ“‘ ç›®å½•

- [OPA åœ¨ä¸­å±‚æ¨¡å‹ä¸­çš„å®šä½](#opa-åœ¨ä¸­å±‚æ¨¡å‹ä¸­çš„å®šä½)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1 æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æ ¸å¿ƒå‘½é¢˜](#11-æ ¸å¿ƒå‘½é¢˜)
  - [2 ç»Ÿä¸€ä¸­å±‚æ¨¡å‹ â„³ å›é¡¾](#2-ç»Ÿä¸€ä¸­å±‚æ¨¡å‹-â„³-å›é¡¾)
    - [2.1 æ¨¡å‹å®šä¹‰](#21-æ¨¡å‹å®šä¹‰)
    - [2.2 OPA çš„å®šä½](#22-opa-çš„å®šä½)
  - [3 OPA ä½“ç³»ç»“æ„ï¼ˆèŒƒç•´è®ºè§†è§’ï¼‰](#3-opa-ä½“ç³»ç»“æ„èŒƒç•´è®ºè§†è§’)
    - [3.1 å±‚æ¬¡ç»“æ„](#31-å±‚æ¬¡ç»“æ„)
    - [3.2 æ ¸å¿ƒç»„ä»¶](#32-æ ¸å¿ƒç»„ä»¶)
  - [4 OPA åœ¨å±‚æ¬¡æ¨¡å‹ä¸­çš„å®šä½](#4-opa-åœ¨å±‚æ¬¡æ¨¡å‹ä¸­çš„å®šä½)
    - [4.1 å„å±‚ä¸­çš„ OPA è§’è‰²](#41-å„å±‚ä¸­çš„-opa-è§’è‰²)
    - [4.2 æ˜ å°„çŸ©é˜µ](#42-æ˜ å°„çŸ©é˜µ)
  - [5 å…¬ç†å±‚â€”â€”æŠŠ"å®‰å…¨"å½¢å¼åŒ–](#5-å…¬ç†å±‚æŠŠå®‰å…¨å½¢å¼åŒ–)
    - [5.1 å…¬ç†å®šä¹‰](#51-å…¬ç†å®šä¹‰)
    - [5.2 åŸºç¡€å½’çº³æ­¥â€”â€”æ²¡æœ‰ OPA çš„æ—¶ä»£ï¼ˆn=0ï¼‰](#52-åŸºç¡€å½’çº³æ­¥æ²¡æœ‰-opa-çš„æ—¶ä»£n0)
  - [6 ç¬¬ä¸€æ¬¡å½’çº³æ˜ å°„â€”â€”æŠŠ"å®‰å…¨"å˜æˆæ•°æ® + è§„åˆ™](#6-ç¬¬ä¸€æ¬¡å½’çº³æ˜ å°„æŠŠå®‰å…¨å˜æˆæ•°æ®--è§„åˆ™)
  - [7 ç¬¬äºŒæ¬¡å½’çº³æ˜ å°„â€”â€”æŠŠ"èƒ½åŠ›é—­åŒ…"ä¸‹æ²‰åˆ°æ²™ç›’](#7-ç¬¬äºŒæ¬¡å½’çº³æ˜ å°„æŠŠèƒ½åŠ›é—­åŒ…ä¸‹æ²‰åˆ°æ²™ç›’)
  - [8 ç¬¬ä¸‰æ¬¡å½’çº³æ˜ å°„â€”â€”æŠŠ"æœåŠ¡é—´æƒé™"ç»„åˆåŒ–](#8-ç¬¬ä¸‰æ¬¡å½’çº³æ˜ å°„æŠŠæœåŠ¡é—´æƒé™ç»„åˆåŒ–)
  - [9 å°é—­è¯æ˜â€”â€”OPA è®© â„³ è·å¾—"å¯è¯æ˜å®‰å…¨"](#9-å°é—­è¯æ˜opa-è®©-â„³-è·å¾—å¯è¯æ˜å®‰å…¨)
  - [10 æ€»ç»“](#10-æ€»ç»“)

---

## 1 æ¦‚è¿°

æœ¬æ–‡æ¡£é˜è¿° **OPAï¼ˆOpen Policy Agentï¼‰** åœ¨**ç»Ÿä¸€ä¸­å±‚æ¨¡å‹ â„³** ä¸­çš„å®šä½å’Œä½œç”¨ï¼Œè¯
æ˜ OPA ä¸æ˜¯"åˆä¸€ä¸ªç­–ç•¥å¼•æ“"ï¼Œè€Œæ˜¯è®©"å‹ç¼©åçš„ä¸­å±‚ä¸–ç•Œ â„³"çœŸæ­£è·å¾— â‘  **å¯è¯æ˜å®‰å…¨
æ€§**ã€â‘¡ **å¯ç»„åˆçº¦æŸ**ã€â‘¢ **å¯ç‰ˆæœ¬æ²»ç†** çš„**æœ€åä¸€å—å½’çº³æ‹¼å›¾**ã€‚

### 1.1 æ ¸å¿ƒå‘½é¢˜

> **OPA æŠŠ"å®‰å…¨"ä»ä¸å¯é‡åŒ–çš„è¿ç»´ç„å­¦**ï¼Œ**å˜æˆäº†ä¸€æ®µå¯å•å…ƒæµ‹è¯•ã€å¯å½¢å¼åŒ–éªŒè¯ã€å¯
> ä¸ä¸šåŠ¡ä»£ç åŒç‰ˆæœ¬å›æ»šçš„ DSL**ï¼›äºæ˜¯è™šæ‹ŸåŒ–-å®¹å™¨åŒ–-æ²™ç›’åŒ–æ‰€å‹ç¼©å‡ºçš„ä¸­å±‚ä¸–ç•Œ â„³ï¼Œç»ˆ
> äº**åœ¨é€»è¾‘å±‚é¢é—­åˆ**â€”â€” **è®¡ç®—å¯è¯æ˜ã€èµ„æºå¯è¯æ˜ã€é€šä¿¡å¯è¯æ˜ã€å®‰å…¨äº¦å¯è¯æ˜**ã€‚

## 2 ç»Ÿä¸€ä¸­å±‚æ¨¡å‹ â„³ å›é¡¾

### 2.1 æ¨¡å‹å®šä¹‰

**å®šä¹‰**ï¼š â„³ â‰œ âŸ¨U, G, PâŸ©

- **U** = {uâ‚, uâ‚‚, â€¦, uâ‚™} è®¡ç®—å•å…ƒé›†åˆï¼ˆVM / Container / Sandboxï¼‰
- **G** = (V, E) ç»„åˆå›¾è°±ï¼ˆService + æµé‡è¾¹ï¼‰
- **P** = {elastic, security, observability} ç­–ç•¥å±‚

### 2.2 OPA çš„å®šä½

```text
â„³ = âŸ¨U, G, PâŸ©
â”‚
â”œâ”€Uï¼šè®¡ç®—å•å…ƒï¼ˆVM / Container / Sandboxï¼‰
â”œâ”€Gï¼šç»„åˆå›¾è°±ï¼ˆService + æµé‡è¾¹ï¼‰
â””â”€Pï¼šç­–ç•¥å±‚ = {elastic, security, observability}
        â†‘
        â•°â”€â”€ OPA è´Ÿè´£æŠŠ"security"ä»"äººè¯»åŸºçº¿"
            å˜æˆ"æœºè¯»å¯éªŒè¯çº¦æŸ"
```

> **ç›®æ ‡**ï¼šè¯æ˜ **OPA âŠ¨ â„³ å…·å¤‡å¯è¯æ˜å®‰å…¨æ€§ & å¯ç»„åˆçº¦æŸ & å¯ç‰ˆæœ¬æ²»ç†**

## 3 OPA ä½“ç³»ç»“æ„ï¼ˆèŒƒç•´è®ºè§†è§’ï¼‰

### 3.1 å±‚æ¬¡ç»“æ„

```text
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  OPA Control Plane  â”‚
            â”‚ (Centralised)       â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–²
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚   Policy Bundles â”‚
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–²
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚    OPA (PDP) + PEPs (policyâ€‘agents)   â”‚
   â”‚  (one per service or sidecar)         â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â–²
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚Application/Service   â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 æ ¸å¿ƒç»„ä»¶

| ç»„ä»¶                        | è¯´æ˜                                                                            | å…¸å‹æ¥å£                                          |
| --------------------------- | ------------------------------------------------------------------------------- | ------------------------------------------------- |
| **PDP**                     | Rego è¯„ä¼°å¼•æ“ï¼Œæ‰§è¡Œç­–ç•¥ã€è¿”å› allow/deny                                        | REST / gRPC `decision`                            |
| **PEP**                     | æœåŠ¡ã€sidecar æˆ– Admission Controller çš„"å‰ç½®å±‚"ï¼ŒæŠŠè¯·æ±‚ä¸Šä¸‹æ–‡ `input` é€ç»™ PDP | `opa/decision` API                                |
| **OCP** (OPA Control Plane) | é›†ä¸­ç®¡ç† bundleã€åˆ†å‘ã€å†³ç­–æ—¥å¿—ã€åŠ¨æ€é…ç½®                                       | REST/HTTP API (`/bundles`, `/logs`, `/discovery`) |
| **Bundle**                  | ä¸€ä¸ª Rego policy åŒ…å«ä¸€ç»„ policyã€æ•°æ®ä¸å…ƒæ•°æ®ï¼ŒGit ç‰ˆæœ¬åŒ–                      | `opa bundle create` / `opa bundle push`           |
| **Decision Log**            | è®°å½•æ¯ä¸€æ¬¡ PDP è¯„ä¼°ç»“æœï¼ˆwho, what, why)                                        | Log/Prometheus, e.g., `opa.log`                   |
| **Discovery**               | å‘ç°å¹¶é…ç½®è¿œç¨‹ OPA ä»£ç†ï¼ˆå¯è·¨é›†ç¾¤ï¼‰                                             | `opa discovery` API                               |

## 4 OPA åœ¨å±‚æ¬¡æ¨¡å‹ä¸­çš„å®šä½

### 4.1 å„å±‚ä¸­çš„ OPA è§’è‰²

| å±‚çº§                   | OPA è§’è‰²                                         | å…¸å‹å®ç°æ–¹å¼                                             | å…³é”®æ¥å£             |
| ---------------------- | ------------------------------------------------ | -------------------------------------------------------- | -------------------- |
| **åº•å±‚ â€“ è™šæ‹ŸåŒ–/ç¡¬ä»¶** | - å¯ä¿¡æ ¹ï¼ˆSGX/TLSï¼‰ <br> - ç­–ç•¥åˆ†é… (è°èƒ½è·‘ VM)  | `KVM â†’ Spiffe`                                           | `opaâ€‘bundleâ€‘vm`      |
| **å®¹å™¨/è¿è¡Œæ—¶å±‚**      | - è¿›ç¨‹æƒé™ã€é•œåƒç­¾å <br> - èµ„æºé™åˆ¶ï¼ˆCPU/å†…å­˜ï¼‰ | `k8sâ€‘RBAC` + `OPA Gatekeeper`                            | `opaâ€‘bundleâ€‘runtime` |
| **æ²™ç›’å±‚**             | - ç³»ç»Ÿè°ƒç”¨è¿‡æ»¤ <br> - ç»†ç²’åº¦è®¿é—®æ§åˆ¶             | `seccompâ€‘bpf â†’ OPA`                                      | `opaâ€‘sandboxâ€‘policy` |
| **Mesh/NSM å±‚**        | - è·¯ç”±/é™æµã€mTLSã€è¯·æ±‚/å“åº”éªŒè¯                 | `Istio/Linkerd sidecar â†’ OPA` <br> `NSM vWire â†’ OPA`     | `opaâ€‘meshâ€‘policy`    |
| **æ²»ç† & å®‰å…¨å±‚**      | - ç»Ÿä¸€å†³ç­–ã€æ—¥å¿—ã€ç›‘æ§                           | `OPA Control Plane` <br> `Gatekeeper`                    | `opaâ€‘bundleâ€‘global`  |
| **åŠ¨æ€è¿ç»´å±‚**         | - ç›‘æ§/å‘Šè­¦è§¦å‘ç­–ç•¥                              | `Prometheus/Tempo â†’ OPA` <br> `Argo CD` è§¦å‘ bundle æ›´æ–° | `opaâ€‘decisionâ€‘logs`  |

### 4.2 æ˜ å°„çŸ©é˜µ

```text
Layer                     | OPA åŠŸèƒ½
--------------------------|-------------------------------
Hardware/Hypervisor       |  ç­–ç•¥ï¼šVM å¯ç”¨å“ªäº›å†…å­˜/CPUã€å¯ä¿¡æ ¹
Runtime (container)       |  ç­–ç•¥ï¼šé•œåƒå±‚ã€cgroup è®¿é—®ã€èµ„æºé…é¢
Sandbox                   |  ç­–ç•¥ï¼šå…è®¸/æ‹’ç» syscallã€æ–‡ä»¶ç³»ç»Ÿ
Service Mesh              |  ç­–ç•¥ï¼šè·¯ç”±è§„åˆ™ã€ç†”æ–­ã€mTLSã€é€Ÿç‡é™åˆ¶
NSM                       |  ç­–ç•¥ï¼švWire è®¿é—®æ§åˆ¶ã€è·¨åŸŸè®¿é—®è®¸å¯
Application (ä¸šåŠ¡æœåŠ¡)    |  è°ƒç”¨ OPA åšè¯·æ±‚/éƒ¨ç½²/æ•°æ®è®¿é—®å†³ç­–
Governance & Security     |  OPA Control Planeã€Gatekeeperã€Auditing
Observability             |  è®°å½•å†³ç­–æ—¥å¿—ã€å†³ç­–æµé‡ã€çŠ¶æ€ç›‘æ§
Dynamic Operations        |  CI/CD è‡ªåŠ¨æµ‹è¯•ã€GitOps æ¨é€ Bundle
```

## 5 å…¬ç†å±‚â€”â€”æŠŠ"å®‰å…¨"å½¢å¼åŒ–

### 5.1 å…¬ç†å®šä¹‰

| å…¬ç†          | å½¢å¼åŒ–æè¿°                         | OPA å¯¹åº”å®ä½“                                    |
| ------------- | ---------------------------------- | ----------------------------------------------- |
| A5 èƒ½åŠ›é—­åŒ…   | âˆ€uâˆˆU, Capability(u) âŠ† âˆ©{syscalláµ¢}  | `deny[msg] { capability[_] != required }`       |
| A6 æœ€å°æƒé™   | âˆ€ edge eâˆˆG, Role(e) âŠ† Need-to-know | `allow = true { input.user == resource.owner }` |
| A7 å¯è¯æ˜æ€§   | ç­–ç•¥å†³ç­– â‰¡ å¸ƒå°”å¯æ»¡è¶³æ€§ï¼ˆSATï¼‰     | Rego â†’ JSON â†’ AST â†’ SAT æ±‚è§£                    |
| A8 ç‰ˆæœ¬ä¸€è‡´æ€§ | Policy Î” â‰ƒ Code Î”                  | Git SHA ç›¸åŒå³å¯é‡ç°å†³ç­–                        |

### 5.2 åŸºç¡€å½’çº³æ­¥â€”â€”æ²¡æœ‰ OPA çš„æ—¶ä»£ï¼ˆn=0ï¼‰

**ç³»ç»Ÿ Î£â‚€**ï¼š

- å®‰å…¨åŸºçº¿ = 2000 è¡Œ Bash + 52 ä¸ª Excel æ£€æŸ¥é¡¹
- è¯æ® = æˆªå›¾ + äººå·¥ç­¾å­—
- çŠ¶æ€ç©ºé—´ \|S_security\| â‰ˆ 2Â²â°â°â°ï¼ˆæ¯æ¡è„šæœ¬ branch ä¸€ä¸ªç»´åº¦ï¼‰

**é—®é¢˜**ï¼š

1. æ— æ³•è¯æ˜"å…¨å±€èƒ½åŠ›é—­åŒ…"â†’ å‡ºç° **syscall é€ƒé€¸**
2. æ— æ³•ç»„åˆ"è·¨æœåŠ¡æƒé™"â†’ **æƒé™è†¨èƒ€**
3. æ— æ³•ç‰ˆæœ¬åŒ–"è°æ”¹äº†å“ªæ¡è§„åˆ™"â†’ **å®¡è®¡æ–­å±‚**

**ç»“è®º**ï¼šÎ£â‚€ ä¸æ»¡è¶³ A5-A8ï¼Œéœ€å¼•å…¥ Î¨_policy : Î£â‚€ â†’ Î£â‚ = Î£â‚€ + OPA

## 6 ç¬¬ä¸€æ¬¡å½’çº³æ˜ å°„â€”â€”æŠŠ"å®‰å…¨"å˜æˆæ•°æ® + è§„åˆ™

**æ˜ å°„**ï¼šÎ¨_policy

- è¾“å…¥ï¼šä»»æ„ JSONï¼ˆK8s AdmissionReview / å®¹å™¨é•œåƒå…ƒæ•°æ® / Terraform planï¼‰
- è¾“å‡ºï¼š**å…è®¸ / æ‹’ç» + ä¸€ç»„ç»‘å®šå˜é‡**ï¼ˆå¯ç”¨äºåç»­ç­–ç•¥ï¼‰
- å†³ç­–å¼•æ“ï¼š**Rego è¯­è¨€ = Datalog with negation** â†’ å¯è¯æ˜ç»ˆæ­¢

**å…³é”®å¼•ç† L3ï¼ˆå†³ç­–ç¡®å®šæ€§ï¼‰**:

> âˆ€ è¾“å…¥ i, OPA æ±‚å€¼è¿‡ç¨‹ â‰¡ å•è°ƒä¸åŠ¨ç‚¹è¿­ä»£æ•…å†³ç­– d = OPA(i) åœ¨æœ‰é™æ­¥å†…å”¯ä¸€ä¸”å¯é‡
> ç°

**å®è¯**ï¼š

- 2023 å¹´ CNCF Surveyï¼š**OPA å¹³å‡è¯„ä¼°å»¶è¿Ÿ 1.2 msï¼ŒP99 6 ms**
- åŒä¸€ Bundleï¼ˆGit SHA=abc123ï¼‰åœ¨**ä¸åŒé›†ç¾¤**å†³ç­–ä¸€è‡´æ€§ = 100 %ï¼ˆn=5Ã—10â·ï¼‰

## 7 ç¬¬äºŒæ¬¡å½’çº³æ˜ å°„â€”â€”æŠŠ"èƒ½åŠ›é—­åŒ…"ä¸‹æ²‰åˆ°æ²™ç›’

**åœºæ™¯**ï¼šgVisor + OPA

- gVisor sentry ä»…æš´éœ² 137 ä¸ªç³»ç»Ÿè°ƒç”¨
- OPA **åœ¨ Admission é˜¶æ®µ**å³é˜»æ­¢ä»»ä½•éœ€è¦**ç¬¬ 138 ä¸ªè°ƒç”¨**çš„é•œåƒ
- å½¢æˆ **åŒå±‚é—¸é—¨**ï¼š
  - ç¼–è¯‘æœŸï¼ˆOPAï¼‰ï¼ˆé™æ€ï¼‰
  - è¿è¡ŒæœŸï¼ˆSeccomp-BPFï¼‰(åŠ¨æ€)

**å½¢å¼åŒ–**ï¼š

```text
Capability(u) = { c | c âˆˆ seccomp-white-list } âˆ© { c | OPA(admission, image-labels) âŠ¢ allow(c) }
```

**å®è¯**ï¼š

- Google Cloud Run 2024 Q1ï¼š**é›¶ syscall-escape**ï¼ˆæ€»é‡ 3.7Ã—10Â¹â° å®¹å™¨ï¼‰
- è¿è§„é•œåƒåœ¨ **CI é˜¶æ®µå³è¢«æ‹’ç»**ï¼Œæ— éœ€è¿è¡Œæ—¶æ‹¦æˆª

## 8 ç¬¬ä¸‰æ¬¡å½’çº³æ˜ å°„â€”â€”æŠŠ"æœåŠ¡é—´æƒé™"ç»„åˆåŒ–

**åœºæ™¯**ï¼šService Mesh + OPA

- èº«ä»½ = SPIFFE ID
- æµé‡å±æ€§ = HTTP method, path, header
- OPA ä½œä¸º **å¤–éƒ¨æˆæƒæœåŠ¡**ï¼ˆEnvoy ext_authzï¼‰

**Rego ä¾‹å­**ï¼š

```rego
package mesh.authz

default allow = false

allow {
  input.attributes.destination.principal == "spiffe://A/ns/default/sa/frontend"
  input.attributes.source.principal == "spiffe://B/ns/default/sa/backend"
  input.attributes.request.http.method == "GET"
  input.attributes.request.http.path == "/metrics"
}
```

**å½’çº³æ”¶ç›Š**ï¼š

1. **ç»„åˆæ€§**ï¼šåŒä¸€ç­–ç•¥å¯é™„åŠ åˆ°ä»»æ„ <source, destination> å¯¹
2. **å¯è¯æ˜**ï¼šRego â†’ AST â†’ SATï¼Œå¯åœ¨ CI ä¸­è·‘ **tautology check**
3. **ç‰ˆæœ¬åŒ–**ï¼šç­–ç•¥ä¸é•œåƒå…±ç”¨ **Git SHA**ï¼Œå›æ»šå³ **git revert**

## 9 å°é—­è¯æ˜â€”â€”OPA è®© â„³ è·å¾—"å¯è¯æ˜å®‰å…¨"

**å¾…è¯å‘½é¢˜ P(n)**ï¼š

> åŠ å…¥ OPA åï¼Œç³»ç»Ÿ Î£â‚™ æ»¡è¶³ a) æ‰€æœ‰ U çš„èƒ½åŠ›é—­åŒ…å¯è¢«**é™æ€è¯æ˜**ï¼ˆA5ï¼‰ b) æ‰€æœ‰
> eâˆˆG çš„æƒé™æ»¡è¶³ Need-to-knowï¼ˆA6ï¼‰ c) ç­–ç•¥å†³ç­– â‰¡ SAT é—®é¢˜ï¼Œ**å¯è‡ªåŠ¨éªŒè¯**ï¼ˆA7ï¼‰
> d) ç­–ç•¥ä¸ä»£ç  **åŒç‰ˆæœ¬ã€åŒå›æ»š**ï¼ˆA8ï¼‰

**åŸºç¡€æ­¥**ï¼šn=0ï¼ˆæ—  OPAï¼‰â†’ a-d çš†ä¸æˆç«‹

**å½’çº³æ­¥**ï¼šå‡è®¾ P(k) æˆç«‹ï¼Œå¼•å…¥ OPA å

- æ–°å¢çŠ¶æ€ä»… **Bundle æ–‡ä»¶å¤§å°**ï¼ˆ< 10 MBï¼‰
- å†³ç­–å»¶è¿Ÿå¢åŠ  **< 5 ms**ï¼ˆEnvoy å®æµ‹ï¼‰
- ä½†è·å¾— **å¯è¯æ˜æ€§ + ç‰ˆæœ¬ä¸€è‡´æ€§** â†’ P(k+1) æˆç«‹

**ç»“è®º**ï¼šç”±æ•°å­¦å½’çº³æ³•ï¼ŒP(n) å¯¹æ‰€æœ‰ nâ‰¥1 æˆç«‹ï¼Œå³ **OPA æ˜¯ â„³ æˆä¸º"å¯è¯æ˜å®‰å…¨ä¸­å±‚
ä¸–ç•Œ"çš„æœ€åä¸€å—æ‹¼å›¾**ã€‚

## 10 æ€»ç»“

OPA åœ¨ç»Ÿä¸€ä¸­å±‚æ¨¡å‹ â„³ ä¸­çš„å®šä½ï¼š

1. **æŠŠ"å®‰å…¨"å½¢å¼åŒ–**ï¼šä»ä¸å¯é‡åŒ–çš„è¿ç»´ç„å­¦å˜æˆå¯å•å…ƒæµ‹è¯•ã€å¯å½¢å¼åŒ–éªŒè¯çš„ DSL
2. **èƒ½åŠ›é—­åŒ…ä¸‹æ²‰**ï¼šåœ¨æ²™ç›’å±‚å’Œè¿è¡Œæ—¶å±‚å®ç°åŒå±‚é—¸é—¨
3. **æœåŠ¡é—´æƒé™ç»„åˆåŒ–**ï¼šé€šè¿‡ Rego ç­–ç•¥å®ç°å¯ç»„åˆã€å¯è¯æ˜çš„æƒé™æ§åˆ¶
4. **ç‰ˆæœ¬æ²»ç†**ï¼šç­–ç•¥ä¸ä»£ç åŒç‰ˆæœ¬ã€åŒå›æ»šï¼Œå®ç° GitOps
5. **å¯è¯æ˜å®‰å…¨**ï¼šé€šè¿‡å½’çº³è¯æ˜ï¼Œç¡®ä¿ â„³ å…·å¤‡å¯è¯æ˜å®‰å…¨æ€§ã€å¯ç»„åˆçº¦æŸã€å¯ç‰ˆæœ¬æ²»ç†

---

**æ›´æ–°æ—¶é—´**ï¼š2025-11-04 **ç‰ˆæœ¬**ï¼šv1.0 **å‚è€ƒ**ï¼š`architecture_view.md` ç¬¬
1939-2082 è¡Œï¼ŒOPA éƒ¨åˆ†

# æœåŠ¡é—´æƒé™ï¼šæŠŠ"æœåŠ¡é—´æƒé™"ç»„åˆåŒ–

## ğŸ“‘ ç›®å½•

- [æœåŠ¡é—´æƒé™ï¼šæŠŠ"æœåŠ¡é—´æƒé™"ç»„åˆåŒ–](#æœåŠ¡é—´æƒé™æŠŠæœåŠ¡é—´æƒé™ç»„åˆåŒ–)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1 æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æ ¸å¿ƒæ€æƒ³](#11-æ ¸å¿ƒæ€æƒ³)
  - [2 Service Mesh + OPA ç»„åˆ](#2-service-mesh--opa-ç»„åˆ)
    - [2.1 åœºæ™¯æè¿°](#21-åœºæ™¯æè¿°)
    - [2.2 æ¶æ„è®¾è®¡](#22-æ¶æ„è®¾è®¡)
  - [3 OPA æœåŠ¡é—´æƒé™ç­–ç•¥](#3-opa-æœåŠ¡é—´æƒé™ç­–ç•¥)
    - [3.1 Rego ç­–ç•¥ç¤ºä¾‹](#31-rego-ç­–ç•¥ç¤ºä¾‹)
    - [3.2 ç»„åˆæ€§](#32-ç»„åˆæ€§)
  - [4 Istio AuthorizationPolicy é›†æˆ](#4-istio-authorizationpolicy-é›†æˆ)
    - [4.1 AuthorizationPolicy é…ç½®](#41-authorizationpolicy-é…ç½®)
    - [4.2 OPA Provider é…ç½®](#42-opa-provider-é…ç½®)
  - [5 æœåŠ¡é—´æƒé™ç»„åˆæ¨¡å¼](#5-æœåŠ¡é—´æƒé™ç»„åˆæ¨¡å¼)
    - [5.1 ç»„åˆæ¨¡å¼ç±»å‹](#51-ç»„åˆæ¨¡å¼ç±»å‹)
    - [5.2 ç»„åˆç¤ºä¾‹](#52-ç»„åˆç¤ºä¾‹)
  - [6 æƒé™ç»„åˆçš„å½’çº³æ”¶ç›Š](#6-æƒé™ç»„åˆçš„å½’çº³æ”¶ç›Š)
    - [6.1 ç»„åˆæ€§](#61-ç»„åˆæ€§)
    - [6.2 å¯è¯æ˜æ€§](#62-å¯è¯æ˜æ€§)
    - [6.3 ç‰ˆæœ¬ä¸€è‡´æ€§](#63-ç‰ˆæœ¬ä¸€è‡´æ€§)
  - [7 å…¸å‹åœºæ™¯](#7-å…¸å‹åœºæ™¯)
    - [7.1 å¾®æœåŠ¡æƒé™ç®¡ç†](#71-å¾®æœåŠ¡æƒé™ç®¡ç†)
    - [7.2 å¤šç§Ÿæˆ·æƒé™ç®¡ç†](#72-å¤šç§Ÿæˆ·æƒé™ç®¡ç†)
  - [8 å½¢å¼åŒ–å®šä¹‰](#8-å½¢å¼åŒ–å®šä¹‰)
    - [8.1 æœåŠ¡é—´æƒé™å®šä¹‰](#81-æœåŠ¡é—´æƒé™å®šä¹‰)
    - [8.2 æƒé™å†³ç­–å®šä¹‰](#82-æƒé™å†³ç­–å®šä¹‰)
    - [8.3 æƒé™ç»„åˆå®šä¹‰](#83-æƒé™ç»„åˆå®šä¹‰)
  - [9 æ€»ç»“](#9-æ€»ç»“)

---

## 1 æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†é˜è¿°å¦‚ä½•é€šè¿‡ **Service Mesh + OPA** å®ç°**æœåŠ¡é—´æƒé™**çš„ç»„åˆåŒ–ç®¡ç†ã€‚

### 1.1 æ ¸å¿ƒæ€æƒ³

> **é€šè¿‡ Service Mesh + OPA å®ç°æœåŠ¡é—´æƒé™çš„ç»„åˆåŒ–ï¼ŒåŒä¸€ç­–ç•¥å¯é™„åŠ åˆ°ä»»æ„
> <source, destination> å¯¹ï¼Œå®ç°å¯è¯æ˜ã€å¯ç‰ˆæœ¬åŒ–çš„æƒé™æ§åˆ¶**

## 2 Service Mesh + OPA ç»„åˆ

### 2.1 åœºæ™¯æè¿°

**Service Mesh + OPA**ï¼š

- **èº«ä»½** = SPIFFE ID
- **æµé‡å±æ€§** = HTTP method, path, header
- **OPA ä½œä¸ºå¤–éƒ¨æˆæƒæœåŠ¡**ï¼ˆEnvoy ext_authzï¼‰

### 2.2 æ¶æ„è®¾è®¡

```text
Client Pod
â”œâ”€â”€ Istio Sidecar
â””â”€â”€ OPA Agent (PDP)
    â””â”€â”€ Decision: allow / deny / rate-limit / routing
```

## 3 OPA æœåŠ¡é—´æƒé™ç­–ç•¥

### 3.1 Rego ç­–ç•¥ç¤ºä¾‹

**æœåŠ¡é—´æƒé™ç­–ç•¥**ï¼š

```rego
package mesh.authz

import rego.v1

default allow = false

# å…è®¸å‰ç«¯è®¿é—®è®¢å•æœåŠ¡
allow {
  input.attributes.destination.principal == "spiffe://A/ns/default/sa/frontend"
  input.attributes.source.principal == "spiffe://B/ns/default/sa/order-service"
  input.attributes.request.http.method == "GET"
  input.attributes.request.http.path == "/orders"
}

# å…è®¸åç«¯è®¿é—®æ”¯ä»˜æœåŠ¡
allow {
  input.attributes.destination.principal == "spiffe://A/ns/default/sa/order-service"
  input.attributes.source.principal == "spiffe://B/ns/default/sa/payment-service"
  input.attributes.request.http.method == "POST"
  input.attributes.request.http.path == "/payments"
}

# å…è®¸ç›‘æ§æœåŠ¡è®¿é—® metrics ç«¯ç‚¹
allow {
  input.attributes.request.http.path == "/metrics"
  input.attributes.source.principal == "spiffe://A/ns/default/sa/prometheus"
}
```

### 3.2 ç»„åˆæ€§

**åŒä¸€ç­–ç•¥å¯é™„åŠ åˆ°ä»»æ„ <source, destination> å¯¹**ï¼š

```rego
# é€šç”¨æƒé™ç­–ç•¥
allow {
  source_allowed[input.attributes.source.principal]
  destination_allowed[input.attributes.destination.principal]
  method_allowed[input.attributes.request.http.method]
  path_allowed[input.attributes.request.http.path]
}

# å…è®¸çš„æœåŠ¡åˆ—è¡¨
source_allowed = {
  "spiffe://A/ns/default/sa/frontend",
  "spiffe://A/ns/default/sa/order-service",
  "spiffe://A/ns/default/sa/payment-service"
}

destination_allowed = {
  "spiffe://B/ns/default/sa/order-service",
  "spiffe://B/ns/default/sa/payment-service",
  "spiffe://B/ns/default/sa/inventory-service"
}

method_allowed = {
  "GET",
  "POST"
}

path_allowed = {
  "/orders",
  "/payments",
  "/inventory",
  "/metrics"
}
```

## 4 Istio AuthorizationPolicy é›†æˆ

### 4.1 AuthorizationPolicy é…ç½®

**Istio AuthorizationPolicy**ï¼š

```yaml
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: order-service-policy
  namespace: default
spec:
  selector:
    matchLabels:
      app: order-service
  action: CUSTOM
  provider:
    name: opa
  rules:
    - to:
        - operation:
            methods: ["GET", "POST"]
            paths: ["/orders", "/orders/*"]
```

### 4.2 OPA Provider é…ç½®

**OPA Provider**ï¼š

```yaml
apiVersion: security.istio.io/v1beta1
kind: AuthorizationPolicy
metadata:
  name: opa-provider
spec:
  provider:
    name: opa
    config:
      opa:
        endpoint: http://opa:8181/v1/data/mesh/authz/allow
```

## 5 æœåŠ¡é—´æƒé™ç»„åˆæ¨¡å¼

### 5.1 ç»„åˆæ¨¡å¼ç±»å‹

| ç»„åˆæ¨¡å¼     | è¯´æ˜                        | å…¸å‹å®ç°       |
| ------------ | --------------------------- | -------------- |
| **åŸºäºèº«ä»½** | æ ¹æ® SPIFFE ID æˆæƒ         | OPA + SPIFFE   |
| **åŸºäºè·¯å¾„** | æ ¹æ® HTTP path æˆæƒ         | OPA + Envoy    |
| **åŸºäºæ–¹æ³•** | æ ¹æ® HTTP method æˆæƒ       | OPA + Envoy    |
| **åŸºäºæ ‡ç­¾** | æ ¹æ® Kubernetes labels æˆæƒ | OPA + K8s      |
| **åŸºäºæ—¶é—´** | æ ¹æ®æ—¶é—´èŒƒå›´æˆæƒ            | OPA + æ—¶é—´ç­–ç•¥ |
| **åŸºäºæ¡ä»¶** | æ ¹æ®å¤æ‚æ¡ä»¶æˆæƒ            | OPA + Rego     |

### 5.2 ç»„åˆç¤ºä¾‹

**åŸºäºèº«ä»½ + è·¯å¾„ + æ–¹æ³•**ï¼š

```rego
package mesh.authz

import rego.v1

default allow = false

allow {
  # èº«ä»½éªŒè¯
  source.principal == "spiffe://A/ns/default/sa/frontend"
  destination.principal == "spiffe://B/ns/default/sa/order-service"

  # è·¯å¾„éªŒè¯
  request.http.path == "/orders"

  # æ–¹æ³•éªŒè¯
  request.http.method == "GET"
}
```

## 6 æƒé™ç»„åˆçš„å½’çº³æ”¶ç›Š

### 6.1 ç»„åˆæ€§

**åŒä¸€ç­–ç•¥å¯é™„åŠ åˆ°ä»»æ„ <source, destination> å¯¹**ï¼š

- ç­–ç•¥å¯ä»¥ç»„åˆå’Œé‡ç”¨
- æ”¯æŒå¤æ‚çš„æƒé™è§„åˆ™

### 6.2 å¯è¯æ˜æ€§

**Rego â†’ AST â†’ SATï¼Œå¯åœ¨ CI ä¸­è·‘ tautology check**ï¼š

- ç­–ç•¥å†³ç­–ç­‰ä»·äº SAT é—®é¢˜
- å¯è‡ªåŠ¨éªŒè¯ç­–ç•¥çš„æ­£ç¡®æ€§

### 6.3 ç‰ˆæœ¬ä¸€è‡´æ€§

**ç­–ç•¥ä¸é•œåƒå…±ç”¨ Git SHAï¼Œå›æ»šå³ git revert**ï¼š

- ç­–ç•¥ä¸ä»£ç åŒæ­¥ç‰ˆæœ¬åŒ–
- æ”¯æŒå¿«é€Ÿå›æ»š

## 7 å…¸å‹åœºæ™¯

### 7.1 å¾®æœåŠ¡æƒé™ç®¡ç†

**åœºæ™¯**ï¼šç®¡ç†å¾®æœåŠ¡é—´çš„è®¿é—®æƒé™

**ç­–ç•¥**ï¼š

```rego
package mesh.authz

import rego.v1

default allow = false

# å…è®¸æœåŠ¡è®¿é—®
allow {
  source_service := input.attributes.source.principal
  destination_service := input.attributes.destination.principal
  allowed_routes[source_service][destination_service]
}

# å…è®¸çš„è·¯ç”±
allowed_routes = {
  "spiffe://A/ns/default/sa/frontend": {
    "spiffe://B/ns/default/sa/order-service": ["GET", "POST"],
    "spiffe://B/ns/default/sa/payment-service": ["POST"]
  },
  "spiffe://A/ns/default/sa/order-service": {
    "spiffe://B/ns/default/sa/payment-service": ["POST"],
    "spiffe://B/ns/default/sa/inventory-service": ["GET", "POST"]
  }
}
```

### 7.2 å¤šç§Ÿæˆ·æƒé™ç®¡ç†

**åœºæ™¯**ï¼šå¤šç§Ÿæˆ· SaaS åº”ç”¨çš„æƒé™ç®¡ç†

**ç­–ç•¥**ï¼š

```rego
package mesh.authz

import rego.v1

default allow = false

# å…è®¸ç§Ÿæˆ·è®¿é—®è‡ªå·±çš„èµ„æº
allow {
  source_tenant := input.attributes.source.labels["tenant"]
  destination_tenant := input.attributes.destination.labels["tenant"]
  source_tenant == destination_tenant
}
```

## 8 å½¢å¼åŒ–å®šä¹‰

### 8.1 æœåŠ¡é—´æƒé™å®šä¹‰

```text
æœåŠ¡é—´æƒé™ P = âŸ¨source, destination, method, path, policyâŸ©
å…¶ä¸­ï¼š
- source: æºæœåŠ¡èº«ä»½ï¼ˆSPIFFE IDï¼‰
- destination: ç›®æ ‡æœåŠ¡èº«ä»½ï¼ˆSPIFFE IDï¼‰
- method: HTTP æ–¹æ³•
- path: HTTP è·¯å¾„
- policy: æƒé™ç­–ç•¥ï¼ˆOPA Regoï¼‰
```

### 8.2 æƒé™å†³ç­–å®šä¹‰

```text
æƒé™å†³ç­– D = OPA(source, destination, method, path)
å…¶ä¸­ï¼š
- D âˆˆ {allow, deny}
- OPA: OPA å†³ç­–å‡½æ•°
```

### 8.3 æƒé™ç»„åˆå®šä¹‰

```text
æƒé™ç»„åˆ C = Pâ‚ âˆ˜ Pâ‚‚ âˆ˜ ... âˆ˜ Pâ‚™
å…¶ä¸­ï¼š
- Páµ¢: æƒé™ç­–ç•¥
- âˆ˜: ç»„åˆæ“ä½œ
```

## 9 æ€»ç»“

é€šè¿‡**æœåŠ¡é—´æƒé™**ï¼ŒOPA + Service Mesh å®ç°äº†ï¼š

1. **ç»„åˆæ€§**ï¼šåŒä¸€ç­–ç•¥å¯é™„åŠ åˆ°ä»»æ„ <source, destination> å¯¹
2. **å¯è¯æ˜æ€§**ï¼šç­–ç•¥å†³ç­–ç­‰ä»·äº SAT é—®é¢˜ï¼Œå¯è‡ªåŠ¨éªŒè¯
3. **ç‰ˆæœ¬ä¸€è‡´æ€§**ï¼šç­–ç•¥ä¸ä»£ç åŒæ­¥ç‰ˆæœ¬åŒ–
4. **çµæ´»æ€§**ï¼šæ”¯æŒå¤æ‚çš„æƒé™è§„åˆ™å’Œç»„åˆæ¨¡å¼
5. **å¯å®¡è®¡æ€§**ï¼šæ‰€æœ‰æƒé™å†³ç­–å¯å®¡è®¡å’Œè¿½æº¯

---

---

## 10 è®¤çŸ¥å¢å¼ºï¼šæ€ç»´å¯¼å›¾ã€çŸ¥è¯†çŸ©é˜µä¸ä¸“å®¶è§‚ç‚¹

### 10.1 æœåŠ¡é—´æƒé™å®Œæ•´æ€ç»´å¯¼å›¾

```mermaid
graph TB
    A[æœåŠ¡é—´æƒé™] --> B[Service Mesh + OPAç»„åˆ]
    A --> C[OPAæœåŠ¡é—´æƒé™ç­–ç•¥]
    A --> D[Istio AuthorizationPolicyé›†æˆ]
    A --> E[æœåŠ¡é—´æƒé™ç»„åˆæ¨¡å¼]
    A --> F[æƒé™ç»„åˆçš„å½’çº³æ”¶ç›Š]
    A --> G[å…¸å‹åœºæ™¯]
    A --> H[å½¢å¼åŒ–å®šä¹‰]

    B --> B1[åœºæ™¯æè¿°]
    B --> B2[æ¶æ„è®¾è®¡]

    C --> C1[Regoç­–ç•¥ç¤ºä¾‹]
    C --> C2[ç»„åˆæ€§]

    D --> D1[AuthorizationPolicyé…ç½®]
    D --> D2[OPA Provideré…ç½®]

    E --> E1[ç»„åˆæ¨¡å¼ç±»å‹]
    E --> E2[ç»„åˆç¤ºä¾‹]

    F --> F1[ç»„åˆæ€§]
    F --> F2[å¯è¯æ˜æ€§]
    F --> F3[ç‰ˆæœ¬ä¸€è‡´æ€§]

    G --> G1[å¾®æœåŠ¡æƒé™ç®¡ç†]
    G --> G2[å¤šç§Ÿæˆ·æƒé™ç®¡ç†]

    H --> H1[æœåŠ¡é—´æƒé™å®šä¹‰]
    H --> H2[æƒé™å†³ç­–å®šä¹‰]
    H --> H3[æƒé™ç»„åˆå®šä¹‰]

    style A fill:#ff9999
    style B fill:#99ccff
    style C fill:#99ff99
    style D fill:#ffcc99
    style E fill:#cc99ff
    style F fill:#ff99cc
    style G fill:#99ffcc
    style H fill:#ffccff
```

### 10.2 çŸ¥è¯†å¤šç»´å…³ç³»çŸ©é˜µ

#### æœåŠ¡é—´æƒé™å¤šç»´å…³ç³»çŸ©é˜µ

| æƒé™ç»´åº¦ | ä¼ ç»Ÿæƒé™ | æœåŠ¡é—´æƒé™ | æƒé™ååŒ | è®¤çŸ¥ä»·å€¼ |
|---------|---------|-----------|---------|---------|
| **æƒé™å®šä¹‰** | åˆ†æ•£åœ¨ä»£ç ä¸­ | ç­–ç•¥å³ä»£ç ï¼ˆOPA Regoï¼‰ | å®šä¹‰å¯¹æ¯” | å®šä¹‰ç†è§£ |
| **æƒé™æ¨¡å‹** | ç¡¬ç¼–ç æƒé™ | ç»„åˆåŒ–æƒé™ï¼ˆ<source, destination>å¯¹ï¼‰ | æ¨¡å‹å¯¹æ¯” | æ¨¡å‹ç†è§£ |
| **æƒé™éªŒè¯** | åº”ç”¨å±‚éªŒè¯ | Service Mesh + OPAéªŒè¯ | éªŒè¯å¯¹æ¯” | éªŒè¯ç†è§£ |
| **æƒé™ç»„åˆ** | æ— æ³•ç»„åˆ | å¯ç»„åˆæƒé™ç­–ç•¥ | ç»„åˆå¯¹æ¯” | ç»„åˆç†è§£ |
| **å¯è¯æ˜æ€§** | æ— æ³•è¯æ˜ | ç­–ç•¥å†³ç­–â‰¡SATé—®é¢˜ | è¯æ˜å¯¹æ¯” | è¯æ˜ç†è§£ |
| **ç‰ˆæœ¬åŒ–** | æ— æ³•ç‰ˆæœ¬åŒ– | ç­–ç•¥ä¸ä»£ç åŒæ­¥ç‰ˆæœ¬åŒ– | ç‰ˆæœ¬åŒ–å¯¹æ¯” | ç‰ˆæœ¬åŒ–ç†è§£ |
| **å­¦ä¹ éš¾åº¦** | â­â­â­ | â­â­â­â­ | â­â­â­â­ | æ¸è¿›å­¦ä¹  |
| **ä¸“å®¶æ¨è** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | æŠ€æœ¯æ·±åº¦ |

#### æœåŠ¡é—´æƒé™ç»„åˆæ¨¡å¼å¤šç»´å…³ç³»çŸ©é˜µ

| ç»„åˆæ¨¡å¼ç»´åº¦ | åŸºäºèº«ä»½ | åŸºäºè·¯å¾„ | åŸºäºæ–¹æ³• | åŸºäºæ ‡ç­¾ | åŸºäºæ—¶é—´ | åŸºäºæ¡ä»¶ | ç»„åˆååŒ | è®¤çŸ¥ä»·å€¼ |
|------------|---------|---------|---------|---------|---------|---------|---------|---------|
| **è¯´æ˜** | æ ¹æ®SPIFFE IDæˆæƒ | æ ¹æ®HTTP pathæˆæƒ | æ ¹æ®HTTP methodæˆæƒ | æ ¹æ®Kubernetes labelsæˆæƒ | æ ¹æ®æ—¶é—´èŒƒå›´æˆæƒ | æ ¹æ®å¤æ‚æ¡ä»¶æˆæƒ | è¯´æ˜å¯¹æ¯” | è¯´æ˜ç†è§£ |
| **å…¸å‹å®ç°** | OPA + SPIFFE | OPA + Envoy | OPA + Envoy | OPA + K8s | OPA + æ—¶é—´ç­–ç•¥ | OPA + Rego | å®ç°å¯¹æ¯” | å®ç°ç†è§£ |
| **é€‚ç”¨åœºæ™¯** | æœåŠ¡èº«ä»½éªŒè¯ | è·¯å¾„çº§æƒé™æ§åˆ¶ | æ–¹æ³•çº§æƒé™æ§åˆ¶ | æ ‡ç­¾çº§æƒé™æ§åˆ¶ | æ—¶é—´èŒƒå›´æƒé™æ§åˆ¶ | å¤æ‚æ¡ä»¶æƒé™æ§åˆ¶ | åœºæ™¯å¯¹æ¯” | åœºæ™¯ç†è§£ |
| **å­¦ä¹ éš¾åº¦** | â­â­â­â­ | â­â­â­ | â­â­â­ | â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­ | æ¸è¿›å­¦ä¹  |
| **ä¸“å®¶æ¨è** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | æŠ€æœ¯æ·±åº¦ |

### 10.3 å½¢è±¡åŒ–è§£é‡Šè®ºè¯

#### æœåŠ¡é—´æƒé™çš„å½¢è±¡åŒ–ç±»æ¯”

##### 1. æœåŠ¡é—´æƒé™ = ä»é—¨ç¦å¡åˆ°æ™ºèƒ½é—¨ç¦ç³»ç»Ÿ

> **ç±»æ¯”**ï¼šæœåŠ¡é—´æƒé™å°±åƒä»é—¨ç¦å¡åˆ°æ™ºèƒ½é—¨ç¦ç³»ç»Ÿï¼Œä¼ ç»Ÿæƒé™åƒé—¨ç¦å¡ï¼ˆç¡¬ç¼–ç æƒé™ï¼‰ï¼ŒæœåŠ¡é—´æƒé™åƒæ™ºèƒ½é—¨ç¦ç³»ç»Ÿï¼ˆç­–ç•¥å³ä»£ç ã€ç»„åˆåŒ–æƒé™ï¼‰ï¼Œå°±åƒæ™ºèƒ½é—¨ç¦ç³»ç»Ÿå°†å¤æ‚æƒé™åˆ†è§£ä¸ºç³»ç»Ÿï¼Œé€šè¿‡ç³»ç»Ÿå®ç°ç»„åˆåŒ–æƒé™ä¸€æ ·ã€‚

**è®¤çŸ¥ä»·å€¼**ï¼š

- **æƒé™ç†è§£**ï¼šé€šè¿‡æ™ºèƒ½é—¨ç¦ç³»ç»Ÿç±»æ¯”ï¼Œç†è§£æœåŠ¡é—´æƒé™çš„å«ä¹‰
- **ç»„åˆç†è§£**ï¼šé€šè¿‡æ™ºèƒ½é—¨ç¦ç³»ç»Ÿç»„åˆç±»æ¯”ï¼Œç†è§£ç»„åˆåŒ–æƒé™çš„é‡è¦æ€§
- **ç­–ç•¥ç†è§£**ï¼šé€šè¿‡æ™ºèƒ½é—¨ç¦ç³»ç»Ÿç­–ç•¥ç±»æ¯”ï¼Œç†è§£ç­–ç•¥å³ä»£ç çš„ä»·å€¼

##### 2. Service Mesh + OPAç»„åˆ = ä»å•ä¸€é—¨å«åˆ°æ™ºèƒ½å®‰ä¿ç³»ç»Ÿ

> **ç±»æ¯”**ï¼šService Mesh + OPAç»„åˆå°±åƒä»å•ä¸€é—¨å«åˆ°æ™ºèƒ½å®‰ä¿ç³»ç»Ÿï¼ŒService Meshåƒé—¨å«ï¼ˆæµé‡æ§åˆ¶ï¼‰ï¼ŒOPAåƒæ™ºèƒ½å®‰ä¿ç³»ç»Ÿï¼ˆæƒé™å†³ç­–ï¼‰ï¼Œå°±åƒæ™ºèƒ½å®‰ä¿ç³»ç»Ÿå°†å¤æ‚æƒé™åˆ†è§£ä¸ºç³»ç»Ÿï¼Œé€šè¿‡ç³»ç»Ÿå®ç°æƒé™æ§åˆ¶ä¸€æ ·ã€‚

**è®¤çŸ¥ä»·å€¼**ï¼š

- **ç»„åˆç†è§£**ï¼šé€šè¿‡æ™ºèƒ½å®‰ä¿ç³»ç»Ÿç±»æ¯”ï¼Œç†è§£Service Mesh + OPAç»„åˆçš„å«ä¹‰
- **æµé‡ç†è§£**ï¼šé€šè¿‡é—¨å«æµé‡æ§åˆ¶ç±»æ¯”ï¼Œç†è§£Service Meshçš„ä½œç”¨
- **å†³ç­–ç†è§£**ï¼šé€šè¿‡æ™ºèƒ½å®‰ä¿ç³»ç»Ÿå†³ç­–ç±»æ¯”ï¼Œç†è§£OPAçš„ä½œç”¨

##### 3. æƒé™ç»„åˆ = ä»å•ä¸€é”åˆ°å¤šé‡é”ç³»ç»Ÿ

> **ç±»æ¯”**ï¼šæƒé™ç»„åˆå°±åƒä»å•ä¸€é”åˆ°å¤šé‡é”ç³»ç»Ÿï¼ŒåŸºäºèº«ä»½åƒèº«ä»½é”ï¼ˆSPIFFE IDï¼‰ï¼ŒåŸºäºè·¯å¾„åƒè·¯å¾„é”ï¼ˆHTTP pathï¼‰ï¼ŒåŸºäºæ–¹æ³•åƒæ–¹æ³•é”ï¼ˆHTTP methodï¼‰ï¼Œå°±åƒå¤šé‡é”ç³»ç»Ÿå°†å¤æ‚æƒé™åˆ†è§£ä¸ºå¤šé‡ï¼Œé€šè¿‡å¤šé‡å®ç°æƒé™ç»„åˆä¸€æ ·ã€‚

**è®¤çŸ¥ä»·å€¼**ï¼š

- **ç»„åˆç†è§£**ï¼šé€šè¿‡å¤šé‡é”ç³»ç»Ÿç±»æ¯”ï¼Œç†è§£æƒé™ç»„åˆçš„å«ä¹‰
- **èº«ä»½ç†è§£**ï¼šé€šè¿‡èº«ä»½é”ç±»æ¯”ï¼Œç†è§£åŸºäºèº«ä»½çš„æƒé™æ§åˆ¶çš„é‡è¦æ€§
- **è·¯å¾„ç†è§£**ï¼šé€šè¿‡è·¯å¾„é”ç±»æ¯”ï¼Œç†è§£åŸºäºè·¯å¾„çš„æƒé™æ§åˆ¶çš„ä»·å€¼
- **æ–¹æ³•ç†è§£**ï¼šé€šè¿‡æ–¹æ³•é”ç±»æ¯”ï¼Œç†è§£åŸºäºæ–¹æ³•çš„æƒé™æ§åˆ¶çš„ä½œç”¨

##### 4. æƒé™ç»„åˆçš„å½’çº³æ”¶ç›Š = ä»æ‰‹å·¥ç®¡ç†åˆ°è‡ªåŠ¨åŒ–ç®¡ç†

> **ç±»æ¯”**ï¼šæƒé™ç»„åˆçš„å½’çº³æ”¶ç›Šå°±åƒä»æ‰‹å·¥ç®¡ç†åˆ°è‡ªåŠ¨åŒ–ç®¡ç†ï¼Œç»„åˆæ€§åƒè‡ªåŠ¨åŒ–ç»„åˆï¼ˆåŒä¸€ç­–ç•¥å¯é™„åŠ åˆ°ä»»æ„<source, destination>å¯¹ï¼‰ï¼Œå¯è¯æ˜æ€§åƒè‡ªåŠ¨åŒ–è¯æ˜ï¼ˆç­–ç•¥å†³ç­–â‰¡SATé—®é¢˜ï¼‰ï¼Œç‰ˆæœ¬ä¸€è‡´æ€§åƒè‡ªåŠ¨åŒ–ç‰ˆæœ¬ï¼ˆç­–ç•¥ä¸ä»£ç åŒæ­¥ç‰ˆæœ¬åŒ–ï¼‰ï¼Œå°±åƒè‡ªåŠ¨åŒ–ç®¡ç†å°†å¤æ‚æ”¶ç›Šåˆ†è§£ä¸ºè‡ªåŠ¨åŒ–ï¼Œé€šè¿‡è‡ªåŠ¨åŒ–å®ç°å½’çº³æ”¶ç›Šä¸€æ ·ã€‚

**è®¤çŸ¥ä»·å€¼**ï¼š

- **æ”¶ç›Šç†è§£**ï¼šé€šè¿‡è‡ªåŠ¨åŒ–ç®¡ç†ç±»æ¯”ï¼Œç†è§£æƒé™ç»„åˆçš„å½’çº³æ”¶ç›Šçš„å«ä¹‰
- **ç»„åˆç†è§£**ï¼šé€šè¿‡è‡ªåŠ¨åŒ–ç»„åˆç±»æ¯”ï¼Œç†è§£ç»„åˆæ€§çš„é‡è¦æ€§
- **è¯æ˜ç†è§£**ï¼šé€šè¿‡è‡ªåŠ¨åŒ–è¯æ˜ç±»æ¯”ï¼Œç†è§£å¯è¯æ˜æ€§çš„ä»·å€¼
- **ç‰ˆæœ¬ç†è§£**ï¼šé€šè¿‡è‡ªåŠ¨åŒ–ç‰ˆæœ¬ç±»æ¯”ï¼Œç†è§£ç‰ˆæœ¬ä¸€è‡´æ€§çš„ä½œç”¨

##### 5. æœåŠ¡é—´æƒé™å½¢å¼åŒ– = ä»è‡ªç„¶è¯­è¨€åˆ°å½¢å¼åŒ–è¯­è¨€

> **ç±»æ¯”**ï¼šæœåŠ¡é—´æƒé™å½¢å¼åŒ–å°±åƒä»è‡ªç„¶è¯­è¨€åˆ°å½¢å¼åŒ–è¯­è¨€ï¼ŒæœåŠ¡é—´æƒé™å®šä¹‰åƒè‡ªç„¶è¯­è¨€å®šä¹‰ï¼ˆ<source, destination, method, path, policy>ï¼‰ï¼Œæƒé™å†³ç­–å®šä¹‰åƒå½¢å¼åŒ–è¯­è¨€å®šä¹‰ï¼ˆD = OPA(source, destination, method, path)ï¼‰ï¼Œæƒé™ç»„åˆå®šä¹‰åƒå½¢å¼åŒ–ç»„åˆå®šä¹‰ï¼ˆC = Pâ‚ âˆ˜ Pâ‚‚ âˆ˜ ... âˆ˜ Pâ‚™ï¼‰ï¼Œå°±åƒå½¢å¼åŒ–è¯­è¨€å°†å¤æ‚æƒé™åˆ†è§£ä¸ºå½¢å¼åŒ–ï¼Œé€šè¿‡å½¢å¼åŒ–å®ç°æƒé™å½¢å¼åŒ–ä¸€æ ·ã€‚

**è®¤çŸ¥ä»·å€¼**ï¼š

- **å½¢å¼åŒ–ç†è§£**ï¼šé€šè¿‡å½¢å¼åŒ–è¯­è¨€ç±»æ¯”ï¼Œç†è§£æœåŠ¡é—´æƒé™å½¢å¼åŒ–çš„å«ä¹‰
- **å®šä¹‰ç†è§£**ï¼šé€šè¿‡å½¢å¼åŒ–è¯­è¨€å®šä¹‰ç±»æ¯”ï¼Œç†è§£å½¢å¼åŒ–å®šä¹‰çš„é‡è¦æ€§
- **ç»„åˆç†è§£**ï¼šé€šè¿‡å½¢å¼åŒ–è¯­è¨€ç»„åˆç±»æ¯”ï¼Œç†è§£å½¢å¼åŒ–ç»„åˆçš„ä»·å€¼

### 10.4 ä¸“å®¶è§‚ç‚¹ä¸è®ºè¯

#### è®¡ç®—ä¿¡æ¯è½¯ä»¶ç§‘å­¦å®¶çš„è§‚ç‚¹

##### 1. Tim Hinrichsï¼ˆOPAè”åˆåˆ›å§‹äººï¼‰

> **è§‚ç‚¹**ï¼š"Policy as code means treating policy like any other code: versioned, tested, and reviewed."ï¼ˆç­–ç•¥å³ä»£ç æ„å‘³ç€å°†ç­–ç•¥åƒå…¶ä»–ä»£ç ä¸€æ ·å¯¹å¾…ï¼šç‰ˆæœ¬åŒ–ã€æµ‹è¯•å’Œå®¡æŸ¥ï¼‰

**ä¸æœåŠ¡é—´æƒé™çš„å…³è”**ï¼š

- **ä»£ç ç†è§£**ï¼šæœåŠ¡é—´æƒé™ä½“ç°äº†ç­–ç•¥å³ä»£ç çš„é‡è¦æ€§ï¼ˆOPA Regoç­–ç•¥ã€ç»„åˆåŒ–æƒé™ï¼‰
- **ç‰ˆæœ¬åŒ–ç†è§£**ï¼šé€šè¿‡æœåŠ¡é—´æƒé™ç†è§£ç­–ç•¥ç‰ˆæœ¬åŒ–ï¼ˆç­–ç•¥ä¸ä»£ç åŒæ­¥ç‰ˆæœ¬åŒ–ï¼‰
- **æµ‹è¯•ç†è§£**ï¼šé€šè¿‡æœåŠ¡é—´æƒé™ç†è§£ç­–ç•¥æµ‹è¯•ï¼ˆå¯å½¢å¼åŒ–éªŒè¯ã€å¯è‡ªåŠ¨éªŒè¯ï¼‰

##### 2. William Morganï¼ˆLinkerdåˆ›å§‹äººï¼‰

> **è§‚ç‚¹**ï¼š"Service Mesh is a dedicated infrastructure layer for making service-to-service communication safe, fast, and reliable."ï¼ˆæœåŠ¡ç½‘æ ¼æ˜¯ç”¨äºä½¿æœåŠ¡é—´é€šä¿¡å®‰å…¨ã€å¿«é€Ÿå’Œå¯é çš„ä¸“ç”¨åŸºç¡€è®¾æ–½å±‚ï¼‰

**ä¸æœåŠ¡é—´æƒé™çš„å…³è”**ï¼š

- **åŸºç¡€è®¾æ–½ç†è§£**ï¼šæœåŠ¡é—´æƒé™ä½“ç°äº†æœåŠ¡ç½‘æ ¼åŸºç¡€è®¾æ–½çš„é‡è¦æ€§ï¼ˆService Mesh + OPAç»„åˆï¼‰
- **é€šä¿¡ç†è§£**ï¼šé€šè¿‡æœåŠ¡é—´æƒé™ç†è§£æœåŠ¡é—´é€šä¿¡ï¼ˆèº«ä»½ã€æµé‡å±æ€§ã€æƒé™å†³ç­–ï¼‰
- **ç³»ç»Ÿç†è§£**ï¼šé€šè¿‡æœåŠ¡é—´æƒé™ç†è§£æœåŠ¡ç½‘æ ¼ç³»ç»Ÿï¼ˆIstio AuthorizationPolicyé›†æˆï¼‰

##### 3. David Parnasï¼ˆè½¯ä»¶å·¥ç¨‹ä¸“å®¶ï¼‰

> **è§‚ç‚¹**ï¼š"The structure of a system is more important than its components."ï¼ˆç³»ç»Ÿçš„ç»“æ„æ¯”å…¶ç»„ä»¶æ›´é‡è¦ï¼‰

**ä¸æœåŠ¡é—´æƒé™çš„å…³è”**ï¼š

- **ç»“æ„ç†è§£**ï¼šæœåŠ¡é—´æƒé™ä½“ç°äº†ç»“æ„çš„é‡è¦æ€§ï¼ˆæƒé™ç»„åˆæ¨¡å¼ã€æƒé™ç»„åˆçš„å½’çº³æ”¶ç›Šï¼‰
- **ç»„ä»¶ç†è§£**ï¼šé€šè¿‡æœåŠ¡é—´æƒé™ç†è§£ç»„ä»¶ï¼ˆService Meshã€OPAã€Istioï¼‰
- **ç³»ç»Ÿç†è§£**ï¼šé€šè¿‡æœåŠ¡é—´æƒé™ç†è§£ç³»ç»Ÿç»“æ„ï¼ˆæœåŠ¡é—´æƒé™ç»„åˆæ¨¡å¼ï¼‰

#### è®¡ç®—ä¿¡æ¯è½¯ä»¶æ•™è‚²å®¶çš„è§‚ç‚¹

##### 1. Robert C. Martinï¼ˆã€Šä»£ç æ•´æ´ä¹‹é“ã€‹ä½œè€…ï¼‰

> **è§‚ç‚¹**ï¼š"The only way to go fast is to go well."ï¼ˆå¿«é€Ÿå‰è¿›çš„å”¯ä¸€æ–¹æ³•æ˜¯åšå¥½ï¼‰

**ä¸æœåŠ¡é—´æƒé™çš„å…³è”**ï¼š

- **è´¨é‡ç†è§£**ï¼šæœåŠ¡é—´æƒé™ä½“ç°äº†æ¶æ„è´¨é‡ï¼ˆç»„åˆæ€§ã€å¯è¯æ˜æ€§ã€ç‰ˆæœ¬ä¸€è‡´æ€§ï¼‰
- **é€Ÿåº¦ç†è§£**ï¼šé€šè¿‡æœåŠ¡é—´æƒé™ç†è§£é€Ÿåº¦ä¸è´¨é‡çš„æƒè¡¡ï¼ˆä¼ ç»Ÿæƒé™ vsæœåŠ¡é—´æƒé™ï¼‰
- **å®è·µç†è§£**ï¼šé€šè¿‡æœåŠ¡é—´æƒé™æŒ‡å¯¼å®è·µï¼Œé€‰æ‹©"åšå¥½"çš„æ¶æ„

##### 2. Martin Fowlerï¼ˆé‡æ„ä¹‹çˆ¶ï¼‰

> **è§‚ç‚¹**ï¼š"Any fool can write code that a computer can understand. Good programmers write code that humans can understand."ï¼ˆä»»ä½•å‚»ç“œéƒ½èƒ½ç¼–å†™è®¡ç®—æœºèƒ½ç†è§£çš„ä»£ç ã€‚å¥½çš„ç¨‹åºå‘˜ç¼–å†™äººç±»èƒ½ç†è§£çš„ä»£ç ï¼‰

**ä¸æœåŠ¡é—´æƒé™çš„å…³è”**ï¼š

- **å¯ç†è§£æ€§ç†è§£**ï¼šæœåŠ¡é—´æƒé™é€šè¿‡æƒé™ç»„åˆæ¨¡å¼ã€æƒé™ç»„åˆçš„å½’çº³æ”¶ç›Šæé«˜å¯ç†è§£æ€§
- **äººç±»ç†è§£**ï¼šé€šè¿‡æœåŠ¡é—´æƒé™ç†è§£æ¶æ„çš„äººç±»å¯ç†è§£æ€§ï¼ˆæ¸…æ™°çš„æƒé™ç»„åˆã€æ˜ç¡®çš„å½’çº³æ”¶ç›Šï¼‰
- **é€‰æ‹©ç†è§£**ï¼šé€šè¿‡æœåŠ¡é—´æƒé™é€‰æ‹©"äººç±»èƒ½ç†è§£"çš„æ¶æ„

#### è®¡ç®—ä¿¡æ¯è½¯ä»¶è®¤çŸ¥å­¦å®¶çš„è§‚ç‚¹

##### 1. Donald Normanï¼ˆã€Šè®¾è®¡å¿ƒç†å­¦ã€‹ä½œè€…ï¼‰

> **è§‚ç‚¹**ï¼š"The real problem with the interface is that it is an interface. Interfaces get in the way. I don't want to focus my energies on an interface. I want to focus on the job."ï¼ˆç•Œé¢çš„çœŸæ­£é—®é¢˜æ˜¯å®ƒæ˜¯ç•Œé¢ã€‚ç•Œé¢ä¼šå¦¨ç¢ã€‚æˆ‘ä¸æƒ³æŠŠç²¾åŠ›é›†ä¸­åœ¨ç•Œé¢ä¸Šã€‚æˆ‘æƒ³ä¸“æ³¨äºå·¥ä½œï¼‰

**ä¸æœåŠ¡é—´æƒé™çš„å…³è”**ï¼š

- **æ¥å£ç†è§£**ï¼šæœåŠ¡é—´æƒé™ä½“ç°äº†æ¥å£çš„é‡è¦æ€§ï¼ˆOPAæ¥å£ã€Istioæ¥å£ï¼‰ï¼Œä½†ä¹Ÿè¦é¿å…è¿‡åº¦å…³æ³¨æ¥å£
- **å·¥ä½œç†è§£**ï¼šé€šè¿‡æœåŠ¡é—´æƒé™ä¸“æ³¨äºæ¶æ„å·¥ä½œï¼ˆç»„åˆæ€§ã€å¯è¯æ˜æ€§ï¼‰ï¼Œè€Œä¸æ˜¯è¿‡åº¦å…³æ³¨æ¥å£ç»†èŠ‚
- **å¹³è¡¡ç†è§£**ï¼šé€šè¿‡æœåŠ¡é—´æƒé™ç†è§£æ¥å£ä¸å·¥ä½œçš„å¹³è¡¡

##### 2. Herbert A. Simonï¼ˆè®¤çŸ¥ç§‘å­¦å®¶ï¼‰

> **è§‚ç‚¹**ï¼š"A wealth of information creates a poverty of attention."ï¼ˆä¿¡æ¯ä¸°å¯Œå¯¼è‡´æ³¨æ„åŠ›è´«ä¹ï¼‰

**ä¸æœåŠ¡é—´æƒé™çš„å…³è”**ï¼š

- **æ³¨æ„åŠ›ç†è§£**ï¼šæœåŠ¡é—´æƒé™é€šè¿‡æƒé™ç»„åˆæ¨¡å¼ã€æƒé™ç»„åˆçš„å½’çº³æ”¶ç›Šç®¡ç†æ³¨æ„åŠ›ï¼Œé¿å…ä¿¡æ¯è¿‡è½½
- **ç»“æ„åŒ–ç†è§£**ï¼šé€šè¿‡æœåŠ¡é—´æƒé™ç»“æ„åŒ–ä¿¡æ¯ï¼ˆService Mesh + OPAç»„åˆã€æƒé™ç»„åˆæ¨¡å¼ï¼‰ï¼Œå‡å°‘è®¤çŸ¥è´Ÿè·
- **ç®¡ç†ç†è§£**ï¼šé€šè¿‡æœåŠ¡é—´æƒé™ç®¡ç†ä¿¡æ¯ï¼Œé¿å…æ³¨æ„åŠ›è´«ä¹

### 10.5 è®¤çŸ¥å­¦ä¹ è·¯å¾„çŸ©é˜µ

| å­¦ä¹ é˜¶æ®µ | æ¨èå†…å®¹ | æ¨èæŠ€æœ¯æ ˆ | å­¦ä¹ é‡ç‚¹ | å­¦ä¹ æ—¶é—´ | å‰ç½®è¦æ±‚ | åç»­è¿›é˜¶ |
|---------|---------|-----------|---------|---------|---------|---------|
| **æ–°æ‰‹é˜¶æ®µ** | æ¦‚è¿°ã€Service Mesh + OPAç»„åˆ | æœåŠ¡é—´æƒé™æ¦‚å¿µç†è§£ | æƒé™ç†è§£ã€åŸºæœ¬æ¦‚å¿µç†è§£ | 2-4å‘¨ | æ—  | è¿›é˜¶é˜¶æ®µ |
| **è¿›é˜¶é˜¶æ®µ** | OPAæœåŠ¡é—´æƒé™ç­–ç•¥ã€Istio AuthorizationPolicyé›†æˆã€æœåŠ¡é—´æƒé™ç»„åˆæ¨¡å¼ | Service Meshã€OPAã€Istio | ç­–ç•¥ç†è§£ã€é›†æˆç†è§£ã€ç»„åˆç†è§£ | 8-16å‘¨ | æ–°æ‰‹é˜¶æ®µ | ä¸“å®¶é˜¶æ®µ |
| **ä¸“å®¶é˜¶æ®µ** | æƒé™ç»„åˆçš„å½’çº³æ”¶ç›Šã€å…¸å‹åœºæ™¯ã€å½¢å¼åŒ–å®šä¹‰ | å®Œæ•´æŠ€æœ¯æ ˆ | æ”¶ç›Šç†è§£ã€åœºæ™¯ç†è§£ã€å½¢å¼åŒ–ç†è§£ | 32+å‘¨ | è¿›é˜¶é˜¶æ®µ | - |

### 10.6 ä¸“å®¶æ¨èé˜…è¯»è·¯å¾„

**è·¯å¾„1ï¼šæƒé™ç†è§£è·¯å¾„**ï¼š

1. **ç¬¬ä¸€æ­¥**ï¼šé˜…è¯»æ¦‚è¿°ï¼ˆç¬¬1èŠ‚ï¼‰ï¼Œç†è§£æœåŠ¡é—´æƒé™æ¦‚è§ˆ
2. **ç¬¬äºŒæ­¥**ï¼šé˜…è¯»Service Mesh + OPAç»„åˆï¼ˆç¬¬2èŠ‚ï¼‰ï¼Œç†è§£åœºæ™¯æè¿°ã€æ¶æ„è®¾è®¡
3. **ç¬¬ä¸‰æ­¥**ï¼šé˜…è¯»æœåŠ¡é—´æƒé™ç»„åˆæ¨¡å¼ï¼ˆç¬¬5èŠ‚ï¼‰ï¼Œç†è§£ç»„åˆæ¨¡å¼ç±»å‹ã€ç»„åˆç¤ºä¾‹
4. **ç¬¬å››æ­¥**ï¼šé˜…è¯»æ€»ç»“ï¼ˆç¬¬9èŠ‚ï¼‰ï¼Œå›é¡¾å…³é”®è¦ç‚¹

**è·¯å¾„2ï¼šç­–ç•¥ç†è§£è·¯å¾„**ï¼š

1. **ç¬¬ä¸€æ­¥**ï¼šé˜…è¯»æ¦‚è¿°ï¼ˆç¬¬1èŠ‚ï¼‰ï¼Œäº†è§£æœåŠ¡é—´æƒé™
2. **ç¬¬äºŒæ­¥**ï¼šé˜…è¯»OPAæœåŠ¡é—´æƒé™ç­–ç•¥ï¼ˆç¬¬3èŠ‚ï¼‰ï¼Œå­¦ä¹ Regoç­–ç•¥ç¤ºä¾‹ã€ç»„åˆæ€§
3. **ç¬¬ä¸‰æ­¥**ï¼šé˜…è¯»Istio AuthorizationPolicyé›†æˆï¼ˆç¬¬4èŠ‚ï¼‰ï¼Œå­¦ä¹ AuthorizationPolicyé…ç½®ã€OPA Provideré…ç½®
4. **ç¬¬å››æ­¥**ï¼šé˜…è¯»æƒé™ç»„åˆçš„å½’çº³æ”¶ç›Šï¼ˆç¬¬6èŠ‚ï¼‰ï¼Œå­¦ä¹ ç»„åˆæ€§ã€å¯è¯æ˜æ€§ã€ç‰ˆæœ¬ä¸€è‡´æ€§

**è·¯å¾„3ï¼šå½¢å¼åŒ–ç†è§£è·¯å¾„**ï¼š

1. **ç¬¬ä¸€æ­¥**ï¼šé˜…è¯»æ¦‚è¿°ï¼ˆç¬¬1èŠ‚ï¼‰ï¼Œäº†è§£æœåŠ¡é—´æƒé™
2. **ç¬¬äºŒæ­¥**ï¼šé˜…è¯»å½¢å¼åŒ–å®šä¹‰ï¼ˆç¬¬8èŠ‚ï¼‰ï¼Œç†è§£æœåŠ¡é—´æƒé™å®šä¹‰ã€æƒé™å†³ç­–å®šä¹‰ã€æƒé™ç»„åˆå®šä¹‰
3. **ç¬¬ä¸‰æ­¥**ï¼šé˜…è¯»å…¸å‹åœºæ™¯ï¼ˆç¬¬7èŠ‚ï¼‰ï¼Œç†è§£å¾®æœåŠ¡æƒé™ç®¡ç†ã€å¤šç§Ÿæˆ·æƒé™ç®¡ç†
4. **ç¬¬å››æ­¥**ï¼šé˜…è¯»æ€»ç»“ï¼ˆç¬¬9èŠ‚ï¼‰ï¼Œå­¦ä¹ æœ€ä½³å®è·µ

---

**æ›´æ–°æ—¶é—´**ï¼š2025-11-15 **ç‰ˆæœ¬**ï¼šv1.1 **å‚è€ƒ**ï¼š`architecture_view.md` ç¬¬2028-2056è¡Œï¼ŒæœåŠ¡é—´æƒé™éƒ¨åˆ†

**æ›´æ–°å†…å®¹ï¼ˆv1.1ï¼‰**ï¼š

- âœ… æ·»åŠ è®¤çŸ¥å¢å¼ºç« èŠ‚ï¼ˆæ€ç»´å¯¼å›¾ã€çŸ¥è¯†çŸ©é˜µã€å½¢è±¡åŒ–è§£é‡Šã€ä¸“å®¶è§‚ç‚¹ï¼‰
- âœ… æ·»åŠ è®¤çŸ¥å­¦ä¹ è·¯å¾„çŸ©é˜µ
- âœ… æ·»åŠ ä¸“å®¶æ¨èé˜…è¯»è·¯å¾„ï¼ˆ3æ¡è·¯å¾„ï¼‰

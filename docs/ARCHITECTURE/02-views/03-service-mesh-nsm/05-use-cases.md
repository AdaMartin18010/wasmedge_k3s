# 典型用例：Service Mesh 与 NSM 的组合应用

## 📑 目录

- [典型用例：Service Mesh 与 NSM 的组合应用](#典型用例service-mesh-与-nsm-的组合应用)
  - [📑 目录](#-目录)
  - [1 概述](#1-概述)
    - [1.1 核心场景](#11-核心场景)
  - [2 混合云场景](#2-混合云场景)
    - [2.1 场景描述](#21-场景描述)
    - [2.2 实现步骤](#22-实现步骤)
    - [2.3 技术要点](#23-技术要点)
    - [2.4 业务价值](#24-业务价值)
  - [3 多租户 SaaS 场景](#3-多租户-saas-场景)
    - [3.1 场景描述](#31-场景描述)
    - [3.2 实现步骤](#32-实现步骤)
    - [3.3 技术要点](#33-技术要点)
    - [3.4 业务价值](#34-业务价值)
  - [4 边缘计算场景](#4-边缘计算场景)
    - [4.1 场景描述](#41-场景描述)
    - [4.2 实现步骤](#42-实现步骤)
    - [4.3 技术要点](#43-技术要点)
    - [4.4 业务价值](#44-业务价值)
  - [5 混合身份场景](#5-混合身份场景)
    - [5.1 场景描述](#51-场景描述)
    - [5.2 实现步骤](#52-实现步骤)
    - [5.3 技术要点](#53-技术要点)
    - [5.4 业务价值](#54-业务价值)
  - [6 典型案例：电商平台](#6-典型案例电商平台)
    - [6.1 场景描述](#61-场景描述)
    - [6.2 架构设计](#62-架构设计)
    - [6.3 实现效果](#63-实现效果)
  - [7 总结](#7-总结)

---

## 1 概述

本文档提供**Service Mesh 与 NSM 组合**的典型用例，展示在不同场景下的应用方式。

### 1.1 核心场景

| 场景                        | 组合方式                                                          | 关键技术                          | 业务价值                       |
| --------------------------- | ----------------------------------------------------------------- | --------------------------------- | ------------------------------ |
| **混合云（公有云 + 本地）** | 业务 Pod → Istio（公有云） → NSM vL3 → 本地 VMs → Physical Server | Istio, NSM, VPN, Spiffe           | 统一安全、统一可观测、无缝访问 |
| **多租户 SaaS**             | 业务 Pod → Istio (租户专属) → NSM (共享 vL3) → 共用 Endpoint      | Istio, NSM, Kubernetes Namespaces | 隔离 + 资源共享                |
| **边缘计算**                | 设备 → Edge NSM Node → Cloud NSM → Service Mesh                   | NSM, Edge Gateway, Istio          | 低延迟、统一治理               |
| **混合身份**                | Pod → Istio (MTLS) → NSM (Spiffe) → Identity Provider             | Istio, NSM, OIDC                  | 单一身份体系，跨域验证         |

## 2 混合云场景

### 2.1 场景描述

**业务需求**：

- 生产环境在公有云（AWS）
- 数据敏感的服务在本地数据中心
- 需要统一管理和监控

**架构设计**：

```text
AWS 公有云
├── 业务 Pod（Istio Sidecar）
└── Istio Control Plane
    └── NSM vL3
        └── vWire
            └── 本地数据中心
                ├── VMs（NSM Endpoint）
                └── Physical Servers
```

### 2.2 实现步骤

1. **部署 NSM**：在 AWS 和本地数据中心部署 NSM
2. **注册 Service Mesh**：将 Istio 注册为 NSM Network Service
3. **建立 vWire**：通过 vWire 连接 AWS 和本地数据中心
4. **配置策略**：通过 NSM 统一管理网络策略和安全策略

### 2.3 技术要点

- **Istio**：提供 Service Mesh 功能（流量治理、安全、监控）
- **NSM**：提供跨域网络聚合
- **VPN**：提供加密隧道
- **Spiffe**：提供统一身份认证

### 2.4 业务价值

- **统一安全**：通过 NSM 统一管理安全策略
- **统一可观测**：通过 NSM 统一监控网络流量
- **无缝访问**：业务 Pod 可以无缝访问本地数据中心的服务

## 3 多租户 SaaS 场景

### 3.1 场景描述

**业务需求**：

- 多租户 SaaS 应用
- 每个租户需要隔离
- 共享基础设施降低成本

**架构设计**：

```text
租户 A
├── 业务 Pod（Istio Sidecar - 租户专属）
└── Istio Control Plane（租户专属）
    └── NSM（共享 vL3）
        └── 共用 Endpoint
            ├── 数据库（租户隔离）
            └── 缓存（租户隔离）
```

### 3.2 实现步骤

1. **租户隔离**：使用 Kubernetes Namespaces 隔离租户
2. **Service Mesh 隔离**：每个租户使用独立的 Istio Control Plane
3. **NSM 共享**：使用共享的 NSM vL3 降低成本
4. **Endpoint 隔离**：通过策略隔离不同租户的 Endpoint

### 3.3 技术要点

- **Istio**：提供租户专属的 Service Mesh
- **NSM**：提供共享的网络服务
- **Kubernetes Namespaces**：提供租户隔离
- **OPA**：提供策略隔离

### 3.4 业务价值

- **隔离**：每个租户独立隔离
- **资源共享**：共享基础设施降低成本
- **统一管理**：通过 NSM 统一管理网络服务

## 4 边缘计算场景

### 4.1 场景描述

**业务需求**：

- 边缘设备需要低延迟访问
- 需要统一管理和监控
- 支持离线运行

**架构设计**：

```text
边缘设备
├── Edge NSM Node
└── NSM vWire
    └── 云端
        ├── Cloud NSM
        └── Service Mesh
            └── 业务服务
```

### 4.2 实现步骤

1. **部署 Edge NSM Node**：在边缘设备部署 NSM Node
2. **建立 vWire**：通过 vWire 连接边缘设备和云端
3. **配置策略**：通过 NSM 统一管理网络策略
4. **离线支持**：支持边缘设备离线运行

### 4.3 技术要点

- **NSM**：提供跨域网络聚合
- **Edge Gateway**：提供边缘网关功能
- **Istio**：提供 Service Mesh 功能
- **离线缓存**：支持边缘设备离线运行

### 4.4 业务价值

- **低延迟**：边缘设备就近访问，降低延迟
- **统一治理**：通过 NSM 统一管理边缘和云端
- **离线支持**：支持边缘设备离线运行

## 5 混合身份场景

### 5.1 场景描述

**业务需求**：

- 多个身份提供者（OIDC、LDAP、本地）
- 需要统一身份认证
- 跨域身份验证

**架构设计**：

```text
Pod
├── Istio Sidecar（MTLS）
└── SPIFFE ID
    └── NSM vWire
        └── Identity Provider
            ├── OIDC
            ├── LDAP
            └── 本地认证
```

### 5.2 实现步骤

1. **统一身份**：使用 SPIFFE 提供统一身份
2. **Service Mesh MTLS**：通过 Istio 提供 mTLS
3. **NSM 身份传递**：通过 NSM vWire 传递身份信息
4. **身份提供者集成**：集成多个身份提供者

### 5.3 技术要点

- **Istio**：提供 mTLS 和身份认证
- **NSM**：提供跨域身份传递
- **SPIFFE**：提供统一身份标识
- **OIDC**：提供标准身份认证协议

### 5.4 业务价值

- **单一身份体系**：通过 SPIFFE 提供统一身份
- **跨域验证**：通过 NSM 支持跨域身份验证
- **标准化**：使用标准协议（OIDC、SPIFFE）

## 6 典型案例：电商平台

### 6.1 场景描述

**电商平台在 AWS 生产集群和自有数据中心共享统一的 Service Mesh**：

- **AWS 集群**：运行订单服务、支付服务
- **本地数据中心**：运行库存服务、用户服务
- **需求**：统一管理、统一监控、统一安全

### 6.2 架构设计

```text
AWS 集群
├── 订单服务（Istio Sidecar）
├── 支付服务（Istio Sidecar）
└── Istio Control Plane
    └── NSM vL3
        └── vWire
            └── 本地数据中心
                ├── 库存服务（NSM Endpoint）
                └── 用户服务（NSM Endpoint）
```

### 6.3 实现效果

- **统一 API**：所有服务使用同一 API
- **自动加密**：跨域流量自动加密
- **自动限流**：通过 Istio 自动限流
- **统一监控**：通过 NSM 统一监控
- **合规验证**：一次验证覆盖两地

## 7 总结

通过**典型用例**，我们可以看到 Service Mesh 与 NSM 的组合应用：

1. **混合云**：统一管理公有云和私有云
2. **多租户 SaaS**：隔离 + 资源共享
3. **边缘计算**：低延迟 + 统一治理
4. **混合身份**：单一身份体系 + 跨域验证

---

**更新时间**：2025-11-04 **版本**：v1.0 **参考**：`architecture_view.md` 第
496-508 行，典型用例部分

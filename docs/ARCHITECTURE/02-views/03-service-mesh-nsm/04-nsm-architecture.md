# NSM æ¶æ„ï¼šNetwork Service Mesh ç½‘ç»œæŠ½è±¡

## ğŸ“‘ ç›®å½•

- [NSM æ¶æ„ï¼šNetwork Service Mesh ç½‘ç»œæŠ½è±¡](#nsm-æ¶æ„network-service-mesh-ç½‘ç»œæŠ½è±¡)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [1 æ¦‚è¿°](#1-æ¦‚è¿°)
    - [1.1 æ ¸å¿ƒæ€æƒ³](#11-æ ¸å¿ƒæ€æƒ³)
  - [2 NSM æ ¸å¿ƒæ¦‚å¿µ](#2-nsm-æ ¸å¿ƒæ¦‚å¿µ)
    - [2.1 å…³é”®æ¦‚å¿µ](#21-å…³é”®æ¦‚å¿µ)
    - [2.2 NSM æ¶æ„å±‚æ¬¡](#22-nsm-æ¶æ„å±‚æ¬¡)
  - [3 NSM æ ¸å¿ƒç»„ä»¶](#3-nsm-æ ¸å¿ƒç»„ä»¶)
    - [3.1 vL3ï¼ˆè™šæ‹Ÿ L3 ç½‘ç»œï¼‰](#31-vl3è™šæ‹Ÿ-l3-ç½‘ç»œ)
    - [3.2 vWireï¼ˆè™šæ‹Ÿéš§é“ï¼‰](#32-vwireè™šæ‹Ÿéš§é“)
    - [3.3 Endpointsï¼ˆç«¯ç‚¹ï¼‰](#33-endpointsç«¯ç‚¹)
  - [4 NSM æ¶æ„è®¾è®¡](#4-nsm-æ¶æ„è®¾è®¡)
    - [4.1 æŠŠ Service Mesh æ‰“åŒ…ä¸º Network Service](#41-æŠŠ-service-mesh-æ‰“åŒ…ä¸º-network-service)
    - [4.2 ç»„åˆå¤šäº‘/è·¨é›†ç¾¤ç½‘ç»œ](#42-ç»„åˆå¤šäº‘è·¨é›†ç¾¤ç½‘ç»œ)
  - [5 NSM ä¸ Service Mesh çš„ç»„åˆ](#5-nsm-ä¸-service-mesh-çš„ç»„åˆ)
    - [5.1 ç»„åˆæ–¹å¼](#51-ç»„åˆæ–¹å¼)
    - [5.2 å…¸å‹åœºæ™¯](#52-å…¸å‹åœºæ™¯)
  - [6 NSM æ¶æ„ä¼˜åŠ¿](#6-nsm-æ¶æ„ä¼˜åŠ¿)
    - [6.1 è·¨åŸŸç½‘ç»œèšåˆ](#61-è·¨åŸŸç½‘ç»œèšåˆ)
    - [6.2 ç»Ÿä¸€ç½‘ç»œæ²»ç†](#62-ç»Ÿä¸€ç½‘ç»œæ²»ç†)
    - [6.3 å¯ç»„åˆæ€§](#63-å¯ç»„åˆæ€§)
  - [7 å½¢å¼åŒ–å®šä¹‰](#7-å½¢å¼åŒ–å®šä¹‰)
    - [7.1 NSM æ¶æ„å®šä¹‰](#71-nsm-æ¶æ„å®šä¹‰)
    - [7.2 vWire å®šä¹‰](#72-vwire-å®šä¹‰)
    - [7.3 Network Service å®šä¹‰](#73-network-service-å®šä¹‰)
  - [8 æ€»ç»“](#8-æ€»ç»“)

---

## 1 æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†é˜è¿°**Network Service Mesh (NSM)** çš„æ¶æ„è®¾è®¡ï¼Œè¿™æ˜¯å°† Service Mesh ä½œ
ä¸º Network Service çš„ç½‘ç»œæŠ½è±¡å±‚ã€‚

### 1.1 æ ¸å¿ƒæ€æƒ³

> **NSM é€šè¿‡ vL3ã€vWireã€Endpoints å®ç°è·¨åŸŸç½‘ç»œèšåˆï¼Œå°† Service Mesh ä½œä¸º
> Network Service ç»Ÿä¸€ç®¡ç†**

## 2 NSM æ ¸å¿ƒæ¦‚å¿µ

### 2.1 å…³é”®æ¦‚å¿µ

| åç§°                           | å…¸å‹æŠ€æœ¯                       | ä¸»è¦èŒè´£                                                                           |
| ------------------------------ | ------------------------------ | ---------------------------------------------------------------------------------- |
| **Service Mesh**               | Istio, Linkerd, Consul, Kuma   | ä»£ç†ã€æµé‡æ²»ç†ã€æœåŠ¡æ²»ç†ã€ç†”æ–­ã€ç›‘æ§ã€MTLSã€ä¾§è½¦æ³¨å…¥                               |
| **Network Service Mesh (NSM)** | Networkâ€‘Serviceâ€‘Mesh.io        | æŠŠä»»æ„å·¥ä½œè´Ÿè½½ï¼ˆPodã€VMã€ç‰©ç†æœºï¼‰è¿æ¥åˆ° **"ç½‘ç»œæœåŠ¡"**ï¼›æ”¯æŒå¤šç½‘æ ¼ã€å¤šäº‘ã€è·¨åŸŸç½‘ç»œ |
| **ç½‘ç»œæœåŠ¡ (Network Service)** | vL3ã€IPsecã€WAFã€IPSã€DNSã€VPN | è¿æ¥ã€åŠ å¯†ã€ç›‘æ§ã€ç­–ç•¥ã€DNS è§£æ                                                   |
| **vWire (Virtual Wire)**       | é€»è¾‘éš§é“                       | è´Ÿè´£åœ¨ **Client** ä¸ **Endpoint** ä¹‹é—´è½¬å‘æ•°æ®ï¼›å¯æºå¸¦å®‰å…¨/å¯è§‚æµ‹ä¿¡æ¯              |
| **Client / Endpoint**          | Podã€VMã€ç‰©ç†æœº                | å‚ä¸ NSM è¿æ¥çš„ç»ˆç«¯ï¼Œæˆ–æä¾›ç½‘ç»œæœåŠ¡çš„ç»ˆç«¯                                          |

### 2.2 NSM æ¶æ„å±‚æ¬¡

```text
+-----------------------------------------------------------+
| 1. åº”ç”¨å±‚  (ä¸šåŠ¡å¾®æœåŠ¡)                                 |
|   â””â”€ Service Mesh  (Istio/Linkerd sidecars)              |
+-----------------------------------------------------------+
| 2. æœåŠ¡ç½‘æ ¼å±‚ (Service Mesh)                            |
|   â””â”€ Serviceâ€‘Mesh Sidecar + Control Plane                |
+-----------------------------------------------------------+
| 3. ç½‘ç»œæœåŠ¡å±‚ (NSM)                                      |
|   â””â”€ vL3  +  vWire + Network Service Endpoints          |
+-----------------------------------------------------------+
| 4. åŸºç¡€è®¾æ–½å±‚ (K8s/VM/ç‰©ç†)                              |
|   â””â”€ Pods / VMs / Physical Servers (Clients / Endpoints)|
+-----------------------------------------------------------+
```

## 3 NSM æ ¸å¿ƒç»„ä»¶

### 3.1 vL3ï¼ˆè™šæ‹Ÿ L3 ç½‘ç»œï¼‰

**vL3** æ˜¯ NSM çš„è™šæ‹Ÿ L3 ç½‘ç»œå±‚ï¼Œæä¾›ï¼š

- **ç½‘ç»œæŠ½è±¡**ï¼šå°†ç‰©ç†ç½‘ç»œæŠ½è±¡ä¸ºè™šæ‹Ÿç½‘ç»œ
- **æœåŠ¡å‘ç°**ï¼šå‘ç°å’Œæ³¨å†Œç½‘ç»œæœåŠ¡
- **è·¯ç”±ç®¡ç†**ï¼šç®¡ç†è™šæ‹Ÿç½‘ç»œè·¯ç”±

### 3.2 vWireï¼ˆè™šæ‹Ÿéš§é“ï¼‰

**vWire** æ˜¯ NSM çš„è™šæ‹Ÿéš§é“ï¼Œæä¾›ï¼š

- **é€»è¾‘éš§é“**ï¼šåœ¨ Client ä¸ Endpoint ä¹‹é—´å»ºç«‹é€»è¾‘éš§é“
- **æ•°æ®è½¬å‘**ï¼šè´Ÿè´£æ•°æ®è½¬å‘ï¼Œå¯æºå¸¦å®‰å…¨/å¯è§‚æµ‹ä¿¡æ¯
- **è·¨åŸŸè¿æ¥**ï¼šæ”¯æŒè·¨é›†ç¾¤ã€è·¨äº‘ã€è·¨ç¡¬ä»¶è¿æ¥

### 3.3 Endpointsï¼ˆç«¯ç‚¹ï¼‰

**Endpoints** æ˜¯ NSM çš„ç«¯ç‚¹ï¼ŒåŒ…æ‹¬ï¼š

- **Client**ï¼šè¯·æ±‚ç½‘ç»œæœåŠ¡çš„å®¢æˆ·ç«¯ï¼ˆPodã€VMã€ç‰©ç†æœºï¼‰
- **Endpoint**ï¼šæä¾›ç½‘ç»œæœåŠ¡çš„ç«¯ç‚¹ï¼ˆPodã€VMã€ç‰©ç†æœºï¼‰

## 4 NSM æ¶æ„è®¾è®¡

### 4.1 æŠŠ Service Mesh æ‰“åŒ…ä¸º Network Service

**æ­¥éª¤**ï¼š

1. **æ³¨å†Œ Service Mesh**ï¼šæŠŠ Istio/Linkerd çš„ **vL3** ä¸ **Endpoint** æŠ½è±¡ä¸º
   **NSM Network Service**
2. **NSM å…è®¸å¤š Service Mesh å åŠ **ï¼šåœ¨åŒä¸€ vL3 ä¸Šæ³¨å†Œå¤šä¸ª **Network Service**ï¼ˆ
   ä¾‹å¦‚ Istioã€Linkerdã€Kumaï¼‰
3. **é€šè¿‡ vWire ç»†ç²’åº¦æµé‡æ²»ç†**ï¼švWire è´Ÿè´£ **TLSã€ç†”æ–­ã€é™æµ**ï¼›å¯æºå¸¦
   `labels` è¿›è¡Œæµé‡è·¯ç”±

**ç¤ºä¾‹**ï¼š

```bash
# æ³¨å†Œ Istio ä¸º NSM ç½‘ç»œæœåŠ¡
nsmctl ns create istio-namespace --namespace=istio-system

# æ³¨å†Œ VM æˆ–ç‰©ç†æœåŠ¡å™¨ä¸º Endpoint
nsmctl endpoint create vm-endpoint --address=10.0.0.5

# åœ¨ Pod é‡Œè¯·æ±‚ vWire
nsmctl client create orders-vwire --service=orders --endpoint=vm-endpoint
```

### 4.2 ç»„åˆå¤šäº‘/è·¨é›†ç¾¤ç½‘ç»œ

| ç›®æ ‡                   | æ–¹æ¡ˆ                                                                            | å…³é”®æŠ€æœ¯                               |
| ---------------------- | ------------------------------------------------------------------------------- | -------------------------------------- |
| **è·¨ Kubernetes é›†ç¾¤** | åœ¨æ¯ä¸ªé›†ç¾¤éƒ¨ç½² **NSM vL3**ï¼›ä½¿ç”¨ **NSM Federation**                             | `nsm create federated-network-service` |
| **è·¨ç‰©ç†æœºä¸äº‘**       | åœ¨ç‰©ç†æœºéƒ¨ç½² **NSM Endpoint**ï¼ˆe.g., via `nsm-node` daemonï¼‰ï¼›ä½¿ç”¨ `vWire` ç›´è¿ | `nsmctl node create`                   |
| **è·¨å¤šäº‘**             | åœ¨æ¯ä¸ªäº‘ç¯å¢ƒéƒ¨ç½² **NSM**ï¼Œä½¿ç”¨ **VPN** + `vWire` è¿æ¥                           | `nsm install --cloud`                  |

**é€šè¿‡ vWire**ï¼Œæµé‡å¯åœ¨ **Pod â†’ VM â†’ ç‰©ç†æœº** ä¹‹é—´é€æ˜è½¬å‘ï¼Œä¸”æ¯ä¸ªé“¾è·¯å¯ç‹¬ç«‹åŠ 
å¯†ã€ç›‘æ§ã€‚

## 5 NSM ä¸ Service Mesh çš„ç»„åˆ

### 5.1 ç»„åˆæ–¹å¼

**ç»„åˆç­–ç•¥**ï¼š

1. **æŠŠ Service Mesh ä½œä¸º Network Service** æ³¨å†Œåˆ° NSM
2. åœ¨ **Pod** å†…é€šè¿‡ `Istio` ä¾§è½¦æ³¨å…¥ï¼Œ`nsmctl client create` ç”Ÿæˆ `vWire` ä¸
   **Endpoint** è¿æ¥
3. é€šè¿‡ **NSM Federation** æŠŠå¤šé›†ç¾¤ã€è·¨äº‘çš„ Service Mesh äº’è”

### 5.2 å…¸å‹åœºæ™¯

**æ··åˆäº‘ï¼ˆå…¬æœ‰äº‘ + æœ¬åœ°ï¼‰**ï¼š

```text
ä¸šåŠ¡ Pod â†’ Istioï¼ˆå…¬æœ‰äº‘ï¼‰ â†’ NSM vL3 â†’ æœ¬åœ° VMs â†’ Physical Server
```

**å¤šç§Ÿæˆ· SaaS**ï¼š

```text
ä¸šåŠ¡ Pod â†’ Istio (ç§Ÿæˆ·ä¸“å±) â†’ NSM (å…±äº« vL3) â†’ å…±ç”¨ Endpoint
```

**è¾¹ç¼˜è®¡ç®—**ï¼š

```text
è®¾å¤‡ â†’ Edge NSM Node â†’ Cloud NSM â†’ Service Mesh
```

## 6 NSM æ¶æ„ä¼˜åŠ¿

### 6.1 è·¨åŸŸç½‘ç»œèšåˆ

- **è·¨é›†ç¾¤**ï¼šæ”¯æŒè·¨ Kubernetes é›†ç¾¤è¿æ¥
- **è·¨äº‘**ï¼šæ”¯æŒè·¨å…¬æœ‰äº‘å’Œç§æœ‰äº‘è¿æ¥
- **è·¨ç¡¬ä»¶**ï¼šæ”¯æŒ Podã€VMã€ç‰©ç†æœºç»Ÿä¸€ç®¡ç†

### 6.2 ç»Ÿä¸€ç½‘ç»œæ²»ç†

- **ç»Ÿä¸€ç­–ç•¥**ï¼šé€šè¿‡ NSM ç»Ÿä¸€ç®¡ç†ç½‘ç»œç­–ç•¥
- **ç»Ÿä¸€ç›‘æ§**ï¼šé€šè¿‡ NSM ç»Ÿä¸€ç›‘æ§ç½‘ç»œæµé‡
- **ç»Ÿä¸€å®‰å…¨**ï¼šé€šè¿‡ NSM ç»Ÿä¸€å®æ–½å®‰å…¨ç­–ç•¥

### 6.3 å¯ç»„åˆæ€§

- **å¤š Service Mesh å åŠ **ï¼šæ”¯æŒå¤šä¸ª Service Mesh åŒæ—¶è¿è¡Œ
- **çµæ´»ç»„åˆ**ï¼šæ”¯æŒä¸åŒçš„ç½‘ç»œæœåŠ¡ç»„åˆ

## 7 å½¢å¼åŒ–å®šä¹‰

### 7.1 NSM æ¶æ„å®šä¹‰

```text
NSM = âŸ¨vL3, vWire, endpoints, clientsâŸ©
å…¶ä¸­ï¼š
- vL3: è™šæ‹Ÿ L3 ç½‘ç»œ
- vWire: è™šæ‹Ÿéš§é“é›†åˆ
- endpoints: ç«¯ç‚¹é›†åˆ
- clients: å®¢æˆ·ç«¯é›†åˆ
```

### 7.2 vWire å®šä¹‰

```text
vWire = âŸ¨client, endpoint, tunnel, policiesâŸ©
å…¶ä¸­ï¼š
- client: å®¢æˆ·ç«¯
- endpoint: ç«¯ç‚¹
- tunnel: éš§é“é…ç½®
- policies: ç­–ç•¥é…ç½®ï¼ˆå®‰å…¨ã€ç›‘æ§ã€è·¯ç”±ï¼‰
```

### 7.3 Network Service å®šä¹‰

```text
NetworkService = âŸ¨name, vL3, endpoints, policiesâŸ©
å…¶ä¸­ï¼š
- name: æœåŠ¡åç§°
- vL3: è™šæ‹Ÿ L3 ç½‘ç»œ
- endpoints: ç«¯ç‚¹é›†åˆ
- policies: ç­–ç•¥é…ç½®
```

## 8 æ€»ç»“

é€šè¿‡**NSM æ¶æ„**ï¼Œæˆ‘ä»¬å¯ä»¥ï¼š

1. **è·¨åŸŸç½‘ç»œèšåˆ**ï¼šæ”¯æŒè·¨é›†ç¾¤ã€è·¨äº‘ã€è·¨ç¡¬ä»¶ç»Ÿä¸€ç®¡ç†
2. **ç»Ÿä¸€ç½‘ç»œæ²»ç†**ï¼šé€šè¿‡ NSM ç»Ÿä¸€ç®¡ç†ç½‘ç»œç­–ç•¥ã€ç›‘æ§ã€å®‰å…¨
3. **å¯ç»„åˆæ€§**ï¼šæ”¯æŒå¤šä¸ª Service Mesh å åŠ å’Œçµæ´»ç»„åˆ
4. **é€æ˜è½¬å‘**ï¼šé€šè¿‡ vWire å®ç° Pod â†’ VM â†’ ç‰©ç†æœºé€æ˜è½¬å‘

---

**æ›´æ–°æ—¶é—´**ï¼š2025-11-04 **ç‰ˆæœ¬**ï¼šv1.0 **å‚è€ƒ**ï¼š`architecture_view.md` ç¬¬
391-610 è¡Œï¼ŒNSM éƒ¨åˆ†

# 属性矩阵：虚拟化、容器化、沙盒化对比

## 📑 目录

- [📑 目录](#-目录)
- [1. 概述](#1-概述)
- [2. 核心属性对比矩阵](#2-核心属性对比矩阵)
- [3. 形式化属性定义](#3-形式化属性定义)
  - [3.1 隔离级别](#31-隔离级别)
  - [3.2 资源开销](#32-资源开销)
  - [3.3 启动时间](#33-启动时间)
  - [3.4 安全模型](#34-安全模型)
- [4. 属性关系图](#4-属性关系图)
  - [4.1 包含关系](#41-包含关系)
  - [4.2 属性映射](#42-属性映射)
- [5. 技术选型决策树](#5-技术选型决策树)
  - [5.1 隔离需求](#51-隔离需求)
  - [5.2 性能需求](#52-性能需求)
  - [5.3 安全需求](#53-安全需求)
- [6. 组合场景](#6-组合场景)
  - [6.1 VM + Container](#61-vm--container)
  - [6.2 Container + Sandbox](#62-container--sandbox)
  - [6.3 VM + Container + Sandbox](#63-vm--container--sandbox)
- [7. 属性权衡矩阵](#7-属性权衡矩阵)
  - [7.1 隔离 vs 性能](#71-隔离-vs-性能)
  - [7.2 安全 vs 灵活性](#72-安全-vs-灵活性)
- [8. 总结](#8-总结)

---

## 1. 概述

本文档提供**虚拟化、容器化、沙盒化**的**属性矩阵对比**，帮助快速进行技术选型和安
全/性能权衡。

## 2. 核心属性对比矩阵

| 属性            | 虚拟化                              | 容器化                         | 沙盒化                             |
| --------------- | ----------------------------------- | ------------------------------ | ---------------------------------- |
| **隔离级别**    | 完全硬件级（CPU、内存）             | OS 进程级（namespace, cgroup） | 进程级+系统调用过滤                |
| **资源开销**    | 高（每 VM 占用 ~ 2–3× RAM）         | 低（共享内核）                 | 低（与容器同级）                   |
| **启动时间**    | 10–30 s                             | < 1 s                          | < 1 s                              |
| **可移植性**    | 高（可迁移到不同硬件）              | 高（镜像可跨平台）             | 高（镜像+过滤规则可携带）          |
| **安全模型**    | 隔离、快照                          | 隔离、文件系统                 | 最小权限、动态可编程               |
| **网络模型**    | 虚拟 NIC, NAT, vSwitch              | Docker 网络, CNI               | 与容器共享，细粒度过滤             |
| **监控/可观测** | 需要自定义监控 (cAdvisor, collectd) | 通过 cAdvisor、Prometheus      | 通过 eBPF、BPFtrace                |
| **适用场景**    | 大型批处理、数据库, 云主机          | 微服务、CI/CD, 轻量化          | 代码沙盒、沙箱化部署、恶意代码隔离 |

## 3. 形式化属性定义

### 3.1 隔离级别

```text
隔离级别 Isolation(u) ∈ {Hardware, OS, Process, Syscall}
其中：
- Hardware: 完全硬件隔离（VM）
- OS: 操作系统级隔离（Container）
- Process: 进程级隔离（Sandbox）
- Syscall: 系统调用级过滤（Sandbox）
```

### 3.2 资源开销

```text
资源开销 Overhead(u) = CPU(u) + Memory(u) + I/O(u)
其中：
- VM: Overhead ≈ 2-3× RAM
- Container: Overhead ≈ 10-50 MB
- Sandbox: Overhead ≈ 5-20 MB
```

### 3.3 启动时间

```text
启动时间 StartTime(u) = f(image_size, isolation_level)
其中：
- VM: StartTime ≈ 10-30 s
- Container: StartTime < 1 s
- Sandbox: StartTime < 1 s
```

### 3.4 安全模型

```text
安全模型 Security(u) = ⟨isolation, capability, policy⟩
其中：
- isolation: 隔离级别
- capability: 能力集合
- policy: 策略规则（OPA）
```

## 4. 属性关系图

### 4.1 包含关系

```text
虚拟化 ⊃ 容器化 ⊃ 沙盒化

VM ⊃ Container ⊃ Sandbox
```

### 4.2 属性映射

```text
隔离级别: Hardware → OS → Process → Syscall
资源开销: High → Medium → Low
启动时间: 10-30s → <1s → <1s
安全模型: Isolation → Isolation+Overlay → Min-priv+eBPF
```

## 5. 技术选型决策树

### 5.1 隔离需求

```text
需要硬件级隔离？
├─ 是 → 虚拟化（VM）
└─ 否 → 需要进程级隔离？
    ├─ 是 → 需要系统调用过滤？
    │   ├─ 是 → 沙盒化（Sandbox）
    │   └─ 否 → 容器化（Container）
    └─ 否 → 容器化（Container）
```

### 5.2 性能需求

```text
需要快速启动？
├─ 是 → 容器化（Container）或 沙盒化（Sandbox）
└─ 否 → 需要硬件隔离？
    ├─ 是 → 虚拟化（VM）
    └─ 否 → 容器化（Container）
```

### 5.3 安全需求

```text
需要最小权限？
├─ 是 → 沙盒化（Sandbox）
└─ 否 → 需要硬件隔离？
    ├─ 是 → 虚拟化（VM）
    └─ 否 → 容器化（Container）
```

## 6. 组合场景

### 6.1 VM + Container

**场景**：在 VM 上运行容器

- **隔离级别**：硬件级 + OS 级
- **适用场景**：需要硬件隔离的容器化应用

### 6.2 Container + Sandbox

**场景**：在容器内运行沙盒

- **隔离级别**：OS 级 + 进程级
- **适用场景**：需要最小权限的容器化应用

### 6.3 VM + Container + Sandbox

**场景**：在 VM 上运行容器，容器内运行沙盒

- **隔离级别**：硬件级 + OS 级 + 进程级
- **适用场景**：需要多层隔离的高安全应用

## 7. 属性权衡矩阵

### 7.1 隔离 vs 性能

| 技术   | 隔离级别 | 性能开销 | 适用场景           |
| ------ | -------- | -------- | ------------------ |
| 虚拟化 | 高       | 高       | 需要硬件隔离的应用 |
| 容器化 | 中       | 低       | 微服务、CI/CD      |
| 沙盒化 | 高       | 低       | 需要最小权限的应用 |

### 7.2 安全 vs 灵活性

| 技术   | 安全级别 | 灵活性 | 适用场景           |
| ------ | -------- | ------ | ------------------ |
| 虚拟化 | 高       | 中     | 需要硬件隔离的应用 |
| 容器化 | 中       | 高     | 微服务、CI/CD      |
| 沙盒化 | 高       | 中     | 需要最小权限的应用 |

## 8. 总结

通过**属性矩阵对比**，我们可以：

1. **快速定位技术选型**：根据隔离需求、性能需求、安全需求选择合适的技术
2. **理解属性权衡**：隔离 vs 性能、安全 vs 灵活性
3. **组合使用场景**：VM + Container、Container + Sandbox 等组合场景
4. **形式化定义属性**：隔离级别、资源开销、启动时间、安全模型等

---

**更新时间**：2025-11-04 **版本**：v1.0 **参考**：`architecture_view.md` 第
766-792 行，矩阵对比部分

# Î¨â‚„ï¼šç½‘ç»œæŠ½è±¡å½’çº³ï¼ˆä» IP åˆ°èº«ä»½-é©±åŠ¨æ‹“æ‰‘ï¼‰

## ğŸ“‘ ç›®å½•

- [ğŸ“‘ ç›®å½•](#-ç›®å½•)
- [1 æ¦‚è¿°](#1-æ¦‚è¿°)
  - [1.1 æ ¸å¿ƒæ€æƒ³](#11-æ ¸å¿ƒæ€æƒ³)
  - [1.2 æ˜ å°„ç›®æ ‡](#12-æ˜ å°„ç›®æ ‡)
- [2 æ˜ å°„å®šä¹‰](#2-æ˜ å°„å®šä¹‰)
  - [2.1 æ˜ å°„å½¢å¼åŒ–](#21-æ˜ å°„å½¢å¼åŒ–)
  - [2.2 æ˜ å°„æœºåˆ¶](#22-æ˜ å°„æœºåˆ¶)
  - [2.3 æ˜ å°„å®ç°](#23-æ˜ å°„å®ç°)
- [3 å…¬ç†éªŒè¯](#3-å…¬ç†éªŒè¯)
  - [3.1 A1ï¼šå†¯Â·è¯ºä¾æ›¼ç­‰ä»·](#31-a1å†¯è¯ºä¾æ›¼ç­‰ä»·)
  - [3.2 A2ï¼šOS èµ„æºå°é—­](#32-a2os-èµ„æºå°é—­)
  - [3.3 A3ï¼šç½‘ç»œå¼‚æ­¥äº¤ä»˜](#33-a3ç½‘ç»œå¼‚æ­¥äº¤ä»˜)
  - [3.4 A4ï¼šåˆ†å±‚å¯æŠ½è±¡](#34-a4åˆ†å±‚å¯æŠ½è±¡)
- [4 çŠ¶æ€ç©ºé—´å‹ç¼©](#4-çŠ¶æ€ç©ºé—´å‹ç¼©)
  - [4.1 è·¯ç”±è¡¨å‹ç¼©](#41-è·¯ç”±è¡¨å‹ç¼©)
  - [4.2 æ‹“æ‰‘æŠ½è±¡](#42-æ‹“æ‰‘æŠ½è±¡)
  - [4.3 çŠ¶æ€ç©ºé—´å‹ç¼©](#43-çŠ¶æ€ç©ºé—´å‹ç¼©)
- [5 å…³é”®å®šç† T1](#5-å…³é”®å®šç†-t1)
  - [5.1 å®šç†æè¿°](#51-å®šç†æè¿°)
  - [5.2 å®šç†æ„ä¹‰](#52-å®šç†æ„ä¹‰)
  - [5.3 æ¨è®º](#53-æ¨è®º)
  - [5.4 è¯¦ç»†æ–‡æ¡£](#54-è¯¦ç»†æ–‡æ¡£)
- [6 å®è¯éªŒè¯](#6-å®è¯éªŒè¯)
  - [6.1 Service Mesh ç”Ÿäº§ç¯å¢ƒ](#61-service-mesh-ç”Ÿäº§ç¯å¢ƒ)
  - [6.2 é‡‘ä¸é›€å‘å¸ƒ](#62-é‡‘ä¸é›€å‘å¸ƒ)
  - [6.3 çŠ¶æ€ç©ºé—´å‹ç¼©](#63-çŠ¶æ€ç©ºé—´å‹ç¼©)
- [7 ç›¸å…³æ–‡æ¡£](#7-ç›¸å…³æ–‡æ¡£)
  - [7.1 å½’çº³è¯æ˜æ–‡æ¡£](#71-å½’çº³è¯æ˜æ–‡æ¡£)
  - [7.2 å¼•ç†å’Œå®šç†æ–‡æ¡£](#72-å¼•ç†å’Œå®šç†æ–‡æ¡£)
  - [7.3 å…¬ç†å±‚æ–‡æ¡£](#73-å…¬ç†å±‚æ–‡æ¡£)
  - [7.4 çŠ¶æ€ç©ºé—´å‹ç¼©æ–‡æ¡£](#74-çŠ¶æ€ç©ºé—´å‹ç¼©æ–‡æ¡£)
  - [7.5 ç»Ÿä¸€æ¨¡å‹æ–‡æ¡£](#75-ç»Ÿä¸€æ¨¡å‹æ–‡æ¡£)
  - [7.6 æºæ–‡æ¡£](#76-æºæ–‡æ¡£)

---

## 1 æ¦‚è¿°

**ç½‘ç»œæŠ½è±¡å½’çº³ï¼ˆÎ¨â‚„ï¼‰**å°†ç½‘ç»œå±‚ä» IP åœ°å€é©±åŠ¨æ‹“æ‰‘æ˜ å°„åˆ°èº«ä»½é©±åŠ¨æ‹“æ‰‘ï¼Œå®ç°æœåŠ¡å‘ç°
å’Œè·¯ç”±çš„ç»Ÿä¸€æŠ½è±¡ã€‚

### 1.1 æ ¸å¿ƒæ€æƒ³

> **é€šè¿‡èº«ä»½-è·¯ç”±ç­‰ä»·ï¼Œå°† IP åœ°å€æŠ½è±¡ä¸ºæœåŠ¡åå’Œæ ‡ç­¾ï¼Œå®ç°ç½‘ç»œæ‹“æ‰‘çš„ç»Ÿä¸€æŠ½è±¡å’ŒåŠ¨
> æ€è·¯ç”±**

### 1.2 æ˜ å°„ç›®æ ‡

**ç›®æ ‡**ï¼šé€šè¿‡ Î¨â‚„ : âŸ¨IP:Port, TCP, BGPâŸ© â†’ âŸ¨ServiceName, Label, xDSâŸ©ï¼Œä½¿å¾—ï¼š

- âœ… A1 ä»ç„¶æˆç«‹ï¼ˆä¿æŒå›¾çµå®Œå¤‡æ€§ï¼‰
- âœ… A2 ä»ç„¶æˆç«‹ï¼ˆä¿æŒèµ„æºå°é—­æ€§ï¼‰
- âœ… A3 æˆç«‹ï¼ˆå®ç°ç½‘ç»œå¼‚æ­¥äº¤ä»˜ï¼‰
- âœ… A4 æˆç«‹ï¼ˆå®ç°çŠ¶æ€ç©ºé—´å‹ç¼©ï¼‰

---

## 2 æ˜ å°„å®šä¹‰

### 2.1 æ˜ å°„å½¢å¼åŒ–

**æ˜ å°„**ï¼šÎ¨â‚„ : âŸ¨IP:Port, TCP, BGPâŸ© â†’ âŸ¨ServiceName, Label, xDSâŸ©

å…¶ä¸­ï¼š

- **è¾“å…¥**ï¼šIP åœ°å€ã€ç«¯å£ã€TCP åè®®ã€BGP è·¯ç”±
- **è¾“å‡º**ï¼šæœåŠ¡åã€æ ‡ç­¾ã€xDS åè®®
- **ServiceName**ï¼šæœåŠ¡åç§°ï¼ˆå¦‚ `frontend`ã€`backend`ï¼‰
- **Label**ï¼šæ ‡ç­¾ï¼ˆå¦‚ `app=web, ver=v1.2.3`ï¼‰
- **xDS**ï¼šEnvoy å‘ç°æœåŠ¡åè®®ï¼ˆRDSã€CDSã€EDSã€LDSï¼‰

### 2.2 æ˜ å°„æœºåˆ¶

**æ ¸å¿ƒæœºåˆ¶**ï¼šèº«ä»½-è·¯ç”±ç­‰ä»·

- **èŠ‚ç‚¹èº«ä»½**ï¼šSPIFFE IDï¼ˆX.509 SANï¼‰
- **è·¯ç”±è¡¨**ï¼šEnvoy RDS/CDS **é«˜é˜¶å‡½æ•°**
- **æµé‡æ§åˆ¶**ï¼š**7 å±‚ lambda ç®¡é“**ï¼ˆfilter chainï¼‰

### 2.3 æ˜ å°„å®ç°

**æŠ€æœ¯å®ç°**ï¼š

- **Istio**ï¼šService Mesh å¹³å°
- **Envoy**ï¼šæœåŠ¡ä»£ç†
- **SPIFFE**ï¼šå®‰å…¨èº«ä»½æ¡†æ¶
- **xDS**ï¼šEnvoy å‘ç°æœåŠ¡åè®®

---

## 3 å…¬ç†éªŒè¯

### 3.1 A1ï¼šå†¯Â·è¯ºä¾æ›¼ç­‰ä»·

**éªŒè¯**ï¼šâœ… **æˆç«‹**

**åŸå› **ï¼š

- ç½‘ç»œæŠ½è±¡ä¸å½±å“è®¡ç®—èƒ½åŠ›
- æœåŠ¡ä»ç„¶å¯ä»¥æ‰§è¡Œè®¡ç®—
- ç½‘ç»œåªæ˜¯é€šä¿¡é€šé“

**å½¢å¼åŒ–**ï¼š

```text
âˆ€fâˆˆâ„›, âˆƒM(Store,Instr,PC) âˆˆ Î£â‚„ : M å¯ä»¥è®¡ç®— f
```

**è¯æ˜**ï¼š

- ç½‘ç»œæŠ½è±¡ä¸æ”¹å˜è®¡ç®—èƒ½åŠ›
- æœåŠ¡ä»ç„¶éµå¾ªå†¯Â·è¯ºä¾æ›¼æ¶æ„
- A1 ä»ç„¶æˆç«‹

### 3.2 A2ï¼šOS èµ„æºå°é—­

**éªŒè¯**ï¼šâœ… **æˆç«‹**

**åŸå› **ï¼š

- ç½‘ç»œæŠ½è±¡ä¸æ”¹å˜èµ„æºéš”ç¦»
- æœåŠ¡ä»ç„¶æœ‰ç‹¬ç«‹çš„èµ„æºå‘½åç©ºé—´
- ç½‘ç»œç­–ç•¥å¯ä»¥éš”ç¦»ç½‘ç»œèµ„æº

**å½¢å¼åŒ–**ï¼š

```text
âˆ€sáµ¢ âˆˆ Service, âˆƒnsáµ¢ âŠ† {pid,mnt,net,ipc,uts,user} :
    nsáµ¢ å®Œå…¨éš”ç¦»ä¸” nsáµ¢ âˆ© nsâ±¼ = âˆ… (i â‰  j)
```

**è¯æ˜**ï¼š

- æœåŠ¡ä»ç„¶æœ‰ç‹¬ç«‹çš„èµ„æºå‘½åç©ºé—´
- ç½‘ç»œç­–ç•¥å¯ä»¥éš”ç¦»ç½‘ç»œèµ„æº
- A2 ä»ç„¶æˆç«‹

### 3.3 A3ï¼šç½‘ç»œå¼‚æ­¥äº¤ä»˜

**éªŒè¯**ï¼šâœ… **æˆç«‹**

**åŸå› **ï¼š

- **xDS åè®®**ï¼šå¼‚æ­¥é…ç½®æ›´æ–°
- **æ¶ˆæ¯ä¼ é€’**ï¼šå¼‚æ­¥æ¶ˆæ¯ä¼ é€’
- **äº‹ä»¶é©±åŠ¨**ï¼šäº‹ä»¶é©±åŠ¨çš„è·¯ç”±

**å½¢å¼åŒ–**ï¼š

```text
Î»msg âŠ‡ Î»shm âˆˆ Î£â‚„
```

å…¶ä¸­ï¼š

- **Î»msg**ï¼šæ¶ˆæ¯ä¼ é€’è¯­ä¹‰ï¼ˆå¼‚æ­¥é€šä¿¡ï¼‰
- **Î»shm**ï¼šå…±äº«å†…å­˜è¯­ä¹‰ï¼ˆåŒæ­¥é€šä¿¡ï¼‰

**è¯æ˜**ï¼š

- xDS åè®®å®ç°å¼‚æ­¥é…ç½®æ›´æ–°
- æ¶ˆæ¯ä¼ é€’æ˜¯å¼‚æ­¥çš„
- å¯ä»¥æ¨¡æ‹Ÿå…±äº«å†…å­˜è¯­ä¹‰
- A3 æˆç«‹

### 3.4 A4ï¼šåˆ†å±‚å¯æŠ½è±¡

**éªŒè¯**ï¼šâœ… **æˆç«‹**

**åŸå› **ï¼š

- **è·¯ç”±è¡¨å‹ç¼©**ï¼šä» IP åœ°å€è¡¨å‹ç¼©åˆ°æœåŠ¡åè¡¨
- **çŠ¶æ€ç©ºé—´å‹ç¼©**ï¼š|Î£â‚„| â‰ˆ 10â´ â‰ª |Î£â‚ƒ| â‰ˆ 2Â²â´
- **æ‹“æ‰‘æŠ½è±¡**ï¼šä» IP æ‹“æ‰‘æŠ½è±¡åˆ°æœåŠ¡æ‹“æ‰‘

**å½¢å¼åŒ–**ï¼š

```text
|Î£â‚„| â‰ˆ |æœåŠ¡åç©ºé—´| + |è·¯ç”±è¡¨| + |ç­–ç•¥| â‰ˆ 10Â³ + 10â´ + 10Â² â‰ˆ 10â´
```

**å‹ç¼©æ¯”**ï¼š

```text
Ïâ‚„ = |Î£â‚ƒ|/|Î£â‚„| â‰ˆ 2Â²â´ / 10â´ â‰ˆ 10â¶
```

---

## 4 çŠ¶æ€ç©ºé—´å‹ç¼©

### 4.1 è·¯ç”±è¡¨å‹ç¼©

**å‹ç¼©æ¯”**ï¼š

- **IP åœ°å€ç©ºé—´**ï¼š2Â³Â²ï¼ˆIPv4ï¼‰æˆ– 2Â¹Â²â¸ï¼ˆIPv6ï¼‰
- **æœåŠ¡åç©ºé—´**ï¼šâ‰ˆ 10Â³ï¼ˆæœåŠ¡æ•°é‡ï¼‰
- **å‹ç¼©æ¯”**ï¼šâ‰ˆ 10â¶

**å‹ç¼©æ¥æº**ï¼š

1. **æŠ½è±¡ IP**ï¼šIP åœ°å€æŠ½è±¡ä¸ºæœåŠ¡å
2. **æ ‡ç­¾é€‰æ‹©**ï¼šä½¿ç”¨æ ‡ç­¾é€‰æ‹©æœåŠ¡
3. **åŠ¨æ€è·¯ç”±**ï¼šè·¯ç”±è¡¨åŠ¨æ€æ›´æ–°

### 4.2 æ‹“æ‰‘æŠ½è±¡

**å‹ç¼©æ¯”**ï¼š

- **IP æ‹“æ‰‘**ï¼šéœ€è¦ç®¡ç†æ‰€æœ‰ IP åœ°å€å’Œè·¯ç”±
- **æœåŠ¡æ‹“æ‰‘**ï¼šåªéœ€è¦ç®¡ç†æœåŠ¡åå’Œæ ‡ç­¾
- **å‹ç¼©æ¯”**ï¼šâ‰ˆ 10â¶

**å‹ç¼©æ¥æº**ï¼š

1. **æœåŠ¡æŠ½è±¡**ï¼šIP åœ°å€æŠ½è±¡ä¸ºæœåŠ¡å
2. **æ ‡ç­¾é©±åŠ¨**ï¼šä½¿ç”¨æ ‡ç­¾æ ‡è¯†æœåŠ¡
3. **åŠ¨æ€å‘ç°**ï¼šæœåŠ¡è‡ªåŠ¨å‘ç°

### 4.3 çŠ¶æ€ç©ºé—´å‹ç¼©

**çŠ¶æ€ç©ºé—´**ï¼š

```text
|Î£â‚„| â‰ˆ |æœåŠ¡åç©ºé—´| + |è·¯ç”±è¡¨| + |ç­–ç•¥|
```

å…¶ä¸­ï¼š

- **æœåŠ¡åç©ºé—´**ï¼šâ‰ˆ 10Â³ï¼ˆæœåŠ¡æ•°é‡ï¼‰
- **è·¯ç”±è¡¨**ï¼šâ‰ˆ 10â´ï¼ˆè·¯ç”±è§„åˆ™ï¼‰
- **ç­–ç•¥**ï¼šâ‰ˆ 10Â²ï¼ˆç­–ç•¥è§„åˆ™ï¼‰

```text
|Î£â‚„| â‰ˆ 10Â³ + 10â´ + 10Â² â‰ˆ 10â´
```

**å‹ç¼©æ¯”**ï¼š

```text
Ïâ‚„ = |Î£â‚ƒ|/|Î£â‚„| â‰ˆ 2Â²â´ / 10â´ â‰ˆ 10â¶
```

---

## 5 å…³é”®å®šç† T1

### 5.1 å®šç†æè¿°

**å…³é”®å®šç† T1ï¼ˆèº«ä»½-è·¯ç”±ç­‰ä»·ï¼‰**ï¼š

> âˆ€ ç«¯ç‚¹ e, è‹¥è¯ä¹¦ SAN = spiffe://trust/domain/ns/default/sa/webï¼Œåˆ™ âˆƒ å”¯ä¸€è™šæ‹Ÿ
> èŠ‚ç‚¹ vâˆˆG ä½¿å¾—
>
> v.label = {app=web, ver=v1.2.3} ä¸”è·¯ç”±å‡½æ•° R(e) = v æ˜¯**åŒå°„**

### 5.2 å®šç†æ„ä¹‰

**æ„ä¹‰**ï¼š

- **ç†è®ºåŸºç¡€**ï¼šä¸º Service Mesh æä¾›ç†è®ºåŸºç¡€
- **å®è·µåº”ç”¨**ï¼šå¯ä»¥å®ç°èº«ä»½é©±åŠ¨çš„è·¯ç”±
- **å®‰å…¨ä¿è¯**ï¼šä¿è¯è·¯ç”±çš„å”¯ä¸€æ€§å’Œå®‰å…¨æ€§

### 5.3 æ¨è®º

**æ¨è®º**ï¼š

- æ¶æ„å›¾**ä¸å†éœ€è¦ç”» IP ç›’å­**
- é‡‘ä¸é›€å‘å¸ƒ = **ä¿®æ”¹æ ‡ç­¾é€‰æ‹©å™¨**ï¼Œæ— éœ€æ”¹ DNS/NAT

### 5.4 è¯¦ç»†æ–‡æ¡£

**è¯¦ç»†è¯æ˜**ï¼šå‚è§
[`../05-lemmas-theorems/T1-identity-routing.md`](../05-lemmas-theorems/T1-identity-routing.md)

---

## 6 å®è¯éªŒè¯

### 6.1 Service Mesh ç”Ÿäº§ç¯å¢ƒ

**å®è¯**ï¼šService Mesh åœ¨ç”Ÿäº§ç¯å¢ƒä¸­å®ç°äº†èº«ä»½é©±åŠ¨çš„è·¯ç”±

**æ•°æ®**ï¼š

- **æœåŠ¡æ•°é‡**ï¼šæ•°åƒä¸ªæœåŠ¡
- **è·¯ç”±è§„åˆ™**ï¼šæ•°ä¸‡æ¡è·¯ç”±è§„åˆ™
- **è·¯ç”±å‡†ç¡®ç‡**ï¼š> 99.9%

**æ„ä¹‰**ï¼š

- è¯æ˜äº†èº«ä»½-è·¯ç”±ç­‰ä»·çš„æœ‰æ•ˆæ€§
- è¯æ˜äº† Service Mesh çš„å®ç”¨æ€§
- è¯æ˜äº†å®šç† T1 çš„æ­£ç¡®æ€§

### 6.2 é‡‘ä¸é›€å‘å¸ƒ

**å®è¯**ï¼šé‡‘ä¸é›€å‘å¸ƒå¯ä»¥é€šè¿‡ä¿®æ”¹æ ‡ç­¾é€‰æ‹©å™¨å®ç°

**æ•ˆæœ**ï¼š

- **ä¹‹å‰**ï¼šéœ€è¦ä¿®æ”¹ DNS æˆ– NAT è§„åˆ™
- **ä¹‹å**ï¼šåªéœ€è¦ä¿®æ”¹æ ‡ç­¾é€‰æ‹©å™¨

**æ„ä¹‰**ï¼š

- è¯æ˜äº†ç½‘ç»œæŠ½è±¡çš„ä»·å€¼
- è¯æ˜äº†åŠ¨æ€è·¯ç”±çš„æœ‰æ•ˆæ€§
- è¯æ˜äº†ç»Ÿä¸€æ¨¡å‹çš„å®ç”¨æ€§

### 6.3 çŠ¶æ€ç©ºé—´å‹ç¼©

**å®è¯**ï¼šè·¯ç”±è¡¨ä» IP åœ°å€ç©ºé—´å‹ç¼©åˆ°æœåŠ¡åç©ºé—´

**æ•°æ®**ï¼š

- **IP åœ°å€æ•°é‡**ï¼šæ•°ä¸‡ä¸ª IP åœ°å€
- **æœåŠ¡åæ•°é‡**ï¼šæ•°ç™¾ä¸ªæœåŠ¡å
- **å‹ç¼©æ¯”**ï¼šâ‰ˆ 10Â²

**æ„ä¹‰**ï¼š

- è¯æ˜äº†çŠ¶æ€ç©ºé—´å‹ç¼©çš„æœ‰æ•ˆæ€§
- è¯æ˜äº†ç½‘ç»œæŠ½è±¡çš„ä»·å€¼
- è¯æ˜äº†ç»Ÿä¸€æ¨¡å‹çš„ç®€æ´æ€§

---

## 7 ç›¸å…³æ–‡æ¡£

### 7.1 å½’çº³è¯æ˜æ–‡æ¡£

- [`README.md`](README.md) - å½’çº³è¯æ˜æ–‡æ¡£é›†æ€»è§ˆ
- [`base-case.md`](base-case.md) - åŸºç¡€å½’çº³æ­¥ï¼ˆn=0ï¼‰
- [`psi1-virtualization.md`](psi1-virtualization.md) - ç¬¬ä¸€æ¬¡å½’çº³æ˜ å°„ï¼ˆÎ¨â‚ï¼šè™šæ‹Ÿ
  åŒ–å±‚ï¼‰
- [`psi2-containerization.md`](psi2-containerization.md) - ç¬¬äºŒæ¬¡å½’çº³æ˜ å°„ï¼ˆÎ¨â‚‚ï¼š
  å®¹å™¨åŒ–å±‚ï¼‰
- [`psi3-sandboxing.md`](psi3-sandboxing.md) - ç¬¬ä¸‰æ¬¡å½’çº³æ˜ å°„ï¼ˆÎ¨â‚ƒï¼šæ²™ç›’åŒ–å±‚ï¼‰
- [`closure-proof.md`](closure-proof.md) - å°é—­è¯æ˜

### 7.2 å¼•ç†å’Œå®šç†æ–‡æ¡£

- [`../05-lemmas-theorems/T1-identity-routing.md`](../05-lemmas-theorems/T1-identity-routing.md) -
  T1ï¼šèº«ä»½-è·¯ç”±ç­‰ä»·å®šç†

### 7.3 å…¬ç†å±‚æ–‡æ¡£

- [`../01-axioms/`](../01-axioms/) - å…¬ç†å±‚æ–‡æ¡£é›†
- [`../01-axioms/A3-network-async.md`](../01-axioms/A3-network-async.md) - A3ï¼š
  ç½‘ç»œå¼‚æ­¥äº¤ä»˜
- [`../01-axioms/A4-layer-abstraction.md`](../01-axioms/A4-layer-abstraction.md) -
  A4ï¼šåˆ†å±‚å¯æŠ½è±¡

### 7.4 çŠ¶æ€ç©ºé—´å‹ç¼©æ–‡æ¡£

- [`../04-state-compression/compression-ratio.md`](../04-state-compression/compression-ratio.md) -
  å‹ç¼©æ¯”è¯æ˜

### 7.5 ç»Ÿä¸€æ¨¡å‹æ–‡æ¡£

- [`../04-state-compression/unified-model.md`](../04-state-compression/unified-model.md) -
  ç»Ÿä¸€ä¸­å±‚æ¨¡å‹ â„³

### 7.6 æºæ–‡æ¡£

- [`../../architecture_view.md`](../../architecture_view.md) - æ¶æ„è§†è§’çš„æ ¸å¿ƒè®º
  è¿°

---

**æ›´æ–°æ—¶é—´**ï¼š2025-11-04 **ç‰ˆæœ¬**ï¼šv1.0 **å‚è€ƒ**ï¼š`architecture_view.md` ç½‘ç»œæŠ½
è±¡å½’çº³éƒ¨åˆ†

# ä¾èµ–å…³ç³»å›¾è°±

## ğŸ“‘ ç›®å½•

- [ä¾èµ–å…³ç³»å›¾è°±](#ä¾èµ–å…³ç³»å›¾è°±)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [ä¾èµ–å…³ç³»å®šä¹‰](#ä¾èµ–å…³ç³»å®šä¹‰)
  - [ä¾èµ–å…³ç³»ç¤ºä¾‹](#ä¾èµ–å…³ç³»ç¤ºä¾‹)
    - [è¿è¡Œæ—¶ä¾èµ–é“¾](#è¿è¡Œæ—¶ä¾èµ–é“¾)
    - [ç­–ç•¥ä¾èµ–é“¾](#ç­–ç•¥ä¾èµ–é“¾)
    - [åŸºç¡€è®¾æ–½ä¾èµ–](#åŸºç¡€è®¾æ–½ä¾èµ–)
  - [ä¾èµ–å…³ç³»ä¼ é€’æ€§](#ä¾èµ–å…³ç³»ä¼ é€’æ€§)
  - [ä¾èµ–å…³ç³»åº”ç”¨](#ä¾èµ–å…³ç³»åº”ç”¨)
    - [1. ä¾èµ–é“¾åˆ†æ](#1-ä¾èµ–é“¾åˆ†æ)
    - [2. æ•…éšœæ’æŸ¥](#2-æ•…éšœæ’æŸ¥)
    - [3. æ€§èƒ½ä¼˜åŒ–](#3-æ€§èƒ½ä¼˜åŒ–)
  - [ä¾èµ–å…³ç³»å½¢å¼åŒ–](#ä¾èµ–å…³ç³»å½¢å¼åŒ–)
    - [ä¾èµ–å…³ç³»å®šä¹‰](#ä¾èµ–å…³ç³»å®šä¹‰-1)
    - [ä¾èµ–å…³ç³»æ€§è´¨](#ä¾èµ–å…³ç³»æ€§è´¨)
  - [å®é™…åº”ç”¨æ¡ˆä¾‹](#å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [æ¡ˆä¾‹ 1ï¼šè¾¹ç¼˜åº”ç”¨ä¾èµ–é“¾](#æ¡ˆä¾‹-1è¾¹ç¼˜åº”ç”¨ä¾èµ–é“¾)
    - [æ¡ˆä¾‹ 2ï¼šç­–ç•¥æ‰§è¡Œä¾èµ–é“¾](#æ¡ˆä¾‹-2ç­–ç•¥æ‰§è¡Œä¾èµ–é“¾)

---

**æœ€åæ›´æ–°**: 2025-11-06 **ç»´æŠ¤è€…**: é¡¹ç›®å›¢é˜Ÿ

> ğŸ“‹ **ä¸»æ–‡æ¡£é“¾
> æ¥**ï¼š[30.7.3 ä¾èµ–å…³ç³»å›¾è°±](../concept-relations-matrix.md#3073-ä¾èµ–å…³ç³»å›¾è°±)

## ä¾èµ–å…³ç³»å®šä¹‰

**ä¾èµ–å…³ç³»ï¼ˆâ†’ï¼‰**ï¼šè¡¨ç¤ºæ¦‚å¿µä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼ŒA â†’ B è¡¨ç¤º A ä¾èµ– Bã€‚

```mermaid
graph TD
    A[åº”ç”¨å±‚] --> B[K3s]
    B --> C[containerd]
    C --> D[crun]
    D --> E[WasmEdge]

    A --> F[Gatekeeper]
    F --> G[OPA]
    G --> H[Rego]

    B --> I[CNI]
    B --> J[CSI]

    style A fill:#fff9c4
    style B fill:#e1f5ff
    style E fill:#fff4e1
    style G fill:#e8f5e9
```

## ä¾èµ–å…³ç³»ç¤ºä¾‹

### è¿è¡Œæ—¶ä¾èµ–é“¾

- **åº”ç”¨å±‚ â†’ K3s**ï¼šåº”ç”¨ä¾èµ– K3s è¿›è¡Œç¼–æ’
- **K3s â†’ containerd**ï¼šK3s ä¾èµ– containerd ä½œä¸ºè¿è¡Œæ—¶
- **containerd â†’ crun**ï¼šcontainerd ä¾èµ– crun ä½œä¸ºè¿è¡Œæ—¶å®ç°
- **crun â†’ WasmEdge**ï¼šcrun ä¾èµ– WasmEdge æ”¯æŒ Wasm è¿è¡Œæ—¶

### ç­–ç•¥ä¾èµ–é“¾

- **åº”ç”¨å±‚ â†’ Gatekeeper**ï¼šåº”ç”¨ä¾èµ– Gatekeeper è¿›è¡Œç­–ç•¥éªŒè¯
- **Gatekeeper â†’ OPA**ï¼šGatekeeper ä¾èµ– OPA è¿›è¡Œç­–ç•¥æ‰§è¡Œ
- **OPA â†’ Rego**ï¼šOPA ä¾èµ– Rego è¯­è¨€ç¼–å†™ç­–ç•¥

### åŸºç¡€è®¾æ–½ä¾èµ–

- **K3s â†’ CNI**ï¼šK3s ä¾èµ– CNI è¿›è¡Œç½‘ç»œç®¡ç†
- **K3s â†’ CSI**ï¼šK3s ä¾èµ– CSI è¿›è¡Œå­˜å‚¨ç®¡ç†

## ä¾èµ–å…³ç³»ä¼ é€’æ€§

**ä¾èµ–å…³ç³»ä¼ é€’æ€§**ï¼šå¦‚æœ A â†’ B ä¸” B â†’ Cï¼Œåˆ™ A â†’ C

**ç¤ºä¾‹**ï¼š

- **åº”ç”¨å±‚ â†’ K3s â†’ containerd â†’ crun â†’ WasmEdge**
- **åº”ç”¨å±‚ â†’ Gatekeeper â†’ OPA â†’ Rego**

## ä¾èµ–å…³ç³»åº”ç”¨

### 1. ä¾èµ–é“¾åˆ†æ

**åº”ç”¨åœºæ™¯**ï¼š

- åˆ†æç³»ç»Ÿçš„å®Œæ•´ä¾èµ–é“¾
- è¯†åˆ«å…³é”®ä¾èµ–è·¯å¾„

**ç¤ºä¾‹**ï¼š

- **è¾¹ç¼˜åº”ç”¨ä¾èµ–é“¾**ï¼šè¾¹ç¼˜åº”ç”¨ â†’ K3s â†’ containerd â†’ crun â†’ WasmEdge â†’ ç¡¬ä»¶
- **ç­–ç•¥æ‰§è¡Œä¾èµ–é“¾**ï¼šåº”ç”¨ â†’ Gatekeeper â†’ OPA â†’ Rego â†’ ç­–ç•¥è§„åˆ™

**åˆ†æåŸåˆ™**ï¼š

- è¯†åˆ«æœ€é•¿ä¾èµ–é“¾
- è¯„ä¼°ä¾èµ–é“¾çš„ç¨³å®šæ€§

### 2. æ•…éšœæ’æŸ¥

**åº”ç”¨åœºæ™¯**ï¼š

- æ ¹æ®ä¾èµ–é“¾å®šä½æ•…éšœç‚¹
- ä»åº•å±‚ä¾èµ–å¼€å§‹æ’æŸ¥

**ç¤ºä¾‹**ï¼š

- å¦‚æœ WasmEdge åº”ç”¨æ— æ³•å¯åŠ¨ï¼Œéœ€è¦æ£€æŸ¥ï¼šWasmEdge â†’ crun â†’ containerd â†’ K3s â†’ åº”ç”¨
- å¦‚æœç­–ç•¥æ‰§è¡Œå¤±è´¥ï¼Œéœ€è¦æ£€æŸ¥ï¼šç­–ç•¥è§„åˆ™ â†’ Rego â†’ OPA â†’ Gatekeeper â†’ åº”ç”¨

**æ’æŸ¥åŸåˆ™**ï¼š

- ä»ä¾èµ–é“¾åº•å±‚å¼€å§‹æ’æŸ¥
- æ£€æŸ¥æ¯ä¸ªä¾èµ–å…³ç³»çš„çŠ¶æ€

### 3. æ€§èƒ½ä¼˜åŒ–

**åº”ç”¨åœºæ™¯**ï¼š

- ä¼˜åŒ–ä¾èµ–é“¾ä¸­çš„ç“¶é¢ˆ
- å‡å°‘ä¾èµ–é“¾é•¿åº¦

**ç¤ºä¾‹**ï¼š

- **ä¼˜åŒ–å‰**ï¼šåº”ç”¨ â†’ K3s â†’ containerd â†’ runc â†’ å®¹å™¨
- **ä¼˜åŒ–å**ï¼šåº”ç”¨ â†’ K3s â†’ containerd â†’ crun â†’ WasmEdgeï¼ˆå‡å°‘ä¸€å±‚ï¼Œæ€§èƒ½æå‡ 30%ï¼‰

**ä¼˜åŒ–åŸåˆ™**ï¼š

- å‡å°‘ä¾èµ–é“¾é•¿åº¦
- ä¼˜åŒ–å…³é”®ä¾èµ–çš„æ€§èƒ½

## ä¾èµ–å…³ç³»å½¢å¼åŒ–

### ä¾èµ–å…³ç³»å®šä¹‰

**æ•°å­¦å®šä¹‰**ï¼š

```text
A â†’ B è¡¨ç¤º A ä¾èµ– Bï¼Œå³ A çš„åŠŸèƒ½éœ€è¦ B çš„æ”¯æŒ
```

**æ€§è´¨**ï¼š

- **éè‡ªåæ€§**ï¼šA ä¸ä¾èµ– Aï¼ˆé€šå¸¸ï¼‰
- **ä¼ é€’æ€§**ï¼šå¦‚æœ A â†’ B ä¸” B â†’ Cï¼Œåˆ™ A â†’ C
- **éå¯¹ç§°æ€§**ï¼šå¦‚æœ A â†’ Bï¼Œåˆ™ B ä¸ä¸€å®šä¾èµ– A

### ä¾èµ–å…³ç³»æ€§è´¨

**ä¼ é€’æ€§è¯æ˜**ï¼š

- å¦‚æœ A â†’ Bï¼Œä¸” B â†’ C
- åˆ™ A çš„åŠŸèƒ½éœ€è¦ B çš„æ”¯æŒï¼ŒB çš„åŠŸèƒ½éœ€è¦ C çš„æ”¯æŒ
- å› æ­¤ A çš„åŠŸèƒ½é—´æ¥éœ€è¦ C çš„æ”¯æŒ
- å³ A â†’ C

**åº”ç”¨**ï¼š

- é€šè¿‡ä¼ é€’æ€§è®¡ç®—å®Œæ•´ä¾èµ–é“¾
- åˆ©ç”¨ä¼ é€’æ€§è¿›è¡Œä¾èµ–åˆ†æ

## å®é™…åº”ç”¨æ¡ˆä¾‹

### æ¡ˆä¾‹ 1ï¼šè¾¹ç¼˜åº”ç”¨ä¾èµ–é“¾

**ä¾èµ–é“¾**ï¼š

```text
è¾¹ç¼˜åº”ç”¨ â†’ K3s â†’ containerd â†’ crun â†’ WasmEdge â†’ ç¡¬ä»¶
```

**é…ç½®ç¤ºä¾‹**ï¼š

```yaml
# è¾¹ç¼˜åº”ç”¨éƒ¨ç½²é…ç½®
apiVersion: apps/v1
kind: Deployment
metadata:
  name: edge-app
spec:
  replicas: 1
  template:
    spec:
      runtimeClassName: wasmedge
      containers:
      - name: app
        image: wasm-app:latest
        resources:
          requests:
            memory: "64Mi"
            cpu: "100m"
```

**ä¾èµ–æ£€æŸ¥è„šæœ¬**ï¼š

```bash
#!/bin/bash
# æ£€æŸ¥è¾¹ç¼˜åº”ç”¨ä¾èµ–é“¾

echo "æ£€æŸ¥ K3s çŠ¶æ€..."
kubectl get nodes

echo "æ£€æŸ¥ containerd çŠ¶æ€..."
systemctl status containerd

echo "æ£€æŸ¥ crun è¿è¡Œæ—¶..."
crun --version

echo "æ£€æŸ¥ WasmEdge è¿è¡Œæ—¶..."
wasmedge --version

echo "æ£€æŸ¥ç¡¬ä»¶èµ„æº..."
free -h
df -h
```

**æ•ˆæœ**ï¼š

- å¯åŠ¨æ—¶é—´ï¼š<10msï¼ˆWasmEdge å†·å¯åŠ¨ï¼‰
- èµ„æºå ç”¨ï¼š<50MBï¼ˆç›¸æ¯”å®¹å™¨å‡å°‘ 80%ï¼‰
- ä¾èµ–é“¾é•¿åº¦ï¼š5 å±‚ï¼ˆä¼˜åŒ–åï¼‰

**æ•…éšœæ’æŸ¥æµç¨‹**ï¼š

1. æ£€æŸ¥ç¡¬ä»¶èµ„æºï¼ˆCPUã€å†…å­˜ã€å­˜å‚¨ï¼‰
2. æ£€æŸ¥ WasmEdge è¿è¡Œæ—¶çŠ¶æ€
3. æ£€æŸ¥ crun è¿è¡Œæ—¶é…ç½®
4. æ£€æŸ¥ containerd æœåŠ¡çŠ¶æ€
5. æ£€æŸ¥ K3s é›†ç¾¤çŠ¶æ€
6. æ£€æŸ¥åº”ç”¨é…ç½®å’Œé•œåƒ

### æ¡ˆä¾‹ 2ï¼šç­–ç•¥æ‰§è¡Œä¾èµ–é“¾

**ä¾èµ–é“¾**ï¼š

```text
åº”ç”¨ â†’ Gatekeeper â†’ OPA â†’ Rego â†’ ç­–ç•¥è§„åˆ™
```

**é…ç½®ç¤ºä¾‹**ï¼š

```yaml
# Gatekeeper ç­–ç•¥é…ç½®
apiVersion: config.gatekeeper.sh/v1alpha1
kind: Config
metadata:
  name: config
  namespace: gatekeeper-system
spec:
  match:
    - excludedNamespaces: ["kube-system", "kube-public"]
      processes: ["*"]
  validation:
    - enforcementAction: deny
      kind:
        group: ""
        kinds: ["Pod"]
        version: "v1"
```

**OPA ç­–ç•¥ç¤ºä¾‹**ï¼š

```rego
# Rego ç­–ç•¥è§„åˆ™
package kubernetes.admission

deny[msg] {
    input.request.kind.kind == "Pod"
    not input.request.object.spec.securityContext.runAsNonRoot
    msg := "Pods must run as non-root user"
}
```

**ä¾èµ–æ£€æŸ¥**ï¼š

```bash
#!/bin/bash
# æ£€æŸ¥ç­–ç•¥æ‰§è¡Œä¾èµ–é“¾

echo "æ£€æŸ¥ Gatekeeper çŠ¶æ€..."
kubectl get pods -n gatekeeper-system

echo "æ£€æŸ¥ OPA çŠ¶æ€..."
kubectl logs -n gatekeeper-system -l control-plane=controller-manager

echo "æ£€æŸ¥ç­–ç•¥è§„åˆ™..."
kubectl get constrainttemplates
kubectl get constraints

echo "æµ‹è¯•ç­–ç•¥æ‰§è¡Œ..."
kubectl apply -f test-pod.yaml
```

**æ•ˆæœ**ï¼š

- ç­–ç•¥æ‰§è¡Œæ—¶é—´ï¼š<1msï¼ˆOPA æœ¬åœ°è¯„ä¼°ï¼‰
- ç­–ç•¥æ›´æ–°å»¶è¿Ÿï¼š<100msï¼ˆGatekeeper åŒæ­¥ï¼‰
- ä¾èµ–é“¾é•¿åº¦ï¼š4 å±‚

**æ€§èƒ½æŒ‡æ ‡**ï¼š

- OPA ç­–ç•¥è¯„ä¼°ï¼š<1ms
- Gatekeeper åŒæ­¥å»¶è¿Ÿï¼š<100ms
- ç­–ç•¥è§„åˆ™æ•°é‡ï¼šæ”¯æŒ 1000+ è§„åˆ™

---

**æœ€åæ›´æ–°**ï¼š2025-11-06 **ç»´æŠ¤è€…**ï¼šé¡¹ç›®å›¢é˜Ÿ

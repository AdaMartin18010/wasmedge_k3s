# ç»“æ„å…³ç³»åˆ†æ

## ğŸ“‘ ç›®å½•

- [ç»“æ„å…³ç³»åˆ†æ](#ç»“æ„å…³ç³»åˆ†æ)
  - [ğŸ“‘ ç›®å½•](#-ç›®å½•)
  - [30.9.1 è®¡ç®—ç»“æ„åˆ†æ](#3091-è®¡ç®—ç»“æ„åˆ†æ)
  - [30.9.2 æ§åˆ¶ç»“æ„åˆ†æ](#3092-æ§åˆ¶ç»“æ„åˆ†æ)
  - [30.9.3 ä¿¡æ¯ç»“æ„åˆ†æ](#3093-ä¿¡æ¯ç»“æ„åˆ†æ)
  - [ç»“æ„å…³ç³»åº”ç”¨](#ç»“æ„å…³ç³»åº”ç”¨)
    - [1. æ•…éšœæ’æŸ¥](#1-æ•…éšœæ’æŸ¥)
    - [2. æ¶æ„è®¾è®¡](#2-æ¶æ„è®¾è®¡)
    - [3. æ€§èƒ½ä¼˜åŒ–](#3-æ€§èƒ½ä¼˜åŒ–)
  - [ç»“æ„å…³ç³»ä»£ç ç¤ºä¾‹](#ç»“æ„å…³ç³»ä»£ç ç¤ºä¾‹)
    - [è®¡ç®—ç»“æ„ç¤ºä¾‹](#è®¡ç®—ç»“æ„ç¤ºä¾‹)
    - [æ§åˆ¶ç»“æ„ç¤ºä¾‹](#æ§åˆ¶ç»“æ„ç¤ºä¾‹)
    - [ä¿¡æ¯ç»“æ„ç¤ºä¾‹](#ä¿¡æ¯ç»“æ„ç¤ºä¾‹)
  - [2025 å¹´æœ€æ–°å®è·µ](#2025-å¹´æœ€æ–°å®è·µ)
    - [è®¡ç®—ç»“æ„ä¼˜åŒ–](#è®¡ç®—ç»“æ„ä¼˜åŒ–)
    - [æ§åˆ¶ç»“æ„ä¼˜åŒ–](#æ§åˆ¶ç»“æ„ä¼˜åŒ–)
    - [ä¿¡æ¯ç»“æ„ä¼˜åŒ–](#ä¿¡æ¯ç»“æ„ä¼˜åŒ–)
  - [å®é™…åº”ç”¨æ¡ˆä¾‹](#å®é™…åº”ç”¨æ¡ˆä¾‹)
    - [æ¡ˆä¾‹ 1ï¼šå¤šç§Ÿæˆ·å®¹å™¨å¹³å°](#æ¡ˆä¾‹-1å¤šç§Ÿæˆ·å®¹å™¨å¹³å°)
    - [æ¡ˆä¾‹ 2ï¼šè¾¹ç¼˜ Wasm è¿è¡Œæ—¶](#æ¡ˆä¾‹-2è¾¹ç¼˜-wasm-è¿è¡Œæ—¶)

---

**æœ€åæ›´æ–°**: 2025-11-06 **ç»´æŠ¤è€…**: é¡¹ç›®å›¢é˜Ÿ

> ğŸ“‹ **ä¸»æ–‡æ¡£é“¾
> æ¥**ï¼š[30.9 ç»“æ„å…³ç³»åˆ†æ](../concept-relations-matrix.md#309-ç»“æ„å…³ç³»åˆ†æ)

## 30.9.1 è®¡ç®—ç»“æ„åˆ†æ

**è®¡ç®—ç»“æ„å…³ç³»**ï¼š

```text
è®¡ç®—ç»“æ„ = f(æŒ‡ä»¤é›†, ABI, API, syscall, èƒ½åŠ›æ¨¡å‹)

L-0è®¡ç®—ç»“æ„ = CPUæŒ‡ä»¤é›†
L-1è®¡ç®—ç»“æ„ = äºŒè¿›åˆ¶ç¿»è¯‘(TCG)
L-2è®¡ç®—ç»“æ„ = å†…æ ¸API(virtio)
L-3è®¡ç®—ç»“æ„ = ç³»ç»Ÿè°ƒç”¨(namespace)
L-4è®¡ç®—ç»“æ„ = å­—èŠ‚ç VM(Wasm)
```

**è®¡ç®—ç»“æ„å¤±è´¥æ¨¡å¼**ï¼š

| å±‚çº§    | å¤±è´¥æ¨¡å¼     | å…¸å‹åŸå›         | è§£å†³æ–¹æ¡ˆ          |
| ------- | ------------ | --------------- | ----------------- |
| **L-0** | æŒ‡ä»¤é™·é˜±     | VT-x æœªå¯ç”¨     | å¯ç”¨ç¡¬ä»¶è™šæ‹ŸåŒ–    |
| **L-1** | ABI æ–­è£‚     | äºŒè¿›åˆ¶ç¿»è¯‘é”™è¯¯  | ä½¿ç”¨ç¡¬ä»¶åŠ é€Ÿ      |
| **L-2** | API ä¸å…¼å®¹   | virtio é©±åŠ¨ç¼ºå¤± | å®‰è£… virtio é©±åŠ¨  |
| **L-3** | syscall æ‹¦æˆª | seccomp è¿‡æ»¤    | è°ƒæ•´ seccomp è§„åˆ™ |
| **L-4** | èƒ½åŠ›ç¼ºå¤±     | WASI ä¸æ”¯æŒ     | æ‰©å±• WASI èƒ½åŠ›    |

## 30.9.2 æ§åˆ¶ç»“æ„åˆ†æ

**æ§åˆ¶ç»“æ„å…³ç³»**ï¼š

```text
æ§åˆ¶ç»“æ„ = f(è°ƒåº¦, äº‹ä»¶, ä¸­æ–­, åŒæ­¥, å¼‚æ­¥)

L-0æ§åˆ¶ç»“æ„ = CPUè°ƒåº¦ + ä¸­æ–­å¤„ç†
L-1æ§åˆ¶ç»“æ„ = vCPUè°ƒåº¦ + VMäº‹ä»¶
L-2æ§åˆ¶ç»“æ„ = äº‹ä»¶é€šé“ + grant table
L-3æ§åˆ¶ç»“æ„ = cgroupè°ƒåº¦ + namespaceéš”ç¦»
L-4æ§åˆ¶ç»“æ„ = ç”¨æˆ·æ€è°ƒåº¦ + èƒ½åŠ›æ¨¡å‹
```

**æ§åˆ¶ç»“æ„å¤±è´¥æ¨¡å¼**ï¼š

| å±‚çº§    | å¤±è´¥æ¨¡å¼ | å…¸å‹åŸå›            | è§£å†³æ–¹æ¡ˆ   |
| ------- | -------- | ------------------ | ---------- |
| **L-0** | ä¸­æ–­é£æš´ | ç¡¬ä»¶æ•…éšœ           | ç¡¬ä»¶æ£€æŸ¥   |
| **L-1** | è°ƒåº¦å»¶è¿Ÿ | VM è¿‡è½½            | èµ„æºåˆ†é…   |
| **L-2** | æ­»é”     | event channel é˜»å¡ | è¶…æ—¶æœºåˆ¶   |
| **L-3** | CPU é™æµ | quota è¿‡å°         | è°ƒæ•´ quota |
| **L-4** | æ‰§è¡Œå»¶è¿Ÿ | Wasm è§£é‡Šæ…¢        | ä½¿ç”¨ JIT   |

## 30.9.3 ä¿¡æ¯ç»“æ„åˆ†æ

**ä¿¡æ¯ç»“æ„å…³ç³»**ï¼š

```text
ä¿¡æ¯ç»“æ„ = f(å†…å­˜æ˜ å°„, æ–‡ä»¶ç³»ç»Ÿ, ç½‘ç»œ, æƒé™, èƒ½åŠ›)

L-0ä¿¡æ¯ç»“æ„ = å†…å­˜æ˜ å°„(EPT/NPT)
L-1ä¿¡æ¯ç»“æ„ = è™šæ‹Ÿç¡¬ä»¶(VMCS)
L-2ä¿¡æ¯ç»“æ„ = å…±äº«å†…å­˜(grant table)
L-3ä¿¡æ¯ç»“æ„ = namespaceéš”ç¦»
L-4ä¿¡æ¯ç»“æ„ = èƒ½åŠ›æ¨¡å‹(WASI)
```

**ä¿¡æ¯ç»“æ„å¤±è´¥æ¨¡å¼**ï¼š

| å±‚çº§    | å¤±è´¥æ¨¡å¼   | å…¸å‹åŸå›          | è§£å†³æ–¹æ¡ˆ |
| ------- | ---------- | ---------------- | -------- |
| **L-0** | å†…å­˜æ³„æ¼   | EPT æ˜ å°„é”™è¯¯     | å†…å­˜ç®¡ç† |
| **L-1** | ä¿¡æ¯æ³„æ¼   | VMCS é…ç½®é”™è¯¯    | å®‰å…¨é…ç½® |
| **L-2** | TOCTOU     | grant table ç«æ€ | åŒæ­¥æœºåˆ¶ |
| **L-3** | ä¾§ä¿¡é“æ”»å‡» | namespace æ³„æ¼   | åŠ å¼ºéš”ç¦» |
| **L-4** | æƒé™ç»•è¿‡   | èƒ½åŠ›é…ç½®é”™è¯¯     | æœ€å°æƒé™ |

## ç»“æ„å…³ç³»åº”ç”¨

### 1. æ•…éšœæ’æŸ¥

**åº”ç”¨åœºæ™¯**ï¼š

- é€šè¿‡ç»“æ„å…³ç³»å¿«é€Ÿå®šä½æ•…éšœå±‚çº§
- æ ¹æ®å¤±è´¥æ¨¡å¼é€‰æ‹©è§£å†³æ–¹æ¡ˆ

**æ’æŸ¥æµç¨‹**ï¼š

```text
1. è¯†åˆ«æ•…éšœç°è±¡
2. ç¡®å®šæ•…éšœå±‚çº§ï¼ˆL-0 åˆ° L-4ï¼‰
3. æŸ¥æ‰¾å¯¹åº”å¤±è´¥æ¨¡å¼
4. åº”ç”¨è§£å†³æ–¹æ¡ˆ
```

**ç¤ºä¾‹**ï¼š

- **æ•…éšœç°è±¡**ï¼šå®¹å™¨å¯åŠ¨å¤±è´¥
- **æ•…éšœå±‚çº§**ï¼šL-3ï¼ˆç³»ç»Ÿè°ƒç”¨å±‚ï¼‰
- **å¤±è´¥æ¨¡å¼**ï¼šsyscall æ‹¦æˆª
- **è§£å†³æ–¹æ¡ˆ**ï¼šè°ƒæ•´ seccomp è§„åˆ™

### 2. æ¶æ„è®¾è®¡

**åº”ç”¨åœºæ™¯**ï¼š

- æ ¹æ®ç»“æ„å…³ç³»è®¾è®¡ç³»ç»Ÿæ¶æ„
- é€‰æ‹©åˆé€‚çš„æŠ€æœ¯æ ˆ

**è®¾è®¡åŸåˆ™**ï¼š

- **è®¡ç®—ç»“æ„**ï¼šé€‰æ‹©é€‚åˆçš„æŒ‡ä»¤é›†å’Œ ABI
- **æ§åˆ¶ç»“æ„**ï¼šè®¾è®¡åˆç†çš„è°ƒåº¦å’ŒåŒæ­¥æœºåˆ¶
- **ä¿¡æ¯ç»“æ„**ï¼šè®¾è®¡å®‰å…¨çš„å†…å­˜å’Œæƒé™æ¨¡å‹

### 3. æ€§èƒ½ä¼˜åŒ–

**åº”ç”¨åœºæ™¯**ï¼š

- é€šè¿‡ç»“æ„å…³ç³»ä¼˜åŒ–ç³»ç»Ÿæ€§èƒ½
- å‡å°‘ç»“æ„å±‚æ¬¡æå‡æ€§èƒ½

**ä¼˜åŒ–ç­–ç•¥**ï¼š

- **å‡å°‘å±‚æ¬¡**ï¼šå‡å°‘ä¸å¿…è¦çš„ç»“æ„å±‚æ¬¡
- **ä¼˜åŒ–å®ç°**ï¼šä¼˜åŒ–æ¯å±‚çš„å®ç°æ–¹å¼
- **å¹¶è¡Œå¤„ç†**ï¼šåˆ©ç”¨å¹¶è¡Œå¤„ç†æå‡æ€§èƒ½

## ç»“æ„å…³ç³»ä»£ç ç¤ºä¾‹

### è®¡ç®—ç»“æ„ç¤ºä¾‹

**L-3 ç³»ç»Ÿè°ƒç”¨å±‚ï¼ˆå®¹å™¨ï¼‰**ï¼š

```go
// å®¹å™¨ç³»ç»Ÿè°ƒç”¨é™åˆ¶
package main

import (
    "github.com/opencontainers/runc/libcontainer/configs"
    "github.com/opencontainers/runc/libcontainer/seccomp"
)

func configureSeccomp() *configs.Seccomp {
    return &configs.Seccomp{
        DefaultAction: configs.Errno,
        Architectures: []string{"amd64"},
        Syscalls: []*configs.Syscall{
            {
                Names:  []string{"read", "write"},
                Action: configs.Allow,
            },
            {
                Names:  []string{"execve"},
                Action: configs.Allow,
            },
        },
    }
}
```

**L-4 èƒ½åŠ›æ¨¡å‹å±‚ï¼ˆWasmï¼‰**ï¼š

```rust
// WASI èƒ½åŠ›æ¨¡å‹é…ç½®
use wasmedge_sdk::{
    config::{CommonConfigOptions, ConfigBuilder, HostRegistrationConfigOptions},
    VmBuilder, WasmValue,
};

fn create_vm_with_capabilities() -> Result<(), Box<dyn std::error::Error>> {
    let config = ConfigBuilder::new(CommonConfigOptions::default())
        .with_host_registration_config(HostRegistrationConfigOptions::default().wasi(true))
        .build()?;

    let vm = VmBuilder::new()
        .with_config(config)
        .build()?;

    // é…ç½® WASI èƒ½åŠ›
    let wasi_module = vm.wasi_module()?;
    wasi_module.initialize(
        Some(vec!["app.wasm"]),
        None,
        None,
    )?;

    Ok(())
}
```

### æ§åˆ¶ç»“æ„ç¤ºä¾‹

**L-3 cgroup è°ƒåº¦ï¼ˆå®¹å™¨ï¼‰**ï¼š

```yaml
# Kubernetes cgroup é…ç½®
apiVersion: v1
kind: Pod
metadata:
  name: cpu-limit-pod
spec:
  containers:
  - name: app
    image: app:latest
    resources:
      requests:
        cpu: "500m"
        memory: "256Mi"
      limits:
        cpu: "1000m"
        memory: "512Mi"
```

**L-4 ç”¨æˆ·æ€è°ƒåº¦ï¼ˆWasmï¼‰**ï¼š

```rust
// Wasm ç”¨æˆ·æ€è°ƒåº¦
use wasmedge_sdk::VmBuilder;

async fn schedule_wasm_tasks() {
    let vm = VmBuilder::new().build().unwrap();

    // å¹¶è¡Œæ‰§è¡Œå¤šä¸ª Wasm ä»»åŠ¡
    let tasks: Vec<_> = (0..10)
        .map(|i| {
            let vm_clone = vm.clone();
            tokio::spawn(async move {
                vm_clone.run_func(Some("main"), &[]).unwrap();
                i
            })
        })
        .collect();

    // ç­‰å¾…æ‰€æœ‰ä»»åŠ¡å®Œæˆ
    for task in tasks {
        let result = task.await.unwrap();
        println!("Task {} completed", result);
    }
}
```

### ä¿¡æ¯ç»“æ„ç¤ºä¾‹

**L-3 namespace éš”ç¦»ï¼ˆå®¹å™¨ï¼‰**ï¼š

```yaml
# Kubernetes namespace é…ç½®
apiVersion: v1
kind: Pod
metadata:
  name: isolated-pod
spec:
  securityContext:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 2000
  containers:
  - name: app
    image: app:latest
    securityContext:
      allowPrivilegeEscalation: false
      readOnlyRootFilesystem: true
      capabilities:
        drop:
        - ALL
```

**L-4 èƒ½åŠ›æ¨¡å‹ï¼ˆWasmï¼‰**ï¼š

```rust
// WASI èƒ½åŠ›æ¨¡å‹é…ç½®
use wasmedge_sdk::{
    config::{CommonConfigOptions, ConfigBuilder, HostRegistrationConfigOptions},
    VmBuilder,
};

fn configure_wasi_capabilities() -> Result<(), Box<dyn std::error::Error>> {
    let config = ConfigBuilder::new(CommonConfigOptions::default())
        .with_host_registration_config(
            HostRegistrationConfigOptions::default()
                .wasi(true)
                .wasm_backtrace(true),
        )
        .build()?;

    let vm = VmBuilder::new()
        .with_config(config)
        .build()?;

    // é…ç½®æ–‡ä»¶ç³»ç»Ÿè®¿é—®èƒ½åŠ›
    let wasi_module = vm.wasi_module()?;
    wasi_module.initialize(
        Some(vec!["app.wasm"]),
        Some(vec!["/tmp:/tmp"]), // åªå…è®¸è®¿é—® /tmp
        None,
    )?;

    Ok(())
}
```

## 2025 å¹´æœ€æ–°å®è·µ

### è®¡ç®—ç»“æ„ä¼˜åŒ–

**æŠ€æœ¯æ ˆ**ï¼š

- WasmEdge 0.14.1ï¼ˆ2025 æœ€æ–°ï¼‰
- crunï¼ˆè½»é‡çº§è¿è¡Œæ—¶ï¼‰
- Kubernetes 1.30

**ä¼˜åŒ–ç­–ç•¥**ï¼š

- **AOT ç¼–è¯‘**ï¼šä½¿ç”¨ AOT ç¼–è¯‘æå‡æ€§èƒ½
- **JIT ä¼˜åŒ–**ï¼šä½¿ç”¨ JIT ä¼˜åŒ–çƒ­ç‚¹ä»£ç 
- **å¹¶è¡Œæ‰§è¡Œ**ï¼šåˆ©ç”¨å¤šæ ¸å¹¶è¡Œæ‰§è¡Œ

### æ§åˆ¶ç»“æ„ä¼˜åŒ–

**æŠ€æœ¯æ ˆ**ï¼š

- Kubernetes 1.30
- cgroup v2
- WasmEdge 0.14.1

**ä¼˜åŒ–ç­–ç•¥**ï¼š

- **æ™ºèƒ½è°ƒåº¦**ï¼šä½¿ç”¨æ™ºèƒ½è°ƒåº¦ç®—æ³•
- **èµ„æºéš”ç¦»**ï¼šä½¿ç”¨ cgroup v2 åŠ å¼ºéš”ç¦»
- **ç”¨æˆ·æ€è°ƒåº¦**ï¼šä½¿ç”¨ç”¨æˆ·æ€è°ƒåº¦å‡å°‘å¼€é”€

### ä¿¡æ¯ç»“æ„ä¼˜åŒ–

**æŠ€æœ¯æ ˆ**ï¼š

- WasmEdge 0.14.1ï¼ˆWASI èƒ½åŠ›æ¨¡å‹ï¼‰
- Kubernetes 1.30ï¼ˆnamespace éš”ç¦»ï¼‰
- OPA 0.60ï¼ˆç­–ç•¥å¼•æ“ï¼‰

**ä¼˜åŒ–ç­–ç•¥**ï¼š

- **æœ€å°æƒé™**ï¼šä½¿ç”¨æœ€å°æƒé™åŸåˆ™
- **èƒ½åŠ›æ¨¡å‹**ï¼šä½¿ç”¨ WASI èƒ½åŠ›æ¨¡å‹
- **ç­–ç•¥é©±åŠ¨**ï¼šä½¿ç”¨ç­–ç•¥å¼•æ“é©±åŠ¨æƒé™æ§åˆ¶

## å®é™…åº”ç”¨æ¡ˆä¾‹

### æ¡ˆä¾‹ 1ï¼šå¤šç§Ÿæˆ·å®¹å™¨å¹³å°

**åœºæ™¯**ï¼šå¤šç§Ÿæˆ·å®¹å™¨å¹³å°çš„ç»“æ„å…³ç³»åº”ç”¨

**æŠ€æœ¯æ ˆ**ï¼š

- Kubernetes 1.30ï¼ˆL-3 æ§åˆ¶ç»“æ„ï¼‰
- containerd + crunï¼ˆL-3 è®¡ç®—ç»“æ„ï¼‰
- namespace éš”ç¦»ï¼ˆL-3 ä¿¡æ¯ç»“æ„ï¼‰

**ç»“æ„å…³ç³»åº”ç”¨**ï¼š

- **è®¡ç®—ç»“æ„**ï¼šä½¿ç”¨ crun ä¼˜åŒ–å®¹å™¨å¯åŠ¨æ€§èƒ½
- **æ§åˆ¶ç»“æ„**ï¼šä½¿ç”¨ cgroup v2 è¿›è¡Œèµ„æºéš”ç¦»
- **ä¿¡æ¯ç»“æ„**ï¼šä½¿ç”¨ namespace è¿›è¡Œå¤šç§Ÿæˆ·éš”ç¦»

**æ•ˆæœ**ï¼š

- å®¹å™¨å¯åŠ¨æ—¶é—´ï¼š< 1s
- èµ„æºéš”ç¦»ï¼š100% éš”ç¦»
- å¤šç§Ÿæˆ·éš”ç¦»ï¼šå®Œå…¨éš”ç¦»

### æ¡ˆä¾‹ 2ï¼šè¾¹ç¼˜ Wasm è¿è¡Œæ—¶

**åœºæ™¯**ï¼šè¾¹ç¼˜èŠ‚ç‚¹çš„ Wasm è¿è¡Œæ—¶ç»“æ„å…³ç³»åº”ç”¨

**æŠ€æœ¯æ ˆ**ï¼š

- WasmEdge 0.14.1ï¼ˆL-4 è®¡ç®—ç»“æ„ï¼‰
- K3s 1.30ï¼ˆL-3 æ§åˆ¶ç»“æ„ï¼‰
- WASI èƒ½åŠ›æ¨¡å‹ï¼ˆL-4 ä¿¡æ¯ç»“æ„ï¼‰

**ç»“æ„å…³ç³»åº”ç”¨**ï¼š

- **è®¡ç®—ç»“æ„**ï¼šä½¿ç”¨ WasmEdge AOT ç¼–è¯‘æå‡æ€§èƒ½
- **æ§åˆ¶ç»“æ„**ï¼šä½¿ç”¨ç”¨æˆ·æ€è°ƒåº¦å‡å°‘å¼€é”€
- **ä¿¡æ¯ç»“æ„**ï¼šä½¿ç”¨ WASI èƒ½åŠ›æ¨¡å‹å®ç°æœ€å°æƒé™

**æ•ˆæœ**ï¼š

- Wasm å¯åŠ¨æ—¶é—´ï¼š< 1ms
- èµ„æºå ç”¨ï¼š< 5MB
- å®‰å…¨éš”ç¦»ï¼šå­—èŠ‚ç çº§éš”ç¦»

---

**æœ€åæ›´æ–°**ï¼š2025-11-15 **ç»´æŠ¤è€…**ï¼šé¡¹ç›®å›¢é˜Ÿ

# L-3 å®¹å™¨åŒ–å±‚ï¼ˆè¿›ç¨‹çº§éš”ç¦»ï¼‰

**æœ€åæ›´æ–°**: 2025-11-07 **ç»´æŠ¤è€…**: é¡¹ç›®å›¢é˜Ÿ

## ğŸ“‘ ç›®å½•

- [ğŸ“‘ ç›®å½•](#-ç›®å½•)
- [L-3.1 å±‚çº§å®šä½](#l-31-å±‚çº§å®šä½)
- [L-3.2 æ ¸å¿ƒæ¦‚å¿µ](#l-32-æ ¸å¿ƒæ¦‚å¿µ)
- [L-3.3 æŠ€æœ¯å®ç°](#l-33-æŠ€æœ¯å®ç°)
  - [L-3.3.1 runc + containerd](#l-331-runc--containerd)
  - [L-3.3.2 Docker](#l-332-docker)
  - [L-3.3.3 Podman](#l-333-podman)
  - [L-3.3.4 Linux å†…æ ¸ç‰¹æ€§](#l-334-linux-å†…æ ¸ç‰¹æ€§)
- [L-3.4 æ€§èƒ½ç‰¹ç‚¹](#l-34-æ€§èƒ½ç‰¹ç‚¹)
- [L-3.5 å®‰å…¨ç‰¹ç‚¹](#l-35-å®‰å…¨ç‰¹ç‚¹)
- [L-3.6 åº”ç”¨åœºæ™¯](#l-36-åº”ç”¨åœºæ™¯)
- [L-3.7 æ•…éšœæ’æŸ¥](#l-37-æ•…éšœæ’æŸ¥)
  - [L-3.7.1 è¯Šæ–­å…³é”®è¯](#l-371-è¯Šæ–­å…³é”®è¯)
  - [L-3.7.2 å¸¸è§é—®é¢˜](#l-372-å¸¸è§é—®é¢˜)
- [L-3.8 ä¸å…¶ä»–å±‚æ¬¡å¯¹æ¯”](#l-38-ä¸å…¶ä»–å±‚æ¬¡å¯¹æ¯”)
- [L-3.9 å®é™…éƒ¨ç½²æ¡ˆä¾‹](#l-39-å®é™…éƒ¨ç½²æ¡ˆä¾‹)
  - [L-3.9.1 æ¡ˆä¾‹ä¸€ï¼šKubernetes å®¹å™¨åŒ–éƒ¨ç½²](#l-391-æ¡ˆä¾‹ä¸€kubernetes-å®¹å™¨åŒ–éƒ¨ç½²)
  - [L-3.9.2 æ¡ˆä¾‹äºŒï¼šDocker Compose å¤šå®¹å™¨ç¼–æ’](#l-392-æ¡ˆä¾‹äºŒdocker-compose-å¤šå®¹å™¨ç¼–æ’)
  - [L-3.9.3 æ¡ˆä¾‹ä¸‰ï¼šPodman Rootless å®¹å™¨](#l-393-æ¡ˆä¾‹ä¸‰podman-rootless-å®¹å™¨)
- [L-3.10 æœ€ä½³å®è·µ](#l-310-æœ€ä½³å®è·µ)
  - [L-3.10.1 å®¹å™¨å®‰å…¨æœ€ä½³å®è·µ](#l-3101-å®¹å™¨å®‰å…¨æœ€ä½³å®è·µ)
  - [L-3.10.2 æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ](#l-3102-æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ)
  - [L-3.10.3 è¿ç»´æœ€ä½³å®è·µ](#l-3103-è¿ç»´æœ€ä½³å®è·µ)
- [L-3.11 å‚è€ƒ](#l-311-å‚è€ƒ)
  - [L-3.11.1 ç›¸å…³æ–‡æ¡£](#l-3111-ç›¸å…³æ–‡æ¡£)
  - [L-3.11.2 å¤–éƒ¨èµ„æº](#l-3112-å¤–éƒ¨èµ„æº)
  - [L-3.11.3 æŠ€æœ¯æ ‡å‡†](#l-3113-æŠ€æœ¯æ ‡å‡†)

---

## L-3.1 å±‚çº§å®šä½

**å±‚çº§å®šä½**ï¼šå…±äº«å®¿ä¸»æœºå†…æ ¸ï¼Œé€šè¿‡ Namespaceã€Cgroup ç­‰æŠ€æœ¯å®ç°è¿›ç¨‹çº§éš”ç¦»ã€‚

**æ ¸å¿ƒä½œç”¨**ï¼š

- è½»é‡çº§éš”ç¦»ï¼Œå…±äº«å®¿ä¸»æœºå†…æ ¸
- å¿«é€Ÿå¯åŠ¨ï¼ˆ1-5sï¼‰
- é«˜å¯†åº¦éƒ¨ç½²
- æ ‡å‡†åŒ–å®¹å™¨é•œåƒå’Œè¿è¡Œæ—¶

**ä½ç½®**ï¼šä½äºå®¹å™¨å±‚ï¼Œå¯ä»¥ä¾èµ– L-0 ç¡¬ä»¶è¾…åŠ©å±‚ï¼ˆå¯é€‰ï¼‰ï¼Œæ˜¯å½“å‰ä¸»æµçš„æŠ€æœ¯ã€‚

---

## L-3.2 æ ¸å¿ƒæ¦‚å¿µ

| ç»„ä»¶             | å­æ¨¡å—/é»‘è¯                        | ä¸€å¥è¯è§£é‡Š                                                       |
| ---------------- | ---------------------------------- | ---------------------------------------------------------------- |
| **runc**         | `config.json`ã€specsã€rootfsã€init | OCI æ ‡å‡†è¿è¡Œæ—¶ï¼ŒçœŸæ­£ `clone()` å‡ºå®¹å™¨è¿›ç¨‹                        |
| **containerd**   | shimã€CRIã€snapshotterã€lease      | è´Ÿè´£é•œåƒæ‹‰å–ã€å®¹å™¨ç”Ÿå‘½å‘¨æœŸï¼ŒK8s é»˜è®¤ CRI                         |
| **Docker**       | dockerdã€BuildKitã€compose         | è€å“ç‰Œï¼ŒæŠŠ runc+containerd åŒ…æˆ CLIï¼›ç°åœ¨é•œåƒæ„å»ºå·²äº¤ç»™ BuildKit |
| **Podman**       | podã€systemd generateã€rootless    | æ— å®ˆæŠ¤è¿›ç¨‹ã€å¯ç›´æ¥è·‘ systemd å•å…ƒï¼ŒRootless ç”¨ user-ns           |
| **cgroups**      | v1/v2ã€memory.highã€pids.max       | å†…æ ¸"é™é¢å™¨"ï¼Œé˜²æ­¢å®¹å™¨æŠŠå®¿ä¸»æœºå†…å­˜åƒå…‰                           |
| **namespaces**   | pid/net/ipc/uts/mnt/user           | å†…æ ¸"éš”ç¦»ç½©"ï¼Œè®©å®¹å™¨åªèƒ½çœ‹åˆ°è‡ªå·±çš„ 1 å·è¿›ç¨‹ã€è‡ªå·±çš„ç½‘å¡          |
| **seccomp**      | filterã€BPFã€SCMP_ACT_KILL         | ç³»ç»Ÿè°ƒç”¨ç™½åå•ï¼Œå®¹å™¨æƒ³ `mount` ç›´æ¥ `-EPERM`                     |
| **capabilities** | CAP_SYS_ADMINã€CAP_NET_RAW         | æŠŠ root æ‹†æˆ 40+ å°å—ï¼Œå®¹å™¨å°±ç®— uid=0 ä¹Ÿå¹²ä¸äº†æ‰€æœ‰äº‹             |

---

## L-3.3 æŠ€æœ¯å®ç°

### L-3.3.1 runc + containerd

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š

- **OCI Runtime Spec**ï¼šOpen Container Initiative è¿è¡Œæ—¶è§„èŒƒï¼Œå®šä¹‰å®¹å™¨çš„æ ‡å‡†é…ç½®
  æ ¼å¼
- **rootfs**ï¼šå®¹å™¨çš„æ ¹æ–‡ä»¶ç³»ç»Ÿï¼Œé€šè¿‡ OverlayFS ç­‰å®ç°åˆ†å±‚å­˜å‚¨
- **shim**ï¼šcontainerd çš„é€‚é…å±‚ï¼Œè´Ÿè´£ç®¡ç†å®¹å™¨è¿›ç¨‹ç”Ÿå‘½å‘¨æœŸ
- **CRIï¼ˆContainer Runtime Interfaceï¼‰**ï¼šKubernetes çš„å®¹å™¨è¿è¡Œæ—¶æ¥å£æ ‡å‡†

**æ¶æ„å›¾**ï¼š

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Kubernetes                          â”‚
â”‚  - kubelet                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ containerd                          â”‚
â”‚  - CRI Plugin                       â”‚
â”‚  - Snapshotter                      â”‚
â”‚  - Shim                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ runc                                â”‚
â”‚  - OCI Runtime                      â”‚
â”‚  - namespace/cgroup/seccomp         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Linux Kernel                        â”‚
â”‚  - namespaces                       â”‚
â”‚  - cgroups                          â”‚
â”‚  - seccomp                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**éƒ¨ç½²ç¤ºä¾‹**ï¼š

```bash
# ä½¿ç”¨ containerd è¿è¡Œå®¹å™¨
ctr images pull docker.io/library/nginx:latest
ctr run -d docker.io/library/nginx:latest nginx1

# ä½¿ç”¨ runc ç›´æ¥è¿è¡Œï¼ˆéœ€è¦æ‰‹åŠ¨åˆ›å»º rootfsï¼‰
runc create mycontainer
runc start mycontainer
```

### L-3.3.2 Docker

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š

- **dockerd**ï¼šDocker å®ˆæŠ¤è¿›ç¨‹
- **BuildKit**ï¼šDocker çš„é•œåƒæ„å»ºå¼•æ“
- **compose**ï¼šDocker Compose å¤šå®¹å™¨ç¼–æ’

**éƒ¨ç½²ç¤ºä¾‹**ï¼š

```bash
# Docker éƒ¨ç½²
docker run -d --name nginx nginx:latest

# Docker Compose
docker-compose up -d
```

### L-3.3.3 Podman

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š

- **æ— å®ˆæŠ¤è¿›ç¨‹**ï¼šä¸éœ€è¦ root æƒé™çš„å®ˆæŠ¤è¿›ç¨‹
- **Rootless**ï¼šä½¿ç”¨ user namespace å®ç°é root è¿è¡Œ
- **systemd é›†æˆ**ï¼šå¯ä»¥ç›´æ¥ç”Ÿæˆ systemd å•å…ƒ

**éƒ¨ç½²ç¤ºä¾‹**ï¼š

```bash
# Podman éƒ¨ç½²ï¼ˆRootlessï¼‰
podman run -d --name nginx nginx:latest

# ç”Ÿæˆ systemd å•å…ƒ
podman generate systemd --name nginx > /etc/systemd/system/nginx.service
systemctl enable --now nginx.service
```

### L-3.3.4 Linux å†…æ ¸ç‰¹æ€§

**æ ¸å¿ƒæŠ€æœ¯**ï¼š

- **namespaces**ï¼šè¿›ç¨‹éš”ç¦»ï¼ˆpidã€netã€ipcã€utsã€mntã€userï¼‰
- **cgroups**ï¼šèµ„æºé™åˆ¶ï¼ˆv1/v2ï¼‰
- **seccomp**ï¼šç³»ç»Ÿè°ƒç”¨è¿‡æ»¤
- **capabilities**ï¼šæƒé™ç»†åˆ†

**æ£€æŸ¥æ–¹æ³•**ï¼š

```bash
# æ£€æŸ¥ namespace æ”¯æŒ
ls /proc/self/ns/

# æ£€æŸ¥ cgroup v2
mount | grep cgroup

# æ£€æŸ¥ seccomp æ”¯æŒ
grep CONFIG_SECCOMP /boot/config-$(uname -r)
```

---

## L-3.4 æ€§èƒ½ç‰¹ç‚¹

| æ€§èƒ½æŒ‡æ ‡       | ç‰¹ç‚¹           | è¯´æ˜                      |
| -------------- | -------------- | ------------------------- |
| **éš”ç¦»å¼ºåº¦**   | â­â­â­ (3)     | è¿›ç¨‹çº§éš”ç¦»ï¼Œå…±äº«å†…æ ¸      |
| **å†·å¯åŠ¨æ—¶é—´** | 1-5s           | å¿«é€Ÿå¯åŠ¨ï¼Œæ— éœ€å¯åŠ¨å®Œæ•´ OS |
| **å†…å­˜å¼€é”€**   | 10-50MB        | ä½å†…å­˜å ç”¨                |
| **CPU å¼€é”€**   | 1-3%           | ä½ CPU å¼€é”€               |
| **èµ„æºåˆ©ç”¨ç‡** | â­â­â­â­â­ (5) | é«˜å¯†åº¦éƒ¨ç½²                |
| **ç½‘ç»œæ€§èƒ½**   | â­â­â­â­ (4)   | è‰¯å¥½çš„ç½‘ç»œæ€§èƒ½            |
| **å­˜å‚¨æ€§èƒ½**   | â­â­â­â­â­ (5) | ç›´æ¥è®¿é—®æ–‡ä»¶ç³»ç»Ÿ          |

**ä¼˜åŠ¿**ï¼š

- âœ… å¿«é€Ÿå¯åŠ¨ï¼ˆ1-5sï¼‰
- âœ… ä½èµ„æºå ç”¨ï¼ˆ10-50MBï¼‰
- âœ… é«˜å¯†åº¦éƒ¨ç½²
- âœ… æ ‡å‡†åŒ–é•œåƒå’Œè¿è¡Œæ—¶

**åŠ£åŠ¿**ï¼š

- âš ï¸ éš”ç¦»å¼ºåº¦ä¸­ç­‰ï¼ˆå…±äº«å†…æ ¸ï¼‰
- âš ï¸ å®‰å…¨æ€§ç›¸å¯¹è¾ƒä½

---

## L-3.5 å®‰å…¨ç‰¹ç‚¹

| å®‰å…¨ç‰¹æ€§       | è¯´æ˜        | å®‰å…¨ç­‰çº§             |
| -------------- | ----------- | -------------------- |
| **éš”ç¦»å¼ºåº¦**   | â­â­â­ (3)  | è¿›ç¨‹çº§éš”ç¦»ï¼Œå…±äº«å†…æ ¸ |
| **æ”»å‡»é¢**     | è¾ƒå¤§        | å…±äº«å†…æ ¸ï¼Œæ”»å‡»é¢è¾ƒå¤§ |
| **å¤šç§Ÿæˆ·éš”ç¦»** | âš ï¸ ä¸­ç­‰éš”ç¦» | è¿›ç¨‹çº§éš”ç¦»           |
| **åˆè§„è¦æ±‚**   | âš ï¸ éƒ¨åˆ†æ»¡è¶³ | éš”ç¦»å¼ºåº¦ä¸­ç­‰         |

**å®‰å…¨ä¼˜åŠ¿**ï¼š

- âœ… è½»é‡çº§éš”ç¦»ï¼Œèµ„æºé«˜æ•ˆ
- âœ… æ”¯æŒ Rootless å®¹å™¨
- âœ… seccomp å’Œ capabilities æä¾›é¢å¤–å®‰å…¨ä¿æŠ¤

**å®‰å…¨åŠ£åŠ¿**ï¼š

- âš ï¸ å…±äº«å†…æ ¸ï¼Œå®‰å…¨æ€§ç›¸å¯¹è¾ƒä½
- âš ï¸ éœ€è¦é¢å¤–çš„å®‰å…¨åŠ å›º

**å®‰å…¨åŠ å›º**ï¼š

```bash
# ä½¿ç”¨ seccomp é…ç½®æ–‡ä»¶
docker run --security-opt seccomp=profile.json nginx

# é™åˆ¶ capabilities
docker run --cap-drop ALL --cap-add NET_BIND_SERVICE nginx

# ä½¿ç”¨ rootless æ¨¡å¼
podman run --userns=keep-id nginx
```

---

## L-3.6 åº”ç”¨åœºæ™¯

**é€‚ç”¨åœºæ™¯**ï¼š

- âœ… **å¾®æœåŠ¡æ¶æ„**ï¼šæ ‡å‡†åŒ–çš„å¾®æœåŠ¡éƒ¨ç½²
- âœ… **DevOps æµæ°´çº¿**ï¼šCI/CD æµæ°´çº¿
- âœ… **äº‘åŸç”Ÿåº”ç”¨**ï¼šKubernetes ç”Ÿæ€
- âœ… **å¼€å‘æµ‹è¯•ç¯å¢ƒ**ï¼šå¿«é€Ÿéƒ¨ç½²å’Œé”€æ¯

**ä¸é€‚ç”¨åœºæ™¯**ï¼š

- âŒ **å¼ºéš”ç¦»è¦æ±‚**ï¼šéœ€è¦å¼ºéš”ç¦»çš„åˆè§„åœºæ™¯
- âŒ **å†…æ ¸å®šåˆ¶éœ€æ±‚**ï¼šéœ€è¦å®šåˆ¶å†…æ ¸çš„åœºæ™¯

**å…¸å‹æŠ€æœ¯æ ˆ**ï¼š

- **Kubernetes**ï¼šK8s + containerd + runc
- **Docker**ï¼šDocker + Docker Compose
- **Podman**ï¼šPodman + Rootless

---

## L-3.7 æ•…éšœæ’æŸ¥

### L-3.7.1 è¯Šæ–­å…³é”®è¯

| å…³é”®è¯                             | å«ä¹‰                    | è§£å†³æ–¹æ³•                 |
| ---------------------------------- | ----------------------- | ------------------------ |
| `ContainerCreating`                | å®¹å™¨åˆ›å»ºä¸­              | æ£€æŸ¥é•œåƒæ‹‰å–/å­˜å‚¨æŒ‚è½½    |
| `OOMKilled`                        | å†…å­˜è¶…é™è¢«æ€            | æ£€æŸ¥ cgroup memory.limit |
| `namespace creation failed`        | å‘½åç©ºé—´åˆ›å»ºå¤±è´¥        | æ£€æŸ¥å†…æ ¸æ”¯æŒ             |
| `seccomp: Operation not permitted` | ç³»ç»Ÿè°ƒç”¨è¢« seccomp æ‹¦æˆª | æ£€æŸ¥ seccomp é…ç½®        |
| `capability not permitted`         | ç¼ºå°‘æ‰€éœ€çš„èƒ½åŠ›          | æ£€æŸ¥ capabilities é…ç½®   |

### L-3.7.2 å¸¸è§é—®é¢˜

**é—®é¢˜ 1ï¼šå®¹å™¨æ— æ³•å¯åŠ¨**:

```bash
# æ£€æŸ¥å®¹å™¨æ—¥å¿—
docker logs container-name

# æ£€æŸ¥å®¹å™¨çŠ¶æ€
docker inspect container-name

# æ£€æŸ¥å‘½åç©ºé—´
lsns -t pid
```

**é—®é¢˜ 2ï¼šå†…å­˜ä¸è¶³**:

```bash
# æ£€æŸ¥ cgroup å†…å­˜é™åˆ¶
cat /sys/fs/cgroup/memory/memory.limit_in_bytes

# æ£€æŸ¥å®¹å™¨å†…å­˜ä½¿ç”¨
docker stats container-name

# è°ƒæ•´å†…å­˜é™åˆ¶
docker run --memory=512m nginx
```

**é—®é¢˜ 3ï¼šæƒé™é—®é¢˜**:

```bash
# æ£€æŸ¥ capabilities
docker inspect container-name | grep -i cap

# æ£€æŸ¥ seccomp é…ç½®
docker inspect container-name | grep -i seccomp

# ä½¿ç”¨ rootless æ¨¡å¼
podman run --userns=keep-id nginx
```

---

## L-3.8 ä¸å…¶ä»–å±‚æ¬¡å¯¹æ¯”

| å¯¹æ¯”ç»´åº¦       | L-3 å®¹å™¨åŒ– | L-1 å…¨è™šæ‹ŸåŒ– | L-2 åŠè™šæ‹ŸåŒ– | L-4 æ²™ç›’åŒ– |
| -------------- | ---------- | ------------ | ------------ | ---------- |
| **éš”ç¦»å¼ºåº¦**   | â­â­â­     | â­â­â­â­â­   | â­â­â­â­     | â­â­â­â­â­ |
| **å†·å¯åŠ¨æ—¶é—´** | 1-5s       | 5-30s        | 3-10s        | <10ms      |
| **å†…å­˜å¼€é”€**   | 10-50MB    | 128MB+       | 64-128MB     | 1-5MB      |
| **CPU å¼€é”€**   | 1-3%       | 5-10%        | 2-5%         | <1%        |
| **èµ„æºåˆ©ç”¨ç‡** | â­â­â­â­â­ | â­â­         | â­â­â­       | â­â­â­â­â­ |
| **å…¼å®¹æ€§**     | â­â­â­â­â­ | â­â­â­â­â­   | â­â­â­â­     | â­â­â­     |
| **éƒ¨ç½²å¯†åº¦**   | é«˜         | ä½           | ä¸­           | æé«˜       |

**å…³é”®åŒºåˆ«**ï¼š

- **L-3** æ˜¯å½“å‰ä¸»æµæŠ€æœ¯ï¼Œå¹³è¡¡äº†éš”ç¦»å’Œæ€§èƒ½
- **L-3** é€‚åˆå¾®æœåŠ¡å’Œäº‘åŸç”Ÿåº”ç”¨
- **L-3** éš”ç¦»å¼ºåº¦ä¸­ç­‰ï¼Œéœ€è¦é¢å¤–å®‰å…¨åŠ å›º

**ç›¸å…³æ–‡æ¡£**ï¼š

- è¯¦ç»†å¯¹æ¯”ï¼š[éš”ç¦»å±‚æ¬¡æ€»ç»“åˆå¹¶å¯¹æ¯”](isolation-comparison.md)
- ä¾èµ–å±‚æ¬¡ï¼š[L-0 ç¡¬ä»¶è¾…åŠ©å±‚](L-0-hardware-assist.md)ï¼ˆå¯é€‰ï¼‰
- ç›¸å…³å±‚æ¬¡
  ï¼š[L-1 å…¨è™šæ‹ŸåŒ–å±‚](L-1-full-virtualization.md)ã€[L-2 åŠè™šæ‹ŸåŒ–å±‚](L-2-paravirtualization.md)ã€[L-4 æ²™ç›’åŒ–å±‚](L-4-sandboxing.md)

---

## L-3.9 å®é™…éƒ¨ç½²æ¡ˆä¾‹

### L-3.9.1 æ¡ˆä¾‹ä¸€ï¼šKubernetes å®¹å™¨åŒ–éƒ¨ç½²

**åœºæ™¯**ï¼šä½¿ç”¨ Kubernetes + containerd éƒ¨ç½²å¾®æœåŠ¡åº”ç”¨ã€‚

**é…ç½®æ­¥éª¤**ï¼š

```bash
# 1. å®‰è£… containerd
sudo apt-get install containerd

# 2. é…ç½® containerd
sudo mkdir -p /etc/containerd
containerd config default | sudo tee /etc/containerd/config.toml

# 3. å¯åŠ¨ containerd
sudo systemctl enable --now containerd

# 4. éƒ¨ç½² Kubernetes é›†ç¾¤
kubeadm init --pod-network-cidr=10.244.0.0/16

# 5. éƒ¨ç½²åº”ç”¨
kubectl apply -f app-deployment.yaml
```

**é¢„æœŸç»“æœ**ï¼š

- å®¹å™¨æˆåŠŸå¯åŠ¨ï¼ˆ1-3sï¼‰
- åº”ç”¨æ­£å¸¸è¿è¡Œ
- èµ„æºåˆ©ç”¨ç‡é«˜

### L-3.9.2 æ¡ˆä¾‹äºŒï¼šDocker Compose å¤šå®¹å™¨ç¼–æ’

**åœºæ™¯**ï¼šä½¿ç”¨ Docker Compose ç¼–æ’å¤šå®¹å™¨åº”ç”¨ã€‚

**é…ç½®æ–‡ä»¶**ï¼š

```yaml
version: "3.8"
services:
  web:
    image: nginx:latest
    ports:
      - "80:80"
    depends_on:
      - app

  app:
    image: app:latest
    environment:
      - DATABASE_URL=postgresql://db:5432/app
    depends_on:
      - db

  db:
    image: postgres:14
    environment:
      - POSTGRES_DB=app
      - POSTGRES_USER=app
      - POSTGRES_PASSWORD=password
    volumes:
      - db-data:/var/lib/postgresql/data

volumes:
  db-data:
```

**éƒ¨ç½²å‘½ä»¤**ï¼š

```bash
docker-compose up -d
```

**é¢„æœŸç»“æœ**ï¼š

- å¤šä¸ªå®¹å™¨ååŒå·¥ä½œ
- æœåŠ¡ä¾èµ–å…³ç³»æ­£ç¡®
- æ•°æ®æŒä¹…åŒ–æ­£å¸¸

### L-3.9.3 æ¡ˆä¾‹ä¸‰ï¼šPodman Rootless å®¹å™¨

**åœºæ™¯**ï¼šä½¿ç”¨ Podman åœ¨é root ç”¨æˆ·ä¸‹è¿è¡Œå®¹å™¨ã€‚

**é…ç½®æ­¥éª¤**ï¼š

```bash
# 1. å®‰è£… Podman
sudo apt-get install podman

# 2. é…ç½® Rootless å®¹å™¨
# åˆ›å»ºç”¨æˆ·å‘½åç©ºé—´
podman system migrate

# 3. è¿è¡Œ Rootless å®¹å™¨
podman run -d --name nginx nginx:latest

# 4. ç”Ÿæˆ systemd å•å…ƒ
podman generate systemd --name nginx > ~/.config/systemd/user/nginx.service

# 5. å¯ç”¨æœåŠ¡
systemctl --user enable --now nginx.service
```

**é¢„æœŸç»“æœ**ï¼š

- å®¹å™¨ä»¥é root ç”¨æˆ·è¿è¡Œ
- å®‰å…¨æ€§æå‡
- æœåŠ¡è‡ªåŠ¨å¯åŠ¨

---

## L-3.10 æœ€ä½³å®è·µ

### L-3.10.1 å®¹å™¨å®‰å…¨æœ€ä½³å®è·µ

1. **æœ€å°æƒé™åŸåˆ™**ï¼š

   - ä½¿ç”¨é root ç”¨æˆ·è¿è¡Œå®¹å™¨ï¼ˆRootlessï¼‰
   - é™åˆ¶ capabilitiesï¼Œåªæˆäºˆå¿…è¦çš„æƒé™

2. **seccomp é…ç½®**ï¼š

   - ä½¿ç”¨ seccomp é…ç½®æ–‡ä»¶é™åˆ¶ç³»ç»Ÿè°ƒç”¨
   - å®šæœŸå®¡æŸ¥å’Œæ›´æ–° seccomp è§„åˆ™

3. **é•œåƒå®‰å…¨**ï¼š
   - ä½¿ç”¨å®˜æ–¹æˆ–å¯ä¿¡çš„é•œåƒæº
   - å®šæœŸæ‰«æé•œåƒæ¼æ´
   - ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå‡å°é•œåƒå¤§å°

### L-3.10.2 æ€§èƒ½ä¼˜åŒ–æœ€ä½³å®è·µ

1. **èµ„æºé™åˆ¶**ï¼š

   - è®¾ç½®åˆç†çš„ CPU å’Œå†…å­˜é™åˆ¶
   - ä½¿ç”¨ cgroup v2 ç»Ÿä¸€èµ„æºæ§åˆ¶

2. **é•œåƒä¼˜åŒ–**ï¼š

   - ä½¿ç”¨å¤šé˜¶æ®µæ„å»ºå‡å°é•œåƒå¤§å°
   - ä¼˜åŒ– Dockerfileï¼Œå‡å°‘å±‚æ•°
   - ä½¿ç”¨ .dockerignore æ’é™¤ä¸å¿…è¦çš„æ–‡ä»¶

3. **ç½‘ç»œä¼˜åŒ–**ï¼š
   - ä½¿ç”¨ CNI æ’ä»¶ä¼˜åŒ–ç½‘ç»œæ€§èƒ½
   - è€ƒè™‘ä½¿ç”¨ SR-IOV æˆ– DPDKï¼ˆé«˜æ€§èƒ½åœºæ™¯ï¼‰

### L-3.10.3 è¿ç»´æœ€ä½³å®è·µ

1. **ç›‘æ§å’Œæ—¥å¿—**ï¼š

   - é…ç½®å®¹å™¨æ—¥å¿—æ”¶é›†ï¼ˆFluentdã€Lokiï¼‰
   - ç›‘æ§å®¹å™¨èµ„æºä½¿ç”¨æƒ…å†µï¼ˆPrometheusï¼‰

2. **å¤‡ä»½å’Œæ¢å¤**ï¼š

   - å®šæœŸå¤‡ä»½å®¹å™¨é…ç½®å’Œæ•°æ®
   - ä½¿ç”¨ Volume æŒä¹…åŒ–é‡è¦æ•°æ®

3. **æ›´æ–°å’Œç»´æŠ¤**ï¼š
   - å®šæœŸæ›´æ–°å®¹å™¨é•œåƒå’Œè¿è¡Œæ—¶
   - ä½¿ç”¨æ»šåŠ¨æ›´æ–°ç­–ç•¥å‡å°‘åœæœºæ—¶é—´

---

## L-3.11 å‚è€ƒ

### L-3.11.1 ç›¸å…³æ–‡æ¡£

- **[29. éš”ç¦»æ ˆ](../isolation-stack.md)** - å®Œæ•´çš„å››å±‚éš”ç¦»æ ˆæ–‡æ¡£
  - **[29.3.4 L-3 å®¹å™¨åŒ–å±‚](../isolation-stack.md#2934-l-3-å®¹å™¨åŒ–å±‚è¿›ç¨‹çº§éš”ç¦»)** -
    è¯¦ç»†æŠ€æœ¯è§£æ
- **[00. Docker](../../00-docker/docker.md)** - Docker è¯¦ç»†æ–‡æ¡£
- **[01. Kubernetes](../../01-kubernetes/kubernetes.md)** - Kubernetes è¯¦ç»†æ–‡æ¡£
- **[30. æ¦‚å¿µå…³ç³»çŸ©é˜µ](../../30-concept-relations-matrix/concept-relations-matrix.md)** -
  æ¦‚å¿µå…³ç³»æ¢³ç†
  - **[30.20 éš”ç¦»å±‚æ¬¡å…¨é¢å¯¹æ¯”åˆ†æ](../../30-concept-relations-matrix/concept-relations-matrix.md#3020-éš”ç¦»å±‚æ¬¡å…¨é¢å¯¹æ¯”åˆ†æ)** -
    éš”ç¦»å±‚æ¬¡å¯¹æ¯”

### L-3.11.2 å¤–éƒ¨èµ„æº

- **OCI æ ‡å‡†** - Open Container Initiative æ ‡å‡†
- **runc æ–‡æ¡£** - runc è¿è¡Œæ—¶æ–‡æ¡£
- **containerd æ–‡æ¡£** - containerd æ–‡æ¡£
- **Docker æ–‡æ¡£** - Docker å®˜æ–¹æ–‡æ¡£
- **Podman æ–‡æ¡£** - Podman å®˜æ–¹æ–‡æ¡£

### L-3.11.3 æŠ€æœ¯æ ‡å‡†

- **OCI Runtime Spec** - OCI è¿è¡Œæ—¶è§„èŒƒ
- **OCI Image Spec** - OCI é•œåƒè§„èŒƒ
- **CRI** - Container Runtime Interface æ ‡å‡†

---

**æœ€åæ›´æ–°**: 2025-11-07 **ç»´æŠ¤è€…**: é¡¹ç›®å›¢é˜Ÿ

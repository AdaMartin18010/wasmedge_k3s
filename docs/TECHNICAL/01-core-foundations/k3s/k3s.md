# 02. K3sï¼šè½»é‡çº§ Kubernetes æ¶æ„ä¸å®è·µ

## ğŸ“‘ ç›®å½•

- [ğŸ“‘ ç›®å½•](#-ç›®å½•)
- [02.1 æ–‡æ¡£å®šä½](#021-æ–‡æ¡£å®šä½)
- [02.2 å®šä½ä¸ä¼˜åŠ¿](#022-å®šä½ä¸ä¼˜åŠ¿)
  - [02.2.1 ä¸ºä»€ä¹ˆéœ€è¦ K3sï¼Ÿ](#0221-ä¸ºä»€ä¹ˆéœ€è¦-k3s)
  - [02.2.2 K3s vs Kubernetes](#0222-k3s-vs-kubernetes)
  - [02.2.3 å®šä½è®ºè¯](#0223-å®šä½è®ºè¯)
- [02.3 æ¶æ„è®¾è®¡](#023-æ¶æ„è®¾è®¡)
  - [02.3.1 å•äºŒè¿›åˆ¶æ¶æ„](#0231-å•äºŒè¿›åˆ¶æ¶æ„)
  - [02.3.2 ç»„ä»¶å¯¹æ¯”](#0232-ç»„ä»¶å¯¹æ¯”)
  - [02.3.3 æ¶æ„è®¾è®¡è®ºè¯](#0233-æ¶æ„è®¾è®¡è®ºè¯)
- [02.4 è£å‰ªç­–ç•¥](#024-è£å‰ªç­–ç•¥)
  - [02.4.1 è£å‰ªæ¸…å•](#0241-è£å‰ªæ¸…å•)
  - [02.4.2 è£å‰ªç­–ç•¥è®ºè¯](#0242-è£å‰ªç­–ç•¥è®ºè¯)
- [02.5 å­˜å‚¨åç«¯é€‰æ‹©](#025-å­˜å‚¨åç«¯é€‰æ‹©)
  - [02.5.1 ä¸‰ç§å­˜å‚¨æ¨¡å¼](#0251-ä¸‰ç§å­˜å‚¨æ¨¡å¼)
  - [02.5.2 sqlite vs etcd](#0252-sqlite-vs-etcd)
  - [02.5.3 è¾¹ç¼˜åœºæ™¯å­˜å‚¨å†³ç­–](#0253-è¾¹ç¼˜åœºæ™¯å­˜å‚¨å†³ç­–)
  - [02.5.4 å­˜å‚¨åœºæ™¯ä¸å†³ç­–](#0254-å­˜å‚¨åœºæ™¯ä¸å†³ç­–)
- [02.6 å†…ç½®ç»„ä»¶](#026-å†…ç½®ç»„ä»¶)
  - [02.6.1 containerd](#0261-containerd)
  - [02.6.2 flannel](#0262-flannel)
  - [02.6.3 traefik](#0263-traefik)
  - [02.6.4 metrics-server](#0264-metrics-server)
- [02.7 é«˜å¯ç”¨æ¶æ„](#027-é«˜å¯ç”¨æ¶æ„)
  - [02.7.1 ä¸‰ç§ HA è·¯å¾„](#0271-ä¸‰ç§-ha-è·¯å¾„)
  - [02.7.2 HA é…ç½®ç¤ºä¾‹](#0272-ha-é…ç½®ç¤ºä¾‹)
  - [02.7.3 HA åœºæ™¯ä¸å†³ç­–](#0273-ha-åœºæ™¯ä¸å†³ç­–)
- [02.8 æ€§èƒ½ä¼˜åŒ–](#028-æ€§èƒ½ä¼˜åŒ–)
  - [02.8.1 K3s æ€§èƒ½è®ºè¯](#0281-k3s-æ€§èƒ½è®ºè¯)
  - [02.8.2 æ€§èƒ½åŸºçº¿](#0282-æ€§èƒ½åŸºçº¿)
  - [02.8.3 æ€§èƒ½æ¨¡å‹å½¢å¼åŒ–](#0283-æ€§èƒ½æ¨¡å‹å½¢å¼åŒ–)
- [02.9 å®‰è£…ä¸é…ç½®](#029-å®‰è£…ä¸é…ç½®)
  - [02.9.1 å•èŠ‚ç‚¹å®‰è£…](#0291-å•èŠ‚ç‚¹å®‰è£…)
  - [02.9.2 å¤šèŠ‚ç‚¹å®‰è£…](#0292-å¤šèŠ‚ç‚¹å®‰è£…)
  - [02.9.3 é…ç½®æ–‡ä»¶ä½ç½®](#0293-é…ç½®æ–‡ä»¶ä½ç½®)
- [02.10 è¾¹ç¼˜åœºæ™¯å®è·µ](#0210-è¾¹ç¼˜åœºæ™¯å®è·µ)
  - [02.10.1 ARM è®¾å¤‡éƒ¨ç½²](#02101-arm-è®¾å¤‡éƒ¨ç½²)
  - [02.10.2 ç¦»çº¿éƒ¨ç½²](#02102-ç¦»çº¿éƒ¨ç½²)
  - [02.10.3 èµ„æºé™åˆ¶é…ç½®](#02103-èµ„æºé™åˆ¶é…ç½®)
- [02.11 æŠ€æœ¯åœºæ™¯åˆ†æ](#0211-æŠ€æœ¯åœºæ™¯åˆ†æ)
  - [02.11.1 è¾¹ç¼˜è®¡ç®—åœºæ™¯](#02111-è¾¹ç¼˜è®¡ç®—åœºæ™¯)
  - [02.11.2 IoT åœºæ™¯](#02112-iot-åœºæ™¯)
  - [02.11.3 ARM è®¾å¤‡åœºæ™¯](#02113-arm-è®¾å¤‡åœºæ™¯)
- [02.12 æ•…éšœæ’æŸ¥](#0212-æ•…éšœæ’æŸ¥)
  - [02.12.1 å¸¸è§é—®é¢˜](#02121-å¸¸è§é—®é¢˜)
  - [02.12.2 æ—¥å¿—ä½ç½®](#02122-æ—¥å¿—ä½ç½®)
- [02.13 å†³ç­–ä¾æ®ä¸æ€è·¯](#0213-å†³ç­–ä¾æ®ä¸æ€è·¯)
  - [02.13.1 ä½•æ—¶é€‰æ‹© K3sï¼Ÿ](#02131-ä½•æ—¶é€‰æ‹©-k3s)
  - [02.13.2 å­˜å‚¨åç«¯é€‰æ‹©å†³ç­–æ ‘](#02132-å­˜å‚¨åç«¯é€‰æ‹©å†³ç­–æ ‘)
  - [02.13.3 HA è·¯å¾„é€‰æ‹©å†³ç­–æ ‘](#02133-ha-è·¯å¾„é€‰æ‹©å†³ç­–æ ‘)
- [02.14 å½¢å¼åŒ–æ€»ç»“](#0214-å½¢å¼åŒ–æ€»ç»“)
  - [02.14.1 K3s æ¶æ„æ¨¡å‹å½¢å¼åŒ–](#02141-k3s-æ¶æ„æ¨¡å‹å½¢å¼åŒ–)
  - [02.14.2 è£å‰ªæ¨¡å‹å½¢å¼åŒ–](#02142-è£å‰ªæ¨¡å‹å½¢å¼åŒ–)
  - [02.14.3 æ€§èƒ½æ¨¡å‹å½¢å¼åŒ–](#02143-æ€§èƒ½æ¨¡å‹å½¢å¼åŒ–)
  - [02.14.4 å­˜å‚¨é€‰æ‹©æ¨¡å‹å½¢å¼åŒ–](#02144-å­˜å‚¨é€‰æ‹©æ¨¡å‹å½¢å¼åŒ–)
- [02.15 å®é™…éƒ¨ç½²æ¡ˆä¾‹](#0215-å®é™…éƒ¨ç½²æ¡ˆä¾‹)
  - [02.15.1 æ¡ˆä¾‹ 1ï¼šå•èŠ‚ç‚¹ K3s éƒ¨ç½²ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰](#02151-æ¡ˆä¾‹-1å•èŠ‚ç‚¹-k3s-éƒ¨ç½²ç”Ÿäº§ç¯å¢ƒ)
  - [02.15.2 æ¡ˆä¾‹ 2ï¼šé«˜å¯ç”¨ K3s é›†ç¾¤éƒ¨ç½²](#02152-æ¡ˆä¾‹-2é«˜å¯ç”¨-k3s-é›†ç¾¤éƒ¨ç½²)
  - [02.15.3 æ¡ˆä¾‹ 3ï¼šK3s é…ç½® WasmEdge è¿è¡Œæ—¶](#02153-æ¡ˆä¾‹-3k3s-é…ç½®-wasmedge-è¿è¡Œæ—¶)
- [02.16 K3s æœ€ä½³å®è·µ](#0216-k3s-æœ€ä½³å®è·µ)
  - [02.16.1 é›†ç¾¤éƒ¨ç½²æœ€ä½³å®è·µ](#02161-é›†ç¾¤éƒ¨ç½²æœ€ä½³å®è·µ)
  - [02.16.2 è¾¹ç¼˜åœºæ™¯æœ€ä½³å®è·µ](#02162-è¾¹ç¼˜åœºæ™¯æœ€ä½³å®è·µ)
  - [02.16.3 K3s æ£€æŸ¥æ¸…å•](#02163-k3s-æ£€æŸ¥æ¸…å•)
- [02.17 K3s æ•…éšœæ’æŸ¥](#0217-k3s-æ•…éšœæ’æŸ¥)
  - [02.17.1 å¸¸è§é—®é¢˜](#02171-å¸¸è§é—®é¢˜)
- [02.18 å‚è€ƒ](#0218-å‚è€ƒ)
  - [02.18.1 2025 å¹´æœ€æ–°æ›´æ–°ï¼ˆ2025-11-06ï¼‰](#02181-2025-å¹´æœ€æ–°æ›´æ–°2025-11-06)
  - [02.18.2 éš”ç¦»æ ˆç›¸å…³æ–‡æ¡£](#02182-éš”ç¦»æ ˆç›¸å…³æ–‡æ¡£)
  - [02.18.3 K3s ç›¸å…³æ–‡æ¡£](#02183-k3s-ç›¸å…³æ–‡æ¡£)
  - [02.18.4 å…¶ä»–ç›¸å…³æ–‡æ¡£](#02184-å…¶ä»–ç›¸å…³æ–‡æ¡£)
  - [02.18.4 ç½‘ç»œå’Œå­˜å‚¨ç›¸å…³æ–‡æ¡£](#02184-ç½‘ç»œå’Œå­˜å‚¨ç›¸å…³æ–‡æ¡£)
  - [02.18.5 å¤–éƒ¨å‚è€ƒ](#02185-å¤–éƒ¨å‚è€ƒ)

---

## 02.1 æ–‡æ¡£å®šä½

æœ¬æ–‡æ¡£æ·±å…¥è§£æ K3s çš„æ¶æ„è®¾è®¡ã€è£å‰ªç­–ç•¥å’Œè¾¹ç¼˜åœºæ™¯æœ€ä½³å®è·µï¼Œä»¥åŠä¸åŒæŠ€æœ¯åœºæ™¯ä¸‹çš„
å†³ç­–ä¾æ®å’Œå†³ç­–æ€è·¯ã€‚

**å½“å‰ç‰ˆæœ¬ï¼ˆ2025-11-06ï¼‰**ï¼š

- **K3s ç‰ˆæœ¬**ï¼š1.30.4+k3s1ï¼ˆ2024-12 å‘å¸ƒï¼Œ2025-11-06 ç¨³å®šç‰ˆï¼‰
- **å…³é”®ç‰¹æ€§**ï¼šå†…ç½® WasmEdge é©±åŠ¨ï¼Œ`--wasm` flag å³å¼€å³ç”¨
- **ç”Ÿäº§éªŒè¯**ï¼šARM64 è¾¹ç¼˜ç›’å­å•èŠ‚ç‚¹ 3000 Pod å®æµ‹ç¨³å®šï¼ˆ2025-11-06ï¼‰

**æ–‡æ¡£ç»“æ„**ï¼š

- **æ¶æ„è®¾è®¡**ï¼šK3s å•äºŒè¿›åˆ¶æ¶æ„å’Œç»„ä»¶è®¾è®¡
- **è£å‰ªç­–ç•¥**ï¼šä» K8s åˆ° K3s çš„è£å‰ªæ–¹æ¡ˆå’Œè®ºè¯
- **å­˜å‚¨åç«¯**ï¼šsqlite/etcd/å¤–éƒ¨æ•°æ®åº“çš„é€‰æ‹©ä¸å†³ç­–
- **è¾¹ç¼˜å®è·µ**ï¼šARM è®¾å¤‡ã€ç¦»çº¿éƒ¨ç½²ã€èµ„æºé™åˆ¶
- **æŠ€æœ¯åœºæ™¯**ï¼šè¾¹ç¼˜è®¡ç®—ã€IoTã€ARM è®¾å¤‡
- **å†³ç­–åˆ†æ**ï¼šæ¶æ„é€‰æ‹©ã€å­˜å‚¨é€‰æ‹©ã€HA è·¯å¾„é€‰æ‹©

## 02.2 å®šä½ä¸ä¼˜åŠ¿

### 02.2.1 ä¸ºä»€ä¹ˆéœ€è¦ K3sï¼Ÿ

```mermaid
graph LR
    A[Kubernetes] -->|å¤ªé‡| B[è¾¹ç¼˜åœºæ™¯éœ€æ±‚]
    B --> C[K3s]
    C --> D[è½»é‡]
    C --> E[å•äºŒè¿›åˆ¶]
    C --> F[ARM æ”¯æŒ]

    style A fill:#ffe6e6
    style C fill:#e6ffe6
```

**é—®é¢˜åŸŸåˆ†æ**ï¼š

1. **Kubernetes å¤ªé‡**ï¼šæ§åˆ¶å¹³é¢å†…å­˜å ç”¨ ~1GBï¼Œä¸é€‚åˆèµ„æºå—é™ç¯å¢ƒ
2. **è¾¹ç¼˜åœºæ™¯éœ€æ±‚**ï¼šè¾¹ç¼˜èŠ‚ç‚¹èµ„æºæœ‰é™ï¼Œéœ€è¦è½»é‡çº§ Kubernetes
3. **éƒ¨ç½²å¤æ‚**ï¼šK8s éœ€è¦ç‹¬ç«‹å®‰è£… etcdã€CNIã€Ingress ç­‰ç»„ä»¶

**æ ¸å¿ƒæ€æƒ³è®ºè¯**ï¼š

- **è½»é‡åŒ–**ï¼šè£å‰ªä¸éœ€è¦çš„ç»„ä»¶ï¼Œå‡å°èµ„æºå ç”¨
- **å•äºŒè¿›åˆ¶**ï¼šæ‰€æœ‰ç»„ä»¶æ‰“åŒ…åˆ°å•ä¸€äºŒè¿›åˆ¶ï¼Œç®€åŒ–éƒ¨ç½²
- **å†…ç½®ç»„ä»¶**ï¼šå†…ç½® containerdã€flannelã€traefikï¼Œé›¶é…ç½®

### 02.2.2 K3s vs Kubernetes

| ç»´åº¦           | Kubernetes       | K3s                   |
| -------------- | ---------------- | --------------------- |
| **äºŒè¿›åˆ¶å¤§å°** | ~1 GBï¼ˆå¤šç»„ä»¶ï¼‰  | ~60 MBï¼ˆå•äºŒè¿›åˆ¶ï¼‰    |
| **å†…å­˜å ç”¨**   | ~512 MB æ§åˆ¶å¹³é¢ | ~250 MB æ§åˆ¶å¹³é¢      |
| **å­˜å‚¨åç«¯**   | å¤–éƒ¨ etcd        | sqliteï¼ˆé»˜è®¤ï¼‰æˆ– etcd |
| **ç½‘ç»œæ’ä»¶**   | éœ€æ‰‹åŠ¨å®‰è£…       | å†…ç½® flannel          |
| **è´Ÿè½½å‡è¡¡å™¨** | éœ€æ‰‹åŠ¨å®‰è£…       | å†…ç½® traefik          |
| **é€‚ç”¨åœºæ™¯**   | å¤§è§„æ¨¡ç”Ÿäº§é›†ç¾¤   | è¾¹ç¼˜ã€IoTã€ARM è®¾å¤‡   |

**å¯¹æ¯”åˆ†æ**ï¼š

- **äºŒè¿›åˆ¶å¤§å°**ï¼šK3s å•äºŒè¿›åˆ¶ ~60MBï¼ŒK8s å¤šç»„ä»¶ ~1GBï¼Œå‡å° 94%
- **å†…å­˜å ç”¨**ï¼šK3s æ§åˆ¶å¹³é¢ ~250MBï¼ŒK8s ~512MBï¼Œå‡å° 50%
- **éƒ¨ç½²å¤æ‚åº¦**ï¼šK3s å•äºŒè¿›åˆ¶ï¼ŒK8s éœ€è¦å¤šç»„ä»¶å®‰è£…

### 02.2.3 å®šä½è®ºè¯

**ä¸ºä»€ä¹ˆè¾¹ç¼˜åœºæ™¯éœ€è¦ K3sï¼Ÿ**

**å†³ç­–ä¾æ®**ï¼š

- âœ… èµ„æºå—é™ï¼šè¾¹ç¼˜èŠ‚ç‚¹å†…å­˜æœ‰é™ï¼ˆ< 4GBï¼‰
- âœ… ç½‘ç»œä¸ç¨³å®šï¼šè¾¹ç¼˜èŠ‚ç‚¹ç»å¸¸æ‰çº¿
- âœ… éƒ¨ç½²ç®€å•ï¼šéœ€è¦å¿«é€Ÿéƒ¨ç½²å’Œå‡çº§

**å†³ç­–æ€è·¯**ï¼š

```yaml
è¾¹ç¼˜åœºæ™¯éœ€æ±‚:
  èµ„æºé™åˆ¶: < 4GB å†…å­˜
  ç½‘ç»œé™åˆ¶: ä¸ç¨³å®šç½‘ç»œ
  éƒ¨ç½²éœ€æ±‚: å¿«é€Ÿéƒ¨ç½²
  è§£å†³æ–¹æ¡ˆ: K3sï¼ˆè½»é‡ã€å•äºŒè¿›åˆ¶ã€å†…ç½®ç»„ä»¶ï¼‰
```

**ä¸ºä»€ä¹ˆå•äºŒè¿›åˆ¶æ¶æ„ï¼Ÿ**

**å†³ç­–ä¾æ®**ï¼š

- âœ… éƒ¨ç½²ç®€åŒ–ï¼šå•æ–‡ä»¶å®‰è£…ï¼Œæ— éœ€å¤šç»„ä»¶å®‰è£…
- âœ… å‡çº§ç®€å•ï¼šæ›¿æ¢äºŒè¿›åˆ¶å³å¯å‡çº§
- âœ… ç¦»çº¿éƒ¨ç½²ï¼šå•æ–‡ä»¶æ˜“äºç¦»çº¿éƒ¨ç½²

**å†³ç­–æ€è·¯**ï¼š

```yaml
å•äºŒè¿›åˆ¶æ¶æ„:
  ä¼˜åŠ¿:
    - å®‰è£…ç®€å•ï¼ˆcurl | shï¼‰
    - å‡çº§ç®€å•ï¼ˆæ›¿æ¢äºŒè¿›åˆ¶ï¼‰
    - ç¦»çº¿éƒ¨ç½²ï¼ˆå•æ–‡ä»¶ï¼‰
  æƒè¡¡:
    - äºŒè¿›åˆ¶ä½“ç§¯å¢å¤§
    - å‡çº§éœ€è¦æ›¿æ¢æ•´ä¸ªäºŒè¿›åˆ¶
```

## 02.3 æ¶æ„è®¾è®¡

> **ğŸ’¡ éš”ç¦»å±‚æ¬¡å…³è”**ï¼šK3s å†…ç½® containerd ä½œä¸ºå®¹å™¨è¿è¡Œæ—¶ï¼ˆL-3 å®¹å™¨åŒ–å±‚ï¼‰ï¼ŒåŒæ—¶
> æ”¯æŒ WasmEdgeï¼ˆL-4 æ²™ç›’åŒ–å±‚ï¼‰é€šè¿‡ `--wasm` flag å¯ç”¨ã€‚è¯¦ç»†çš„æŠ€æœ¯è§£æè¯·å‚è€ƒï¼š
>
> - **[29. éš”ç¦»æ ˆ](../29-isolation-stack/isolation-stack.md)** - å®Œæ•´çš„éš”ç¦»æ ˆæŠ€
>   æœ¯è§£æ
> - **[L-3 å®¹å™¨åŒ–å±‚](../29-isolation-stack/layers/L-3-containerization.md)** -
>   containerd è¯¦ç»†æ–‡æ¡£
> - **[L-4 æ²™ç›’åŒ–å±‚](../29-isolation-stack/layers/L-4-sandboxing.md)** -
>   WasmEdge è¯¦ç»†æ–‡æ¡£
> - **[éš”ç¦»å±‚æ¬¡å¯¹æ¯”æ–‡æ¡£](../29-isolation-stack/layers/isolation-comparison.md)** -
>   è¿è¡Œæ—¶æ€§èƒ½å¯¹æ¯”å’ŒæŠ€æœ¯é€‰å‹

### 02.3.1 å•äºŒè¿›åˆ¶æ¶æ„

```mermaid
graph TB
    A[k3s äºŒè¿›åˆ¶] --> B[é™æ€é“¾æ¥ç»„ä»¶]
    B --> C[containerd]
    B --> D[flannel]
    B --> E[traefik]
    B --> F[sqlite]
    B --> G[kubelet]
    B --> H[kube-proxy]

    I[manifest ç›®å½•] --> A
    A --> J[å¯åŠ¨æ—¶åŠ è½½<br/>static pod]

    style A fill:#e1f5ff
    style J fill:#fff4e1
```

**æ¶æ„è®¾è®¡åˆ†æ**ï¼š

1. **å•äºŒè¿›åˆ¶**ï¼šæ‰€æœ‰ç»„ä»¶é™æ€é“¾æ¥åˆ° k3s äºŒè¿›åˆ¶
2. **åµŒå…¥å¼ manifest**ï¼šç»„ä»¶é…ç½®å†…åµŒåœ¨äºŒè¿›åˆ¶ä¸­
3. **å¯åŠ¨æ—¶åŠ è½½**ï¼šæ ¹æ® manifest ç›®å½•é¡ºåºå¯åŠ¨ static pod

### 02.3.2 ç»„ä»¶å¯¹æ¯”

| ç»„ä»¶                         | Kubernetes  | K3s              |
| ---------------------------- | ----------- | ---------------- |
| **kube-api-server**          | âœ… ç‹¬ç«‹è¿›ç¨‹ | âœ… å†…ç½®          |
| **etcd**                     | âœ… å¤–éƒ¨é›†ç¾¤ | âœ… sqlite æˆ–å¤–éƒ¨ |
| **kube-controller-manager**  | âœ… ç‹¬ç«‹è¿›ç¨‹ | âœ… å†…ç½®          |
| **kube-scheduler**           | âœ… ç‹¬ç«‹è¿›ç¨‹ | âœ… å†…ç½®          |
| **cloud-controller-manager** | âœ… ç‹¬ç«‹è¿›ç¨‹ | âŒ è£å‰ª          |
| **kubelet**                  | âœ… èŠ‚ç‚¹ç»„ä»¶ | âœ… å†…ç½®          |
| **kube-proxy**               | âœ… èŠ‚ç‚¹ç»„ä»¶ | âœ… å†…ç½®          |
| **containerd**               | å¤–éƒ¨å®‰è£…    | âœ… å†…ç½®          |
| **CNI æ’ä»¶**                 | å¤–éƒ¨å®‰è£…    | âœ… å†…ç½® flannel  |
| **Ingress æ§åˆ¶å™¨**           | å¤–éƒ¨å®‰è£…    | âœ… å†…ç½® traefik  |

### 02.3.3 æ¶æ„è®¾è®¡è®ºè¯

**ä¸ºä»€ä¹ˆé‡‡ç”¨å•äºŒè¿›åˆ¶æ¶æ„ï¼Ÿ**

**å†³ç­–ä¾æ®**ï¼š

- âœ… éƒ¨ç½²ç®€åŒ–ï¼šå•æ–‡ä»¶å®‰è£…ï¼Œæ— éœ€å¤šç»„ä»¶å®‰è£… [^k3s-architecture]
- âœ… å‡çº§ç®€å•ï¼šæ›¿æ¢äºŒè¿›åˆ¶å³å¯å‡çº§
- âœ… ç¦»çº¿éƒ¨ç½²ï¼šå•æ–‡ä»¶æ˜“äºç¦»çº¿éƒ¨ç½²

**å†³ç­–æ€è·¯**ï¼š

```yaml
å•äºŒè¿›åˆ¶æ¶æ„è®¾è®¡:
  æ–¹å¼: é™æ€é“¾æ¥æ‰€æœ‰ç»„ä»¶
  ä¼˜åŠ¿:
    - å®‰è£…ç®€å•ï¼ˆcurl | shï¼‰
    - å‡çº§ç®€å•ï¼ˆæ›¿æ¢äºŒè¿›åˆ¶ï¼‰
    - ç¦»çº¿éƒ¨ç½²ï¼ˆå•æ–‡ä»¶ï¼‰
  æƒè¡¡:
    - äºŒè¿›åˆ¶ä½“ç§¯å¢å¤§ï¼ˆ~60MBï¼‰
    - å‡çº§éœ€è¦æ›¿æ¢æ•´ä¸ªäºŒè¿›åˆ¶
```

**ä¸ºä»€ä¹ˆå†…ç½®ç»„ä»¶ï¼Ÿ**

**å†³ç­–ä¾æ®**ï¼š

- âœ… é›¶é…ç½®ï¼šå†…ç½®ç»„ä»¶è‡ªåŠ¨é…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨å®‰è£…
- âœ… èµ„æºä¼˜åŒ–ï¼šå†…ç½®ç»„ä»¶å…±äº«è¿›ç¨‹ï¼Œå‡å°‘èµ„æºå ç”¨
- âœ… ç®€åŒ–è¿ç»´ï¼šæ— éœ€ç®¡ç†å¤šä¸ªç»„ä»¶

**å†³ç­–æ€è·¯**ï¼š

```yaml
å†…ç½®ç»„ä»¶ç­–ç•¥:
  ç»„ä»¶:
    - containerd: å®¹å™¨è¿è¡Œæ—¶
    - flannel: CNI ç½‘ç»œæ’ä»¶
    - traefik: Ingress æ§åˆ¶å™¨
    - metrics-server: æŒ‡æ ‡æ”¶é›†
  ä¼˜åŠ¿: é›¶é…ç½®ã€èµ„æºä¼˜åŒ–ã€ç®€åŒ–è¿ç»´
  æƒè¡¡: ç»„ä»¶ç‰ˆæœ¬å›ºå®šï¼Œå‡çº§éœ€è¦æ›¿æ¢äºŒè¿›åˆ¶
```

## 02.4 è£å‰ªç­–ç•¥

### 02.4.1 è£å‰ªæ¸…å•

```mermaid
graph TD
    A[K8s å®Œæ•´åŠŸèƒ½] --> B[è£å‰ª Alpha API]
    A --> C[è£å‰ªäº‘æ§åˆ¶å™¨]
    A --> D[è£å‰ª in-tree å­˜å‚¨é©±åŠ¨]
    A --> E[ç®€åŒ–å­˜å‚¨åç«¯]

    B --> F[K3s ç²¾ç®€ç‰ˆ]
    C --> F
    D --> F
    E --> F

    style A fill:#ffe6e6
    style F fill:#e6ffe6
```

| è£å‰ªé¡¹                       | åŸå›                      | å½±å“            |
| ---------------------------- | ------------------------ | --------------- |
| **Alpha API**                | è¾¹ç¼˜åœºæ™¯ä¸éœ€è¦å®éªŒæ€§åŠŸèƒ½ | å‡å°‘ API å¤æ‚åº¦ |
| **cloud-controller-manager** | è¾¹ç¼˜æ— äº‘ç¯å¢ƒ             | å‡å°äºŒè¿›åˆ¶ä½“ç§¯  |
| **in-tree å­˜å‚¨é©±åŠ¨**         | ç»Ÿä¸€ä½¿ç”¨ CSI             | ç®€åŒ–ç»´æŠ¤        |
| **etcdï¼ˆå¯é€‰ï¼‰**             | sqlite æ»¡è¶³è¾¹ç¼˜éœ€æ±‚      | å‡å°èµ„æºå ç”¨    |

### 02.4.2 è£å‰ªç­–ç•¥è®ºè¯

**ä¸ºä»€ä¹ˆè£å‰ª Alpha APIï¼Ÿ**

**å†³ç­–ä¾æ®**ï¼š

- âœ… è¾¹ç¼˜åœºæ™¯ä¸éœ€è¦å®éªŒæ€§åŠŸèƒ½
- âœ… å‡å°‘ API å¤æ‚åº¦
- âœ… å‡å°äºŒè¿›åˆ¶ä½“ç§¯

**å†³ç­–æ€è·¯**ï¼š

```yaml
Alpha API è£å‰ª:
  åŸå› : è¾¹ç¼˜åœºæ™¯ä¸éœ€è¦å®éªŒæ€§åŠŸèƒ½
  å½±å“: å‡å°‘ API å¤æ‚åº¦ï¼Œå‡å°äºŒè¿›åˆ¶ä½“ç§¯
  æƒè¡¡: æ— æ³•ä½¿ç”¨ Alpha API åŠŸèƒ½
```

**ä¸ºä»€ä¹ˆè£å‰ª cloud-controller-managerï¼Ÿ**

**å†³ç­–ä¾æ®**ï¼š

- âœ… è¾¹ç¼˜åœºæ™¯æ— äº‘ç¯å¢ƒ
- âœ… äº‘æ§åˆ¶å™¨åŠŸèƒ½ä¸éœ€è¦
- âœ… å‡å°äºŒè¿›åˆ¶ä½“ç§¯

**å†³ç­–æ€è·¯**ï¼š

```yaml
cloud-controller-manager è£å‰ª:
  åŸå› : è¾¹ç¼˜åœºæ™¯æ— äº‘ç¯å¢ƒ
  å½±å“: å‡å°äºŒè¿›åˆ¶ä½“ç§¯ï¼Œå‡å°‘èµ„æºå ç”¨
  æƒè¡¡: æ— æ³•ä½¿ç”¨äº‘æ§åˆ¶å™¨åŠŸèƒ½
```

**ä¸ºä»€ä¹ˆè£å‰ª in-tree å­˜å‚¨é©±åŠ¨ï¼Ÿ**

**å†³ç­–ä¾æ®**ï¼š

- âœ… ç»Ÿä¸€ä½¿ç”¨ CSI
- âœ… ç®€åŒ–ç»´æŠ¤
- âœ… å‡å°äºŒè¿›åˆ¶ä½“ç§¯

**å†³ç­–æ€è·¯**ï¼š

```yaml
in-tree å­˜å‚¨é©±åŠ¨è£å‰ª:
  åŸå› : ç»Ÿä¸€ä½¿ç”¨ CSI
  å½±å“: ç®€åŒ–ç»´æŠ¤ï¼Œå‡å°äºŒè¿›åˆ¶ä½“ç§¯
  æƒè¡¡: å¿…é¡»ä½¿ç”¨ CSI å­˜å‚¨é©±åŠ¨
```

## 02.5 å­˜å‚¨åç«¯é€‰æ‹©

### 02.5.1 ä¸‰ç§å­˜å‚¨æ¨¡å¼

```mermaid
graph TB
    A[K3s å­˜å‚¨åç«¯] --> B[åµŒå…¥å¼ etcd]
    A --> C[å¤–éƒ¨ etcd]
    A --> D[å¤–éƒ¨æ•°æ®åº“<br/>MySQL/PostgreSQL]

    B --> E[å•èŠ‚ç‚¹/å°è§„æ¨¡]
    C --> F[ä¸­ç­‰è§„æ¨¡<br/>3-5 èŠ‚ç‚¹]
    D --> G[å¤§è§„æ¨¡<br/>å·²æœ‰æ•°æ®åº“]

    style B fill:#e1f5ff
    style D fill:#fff4e1
```

**å­˜å‚¨æ¨¡å¼åˆ†æ**ï¼š

1. **åµŒå…¥å¼ etcd**ï¼šå•èŠ‚ç‚¹æˆ–å°è§„æ¨¡é›†ç¾¤ï¼ˆ< 5 èŠ‚ç‚¹ï¼‰
2. **å¤–éƒ¨ etcd**ï¼šä¸­ç­‰è§„æ¨¡é›†ç¾¤ï¼ˆ3-10 èŠ‚ç‚¹ï¼‰
3. **å¤–éƒ¨æ•°æ®åº“**ï¼šå¤§è§„æ¨¡é›†ç¾¤æˆ–å·²æœ‰æ•°æ®åº“

### 02.5.2 sqlite vs etcd

| ç»´åº¦           | sqlite            | etcd              |
| -------------- | ----------------- | ----------------- |
| **å®‰è£…å¤æ‚åº¦** | âœ… é›¶é…ç½®         | âŒ éœ€ç‹¬ç«‹é›†ç¾¤     |
| **èµ„æºå ç”¨**   | âœ… æä½ï¼ˆå•æ–‡ä»¶ï¼‰ | âŒ éœ€è¦ 3 èŠ‚ç‚¹    |
| **ç½‘ç»œä¾èµ–**   | âœ… æ— ç½‘ç»œå»¶è¿Ÿ     | âŒ ç½‘ç»œå¾€è¿” 2ms   |
| **æ•°æ®ä¸€è‡´æ€§** | âœ… æœ€ç»ˆä¸€è‡´       | âœ… å¼ºä¸€è‡´ï¼ˆRaftï¼‰ |
| **é«˜å¯ç”¨**     | âŒ å•ç‚¹           | âœ… åˆ†å¸ƒå¼         |
| **é€‚ç”¨åœºæ™¯**   | è¾¹ç¼˜ã€å•èŠ‚ç‚¹      | ç”Ÿäº§é›†ç¾¤          |

**å¯¹æ¯”åˆ†æ**ï¼š

- **å®‰è£…å¤æ‚åº¦**ï¼šsqlite é›¶é…ç½®ï¼Œetcd éœ€è¦ç‹¬ç«‹é›†ç¾¤
- **èµ„æºå ç”¨**ï¼šsqlite æä½ï¼ˆå•æ–‡ä»¶ï¼‰ï¼Œetcd éœ€è¦ 3 èŠ‚ç‚¹
- **ç½‘ç»œä¾èµ–**ï¼šsqlite æœ¬åœ°è°ƒç”¨ï¼Œetcd ç½‘ç»œå¾€è¿” 2ms
- **æ•°æ®ä¸€è‡´æ€§**ï¼šsqlite æœ€ç»ˆä¸€è‡´ï¼Œetcd å¼ºä¸€è‡´ï¼ˆRaftï¼‰
- **é«˜å¯ç”¨**ï¼šsqlite å•ç‚¹ï¼Œetcd åˆ†å¸ƒå¼

### 02.5.3 è¾¹ç¼˜åœºæ™¯å­˜å‚¨å†³ç­–

**é—®é¢˜åŸŸåˆ†æ**ï¼š

- è¾¹ç¼˜èŠ‚ç‚¹å¸¸æ‰ç”µ
- ç½‘ç»œä¸ç¨³å®š
- èµ„æºå—é™

**ä¸ºä»€ä¹ˆè¾¹ç¼˜åœºæ™¯é€‰ sqliteï¼Ÿ**

**æŠ€æœ¯è®ºè¯**ï¼š

1. **è¾¹ç¼˜èŠ‚ç‚¹å¸¸æ‰ç”µ**ï¼šsqlite å•æ–‡ä»¶å¤åˆ¶/å¤‡ä»½æˆæœ¬æœ€ä½
2. **ç½‘ç»œåˆ†åŒºå®¹å¿**ï¼šæœ¬åœ°ç»§ç»­è¿è¡Œï¼Œæ¢å¤ååŒæ­¥ï¼Œæ¥å—"æœ€ç»ˆä¸€è‡´"
3. **Pod å¯†åº¦ä½**ï¼šè¾¹ç¼˜èŠ‚ç‚¹å¹³å‡ 10 Pod/èŠ‚ç‚¹ï¼Œæ€»å¯¹è±¡æ•° â‰ˆ1 ä¸‡ï¼Œsqlite å•çº¿ç¨‹è¶³ä»¥
4. **èµ„æºå—é™**ï¼šARM è®¾å¤‡å†…å­˜æœ‰é™ï¼Œsqlite å†…å­˜å ç”¨æä½

```mermaid
graph LR
    A[è¾¹ç¼˜åœºæ™¯] --> B[æ‰ç”µé¢‘ç¹]
    A --> C[ç½‘ç»œä¸ç¨³å®š]
    A --> D[èµ„æºå—é™]

    B --> E[sqlite<br/>å•æ–‡ä»¶å¤‡ä»½]
    C --> F[æœ¬åœ°è¿è¡Œ<br/>æœ€ç»ˆä¸€è‡´]
    D --> G[æä½å†…å­˜å ç”¨]

    style E fill:#e6ffe6
    style F fill:#e6ffe6
    style G fill:#e6ffe6
```

**å†³ç­–ä¾æ®**ï¼š

- âœ… **è¾¹ç¼˜èŠ‚ç‚¹å¸¸æ‰ç”µ**ï¼šsqlite å•æ–‡ä»¶å¤åˆ¶/å¤‡ä»½æˆæœ¬æœ€ä½
- âœ… **ç½‘ç»œåˆ†åŒºå®¹å¿**ï¼šæœ¬åœ°ç»§ç»­è¿è¡Œï¼Œæ¢å¤ååŒæ­¥ï¼Œæ¥å—"æœ€ç»ˆä¸€è‡´"
- âœ… **èµ„æºå—é™**ï¼šsqlite å†…å­˜å ç”¨æä½ï¼Œé€‚åˆ ARM è®¾å¤‡

**å†³ç­–æ€è·¯**ï¼š

```yaml
è¾¹ç¼˜åœºæ™¯å­˜å‚¨é€‰æ‹©:
  åœºæ™¯: è¾¹ç¼˜èŠ‚ç‚¹ï¼ˆARM è®¾å¤‡ï¼‰
  å­˜å‚¨: sqliteï¼ˆé»˜è®¤ï¼‰
  åŸå› :
    - å•æ–‡ä»¶å¤‡ä»½ç®€å•
    - æœ¬åœ°è¿è¡Œï¼Œæ— éœ€ç½‘ç»œ
    - èµ„æºå ç”¨æä½
  æƒè¡¡:
    - ä¸æ”¯æŒå¤šèŠ‚ç‚¹å†™å…¥
    - æœ€ç»ˆä¸€è‡´æ€§ï¼Œéå¼ºä¸€è‡´
  æ›¿ä»£æ–¹æ¡ˆ:
    - å¤–éƒ¨ etcdï¼ˆå¦‚æœæœ‰ç¨³å®šç½‘ç»œï¼‰
    - å¤–éƒ¨æ•°æ®åº“ï¼ˆå¦‚æœæœ‰ç°æˆæ•°æ®åº“ï¼‰
```

### 02.5.4 å­˜å‚¨åœºæ™¯ä¸å†³ç­–

**åœºæ™¯ 1ï¼šå•èŠ‚ç‚¹è¾¹ç¼˜**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… å•èŠ‚ç‚¹éƒ¨ç½²
- âœ… èµ„æºå—é™
- âœ… é«˜å¯ç”¨ä¸é‡è¦

**å†³ç­–æ€è·¯**ï¼š

```yaml
å•èŠ‚ç‚¹è¾¹ç¼˜å­˜å‚¨:
  é€‰æ‹©: sqliteï¼ˆé»˜è®¤ï¼‰
  åŸå› : ç®€å•ã€è½»é‡ã€é›¶é…ç½®
  æƒè¡¡: æ— é«˜å¯ç”¨ï¼Œå•ç‚¹æ•…éšœ
```

**åœºæ™¯ 2ï¼šå°è§„æ¨¡è¾¹ç¼˜é›†ç¾¤ï¼ˆ3-5 èŠ‚ç‚¹ï¼‰**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… éœ€è¦é«˜å¯ç”¨
- âœ… èµ„æºç›¸å¯¹å……è¶³
- âœ… ç½‘ç»œç¨³å®š

**å†³ç­–æ€è·¯**ï¼š

```yaml
å°è§„æ¨¡è¾¹ç¼˜é›†ç¾¤å­˜å‚¨:
  é€‰æ‹©: åµŒå…¥å¼ etcdï¼ˆ--cluster-initï¼‰
  åŸå› : é«˜å¯ç”¨ã€ç®€å•ã€å†…ç½®
  æƒè¡¡: èµ„æºå ç”¨å¢åŠ 
```

**åœºæ™¯ 3ï¼šå¤§è§„æ¨¡è¾¹ç¼˜é›†ç¾¤ï¼ˆ> 10 èŠ‚ç‚¹ï¼‰**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… éœ€è¦é«˜å¯ç”¨
- âœ… æœ‰ç°æˆæ•°æ®åº“
- âœ… èµ„æºå……è¶³

**å†³ç­–æ€è·¯**ï¼š

```yaml
å¤§è§„æ¨¡è¾¹ç¼˜é›†ç¾¤å­˜å‚¨:
  é€‰æ‹©: å¤–éƒ¨ etcd æˆ–å¤–éƒ¨æ•°æ®åº“
  åŸå› : é«˜å¯ç”¨ã€å¯æ‰©å±•
  æƒè¡¡: ä¾èµ–å¤–éƒ¨ç»„ä»¶
```

**æŠ€æœ¯åœºæ™¯å¯¹æ¯”**ï¼š

| åœºæ™¯               | å­˜å‚¨é€‰æ‹©     | å†³ç­–ä¾æ®       | æƒè¡¡         |
| ------------------ | ------------ | -------------- | ------------ |
| **å•èŠ‚ç‚¹è¾¹ç¼˜**     | sqlite       | ç®€å•ã€è½»é‡     | æ— é«˜å¯ç”¨     |
| **å°è§„æ¨¡è¾¹ç¼˜é›†ç¾¤** | åµŒå…¥å¼ etcd  | é«˜å¯ç”¨ã€ç®€å•   | èµ„æºå ç”¨å¢åŠ  |
| **å¤§è§„æ¨¡è¾¹ç¼˜é›†ç¾¤** | å¤–éƒ¨ etcd/DB | é«˜å¯ç”¨ã€å¯æ‰©å±• | ä¾èµ–å¤–éƒ¨ç»„ä»¶ |

## 02.6 å†…ç½®ç»„ä»¶

### 02.6.1 containerd

**å®šä½**ï¼šå®¹å™¨è¿è¡Œæ—¶æ¥å£

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š

- **ç‰ˆæœ¬**ï¼šè·Ÿéšä¸Šæ¸¸ containerd
- **é…ç½®**ï¼šè‡ªåŠ¨é…ç½®ï¼Œæ— éœ€æ‰‹åŠ¨ç®¡ç†
- **åŠŸèƒ½**ï¼šå®¹å™¨ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€é•œåƒç®¡ç†

**containerd è®ºè¯**ï¼š

- **å†…ç½®ä¼˜åŠ¿**ï¼šæ— éœ€æ‰‹åŠ¨å®‰è£…ï¼Œè‡ªåŠ¨é…ç½®
- **ç‰ˆæœ¬ç»Ÿä¸€**ï¼šè·Ÿéšä¸Šæ¸¸ç‰ˆæœ¬ï¼Œä¿è¯å…¼å®¹æ€§
- **èµ„æºä¼˜åŒ–**ï¼šå…±äº«è¿›ç¨‹ï¼Œå‡å°‘èµ„æºå ç”¨

### 02.6.2 flannel

**å®šä½**ï¼šCNI ç½‘ç»œæ’ä»¶

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š

- **æ¨¡å¼**ï¼šVXLANï¼ˆé»˜è®¤ï¼‰æˆ– host-gw
- **é…ç½®**ï¼šè‡ªåŠ¨é…ç½® Pod ç½‘ç»œ
- **åŠŸèƒ½**ï¼šPod ç½‘ç»œç®¡ç†ã€æœåŠ¡å‘ç°

**flannel è®ºè¯**ï¼š

- **å†…ç½®ä¼˜åŠ¿**ï¼šæ— éœ€æ‰‹åŠ¨å®‰è£… CNI æ’ä»¶
- **è‡ªåŠ¨é…ç½®**ï¼šPod ç½‘ç»œè‡ªåŠ¨é…ç½®
- **ç®€å•æ˜“ç”¨**ï¼šVXLAN æ¨¡å¼ç®€å•æ˜“ç”¨

### 02.6.3 traefik

**å®šä½**ï¼šIngress æ§åˆ¶å™¨å’Œè´Ÿè½½å‡è¡¡å™¨

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š

- **åŠŸèƒ½**ï¼šè‡ªåŠ¨å‘ç° Serviceï¼Œæä¾› HTTP/HTTPS è·¯ç”±
- **é…ç½®**ï¼šæ”¯æŒæ³¨è§£é…ç½®
- **ä¼˜åŠ¿**ï¼šé›¶é…ç½®ï¼Œè‡ªåŠ¨å‘ç°

**traefik è®ºè¯**ï¼š

- **å†…ç½®ä¼˜åŠ¿**ï¼šæ— éœ€æ‰‹åŠ¨å®‰è£… Ingress æ§åˆ¶å™¨
- **è‡ªåŠ¨å‘ç°**ï¼šè‡ªåŠ¨å‘ç° Serviceï¼Œæä¾›è·¯ç”±
- **é…ç½®ç®€å•**ï¼šé€šè¿‡æ³¨è§£é…ç½®ï¼Œç®€å•æ˜“ç”¨

### 02.6.4 metrics-server

**å®šä½**ï¼šèµ„æºæŒ‡æ ‡æ”¶é›†

**æŠ€æœ¯ç‰¹ç‚¹**ï¼š

- **åŠŸèƒ½**ï¼šæä¾› CPU/å†…å­˜æŒ‡æ ‡ï¼Œæ”¯æŒ HPA
- **é…ç½®**ï¼šè‡ªåŠ¨éƒ¨ç½²
- **ä¼˜åŠ¿**ï¼šé›¶é…ç½®ï¼Œè‡ªåŠ¨éƒ¨ç½²

**metrics-server è®ºè¯**ï¼š

- **å†…ç½®ä¼˜åŠ¿**ï¼šæ— éœ€æ‰‹åŠ¨å®‰è£… metrics-server
- **è‡ªåŠ¨éƒ¨ç½²**ï¼šè‡ªåŠ¨éƒ¨ç½²ï¼Œé›¶é…ç½®
- **åŠŸèƒ½å®Œæ•´**ï¼šæ”¯æŒ HPAï¼ŒåŠŸèƒ½å®Œæ•´

## 02.7 é«˜å¯ç”¨æ¶æ„

### 02.7.1 ä¸‰ç§ HA è·¯å¾„

```mermaid
graph TD
    A[K3s HA è·¯å¾„] --> B[åµŒå…¥å¼ etcd]
    A --> C[å¤–éƒ¨ etcd]
    A --> D[å¤–éƒ¨æ•°æ®åº“]

    B --> E[k3s server<br/>--cluster-init]
    C --> F[k3s server<br/>--server]
    D --> G[k3s server<br/>--datastore-endpoint]

    style B fill:#e1f5ff
    style D fill:#fff4e1
```

**HA è·¯å¾„åˆ†æ**ï¼š

1. **åµŒå…¥å¼ etcd**ï¼šé€‚åˆå°è§„æ¨¡é›†ç¾¤ï¼ˆ3-5 èŠ‚ç‚¹ï¼‰ï¼Œç®€å•æ˜“ç”¨
2. **å¤–éƒ¨ etcd**ï¼šé€‚åˆä¸­ç­‰è§„æ¨¡é›†ç¾¤ï¼Œé«˜å¯ç”¨
3. **å¤–éƒ¨æ•°æ®åº“**ï¼šé€‚åˆå¤§è§„æ¨¡é›†ç¾¤æˆ–å·²æœ‰æ•°æ®åº“

### 02.7.2 HA é…ç½®ç¤ºä¾‹

```bash
# è·¯å¾„ 1ï¼šåµŒå…¥å¼ etcdï¼ˆ3 èŠ‚ç‚¹ï¼‰
# èŠ‚ç‚¹ 1
k3s server --cluster-init

# èŠ‚ç‚¹ 2
k3s server --server https://node1:6443 --token <token>

# èŠ‚ç‚¹ 3
k3s server --server https://node1:6443 --token <token>

# è·¯å¾„ 2ï¼šå¤–éƒ¨ etcd
k3s server \
  --datastore-endpoint="etcd" \
  --datastore-cafile=/path/to/ca.pem \
  --datastore-certfile=/path/to/etcd.pem \
  --datastore-keyfile=/path/to/etcd-key.pem

# è·¯å¾„ 3ï¼šå¤–éƒ¨æ•°æ®åº“
k3s server \
  --datastore-endpoint="mysql://user:pass@tcp(host:3306)/dbname"
```

### 02.7.3 HA åœºæ™¯ä¸å†³ç­–

**åœºæ™¯ 1ï¼šå°è§„æ¨¡é›†ç¾¤ï¼ˆ3-5 èŠ‚ç‚¹ï¼‰**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… éœ€è¦é«˜å¯ç”¨
- âœ… èµ„æºç›¸å¯¹å……è¶³
- âœ… ç½‘ç»œç¨³å®š

**å†³ç­–æ€è·¯**ï¼š

```yaml
å°è§„æ¨¡é›†ç¾¤ HA:
  é€‰æ‹©: åµŒå…¥å¼ etcdï¼ˆ--cluster-initï¼‰
  åŸå› : é«˜å¯ç”¨ã€ç®€å•ã€å†…ç½®
  é…ç½®: 3 èŠ‚ç‚¹ï¼Œè‡ªåŠ¨é€‰ä¸¾
  æƒè¡¡: èµ„æºå ç”¨å¢åŠ 
```

**åœºæ™¯ 2ï¼šä¸­ç­‰è§„æ¨¡é›†ç¾¤ï¼ˆ5-10 èŠ‚ç‚¹ï¼‰**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… éœ€è¦é«˜å¯ç”¨
- âœ… å¯ä»¥ç‹¬ç«‹éƒ¨ç½² etcd
- âœ… èµ„æºå……è¶³

**å†³ç­–æ€è·¯**ï¼š

```yaml
ä¸­ç­‰è§„æ¨¡é›†ç¾¤ HA:
  é€‰æ‹©: å¤–éƒ¨ etcd
  åŸå› : é«˜å¯ç”¨ã€å¯æ‰©å±•ã€ç‹¬ç«‹ç®¡ç†
  é…ç½®: 3 èŠ‚ç‚¹ etcd é›†ç¾¤
  æƒè¡¡: éœ€è¦ç‹¬ç«‹éƒ¨ç½² etcd
```

**åœºæ™¯ 3ï¼šå¤§è§„æ¨¡é›†ç¾¤ï¼ˆ> 10 èŠ‚ç‚¹ï¼‰æˆ–å·²æœ‰æ•°æ®åº“**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… éœ€è¦é«˜å¯ç”¨
- âœ… æœ‰ç°æˆæ•°æ®åº“
- âœ… èµ„æºå……è¶³

**å†³ç­–æ€è·¯**ï¼š

```yaml
å¤§è§„æ¨¡é›†ç¾¤ HA:
  é€‰æ‹©: å¤–éƒ¨æ•°æ®åº“ï¼ˆMySQL/PostgreSQLï¼‰
  åŸå› : é«˜å¯ç”¨ã€å¯æ‰©å±•ã€åˆ©ç”¨ç°æœ‰æ•°æ®åº“
  é…ç½®: ç°æœ‰æ•°æ®åº“é›†ç¾¤
  æƒè¡¡: ä¾èµ–å¤–éƒ¨æ•°æ®åº“
```

## 02.8 æ€§èƒ½ä¼˜åŒ–

### 02.8.1 K3s æ€§èƒ½è®ºè¯

**ä¸ºä»€ä¹ˆ K3s èƒ½æ”¯æŒ 1000 èŠ‚ç‚¹ï¼Ÿ**

**æŠ€æœ¯è®ºè¯**ï¼š

1. **æ§åˆ¶å™¨ç²¾ç®€**ï¼šå»æ‰å¤§é‡ controller ä¸ alpha APIï¼Œlist-watch å‹åŠ›ä¸‹é™ 40%
2. **æœ¬åœ°å­˜å‚¨**ï¼šsqlite æœ¬åœ°è°ƒç”¨å»¶è¿Ÿ 0.1msï¼Œæ¯” etcd ç½‘ç»œå¾€è¿” 2ms ä½ä¸€ä¸ªé‡çº§
3. **Pod å¯†åº¦ä½**ï¼šè¾¹ç¼˜èŠ‚ç‚¹å¹³å‡ 10 Pod/èŠ‚ç‚¹ï¼Œæ€»å¯¹è±¡æ•° â‰ˆ1 ä¸‡ï¼Œsqlite å•çº¿ç¨‹è¶³ä»¥
4. **ç½‘ç»œæ‹“æ‰‘**ï¼šæ˜Ÿå‹æ‹“æ‰‘ï¼Œè·¨èŠ‚ç‚¹ watch å°‘
5. **å†…å­˜ä¼˜åŒ–**ï¼šæ§åˆ¶å™¨ç²¾ç®€åï¼Œå†…å­˜å¸¸é©» < 250MBï¼Œæ ‘è“æ´¾ 4Bï¼ˆ4GBï¼‰å¯æ‰¿å—

```mermaid
graph TD
    A[K3s æ€§èƒ½ä¼˜åŒ–] --> B[è£å‰ªæ§åˆ¶å™¨]
    A --> C[æœ¬åœ° sqlite]
    A --> D[ä½ Pod å¯†åº¦]
    A --> E[æ˜Ÿå‹ç½‘ç»œ]

    B --> F[å‡å°‘ 40% å‹åŠ›]
    C --> G[å»¶è¿Ÿ 0.1ms]
    D --> H[å¯¹è±¡æ•° â‰ˆ1 ä¸‡]
    E --> I[å‡å°‘è·¨èŠ‚ç‚¹ watch]

    style F fill:#e6ffe6
    style G fill:#e6ffe6
```

**æ€§èƒ½æ¨¡å‹è®ºè¯**ï¼š

- **æ§åˆ¶å™¨ç²¾ç®€**ï¼šlist-watch å‹åŠ›ä¸‹é™ 40%
- **æœ¬åœ°å­˜å‚¨**ï¼šsqlite å»¶è¿Ÿ 0.1msï¼Œæ¯” etcd 2ms ä½ 20 å€
- **Pod å¯†åº¦**ï¼šè¾¹ç¼˜èŠ‚ç‚¹å¹³å‡ 10 Pod/èŠ‚ç‚¹ï¼Œæ€»å¯¹è±¡æ•° â‰ˆ1 ä¸‡
- **ç½‘ç»œæ‹“æ‰‘**ï¼šæ˜Ÿå‹æ‹“æ‰‘ï¼Œè·¨èŠ‚ç‚¹ watch å°‘
- **å†…å­˜ä¼˜åŒ–**ï¼šå†…å­˜å¸¸é©» < 250MBï¼Œæ ‘è“æ´¾ 4B å¯æ‰¿å—

### 02.8.2 æ€§èƒ½åŸºçº¿

| æŒ‡æ ‡             | æ•°å€¼      | è¯´æ˜             |
| ---------------- | --------- | ---------------- |
| **æ§åˆ¶å¹³é¢å†…å­˜** | < 250 MB  | æ ‘è“æ´¾ 4B å¯æ‰¿å— |
| **å¯åŠ¨æ—¶é—´**     | < 10s     | å•èŠ‚ç‚¹           |
| **æ”¯æŒèŠ‚ç‚¹æ•°**   | 1000 èŠ‚ç‚¹ | è¾¹ç¼˜åœºæ™¯         |
| **sqlite å»¶è¿Ÿ**  | 0.1ms     | æœ¬åœ°è°ƒç”¨         |

**æ€§èƒ½åŸºçº¿è®ºè¯**ï¼š

- **æ§åˆ¶å¹³é¢å†…å­˜**ï¼š< 250MBï¼Œæ ‘è“æ´¾ 4Bï¼ˆ4GBï¼‰å¯æ‰¿å— [^k3s-memory]
- **å¯åŠ¨æ—¶é—´**ï¼š< 10sï¼Œå•äºŒè¿›åˆ¶å¯åŠ¨å¿«
- **æ”¯æŒèŠ‚ç‚¹æ•°**ï¼š1000 èŠ‚ç‚¹ï¼Œè¾¹ç¼˜åœºæ™¯è¶³å¤Ÿ
- **sqlite å»¶è¿Ÿ**ï¼š0.1msï¼Œæœ¬åœ°è°ƒç”¨å»¶è¿Ÿä½

### 02.8.3 æ€§èƒ½æ¨¡å‹å½¢å¼åŒ–

**K3s æ€§èƒ½æ¨¡å‹**ï¼š
$$P_{K3}(N, P) = f(\text{controller\_count}, \text{storage\_latency}, \text{pod\_density}, \text{network\_topology})$$

å…¶ä¸­ï¼š

- $N$ = èŠ‚ç‚¹æ•°
- $P$ = Pod æ•°
- $\text{controller\_count}$ = æ§åˆ¶å™¨æ•°é‡ï¼ˆå‡å°‘ 40%ï¼‰
- $\text{storage\_latency}$ = å­˜å‚¨å»¶è¿Ÿï¼ˆsqlite 0.1msï¼‰
- $\text{pod\_density}$ = Pod å¯†åº¦ï¼ˆè¾¹ç¼˜åœºæ™¯ 10 Pod/èŠ‚ç‚¹ï¼‰
- $\text{network\_topology}$ = ç½‘ç»œæ‹“æ‰‘ï¼ˆæ˜Ÿå‹ï¼‰

**ä¼˜åŒ–ç›®æ ‡**ï¼š
$$\max_{K3} P_{K3}(N, P) = \max_{K3} f(\text{controller\_count} \downarrow, \text{storage\_latency} \downarrow, \text{pod\_density}, \text{network\_topology})$$

## 02.9 å®‰è£…ä¸é…ç½®

### 02.9.1 å•èŠ‚ç‚¹å®‰è£…

```bash
# å¿«é€Ÿå®‰è£…
curl -sfL https://get.k3s.io | sh -

# å¸¦ WasmEdge æ”¯æŒï¼ˆ2025ï¼‰
curl -sfL https://get.k3s.io | \
  INSTALL_K3S_VERSION=v1.30.4+k3s1 \
  sh -s - --wasm --write-kubeconfig-mode 644
```

**å®‰è£…è®ºè¯**ï¼š

- **å®‰è£…ç®€å•**ï¼šå•å‘½ä»¤å®‰è£…ï¼Œæ— éœ€å¤šæ­¥éª¤
- **WasmEdge æ”¯æŒ**ï¼šé€šè¿‡ `--wasm` å‚æ•°å¯ç”¨ WasmEdge æ”¯æŒ

### 02.9.2 å¤šèŠ‚ç‚¹å®‰è£…

```bash
# Server èŠ‚ç‚¹
curl -sfL https://get.k3s.io | K3S_TOKEN=xxx sh -s - server

# Agent èŠ‚ç‚¹
curl -sfL https://get.k3s.io | K3S_TOKEN=xxx \
  K3S_URL=https://server-ip:6443 sh -s - agent
```

**å¤šèŠ‚ç‚¹å®‰è£…è®ºè¯**ï¼š

- **Server èŠ‚ç‚¹**ï¼šè¿è¡Œæ§åˆ¶å¹³é¢
- **Agent èŠ‚ç‚¹**ï¼šè¿è¡Œå·¥ä½œè´Ÿè½½
- **Token è®¤è¯**ï¼šé€šè¿‡ token è®¤è¯èŠ‚ç‚¹åŠ å…¥

### 02.9.3 é…ç½®æ–‡ä»¶ä½ç½®

| ç±»å‹           | è·¯å¾„                                    | è¯´æ˜            |
| -------------- | --------------------------------------- | --------------- |
| **kubeconfig** | `/etc/rancher/k3s/k3s.yaml`             | é›†ç¾¤é…ç½®æ–‡ä»¶    |
| **æ•°æ®ç›®å½•**   | `/var/lib/rancher/k3s`                  | é›†ç¾¤æ•°æ®        |
| **manifest**   | `/var/lib/rancher/k3s/server/manifests` | Static pod æ¸…å• |

## 02.10 è¾¹ç¼˜åœºæ™¯å®è·µ

### 02.10.1 ARM è®¾å¤‡éƒ¨ç½²

**åœºæ™¯æè¿°**ï¼šARM è®¾å¤‡ï¼ˆå¦‚æ ‘è“æ´¾ï¼‰èµ„æºå—é™

**æ¶æ„æŒ‘æˆ˜**ï¼š

1. **èµ„æºå—é™**ï¼šå†…å­˜å’Œ CPU æœ‰é™
2. **å­˜å‚¨å—é™**ï¼šå­˜å‚¨ç©ºé—´æœ‰é™
3. **ç½‘ç»œä¸ç¨³å®š**ï¼šç½‘ç»œç»å¸¸æ‰çº¿

**æ¶æ„å†³ç­–**ï¼š

```yaml
ARM è®¾å¤‡éƒ¨ç½²:
  å®‰è£…: curl | shï¼ˆå•å‘½ä»¤ï¼‰
  å­˜å‚¨: sqliteï¼ˆé»˜è®¤ï¼Œå•æ–‡ä»¶ï¼‰
  ç½‘ç»œ: flannelï¼ˆå†…ç½®ï¼Œè‡ªåŠ¨é…ç½®ï¼‰
  èµ„æºé™åˆ¶: < 250MB å†…å­˜
  ä¼˜åŠ¿: ç®€å•ã€è½»é‡ã€é›¶é…ç½®
```

**å†³ç­–ä¾æ®**ï¼š

- âœ… èµ„æºå—é™ï¼šK3s å†…å­˜å ç”¨ < 250MBï¼Œé€‚åˆ ARM è®¾å¤‡
- âœ… å­˜å‚¨å—é™ï¼šsqlite å•æ–‡ä»¶ï¼Œå­˜å‚¨å ç”¨å°
- âœ… ç½‘ç»œä¸ç¨³å®šï¼šsqlite æœ¬åœ°å­˜å‚¨ï¼Œä¸ä¾èµ–ç½‘ç»œ

### 02.10.2 ç¦»çº¿éƒ¨ç½²

**åœºæ™¯æè¿°**ï¼šè¾¹ç¼˜èŠ‚ç‚¹æ— æ³•è®¿é—®å¤–ç½‘

**æ¶æ„æŒ‘æˆ˜**ï¼š

1. **æ— æ³•ä¸‹è½½**ï¼šæ— æ³•ä»äº’è”ç½‘ä¸‹è½½é•œåƒå’ŒäºŒè¿›åˆ¶
2. **éœ€è¦ç¦»çº¿å®‰è£…**ï¼šéœ€è¦åœ¨æœ‰ç½‘ç»œçš„æœºå™¨ä¸Šå‡†å¤‡ç¦»çº¿åŒ…
3. **ä¼ è¾“å›°éš¾**ï¼šéœ€è¦ä¼ è¾“ç¦»çº¿åŒ…åˆ°ç›®æ ‡æœºå™¨

**æ¶æ„å†³ç­–**ï¼š

```yaml
ç¦»çº¿éƒ¨ç½²:
  æ­¥éª¤:
    1. æœ‰ç½‘ç»œæœºå™¨ä¸‹è½½ç¦»çº¿åŒ…ï¼ˆk3s-airgap-images.tar + k3s äºŒè¿›åˆ¶ï¼‰ 2.
    ä¼ è¾“åˆ°ç›®æ ‡æœºå™¨ï¼ˆscp/usbï¼‰ 3. ç¦»çº¿å®‰è£…ï¼ˆINSTALL_K3S_SKIP_DOWNLOAD=trueï¼‰
  ä¼˜åŠ¿: æ”¯æŒç¦»çº¿ç¯å¢ƒéƒ¨ç½²
  æƒè¡¡: éœ€è¦å‡†å¤‡ç¦»çº¿åŒ…
```

**å†³ç­–ä¾æ®**ï¼š

- âœ… ç¦»çº¿ç¯å¢ƒï¼šæ”¯æŒç¦»çº¿éƒ¨ç½²ï¼Œæ— éœ€äº’è”ç½‘
- âœ… ç¦»çº¿åŒ…å‡†å¤‡ï¼šåœ¨æœ‰ç½‘ç»œæœºå™¨ä¸Šå‡†å¤‡ç¦»çº¿åŒ…
- âœ… ä¼ è¾“æ–¹å¼ï¼šé€šè¿‡ scp/usb ä¼ è¾“ç¦»çº¿åŒ…

### 02.10.3 èµ„æºé™åˆ¶é…ç½®

**åœºæ™¯æè¿°**ï¼šè¾¹ç¼˜èŠ‚ç‚¹èµ„æºæœ‰é™ï¼Œéœ€è¦é™åˆ¶èµ„æºä½¿ç”¨

**æ¶æ„æŒ‘æˆ˜**ï¼š

1. **èµ„æºæœ‰é™**ï¼šå†…å­˜å’Œ CPU æœ‰é™
2. **éœ€è¦é™åˆ¶**ï¼šéœ€è¦é™åˆ¶ Pod èµ„æºä½¿ç”¨
3. **ä¼˜å…ˆçº§ç®¡ç†**ï¼šéœ€è¦ä¼˜å…ˆçº§ç®¡ç†

**æ¶æ„å†³ç­–**ï¼š

```yaml
èµ„æºé™åˆ¶é…ç½®:
  Node Taints: é™åˆ¶èŠ‚ç‚¹ä½¿ç”¨
  ResourceQuota: é™åˆ¶å‘½åç©ºé—´èµ„æº
  LimitRange: é™åˆ¶ Pod èµ„æº
  ä¼˜åŠ¿: ç²¾ç¡®æ§åˆ¶èµ„æºä½¿ç”¨
  æƒè¡¡: éœ€è¦é…ç½® ResourceQuota å’Œ LimitRange
```

## 02.11 æŠ€æœ¯åœºæ™¯åˆ†æ

### 02.11.1 è¾¹ç¼˜è®¡ç®—åœºæ™¯

**åœºæ™¯æè¿°**ï¼šè¾¹ç¼˜è®¡ç®—èŠ‚ç‚¹ï¼Œèµ„æºå—é™ï¼Œç½‘ç»œä¸ç¨³å®š

**æ¶æ„æŒ‘æˆ˜**ï¼š

1. **èµ„æºå—é™**ï¼šå†…å­˜å’Œ CPU æœ‰é™
2. **ç½‘ç»œä¸ç¨³å®š**ï¼šç»å¸¸æ‰çº¿
3. **å­˜å‚¨å—é™**ï¼šå­˜å‚¨ç©ºé—´æœ‰é™

**æ¶æ„å†³ç­–**ï¼š

```yaml
è¾¹ç¼˜è®¡ç®—åœºæ™¯:
  é€‰æ‹©: K3s
  å­˜å‚¨: sqliteï¼ˆé»˜è®¤ï¼‰
  ç½‘ç»œ: flannelï¼ˆå†…ç½®ï¼‰
  èµ„æº: < 250MB å†…å­˜
  ä¼˜åŠ¿: è½»é‡ã€ç®€å•ã€ç¦»çº¿èƒ½åŠ›
  æƒè¡¡: è§„æ¨¡å—é™ï¼ˆ1000 èŠ‚ç‚¹ï¼‰
```

**å†³ç­–ä¾æ®**ï¼š

- âœ… èµ„æºå—é™ï¼šK3s å†…å­˜å ç”¨ < 250MBï¼Œé€‚åˆè¾¹ç¼˜èŠ‚ç‚¹
- âœ… ç½‘ç»œä¸ç¨³å®šï¼šsqlite æœ¬åœ°å­˜å‚¨ï¼Œä¸ä¾èµ–ç½‘ç»œ
- âœ… å­˜å‚¨å—é™ï¼šsqlite å•æ–‡ä»¶ï¼Œå­˜å‚¨å ç”¨å°

### 02.11.2 IoT åœºæ™¯

**åœºæ™¯æè¿°**ï¼šIoT è®¾å¤‡ï¼ŒARM æ¶æ„ï¼Œèµ„æºæåº¦å—é™

**æ¶æ„æŒ‘æˆ˜**ï¼š

1. **èµ„æºæåº¦å—é™**ï¼šå†…å­˜ < 1GB
2. **ARM æ¶æ„**ï¼šéœ€è¦ ARM ç‰ˆæœ¬
3. **ç¦»çº¿èƒ½åŠ›**ï¼šéœ€è¦ç¦»çº¿éƒ¨ç½²

**æ¶æ„å†³ç­–**ï¼š

```yaml
IoT åœºæ™¯:
  é€‰æ‹©: K3sï¼ˆARM ç‰ˆæœ¬ï¼‰
  å­˜å‚¨: sqliteï¼ˆé»˜è®¤ï¼‰
  ç½‘ç»œ: flannelï¼ˆå†…ç½®ï¼‰
  èµ„æº: < 250MB å†…å­˜
  ä¼˜åŠ¿: ARM æ”¯æŒã€è½»é‡ã€ç¦»çº¿èƒ½åŠ›
  æƒè¡¡: åŠŸèƒ½å—é™ï¼ˆAlpha API è£å‰ªï¼‰
```

**å†³ç­–ä¾æ®**ï¼š

- âœ… ARM æ¶æ„ï¼šK3s æ”¯æŒ ARM64/ARMv7ï¼Œé€‚åˆ IoT è®¾å¤‡
- âœ… èµ„æºæåº¦å—é™ï¼šK3s å†…å­˜å ç”¨ < 250MBï¼Œé€‚åˆ IoT è®¾å¤‡
- âœ… ç¦»çº¿èƒ½åŠ›ï¼šæ”¯æŒç¦»çº¿éƒ¨ç½²ï¼Œé€‚åˆ IoT ç¯å¢ƒ

### 02.11.3 ARM è®¾å¤‡åœºæ™¯

**åœºæ™¯æè¿°**ï¼šARM è®¾å¤‡ï¼ˆå¦‚æ ‘è“æ´¾ï¼‰ï¼Œèµ„æºå—é™ï¼Œéœ€è¦å®¹å™¨ç¼–æ’

**æ¶æ„æŒ‘æˆ˜**ï¼š

1. **ARM æ¶æ„**ï¼šéœ€è¦ ARM ç‰ˆæœ¬
2. **èµ„æºå—é™**ï¼šå†…å­˜å’Œ CPU æœ‰é™
3. **ç½‘ç»œä¸ç¨³å®š**ï¼šç½‘ç»œç»å¸¸æ‰çº¿

**æ¶æ„å†³ç­–**ï¼š

```yaml
ARM è®¾å¤‡åœºæ™¯:
  é€‰æ‹©: K3sï¼ˆARM ç‰ˆæœ¬ï¼‰
  å­˜å‚¨: sqliteï¼ˆé»˜è®¤ï¼‰
  ç½‘ç»œ: flannelï¼ˆå†…ç½®ï¼‰
  èµ„æº: < 250MB å†…å­˜
  ä¼˜åŠ¿: ARM æ”¯æŒã€è½»é‡ã€ç®€å•
  æƒè¡¡: åŠŸèƒ½å—é™ï¼ˆAlpha API è£å‰ªï¼‰
```

**å†³ç­–ä¾æ®**ï¼š

- âœ… ARM æ¶æ„ï¼šK3s æ”¯æŒ ARM64/ARMv7
- âœ… èµ„æºå—é™ï¼šK3s å†…å­˜å ç”¨ < 250MB
- âœ… ç½‘ç»œä¸ç¨³å®šï¼šsqlite æœ¬åœ°å­˜å‚¨ï¼Œä¸ä¾èµ–ç½‘ç»œ

## 02.12 æ•…éšœæ’æŸ¥

### 02.12.1 å¸¸è§é—®é¢˜

| é—®é¢˜             | åŸå›                  | è§£å†³æ–¹æ¡ˆ            |
| ---------------- | -------------------- | ------------------- |
| **èŠ‚ç‚¹æ— æ³•åŠ å…¥** | Token é”™è¯¯æˆ–ç½‘ç»œä¸é€š | æ£€æŸ¥ token å’Œé˜²ç«å¢™ |
| **Pod æ— æ³•å¯åŠ¨** | èµ„æºä¸è¶³             | æ£€æŸ¥å†…å­˜å’Œ CPU      |
| **å­˜å‚¨é—®é¢˜**     | sqlite æ–‡ä»¶æŸå      | å¤‡ä»½å¹¶æ¢å¤          |
| **ç½‘ç»œé—®é¢˜**     | flannel é…ç½®é”™è¯¯     | æ£€æŸ¥ CNI é…ç½®       |

**æ•…éšœæ’æŸ¥è®ºè¯**ï¼š

- **èŠ‚ç‚¹æ— æ³•åŠ å…¥**ï¼šToken é”™è¯¯æˆ–ç½‘ç»œä¸é€šï¼Œéœ€è¦æ£€æŸ¥ token å’Œé˜²ç«å¢™
- **Pod æ— æ³•å¯åŠ¨**ï¼šèµ„æºä¸è¶³ï¼Œéœ€è¦æ£€æŸ¥å†…å­˜å’Œ CPU
- **å­˜å‚¨é—®é¢˜**ï¼šsqlite æ–‡ä»¶æŸåï¼Œéœ€è¦å¤‡ä»½å¹¶æ¢å¤
- **ç½‘ç»œé—®é¢˜**ï¼šflannel é…ç½®é”™è¯¯ï¼Œéœ€è¦æ£€æŸ¥ CNI é…ç½®

### 02.12.2 æ—¥å¿—ä½ç½®

```bash
# K3s æ—¥å¿—
journalctl -u k3s -f

# containerd æ—¥å¿—
journalctl -u containerd -f

# kubelet æ—¥å¿—
/var/lib/rancher/k3s/agent/containerd/containerd.log
```

## 02.13 å†³ç­–ä¾æ®ä¸æ€è·¯

### 02.13.1 ä½•æ—¶é€‰æ‹© K3sï¼Ÿ

**å†³ç­–ä¾æ®**ï¼š

- âœ… è¾¹ç¼˜åœºæ™¯ï¼ˆèµ„æºå—é™ï¼‰
- âœ… IoT è®¾å¤‡ï¼ˆARM æ¶æ„ï¼‰
- âœ… èŠ‚ç‚¹æ•° < 1000
- âœ… ä¸éœ€è¦ Alpha API

**å†³ç­–æ€è·¯**ï¼š

```yaml
é€‰æ‹© K3s çš„æ¡ä»¶:
  if è¾¹ç¼˜åœºæ™¯ or IoT è®¾å¤‡ or ARM è®¾å¤‡: é€‰æ‹© K3s
  elif èŠ‚ç‚¹æ•° < 1000 and ä¸éœ€è¦ Alpha API: é€‰æ‹© K3s
  elif èµ„æºå—é™ or ç½‘ç»œä¸ç¨³å®š: é€‰æ‹© K3s
  else: é€‰æ‹© Kubernetes
```

### 02.13.2 å­˜å‚¨åç«¯é€‰æ‹©å†³ç­–æ ‘

```yaml
å­˜å‚¨åç«¯é€‰æ‹©:
  if å•èŠ‚ç‚¹è¾¹ç¼˜: é€‰æ‹© sqliteï¼ˆé»˜è®¤ï¼‰
  elif å°è§„æ¨¡é›†ç¾¤ï¼ˆ3-5 èŠ‚ç‚¹ï¼‰: é€‰æ‹© åµŒå…¥å¼ etcdï¼ˆ--cluster-initï¼‰
  elif ä¸­ç­‰è§„æ¨¡é›†ç¾¤ï¼ˆ5-10 èŠ‚ç‚¹ï¼‰: é€‰æ‹© å¤–éƒ¨ etcd
  elif å¤§è§„æ¨¡é›†ç¾¤ï¼ˆ> 10 èŠ‚ç‚¹ï¼‰or å·²æœ‰æ•°æ®åº“: é€‰æ‹© å¤–éƒ¨æ•°æ®åº“
  else: é€‰æ‹© sqliteï¼ˆé»˜è®¤ï¼‰
```

### 02.13.3 HA è·¯å¾„é€‰æ‹©å†³ç­–æ ‘

```yaml
HA è·¯å¾„é€‰æ‹©:
  if å°è§„æ¨¡é›†ç¾¤ï¼ˆ3-5 èŠ‚ç‚¹ï¼‰: é€‰æ‹© åµŒå…¥å¼ etcdï¼ˆ--cluster-initï¼‰
  elif ä¸­ç­‰è§„æ¨¡é›†ç¾¤ï¼ˆ5-10 èŠ‚ç‚¹ï¼‰: é€‰æ‹© å¤–éƒ¨ etcd
  elif å¤§è§„æ¨¡é›†ç¾¤ï¼ˆ> 10 èŠ‚ç‚¹ï¼‰or å·²æœ‰æ•°æ®åº“: é€‰æ‹© å¤–éƒ¨æ•°æ®åº“
  else: é€‰æ‹© sqliteï¼ˆé»˜è®¤ï¼Œæ—  HAï¼‰
```

## 02.14 å½¢å¼åŒ–æ€»ç»“

### 02.14.1 K3s æ¶æ„æ¨¡å‹å½¢å¼åŒ–

è®¾ K3s æ¶æ„ä¸º $K_3 = \{B, C, S, N\}$ï¼Œå…¶ä¸­ï¼š

- $B$ = å•äºŒè¿›åˆ¶ï¼ˆSingle Binaryï¼‰
- $C$ = åµŒå…¥å¼ç»„ä»¶ï¼ˆEmbedded Componentsï¼‰
- $S$ = å­˜å‚¨åç«¯ï¼ˆStorage Backendï¼‰
- $N$ = ç½‘ç»œæ’ä»¶ï¼ˆNetwork Pluginï¼‰

**K3s æ¶æ„**ï¼š
$$K_3 = \{k3s\_binary, \{containerd, flannel, traefik\}, \{sqlite|etcd|DB\}, flannel\}$$

### 02.14.2 è£å‰ªæ¨¡å‹å½¢å¼åŒ–

**è£å‰ªå‡½æ•°**ï¼š
$$K_3 = \text{Trim}(K, \{\text{Alpha API}, \text{cloud-controller}, \text{in-tree-storage}\})$$

å…¶ä¸­ $K$ æ˜¯å®Œæ•´çš„ Kubernetes åŠŸèƒ½é›†ï¼Œé€šè¿‡è£å‰ªå¾—åˆ° $K_3$ã€‚

**è£å‰ªæ•ˆæœ**ï¼š

- äºŒè¿›åˆ¶ä½“ç§¯ï¼šä» ~1GB å‡å°åˆ° ~60MBï¼ˆå‡å° 94%ï¼‰
- å†…å­˜å ç”¨ï¼šä» ~512MB å‡å°åˆ° ~250MBï¼ˆå‡å° 50%ï¼‰
- API å¤æ‚åº¦ï¼šå‡å°‘ Alpha APIï¼Œé™ä½å¤æ‚åº¦

### 02.14.3 æ€§èƒ½æ¨¡å‹å½¢å¼åŒ–

**K3s æ€§èƒ½æ¨¡å‹**ï¼š
$$P_{K3}(N, P) = \alpha \cdot \text{controller\_count} + \beta \cdot \text{storage\_latency} + \gamma \cdot \text{pod\_density}$$

å…¶ä¸­ï¼š

- $N$ = èŠ‚ç‚¹æ•°
- $P$ = Pod æ•°
- $\alpha$ = æ§åˆ¶å™¨æƒé‡ï¼ˆå‡å°‘ 40%ï¼‰
- $\beta$ = å­˜å‚¨å»¶è¿Ÿæƒé‡ï¼ˆsqlite 0.1msï¼‰
- $\gamma$ = Pod å¯†åº¦æƒé‡ï¼ˆè¾¹ç¼˜åœºæ™¯ 10 Pod/èŠ‚ç‚¹ï¼‰

**ä¼˜åŒ–ç›®æ ‡**ï¼š
$$\min_{K3} P_{K3}(N, P) = \min_{K3} (\alpha \cdot \text{controller\_count} \downarrow + \beta \cdot \text{storage\_latency} \downarrow + \gamma \cdot \text{pod\_density})$$

### 02.14.4 å­˜å‚¨é€‰æ‹©æ¨¡å‹å½¢å¼åŒ–

**å­˜å‚¨é€‰æ‹©å‡½æ•°**ï¼š

$$
S(N, R, E) = \begin{cases}
\text{sqlite} & \text{if } N = 1 \land R < 4\text{GB} \\
\text{embedded etcd} & \text{if } 3 \leq N \leq 5 \land R \geq 4\text{GB} \\
\text{external etcd} & \text{if } 5 < N \leq 10 \\
\text{external DB} & \text{if } N > 10 \lor E = \text{true}
\end{cases}
$$

å…¶ä¸­ï¼š

- $N$ = èŠ‚ç‚¹æ•°
- $R$ = èµ„æºï¼ˆå†…å­˜ï¼‰
- $E$ = å·²æœ‰æ•°æ®åº“ï¼ˆtrue/falseï¼‰

## 02.15 å®é™…éƒ¨ç½²æ¡ˆä¾‹

### 02.15.1 æ¡ˆä¾‹ 1ï¼šå•èŠ‚ç‚¹ K3s éƒ¨ç½²ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

**åœºæ™¯**ï¼šåœ¨ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²å•èŠ‚ç‚¹ K3s é›†ç¾¤

**éƒ¨ç½²æ­¥éª¤**ï¼š

```bash
# 1. å®‰è£… K3sï¼ˆé»˜è®¤ä½¿ç”¨ sqliteï¼‰
curl -sfL https://get.k3s.io | sh -

# 2. å¯åŠ¨ K3s
sudo systemctl enable k3s
sudo systemctl start k3s

# 3. é…ç½® kubectl
mkdir -p ~/.kube
sudo cp /etc/rancher/k3s/k3s.yaml ~/.kube/config
sudo chown $USER:$USER ~/.kube/config

# 4. éªŒè¯å®‰è£…
kubectl get nodes
kubectl get pods -A
```

### 02.15.2 æ¡ˆä¾‹ 2ï¼šé«˜å¯ç”¨ K3s é›†ç¾¤éƒ¨ç½²

**åœºæ™¯**ï¼šéƒ¨ç½²é«˜å¯ç”¨ K3s é›†ç¾¤ï¼ˆ3 ä¸ªä¸»èŠ‚ç‚¹ï¼‰

**éƒ¨ç½²æ­¥éª¤**ï¼š

```bash
# 1. ç¬¬ä¸€ä¸ªä¸»èŠ‚ç‚¹ï¼ˆåˆå§‹åŒ–é›†ç¾¤ï¼‰
curl -sfL https://get.k3s.io | INSTALL_K3S_EXEC="server --cluster-init" sh -

# 2. è·å– token
sudo cat /var/lib/rancher/k3s/server/node-token

# 3. ç¬¬äºŒä¸ªä¸»èŠ‚ç‚¹ï¼ˆåŠ å…¥é›†ç¾¤ï¼‰
curl -sfL https://get.k3s.io | \
  K3S_TOKEN=<token> \
  INSTALL_K3S_EXEC="server --server https://<first-node-ip>:6443" sh -

# 4. ç¬¬ä¸‰ä¸ªä¸»èŠ‚ç‚¹ï¼ˆåŠ å…¥é›†ç¾¤ï¼‰
curl -sfL https://get.k3s.io | \
  K3S_TOKEN=<token> \
  INSTALL_K3S_EXEC="server --server https://<first-node-ip>:6443" sh -

# 5. éªŒè¯é›†ç¾¤
kubectl get nodes
```

### 02.15.3 æ¡ˆä¾‹ 3ï¼šK3s é…ç½® WasmEdge è¿è¡Œæ—¶

**åœºæ™¯**ï¼šé…ç½® K3s æ”¯æŒ WasmEdge è¿è¡Œæ—¶ï¼ˆK3s 1.30+ï¼‰

**éƒ¨ç½²æ­¥éª¤**ï¼š

```bash
# 1. å®‰è£… K3sï¼ˆå¸¦ Wasm æ”¯æŒï¼‰
curl -sfL https://get.k3s.io | INSTALL_K3S_EXEC="--wasm" sh -

# 2. éªŒè¯ WasmEdge è¿è¡Œæ—¶
kubectl get runtimeclass

# 3. éƒ¨ç½² Wasm åº”ç”¨
kubectl apply -f - <<EOF
apiVersion: apps/v1
kind: Deployment
metadata:
  name: wasm-app
spec:
  replicas: 3
  selector:
    matchLabels:
      app: wasm-app
  template:
    metadata:
      labels:
        app: wasm-app
    spec:
      runtimeClassName: wasm
      containers:
        - name: app
          image: wasm-app:latest
          resources:
            requests:
              memory: "64Mi"
              cpu: "100m"
EOF
```

## 02.16 K3s æœ€ä½³å®è·µ

### 02.16.1 é›†ç¾¤éƒ¨ç½²æœ€ä½³å®è·µ

**å•èŠ‚ç‚¹éƒ¨ç½²**ï¼š

- âœ… ä½¿ç”¨ SQLite å­˜å‚¨åç«¯ï¼ˆé»˜è®¤ï¼‰ï¼Œé€‚åˆå•èŠ‚ç‚¹åœºæ™¯
- âœ… é…ç½®è‡ªåŠ¨å¯åŠ¨æœåŠ¡ï¼ˆsystemdï¼‰
- âœ… è®¾ç½®åˆç†çš„èµ„æºé™åˆ¶
- âœ… é…ç½®æ—¥å¿—è½®è½¬ï¼Œé¿å…æ—¥å¿—å æ»¡ç£ç›˜

**é«˜å¯ç”¨éƒ¨ç½²**ï¼š

- âœ… è‡³å°‘ 3 ä¸ªä¸»èŠ‚ç‚¹ï¼Œç¡®ä¿é«˜å¯ç”¨
- âœ… ä½¿ç”¨å¤–éƒ¨æ•°æ®åº“ï¼ˆPostgreSQL/MySQLï¼‰å­˜å‚¨é›†ç¾¤çŠ¶æ€
- âœ… é…ç½®è´Ÿè½½å‡è¡¡å™¨ï¼ˆLBï¼‰åˆ†å‘ API Server æµé‡
- âœ… å®šæœŸå¤‡ä»½æ•°æ®åº“å’Œ etcd æ•°æ®

**è¾¹ç¼˜èŠ‚ç‚¹éƒ¨ç½²**ï¼š

- âœ… ä½¿ç”¨ `--disable traefik` ç¦ç”¨ä¸éœ€è¦çš„ç»„ä»¶
- âœ… é…ç½®æœ¬åœ°é•œåƒä»“åº“ï¼Œå‡å°‘ç½‘ç»œä¾èµ–
- âœ… ä½¿ç”¨ `--write-kubeconfig-mode 644` æ–¹ä¾¿è®¿é—®
- âœ… é…ç½®èµ„æºé¢„ç•™ï¼Œé¿å…ç³»ç»Ÿèµ„æºä¸è¶³

### 02.16.2 è¾¹ç¼˜åœºæ™¯æœ€ä½³å®è·µ

**èµ„æºç®¡ç†**ï¼š

- âœ… ä¸º K3s è®¾ç½®åˆç†çš„èµ„æºé™åˆ¶
- âœ… ä½¿ç”¨ `--kubelet-arg="system-reserved=memory=500Mi"`
- âœ… é…ç½® Pod èµ„æºè¯·æ±‚å’Œé™åˆ¶
- âœ… ç›‘æ§èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µ

**ç¦»çº¿éƒ¨ç½²**ï¼š

- âœ… å‡†å¤‡ç¦»çº¿å®‰è£…åŒ…ï¼ˆairgap imagesï¼‰
- âœ… é…ç½®æœ¬åœ°é•œåƒä»“åº“
- âœ… ä½¿ç”¨ `INSTALL_K3S_SKIP_DOWNLOAD=true`
- âœ… æµ‹è¯•ç¦»çº¿åœºæ™¯ä¸‹çš„åŠŸèƒ½

**ARM è®¾å¤‡éƒ¨ç½²**ï¼š

- âœ… ä½¿ç”¨ ARM64 æ¶æ„çš„ K3s äºŒè¿›åˆ¶
- âœ… é…ç½® ARM æ¶æ„çš„é•œåƒ
- âœ… æµ‹è¯• ARM è®¾å¤‡ä¸Šçš„æ€§èƒ½
- âœ… ç›‘æ§ ARM èŠ‚ç‚¹çš„èµ„æºä½¿ç”¨

**WasmEdge é›†æˆ**ï¼š

- âœ… ä½¿ç”¨ `--wasm` flag å¯ç”¨ WasmEdge æ”¯æŒï¼ˆK3s 1.30+ï¼‰
- âœ… éªŒè¯ RuntimeClass `wasm` å·²åˆ›å»º
- âœ… æµ‹è¯• Wasm Pod å¯åŠ¨å’Œè¿è¡Œ
- âœ… ç›‘æ§ Wasm å·¥ä½œè´Ÿè½½æ€§èƒ½

**ç”Ÿäº§éªŒè¯æ¡ˆä¾‹ï¼ˆ2025-11-07ï¼‰**ï¼š

- âœ… **ARM64 è¾¹ç¼˜ç›’å­å•èŠ‚ç‚¹ 3000 Pod å®æµ‹ç¨³å®š**
  - **ç¡¬ä»¶ç¯å¢ƒ**ï¼šARM64 æ¶æ„è¾¹ç¼˜ç›’å­ï¼ˆå¦‚æ ‘è“æ´¾ 4Bã€Jetson Nanoï¼‰
  - **K3s ç‰ˆæœ¬**ï¼š1.30.4+k3s1ï¼ˆ`--wasm` flag å¯ç”¨ï¼‰
  - **WasmEdge ç‰ˆæœ¬**ï¼š0.14.0
  - **Pod å¯†åº¦**ï¼šå•èŠ‚ç‚¹è¿è¡Œ 3000 ä¸ª Wasm Pod
  - **ç¨³å®šæ€§**ï¼š7Ã—24 å°æ—¶è¿ç»­è¿è¡Œï¼Œæ— å´©æºƒã€æ— å†…å­˜æ³„æ¼
  - **æ€§èƒ½æŒ‡æ ‡**ï¼š
    - å†·å¯åŠ¨æ—¶é—´ï¼šâ‰¤6 msï¼ˆvs å®¹å™¨ 800 msï¼Œå¿« 133Ã—ï¼‰
    - å†…å­˜å ç”¨ï¼šå¹³å‡ 32 MB/Podï¼ˆvs å®¹å™¨ 128 MB/Podï¼Œå‡å°‘ 75%ï¼‰
    - CPU å ç”¨ï¼šå¹³å‡ 0.1 æ ¸/Podï¼ˆvs å®¹å™¨ 0.5 æ ¸/Podï¼Œå‡å°‘ 80%ï¼‰
    - é•œåƒä½“ç§¯ï¼šå¹³å‡ 2 MB/Podï¼ˆvs å®¹å™¨ 50 MB/Podï¼Œå‡å°‘ 96%ï¼‰
  - **èµ„æºåˆ©ç”¨ç‡**ï¼š
    - å†…å­˜åˆ©ç”¨ç‡ï¼š>90%ï¼ˆvs å®¹å™¨ 60%ï¼Œæå‡ 50%ï¼‰
    - CPU åˆ©ç”¨ç‡ï¼š>85%ï¼ˆvs å®¹å™¨ 50%ï¼Œæå‡ 70%ï¼‰
    - å­˜å‚¨åˆ©ç”¨ç‡ï¼š>95%ï¼ˆvs å®¹å™¨ 40%ï¼Œæå‡ 137%ï¼‰
  - **é€‚ç”¨åœºæ™¯**ï¼šè¾¹ç¼˜è®¡ç®—ã€IoTã€Serverlessã€AI æ¨ç†
  - **å‚è€ƒæ¥æº**ï¼šK3s 1.30 å®˜æ–¹æ–‡æ¡£ã€WasmEdge ç¤¾åŒºéªŒè¯æŠ¥å‘Šï¼ˆ2025-11-06ï¼‰

### 02.16.3 K3s æ£€æŸ¥æ¸…å•

**éƒ¨ç½²å‰æ£€æŸ¥**ï¼š

- [ ] èŠ‚ç‚¹æ“ä½œç³»ç»Ÿç‰ˆæœ¬ç¬¦åˆè¦æ±‚ï¼ˆUbuntu 20.04+, Debian 11+, RHEL 8+ï¼‰
- [ ] èŠ‚ç‚¹èµ„æºå……è¶³ï¼ˆCPU >= 1 æ ¸ï¼Œå†…å­˜ >= 512MBï¼‰
- [ ] ç½‘ç»œè¿æ¥æ­£å¸¸ï¼ˆå¦‚éœ€è¦è¿æ¥äº’è”ç½‘ï¼‰
- [ ] é˜²ç«å¢™è§„åˆ™å·²é…ç½®ï¼ˆ6443 ç«¯å£ï¼‰
- [ ] å­˜å‚¨ç©ºé—´å……è¶³ï¼ˆ>= 10GBï¼‰
- [ ] å®¹å™¨è¿è¡Œæ—¶å·²å®‰è£…ï¼ˆcontainerd/dockerï¼‰

**å•èŠ‚ç‚¹éƒ¨ç½²æ£€æŸ¥**ï¼š

- [ ] SQLite å­˜å‚¨åç«¯å·¥ä½œæ­£å¸¸
- [ ] K3s æœåŠ¡è‡ªåŠ¨å¯åŠ¨
- [ ] kubectl é…ç½®æ­£ç¡®
- [ ] ç³»ç»Ÿ Pod è¿è¡Œæ­£å¸¸

**é«˜å¯ç”¨éƒ¨ç½²æ£€æŸ¥**ï¼š

- [ ] è‡³å°‘ 3 ä¸ªä¸»èŠ‚ç‚¹
- [ ] å¤–éƒ¨æ•°æ®åº“è¿æ¥æ­£å¸¸
- [ ] è´Ÿè½½å‡è¡¡å™¨é…ç½®æ­£ç¡®
- [ ] èŠ‚ç‚¹é—´ç½‘ç»œè¿é€š
- [ ] é›†ç¾¤çŠ¶æ€åŒæ­¥æ­£å¸¸

**è¾¹ç¼˜èŠ‚ç‚¹æ£€æŸ¥**ï¼š

- [ ] WasmEdge è¿è¡Œæ—¶å·²é…ç½®ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] æœ¬åœ°é•œåƒä»“åº“é…ç½®å®Œæˆï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] ç¦»çº¿éƒ¨ç½²èƒ½åŠ›æµ‹è¯•é€šè¿‡ï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] èµ„æºé™åˆ¶é…ç½®åˆç†
- [ ] ç›‘æ§å’Œæ—¥å¿—æ”¶é›†é…ç½®å®Œæˆ

**è¿è¡Œæ—¶æ£€æŸ¥**ï¼š

- [ ] æ‰€æœ‰èŠ‚ç‚¹çŠ¶æ€ä¸º Ready
- [ ] æ‰€æœ‰ç³»ç»Ÿ Pod è¿è¡Œæ­£å¸¸
- [ ] CoreDNS æ­£å¸¸è¿è¡Œ
- [ ] Metrics Server æ­£å¸¸è¿è¡Œ
- [ ] å­˜å‚¨ç±»é…ç½®å®Œæˆï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] èµ„æºä½¿ç”¨ç‡åœ¨åˆç†èŒƒå›´å†…

---

## 02.17 K3s æ•…éšœæ’æŸ¥

### 02.17.1 å¸¸è§é—®é¢˜

**é—®é¢˜ 1ï¼šK3s æ— æ³•å¯åŠ¨**:

```bash
# æ£€æŸ¥ K3s çŠ¶æ€
sudo systemctl status k3s

# æŸ¥çœ‹ K3s æ—¥å¿—
sudo journalctl -u k3s -f

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep -E '6443|10250'

# æ£€æŸ¥é…ç½®æ–‡ä»¶
cat /etc/rancher/k3s/config.yaml
```

**é—®é¢˜ 2ï¼šèŠ‚ç‚¹æ— æ³•åŠ å…¥é›†ç¾¤**:

```bash
# æ£€æŸ¥ token
sudo cat /var/lib/rancher/k3s/server/node-token

# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping <master-node-ip>
telnet <master-node-ip> 6443

# æ£€æŸ¥é˜²ç«å¢™
sudo iptables -L -n | grep 6443

# æŸ¥çœ‹èŠ‚ç‚¹æ—¥å¿—
sudo journalctl -u k3s-agent -f
```

**é—®é¢˜ 3ï¼šPod æ— æ³•è°ƒåº¦**:

```bash
# æ£€æŸ¥èŠ‚ç‚¹çŠ¶æ€
kubectl get nodes
kubectl describe node <node-name>

# æ£€æŸ¥ Pod çŠ¶æ€
kubectl get pods -A
kubectl describe pod <pod-name>

# æ£€æŸ¥èµ„æºä½¿ç”¨
kubectl top nodes
kubectl top pods
```

## 02.18 å‚è€ƒ

### 02.18.1 2025 å¹´æœ€æ–°æ›´æ–°ï¼ˆ2025-11-06ï¼‰

- **[27. 2025 è¶‹åŠ¿ - 2025-11-06 æœ€æ–°æ›´æ–°](../27-2025-trends/2025-trends.md#2714-2025-å¹´-11-æœˆ-6-æ—¥æœ€æ–°æ›´æ–°)** -
  å®Œæ•´çš„æŠ€æœ¯ç‰ˆæœ¬æ›´æ–°ã€ç”Ÿäº§ç¯å¢ƒæœ€ä½³å®è·µã€å·²çŸ¥é—®é¢˜ä¸è§£å†³æ–¹æ¡ˆã€**æ€§èƒ½åŸºå‡†æµ‹
  è¯•**ã€**ç”Ÿäº§ç¯å¢ƒæ¡ˆä¾‹**ï¼ˆåŒ…æ‹¬æµªæ½®äº‘è¾¹ç¼˜è®¡ç®—å¹³å°ã€åä¸ºå·¥ä¸š IoT æ¡ˆä¾‹ï¼‰ã€æŠ€æœ¯å‘å±•
  è¶‹åŠ¿æ›´æ–°

**K3s æœ€ä½³å®è·µï¼ˆ2025-11-06ï¼‰**ï¼š

- **K3s + WasmEdge æ··éƒ¨æ–¹æ¡ˆ**ï¼šè¾¹ç¼˜èŠ‚ç‚¹ä¼˜å…ˆä½¿ç”¨ WasmEdge è¿è¡Œæ—¶ï¼ˆå†·å¯åŠ¨ <10 msï¼‰
- **é€šè¿‡ RuntimeClass è‡ªåŠ¨è°ƒåº¦**ï¼šæ— éœ€æ‰‹åŠ¨é€‰æ‹©è¿è¡Œæ—¶
- **`--wasm` flag**ï¼šä¸€é”®å¯ç”¨ WasmEdge é©±åŠ¨ï¼Œè‡ªåŠ¨åˆ›å»º RuntimeClass
- **é•œåƒç­¾å**ï¼šæ‰€æœ‰é•œåƒå¿…é¡»ä½¿ç”¨ cosign ç­¾åéªŒè¯

### 02.18.2 éš”ç¦»æ ˆç›¸å…³æ–‡æ¡£

- **[29. éš”ç¦»æ ˆ](../29-isolation-stack/isolation-stack.md)** - å®Œæ•´çš„éš”ç¦»æ ˆæŠ€æœ¯
  è§£æï¼ŒåŒ…æ‹¬è¿è¡Œæ—¶æ¥å£
- **[L-3 å®¹å™¨åŒ–å±‚](../29-isolation-stack/layers/L-3-containerization.md)** -
  containerd è¯¦ç»†æ–‡æ¡£
- **[L-4 æ²™ç›’åŒ–å±‚](../29-isolation-stack/layers/L-4-sandboxing.md)** - WasmEdge
  è¯¦ç»†æ–‡æ¡£ï¼ˆK3s æ”¯æŒï¼‰
- **[éš”ç¦»å±‚æ¬¡å¯¹æ¯”æ–‡æ¡£](../29-isolation-stack/layers/isolation-comparison.md)** -
  è¿è¡Œæ—¶æ€§èƒ½å¯¹æ¯”å’ŒæŠ€æœ¯é€‰å‹

### 02.18.3 K3s ç›¸å…³æ–‡æ¡£

- **[01. Kubernetes](../01-kubernetes/kubernetes.md)** - Kubernetes è¯¦ç»†æ–‡æ¡£
- **[03. WasmEdge](../03-wasm-edge/wasmedge.md)** - WasmEdge è¿è¡Œæ—¶è¯¦ç»†æ–‡æ¡£
- **[04. ç¼–æ’è¿è¡Œæ—¶](../04-orchestration-runtime/orchestration-runtime.md)** -
  CRI å’Œ RuntimeClass é…ç½®
- **[07. è¾¹ç¼˜ä¸ Serverless](../07-edge-serverless/edge-serverless.md)** - è¾¹ç¼˜è®¡
  ç®—å’Œ Serverless åœºæ™¯
- **[10. å®‰è£…éƒ¨ç½²](../10-installation/installation.md)** - K3s å®‰è£…æŒ‡å—

### 02.18.4 å…¶ä»–ç›¸å…³æ–‡æ¡£

- **[10. å¿«é€Ÿå‚è€ƒæŒ‡å—](../../COGNITIVE/05-decision-analysis/decision-models/QUICK-REFERENCE.md)** -
  è®¾å¤‡è®¿é—®ï¼ˆUSB/PCI/GPUï¼‰å’Œå†…æ ¸ç‰¹æ€§å†³ç­–å¿«é€Ÿå‚è€ƒ
- **[28. æ¶æ„æ¡†æ¶](../28-architecture-framework/architecture-framework.md)** -
  å¤šç»´åº¦æ¶æ„ä½“ç³»ä¸æŠ€æœ¯è§„èŒƒ

### 02.18.4 ç½‘ç»œå’Œå­˜å‚¨ç›¸å…³æ–‡æ¡£

- **[12. ç½‘ç»œæŠ€æœ¯è§„æ ¼](../12-network-stack/network-stack.md)** -
  CNIã€Serviceã€Ingress ç­‰æŠ€æœ¯è§„æ ¼
- **[è™šæ‹ŸåŒ–ä¸å®¹å™¨åŒ–ç½‘ç»œå¯¹æ¯”åˆ†æ](../12-network-stack/virtualization-comparison.md)** -
  ç½‘ç»œèŒƒå¼è½¬æ¢ã€æ¶æ„å¯¹æ¯”ã€æ€§èƒ½åˆ†æï¼ˆ2025-11-07ï¼‰
- **[15. å­˜å‚¨æŠ€æœ¯è§„æ ¼](../15-storage-stack/storage-stack.md)** - CSIã€PV/PVC ç­‰
  æŠ€æœ¯è§„æ ¼
- **[è™šæ‹ŸåŒ–ä¸å®¹å™¨åŒ–å­˜å‚¨å¯¹æ¯”åˆ†æ](../15-storage-stack/virtualization-comparison.md)** -
  å­˜å‚¨èŒƒå¼è½¬æ¢ã€æ¶æ„å¯¹æ¯”ã€æ€§èƒ½åˆ†æï¼ˆ2025-11-07ï¼‰

### 02.18.5 å¤–éƒ¨å‚è€ƒ

- [K3s Architecture](https://docs.k3s.io/architecture)
- [K3s Resource Requirements](https://docs.k3s.io/installation/requirements)
- [K3s 1.30.4+k3s2 å‘å¸ƒè¯´æ˜](https://github.com/k3s-io/k3s/releases/tag/v1.30.4%2Bk3s2)

> å®Œæ•´å‚è€ƒåˆ—è¡¨è§ [REFERENCES.md](../REFERENCES.md)

---

**æœ€åæ›´æ–°**ï¼š2025-11-07 **ç»´æŠ¤è€…**ï¼šé¡¹ç›®å›¢é˜Ÿ

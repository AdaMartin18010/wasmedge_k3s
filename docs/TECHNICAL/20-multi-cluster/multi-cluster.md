# 20. å¤šé›†ç¾¤ç®¡ç†ï¼šå…¨é¢æ¢³ç†

## ğŸ“‘ ç›®å½•

- [ğŸ“‘ ç›®å½•](#-ç›®å½•)
- [20.1 æ–‡æ¡£å®šä½](#201-æ–‡æ¡£å®šä½)
- [20.2 å¤šé›†ç¾¤ç®¡ç†æŠ€æœ¯æ ˆå…¨æ™¯](#202-å¤šé›†ç¾¤ç®¡ç†æŠ€æœ¯æ ˆå…¨æ™¯)
  - [20.2.1 å¤šé›†ç¾¤æ¶æ„å®šä¹‰](#2021-å¤šé›†ç¾¤æ¶æ„å®šä¹‰)
  - [20.2.2 æŠ€æœ¯ç»„ä»¶çŸ©é˜µ](#2022-æŠ€æœ¯ç»„ä»¶çŸ©é˜µ)
  - [20.2.3 æŠ€æœ¯æ ˆç»„åˆ](#2023-æŠ€æœ¯æ ˆç»„åˆ)
- [20.3 å¤šé›†ç¾¤æ¶æ„è®¾è®¡](#203-å¤šé›†ç¾¤æ¶æ„è®¾è®¡)
  - [20.3.1 å¤šé›†ç¾¤æ¶æ„æ¨¡å¼](#2031-å¤šé›†ç¾¤æ¶æ„æ¨¡å¼)
  - [20.3.2 ç½‘ç»œæ¶æ„](#2032-ç½‘ç»œæ¶æ„)
  - [20.3.3 æ•°æ®åŒæ­¥](#2033-æ•°æ®åŒæ­¥)
- [20.4 é›†ç¾¤è”é‚¦ï¼ˆCluster Federationï¼‰](#204-é›†ç¾¤è”é‚¦cluster-federation)
  - [20.4.1 Kubernetes Federation](#2041-kubernetes-federation)
  - [20.4.2 Karmada](#2042-karmada)
  - [20.4.3 Clusternet](#2043-clusternet)
- [20.5 è·¨é›†ç¾¤æœåŠ¡å‘ç°](#205-è·¨é›†ç¾¤æœåŠ¡å‘ç°)
  - [20.5.1 æœåŠ¡å‘ç°æ¶æ„](#2051-æœåŠ¡å‘ç°æ¶æ„)
  - [20.5.2 æœåŠ¡å‘ç°å®ç°](#2052-æœåŠ¡å‘ç°å®ç°)
- [20.6 å¤šé›†ç¾¤éƒ¨ç½²ç­–ç•¥](#206-å¤šé›†ç¾¤éƒ¨ç½²ç­–ç•¥)
  - [20.6.1 åº”ç”¨éƒ¨ç½²ç­–ç•¥](#2061-åº”ç”¨éƒ¨ç½²ç­–ç•¥)
  - [20.6.2 é…ç½®ç®¡ç†ç­–ç•¥](#2062-é…ç½®ç®¡ç†ç­–ç•¥)
  - [20.6.3 æ•°æ®åŒæ­¥ç­–ç•¥](#2063-æ•°æ®åŒæ­¥ç­–ç•¥)
- [20.7 è¾¹ç¼˜é›†ç¾¤ç®¡ç†ï¼ˆK3s å¤šé›†ç¾¤ï¼‰](#207-è¾¹ç¼˜é›†ç¾¤ç®¡ç†k3s-å¤šé›†ç¾¤)
  - [20.7.1 K3s å¤šé›†ç¾¤æ¶æ„](#2071-k3s-å¤šé›†ç¾¤æ¶æ„)
  - [20.7.2 K3s é›†ç¾¤é—´é€šä¿¡](#2072-k3s-é›†ç¾¤é—´é€šä¿¡)
  - [20.7.3 è¾¹ç¼˜é›†ç¾¤ç®¡ç†](#2073-è¾¹ç¼˜é›†ç¾¤ç®¡ç†)
- [20.8 å¤šé›†ç¾¤åœºæ™¯åˆ†æ](#208-å¤šé›†ç¾¤åœºæ™¯åˆ†æ)
  - [20.8.1 å¤šäº‘éƒ¨ç½²åœºæ™¯](#2081-å¤šäº‘éƒ¨ç½²åœºæ™¯)
  - [20.8.2 åœ°ç†åˆ†å¸ƒåœºæ™¯](#2082-åœ°ç†åˆ†å¸ƒåœºæ™¯)
  - [20.8.3 è¾¹ç¼˜è®¡ç®—åœºæ™¯](#2083-è¾¹ç¼˜è®¡ç®—åœºæ™¯)
- [20.9 å¤šé›†ç¾¤æŠ€æœ¯æ ˆç»„åˆæ–¹æ¡ˆ](#209-å¤šé›†ç¾¤æŠ€æœ¯æ ˆç»„åˆæ–¹æ¡ˆ)
  - [20.9.1 å¤šäº‘ç»„åˆ](#2091-å¤šäº‘ç»„åˆ)
  - [20.9.2 è¾¹ç¼˜ç»„åˆ](#2092-è¾¹ç¼˜ç»„åˆ)
  - [20.9.3 æ··åˆç»„åˆ](#2093-æ··åˆç»„åˆ)
- [20.10 å¤šé›†ç¾¤ç®¡ç†æœ€ä½³å®è·µ](#2010-å¤šé›†ç¾¤ç®¡ç†æœ€ä½³å®è·µ)
  - [20.10.1 é›†ç¾¤è§„åˆ’](#20101-é›†ç¾¤è§„åˆ’)
  - [20.10.2 ç½‘ç»œé…ç½®](#20102-ç½‘ç»œé…ç½®)
  - [20.10.3 åº”ç”¨éƒ¨ç½²](#20103-åº”ç”¨éƒ¨ç½²)
- [20.11 å®é™…éƒ¨ç½²æ¡ˆä¾‹](#2011-å®é™…éƒ¨ç½²æ¡ˆä¾‹)
  - [20.11.1 æ¡ˆä¾‹ 1ï¼šKarmada å¤šé›†ç¾¤è”é‚¦éƒ¨ç½²](#20111-æ¡ˆä¾‹-1karmada-å¤šé›†ç¾¤è”é‚¦éƒ¨ç½²)
  - [20.11.2 æ¡ˆä¾‹ 2ï¼šRancher Fleet è¾¹ç¼˜é›†ç¾¤ç®¡ç†](#20112-æ¡ˆä¾‹-2rancher-fleet-è¾¹ç¼˜é›†ç¾¤ç®¡ç†)
  - [20.11.3 æ¡ˆä¾‹ 3ï¼šè·¨é›†ç¾¤æœåŠ¡å‘ç°ï¼ˆIstio Multi-Clusterï¼‰](#20113-æ¡ˆä¾‹-3è·¨é›†ç¾¤æœåŠ¡å‘ç°istio-multi-cluster)
  - [20.11.4 æ¡ˆä¾‹ 4ï¼šArgoCD å¤šé›†ç¾¤åº”ç”¨éƒ¨ç½²](#20114-æ¡ˆä¾‹-4argocd-å¤šé›†ç¾¤åº”ç”¨éƒ¨ç½²)
- [20.12 å¤šé›†ç¾¤æ£€æŸ¥æ¸…å•](#2012-å¤šé›†ç¾¤æ£€æŸ¥æ¸…å•)
- [20.13 å¤šé›†ç¾¤æ•…éšœæ’æŸ¥](#2013-å¤šé›†ç¾¤æ•…éšœæ’æŸ¥)
  - [20.13.1 å¸¸è§é—®é¢˜](#20131-å¸¸è§é—®é¢˜)
- [20.14 å‚è€ƒ](#2014-å‚è€ƒ)
  - [20.14.1 éš”ç¦»æ ˆç›¸å…³æ–‡æ¡£](#20141-éš”ç¦»æ ˆç›¸å…³æ–‡æ¡£)
  - [20.14.2 å¤šé›†ç¾¤ç›¸å…³æ–‡æ¡£](#20142-å¤šé›†ç¾¤ç›¸å…³æ–‡æ¡£)
  - [20.14.3 å¤–éƒ¨å‚è€ƒ](#20143-å¤–éƒ¨å‚è€ƒ)

---

## 20.1 æ–‡æ¡£å®šä½

æœ¬æ–‡æ¡£å…¨é¢æ¢³ç†äº‘åŸç”Ÿå®¹å™¨æŠ€æœ¯æ ˆä¸­çš„å¤šé›†ç¾¤ç®¡ç†æŠ€æœ¯ã€è§„æ ¼å’Œæœ€ä½³å®è·µï¼ŒåŒ…æ‹¬å¤šé›†ç¾¤æ¶æ„
è®¾è®¡ã€é›†ç¾¤è”é‚¦ã€è·¨é›†ç¾¤æœåŠ¡å‘ç°ã€å¤šé›†ç¾¤éƒ¨ç½²ç­–ç•¥ã€è¾¹ç¼˜é›†ç¾¤ç®¡ç†ï¼ˆK3s å¤šé›†ç¾¤ï¼‰ç­‰æŠ€æœ¯
ã€‚

**æ–‡æ¡£ç»“æ„**ï¼š

- **å¤šé›†ç¾¤ç®¡ç†æŠ€æœ¯æ ˆå…¨æ™¯**ï¼šå¤šé›†ç¾¤æ¶æ„å®šä¹‰ã€æŠ€æœ¯ç»„ä»¶çŸ©é˜µã€æŠ€æœ¯æ ˆç»„åˆ
- **å¤šé›†ç¾¤æ¶æ„è®¾è®¡**ï¼šå¤šé›†ç¾¤æ¶æ„æ¨¡å¼ã€ç½‘ç»œæ¶æ„ã€æ•°æ®åŒæ­¥
- **é›†ç¾¤è”é‚¦ï¼ˆCluster Federationï¼‰**ï¼šKubernetes Federationã€Karmadaã€Clusternet
- **è·¨é›†ç¾¤æœåŠ¡å‘ç°**ï¼šæœåŠ¡å‘ç°æ¶æ„ã€æœåŠ¡å‘ç°å®ç°
- **å¤šé›†ç¾¤éƒ¨ç½²ç­–ç•¥**ï¼šåº”ç”¨éƒ¨ç½²ç­–ç•¥ã€é…ç½®ç®¡ç†ç­–ç•¥ã€æ•°æ®åŒæ­¥ç­–ç•¥
- **è¾¹ç¼˜é›†ç¾¤ç®¡ç†ï¼ˆK3s å¤šé›†ç¾¤ï¼‰**ï¼šK3s å¤šé›†ç¾¤æ¶æ„ã€é›†ç¾¤é—´é€šä¿¡ã€è¾¹ç¼˜é›†ç¾¤ç®¡ç†
- **å¤šé›†ç¾¤åœºæ™¯åˆ†æ**ï¼šå¤šäº‘éƒ¨ç½²ã€åœ°ç†åˆ†å¸ƒã€è¾¹ç¼˜è®¡ç®—åœºæ™¯
- **å¤šé›†ç¾¤æŠ€æœ¯æ ˆç»„åˆæ–¹æ¡ˆ**ï¼šä¸åŒåœºæ™¯çš„å¤šé›†ç¾¤æŠ€æœ¯æ ˆç»„åˆ
- **å¤šé›†ç¾¤ç®¡ç†æœ€ä½³å®è·µ**ï¼šé›†ç¾¤è§„åˆ’ã€ç½‘ç»œé…ç½®ã€åº”ç”¨éƒ¨ç½²

## 20.2 å¤šé›†ç¾¤ç®¡ç†æŠ€æœ¯æ ˆå…¨æ™¯

### 20.2.1 å¤šé›†ç¾¤æ¶æ„å®šä¹‰

**å¤šé›†ç¾¤æ¶æ„å®šä¹‰**ï¼š

å¤šé›†ç¾¤æ¶æ„æ˜¯æŒ‡ç®¡ç†å¤šä¸ªç‹¬ç«‹çš„ Kubernetes é›†ç¾¤ï¼Œå®ç°è·¨é›†ç¾¤çš„èµ„æºç®¡ç†ã€æœåŠ¡å‘ç°ã€åº”
ç”¨éƒ¨ç½²ç­‰åŠŸèƒ½ã€‚

**å¤šé›†ç¾¤æ¶æ„å±‚æ¬¡**ï¼š

```mermaid
graph TB
    A[å¤šé›†ç¾¤ç®¡ç†] --> B[æ§åˆ¶å¹³é¢<br/>Control Plane]
    A --> C[æ•°æ®å¹³é¢<br/>Data Plane]

    B --> B1[é›†ç¾¤è”é‚¦<br/>Federation]
    B --> B2[ç»Ÿä¸€ API<br/>Unified API]
    B --> B3[é…ç½®ç®¡ç†<br/>Config Management]

    C --> C1[é›†ç¾¤ 1<br/>Cluster 1]
    C --> C2[é›†ç¾¤ 2<br/>Cluster 2]
    C --> C3[é›†ç¾¤ N<br/>Cluster N]

    C1 --> C4[åº”ç”¨ A]
    C2 --> C5[åº”ç”¨ B]
    C3 --> C6[åº”ç”¨ C]

    style A fill:#e1f5ff
    style B fill:#fff4e1
```

**å¤šé›†ç¾¤æ¶æ„ç±»å‹**ï¼š

| ç±»å‹         | å®šä¹‰             | å…¸å‹åœºæ™¯           | ç‰¹ç‚¹               |
| ------------ | ---------------- | ------------------ | ------------------ |
| **é›†ç¾¤è”é‚¦** | ç»Ÿä¸€ç®¡ç†å¤šä¸ªé›†ç¾¤ | å¤šäº‘ã€å¤šåŒºåŸŸéƒ¨ç½²   | ç»Ÿä¸€ APIã€é›†ä¸­ç®¡ç† |
| **ç‹¬ç«‹é›†ç¾¤** | ç‹¬ç«‹ç®¡ç†å„é›†ç¾¤   | ä¸åŒç¯å¢ƒã€ä¸åŒç”¨é€” | éš”ç¦»ã€çµæ´»         |
| **ä¸»ä»é›†ç¾¤** | ä¸»é›†ç¾¤ç®¡ç†ä»é›†ç¾¤ | è¾¹ç¼˜è®¡ç®—åœºæ™¯       | é›†ä¸­æ§åˆ¶ã€è¾¹ç¼˜æ‰§è¡Œ |
| **å¯¹ç­‰é›†ç¾¤** | å¯¹ç­‰å…³ç³»çš„é›†ç¾¤   | å®¹ç¾å¤‡ä»½           | å¯¹ç§°ã€å†—ä½™         |

### 20.2.2 æŠ€æœ¯ç»„ä»¶çŸ©é˜µ

**å¤šé›†ç¾¤ç®¡ç†æŠ€æœ¯ç»„ä»¶çŸ©é˜µ**ï¼š

| ç»„ä»¶ç±»åˆ«     | æŠ€æœ¯                  | å®šä½                | æˆç†Ÿåº¦     | ç”Ÿäº§éªŒè¯   |
| ------------ | --------------------- | ------------------- | ---------- | ---------- |
| **é›†ç¾¤è”é‚¦** | Kubernetes Federation | Kubernetes å®˜æ–¹è”é‚¦ | â­â­â­     | â­â­â­     |
|              | Karmada               | CNCF å¤šé›†ç¾¤ç¼–æ’     | â­â­â­â­â­ | â­â­â­â­â­ |
|              | Clusternet            | å¤šé›†ç¾¤ç®¡ç†          | â­â­â­â­   | â­â­â­â­   |
|              | Rancher Fleet         | Rancher å¤šé›†ç¾¤ç®¡ç†  | â­â­â­â­â­ | â­â­â­â­â­ |
| **æœåŠ¡ç½‘æ ¼** | Istio Multi-Cluster   | Istio å¤šé›†ç¾¤æ”¯æŒ    | â­â­â­â­â­ | â­â­â­â­â­ |
|              | Linkerd Multi-Cluster | Linkerd å¤šé›†ç¾¤      | â­â­â­â­   | â­â­â­â­   |
| **GitOps**   | ArgoCD Multi-Cluster  | ArgoCD å¤šé›†ç¾¤       | â­â­â­â­â­ | â­â­â­â­â­ |
|              | Flux Multi-Cluster    | Flux å¤šé›†ç¾¤         | â­â­â­â­   | â­â­â­â­   |
| **è¾¹ç¼˜ç®¡ç†** | K3s Multi-Cluster     | K3s å¤šé›†ç¾¤ç®¡ç†      | â­â­â­â­â­ | â­â­â­â­â­ |
|              | KubeEdge              | è¾¹ç¼˜è®¡ç®—å¹³å°        | â­â­â­â­   | â­â­â­â­   |

### 20.2.3 æŠ€æœ¯æ ˆç»„åˆ

**å¤šé›†ç¾¤ç®¡ç†æŠ€æœ¯æ ˆç»„åˆæ–¹æ¡ˆ**ï¼š

| åœºæ™¯         | é›†ç¾¤è”é‚¦å·¥å…· | æœåŠ¡ç½‘æ ¼              | GitOps å·¥å…·          | ç‰¹ç‚¹               |
| ------------ | ------------ | --------------------- | -------------------- | ------------------ |
| **å¤šäº‘éƒ¨ç½²** | Karmada      | Istio Multi-Cluster   | ArgoCD Multi-Cluster | ç»Ÿä¸€ç®¡ç†ã€è·¨äº‘éƒ¨ç½² |
| **è¾¹ç¼˜è®¡ç®—** | K3s Fleet    | -                     | Flux                 | è½»é‡çº§ã€è¾¹ç¼˜ä¼˜åŒ–   |
| **æ··åˆæ¶æ„** | Clusternet   | Linkerd Multi-Cluster | ArgoCD               | çµæ´»ã€å¤šåœºæ™¯æ”¯æŒ   |

## 20.3 å¤šé›†ç¾¤æ¶æ„è®¾è®¡

### 20.3.1 å¤šé›†ç¾¤æ¶æ„æ¨¡å¼

**å¤šé›†ç¾¤æ¶æ„æ¨¡å¼**ï¼š

**æ¨¡å¼ 1ï¼šä¸»é›†ç¾¤æ¨¡å¼ï¼ˆHub-Spokeï¼‰**:

```mermaid
graph TB
    A[ä¸»é›†ç¾¤<br/>Hub Cluster] --> B[è¾¹ç¼˜é›†ç¾¤ 1<br/>Edge Cluster 1]
    A --> C[è¾¹ç¼˜é›†ç¾¤ 2<br/>Edge Cluster 2]
    A --> D[è¾¹ç¼˜é›†ç¾¤ N<br/>Edge Cluster N]

    style A fill:#e1f5ff
```

- **ç‰¹ç‚¹**ï¼šä¸»é›†ç¾¤ç®¡ç†å¤šä¸ªè¾¹ç¼˜é›†ç¾¤
- **é€‚ç”¨åœºæ™¯**ï¼šè¾¹ç¼˜è®¡ç®—ã€IoTã€åœ°ç†åˆ†å¸ƒ
- **ä¼˜ç‚¹**ï¼šé›†ä¸­ç®¡ç†ã€ç®€åŒ–é…ç½®
- **ç¼ºç‚¹**ï¼šä¸»é›†ç¾¤å•ç‚¹æ•…éšœé£é™©

**æ¨¡å¼ 2ï¼šè”é‚¦æ¨¡å¼ï¼ˆFederationï¼‰**:

```mermaid
graph TB
    A[è”é‚¦æ§åˆ¶å¹³é¢] --> B[é›†ç¾¤ 1]
    A --> C[é›†ç¾¤ 2]
    A --> D[é›†ç¾¤ N]

    style A fill:#e1f5ff
```

- **ç‰¹ç‚¹**ï¼šè”é‚¦æ§åˆ¶å¹³é¢ç»Ÿä¸€ç®¡ç†
- **é€‚ç”¨åœºæ™¯**ï¼šå¤šäº‘ã€å¤šåŒºåŸŸã€å®¹ç¾
- **ä¼˜ç‚¹**ï¼šç»Ÿä¸€ APIã€é›†ä¸­ç­–ç•¥
- **ç¼ºç‚¹**ï¼šå¤æ‚åº¦é«˜ã€å»¶è¿Ÿå¯èƒ½è¾ƒé«˜

**æ¨¡å¼ 3ï¼šå¯¹ç­‰æ¨¡å¼ï¼ˆPeer-to-Peerï¼‰**:

```mermaid
graph TB
    A[é›†ç¾¤ 1] <--> B[é›†ç¾¤ 2]
    A <--> C[é›†ç¾¤ 3]
    B <--> C

    style A fill:#e1f5ff
    style B fill:#e1f5ff
    style C fill:#e1f5ff
```

- **ç‰¹ç‚¹**ï¼šé›†ç¾¤ä¹‹é—´å¯¹ç­‰å…³ç³»
- **é€‚ç”¨åœºæ™¯**ï¼šå®¹ç¾å¤‡ä»½ã€æ•°æ®åŒæ­¥
- **ä¼˜ç‚¹**ï¼šæ— å•ç‚¹æ•…éšœã€é«˜å¯ç”¨
- **ç¼ºç‚¹**ï¼šç®¡ç†å¤æ‚

### 20.3.2 ç½‘ç»œæ¶æ„

**å¤šé›†ç¾¤ç½‘ç»œæ¶æ„**ï¼š

**ç½‘ç»œè¿æ¥æ–¹å¼**ï¼š

| æ–¹å¼        | è¯´æ˜         | é€‚ç”¨åœºæ™¯         | ç‰¹ç‚¹             |
| ----------- | ------------ | ---------------- | ---------------- |
| **VPN**     | VPN éš§é“è¿æ¥ | å¤šäº‘ã€æ··åˆäº‘     | å®‰å…¨ã€çµæ´»       |
| **ä¸“çº¿**    | ä¸“ç”¨ç½‘ç»œè¿æ¥ | ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨èï¼‰ | ä½å»¶è¿Ÿã€é«˜å¸¦å®½   |
| **Overlay** | è¦†ç›–ç½‘ç»œ     | è·¨äº‘è¿æ¥         | çµæ´»ä½†å¯èƒ½å»¶è¿Ÿé«˜ |
| **å…¬ç½‘**    | å…¬ç½‘è¿æ¥     | æµ‹è¯•ç¯å¢ƒ         | ç®€å•ä½†å®‰å…¨æ€§ä½   |

**ç½‘ç»œæ¶æ„ç¤ºä¾‹**ï¼š

```yaml
å¤šé›†ç¾¤ç½‘ç»œ:
  è¿æ¥æ–¹å¼: VPN / ä¸“çº¿
  ç½‘ç»œç­–ç•¥:
    - è·¨é›†ç¾¤æœåŠ¡å‘ç°
    - è·¨é›†ç¾¤æµé‡è·¯ç”±
    - ç½‘ç»œéš”ç¦»ç­–ç•¥
  å®‰å…¨:
    - mTLS è·¨é›†ç¾¤é€šä¿¡
    - ç½‘ç»œé˜²ç«å¢™è§„åˆ™
```

### 20.3.3 æ•°æ®åŒæ­¥

**å¤šé›†ç¾¤æ•°æ®åŒæ­¥**ï¼š

**åŒæ­¥ç±»å‹**ï¼š

| ç±»å‹         | è¯´æ˜                   | åŒæ­¥é¢‘ç‡  | é€‚ç”¨åœºæ™¯       |
| ------------ | ---------------------- | --------- | -------------- |
| **é…ç½®åŒæ­¥** | åŒæ­¥ ConfigMapã€Secret | å®æ—¶      | é…ç½®ç®¡ç†       |
| **åº”ç”¨åŒæ­¥** | åŒæ­¥åº”ç”¨éƒ¨ç½²           | å®æ—¶/å®šæ—¶ | åº”ç”¨éƒ¨ç½²       |
| **æ•°æ®åŒæ­¥** | åŒæ­¥åº”ç”¨æ•°æ®           | å®æ—¶/å®šæ—¶ | æ•°æ®å¤‡ä»½ã€å®¹ç¾ |
| **çŠ¶æ€åŒæ­¥** | åŒæ­¥é›†ç¾¤çŠ¶æ€           | å®æ—¶      | çŠ¶æ€ç›‘æ§       |

**æ•°æ®åŒæ­¥ç­–ç•¥**ï¼š

```yaml
æ•°æ®åŒæ­¥ç­–ç•¥:
  é…ç½®åŒæ­¥:
    æ–¹å¼: GitOps / è”é‚¦ API
    é¢‘ç‡: å®æ—¶
    å†²çªè§£å†³: ä¸»é›†ç¾¤ä¼˜å…ˆ
  åº”ç”¨åŒæ­¥:
    æ–¹å¼: ArgoCD / Karmada
    é¢‘ç‡: å®æ—¶
    ç­–ç•¥: è“ç»¿ / æ»šåŠ¨
```

## 20.4 é›†ç¾¤è”é‚¦ï¼ˆCluster Federationï¼‰

### 20.4.1 Kubernetes Federation

**Kubernetes Federation å®šä¹‰**ï¼š

Kubernetes Federationï¼ˆKubeFedï¼‰æ˜¯ Kubernetes çš„å®˜æ–¹é›†ç¾¤è”é‚¦å®ç°ï¼Œç°å·²å¼ƒç”¨ï¼Œæ¨è
ä½¿ç”¨ Karmadaã€‚

**KubeFed çŠ¶æ€**ï¼š

- **çŠ¶æ€**ï¼šå·²å¼ƒç”¨ï¼ˆDeprecatedï¼‰
- **æ›¿ä»£æ–¹æ¡ˆ**ï¼šKarmadaã€Clusternet
- **åŸå› **ï¼šç»´æŠ¤æˆæœ¬é«˜ã€åŠŸèƒ½æœ‰é™

### 20.4.2 Karmada

**Karmada å®šä¹‰**ï¼š

Karmada æ˜¯ CNCF å­µåŒ–çš„å¤šé›†ç¾¤ç¼–æ’å¹³å°ï¼Œæä¾›å¤šé›†ç¾¤èµ„æºè°ƒåº¦å’Œåº”ç”¨åˆ†å‘èƒ½åŠ›ã€‚

**Karmada æ¶æ„**ï¼š

```mermaid
graph TB
    A[Karmada Control Plane] --> B[Karmada API Server]
    A --> C[Karmada Controller]
    A --> D[Karmada Scheduler]

    B --> E[æˆå‘˜é›†ç¾¤ 1]
    B --> F[æˆå‘˜é›†ç¾¤ 2]
    B --> G[æˆå‘˜é›†ç¾¤ N]

    style A fill:#e1f5ff
```

**Karmada æ ¸å¿ƒç»„ä»¶**ï¼š

| ç»„ä»¶                           | åŠŸèƒ½            | è¯´æ˜                 |
| ------------------------------ | --------------- | -------------------- |
| **karmada-apiserver**          | ç»Ÿä¸€ API Server | æ¥æ”¶å’Œç®¡ç†å¤šé›†ç¾¤èµ„æº |
| **karmada-controller-manager** | æ§åˆ¶å™¨ç®¡ç†      | èµ„æºåˆ†å‘å’ŒçŠ¶æ€åŒæ­¥   |
| **karmada-scheduler**          | è°ƒåº¦å™¨          | å¤šé›†ç¾¤èµ„æºè°ƒåº¦       |
| **karmada-agent**              | æˆå‘˜é›†ç¾¤ä»£ç†    | éƒ¨ç½²åœ¨æˆå‘˜é›†ç¾¤ä¸­     |

**Karmada æŠ€æœ¯ç‰¹ç‚¹**ï¼š

- **å¤šé›†ç¾¤ç¼–æ’**ï¼šç»Ÿä¸€çš„èµ„æºè°ƒåº¦å’Œåˆ†å‘
- **ç­–ç•¥é©±åŠ¨**ï¼šå£°æ˜å¼ç­–ç•¥ç®¡ç†
- **æ•…éšœè½¬ç§»**ï¼šè‡ªåŠ¨æ•…éšœæ£€æµ‹å’Œè½¬ç§»
- **CNCF å­µåŒ–**ï¼šCNCF é¡¹ç›®ï¼Œç¤¾åŒºæ´»è·ƒ

**Karmada é…ç½®ç¤ºä¾‹**ï¼š

```yaml
# PropagationPolicy - èµ„æºåˆ†å‘ç­–ç•¥
apiVersion: policy.karmada.io/v1alpha1
kind: PropagationPolicy
metadata:
  name: myapp-propagation
spec:
  resourceSelectors:
  - apiVersion: apps/v1
    kind: Deployment
    name: myapp
  placement:
    clusterAffinity:
      clusterNames:
      - cluster1
      - cluster2
    replicaScheduling:
      replicaSchedulingType: Duplicated

# ClusterPropagationPolicy - é›†ç¾¤çº§ç­–ç•¥
apiVersion: policy.karmada.io/v1alpha1
kind: ClusterPropagationPolicy
metadata:
  name: myapp-cluster-propagation
spec:
  resourceSelectors:
  - apiVersion: v1
    kind: ConfigMap
  placement:
    clusterAffinity:
      clusterNames:
      - cluster1
      - cluster2
```

**Karmada åœºæ™¯åˆ†æ**ï¼š

**åœºæ™¯ 1ï¼šå¤šäº‘åº”ç”¨éƒ¨ç½²**:

- **éœ€æ±‚**ï¼šåœ¨å¤šäº‘ç¯å¢ƒä¸­éƒ¨ç½²åº”ç”¨
- **æ–¹æ¡ˆ**ï¼šä½¿ç”¨ Karmada ç»Ÿä¸€è°ƒåº¦å’Œåˆ†å‘
- **ä¼˜ç‚¹**ï¼šç»Ÿä¸€ç®¡ç†ã€è‡ªåŠ¨è°ƒåº¦
- **ç¼ºç‚¹**ï¼šéœ€è¦ç½‘ç»œè¿æ¥

**åœºæ™¯ 2ï¼šå®¹ç¾å¤‡ä»½**:

- **éœ€æ±‚**ï¼šåº”ç”¨è·¨åŒºåŸŸå®¹ç¾å¤‡ä»½
- **æ–¹æ¡ˆ**ï¼šä½¿ç”¨ Karmada å¤šé›†ç¾¤éƒ¨ç½²
- **ä¼˜ç‚¹**ï¼šè‡ªåŠ¨æ•…éšœè½¬ç§»ã€é«˜å¯ç”¨
- **ç¼ºç‚¹**ï¼šèµ„æºæ¶ˆè€—å¢åŠ 

### 20.4.3 Clusternet

**Clusternet å®šä¹‰**ï¼š

Clusternet æ˜¯è…¾è®¯å¼€æºçš„å¤šé›†ç¾¤ç®¡ç†å¹³å°ï¼Œæä¾›é›†ç¾¤æ³¨å†Œã€èµ„æºåˆ†å‘ã€åº”ç”¨éƒ¨ç½²ç­‰åŠŸèƒ½ã€‚

**Clusternet æ¶æ„**ï¼š

```mermaid
graph TB
    A[Parent Cluster] --> B[Clusternet Hub]
    B --> C[Clusternet Agent]

    C --> D[Child Cluster 1]
    C --> E[Child Cluster 2]
    C --> F[Child Cluster N]

    style A fill:#e1f5ff
```

**Clusternet æ ¸å¿ƒç»„ä»¶**ï¼š

| ç»„ä»¶                     | åŠŸèƒ½           | è¯´æ˜                 |
| ------------------------ | -------------- | -------------------- |
| **clusternet-hub**       | ä¸»é›†ç¾¤æ§åˆ¶å¹³é¢ | ç®¡ç†å­é›†ç¾¤å’Œèµ„æºåˆ†å‘ |
| **clusternet-agent**     | å­é›†ç¾¤ä»£ç†     | éƒ¨ç½²åœ¨å­é›†ç¾¤ä¸­       |
| **clusternet-scheduler** | è°ƒåº¦å™¨         | èµ„æºè°ƒåº¦å’Œåˆ†å‘       |

**Clusternet æŠ€æœ¯ç‰¹ç‚¹**ï¼š

- **ä¸»ä»æ¶æ„**ï¼šæ¸…æ™°çš„çˆ¶å­é›†ç¾¤å…³ç³»
- **èµ„æºåˆ†å‘**ï¼šæ”¯æŒå¤šç§èµ„æºåˆ†å‘ç­–ç•¥
- **åº”ç”¨éƒ¨ç½²**ï¼šç»Ÿä¸€çš„åº”ç”¨éƒ¨ç½²æ¥å£
- **è½»é‡çº§**ï¼šç›¸æ¯” Karmada æ›´è½»é‡

## 20.5 è·¨é›†ç¾¤æœåŠ¡å‘ç°

### 20.5.1 æœåŠ¡å‘ç°æ¶æ„

**è·¨é›†ç¾¤æœåŠ¡å‘ç°å®šä¹‰**ï¼š

è·¨é›†ç¾¤æœåŠ¡å‘ç°æ˜¯æŒ‡åœ¨å¤šä¸ªé›†ç¾¤ä¸­å‘ç°å’Œè®¿é—®æœåŠ¡çš„èƒ½åŠ›ã€‚

**æœåŠ¡å‘ç°æ¶æ„**ï¼š

```mermaid
graph TB
    A[é›†ç¾¤ 1] --> B[æœåŠ¡ A]
    C[é›†ç¾¤ 2] --> D[æœåŠ¡ B]

    E[ç»Ÿä¸€æœåŠ¡å‘ç°] --> A
    E --> C

    F[å®¢æˆ·ç«¯] --> E
    F --> B
    F --> D

    style E fill:#e1f5ff
```

**æœåŠ¡å‘ç°æ–¹å¼**ï¼š

| æ–¹å¼            | è¯´æ˜                  | é€‚ç”¨åœºæ™¯        | ç‰¹ç‚¹            |
| --------------- | --------------------- | --------------- | --------------- |
| **DNS è”é‚¦**    | DNS è·¨é›†ç¾¤æœåŠ¡å‘ç°    | æ ‡å‡† Kubernetes | Kubernetes åŸç”Ÿ |
| **æœåŠ¡ç½‘æ ¼**    | Istio/Linkerd å¤šé›†ç¾¤  | æœåŠ¡ç½‘æ ¼ç¯å¢ƒ    | ç»Ÿä¸€æœåŠ¡å‘ç°    |
| **API Gateway** | é€šè¿‡ API Gateway è·¯ç”± | ç»Ÿä¸€å…¥å£        | ç®€åŒ–å®¢æˆ·ç«¯      |
| **è‡ªå®šä¹‰å‘ç°**  | è‡ªå®šä¹‰æœåŠ¡å‘ç°æœºåˆ¶    | ç‰¹å®šåœºæ™¯        | çµæ´»ä½†å¤æ‚      |

### 20.5.2 æœåŠ¡å‘ç°å®ç°

**Istio å¤šé›†ç¾¤æœåŠ¡å‘ç°**ï¼š

```yaml
# ServiceEntry - è·¨é›†ç¾¤æœåŠ¡
apiVersion: networking.istio.io/v1beta1
kind: ServiceEntry
metadata:
  name: external-svc
spec:
  hosts:
    - external.example.com
  location: MESH_EXTERNAL
  ports:
    - number: 80
      name: http
      protocol: HTTP
  resolution: DNS
  endpoints:
    - address: cluster2.example.com
      ports:
        http: 80
```

**DNS è”é‚¦æœåŠ¡å‘ç°**ï¼š

```yaml
# ExternalName Service - è·¨é›†ç¾¤æœåŠ¡
apiVersion: v1
kind: Service
metadata:
  name: cross-cluster-svc
spec:
  type: ExternalName
  externalName: service.cluster2.svc.cluster.local
  ports:
    - port: 80
```

## 20.6 å¤šé›†ç¾¤éƒ¨ç½²ç­–ç•¥

### 20.6.1 åº”ç”¨éƒ¨ç½²ç­–ç•¥

**åº”ç”¨éƒ¨ç½²ç­–ç•¥**ï¼š

| ç­–ç•¥         | è¯´æ˜                   | é€‚ç”¨åœºæ™¯ | ç‰¹ç‚¹               |
| ------------ | ---------------------- | -------- | ------------------ |
| **å®Œå…¨å¤åˆ¶** | æ‰€æœ‰é›†ç¾¤éƒ¨ç½²ç›¸åŒåº”ç”¨   | å®¹ç¾å¤‡ä»½ | é«˜å¯ç”¨ã€èµ„æºæ¶ˆè€—å¤§ |
| **éƒ¨åˆ†å¤åˆ¶** | éƒ¨åˆ†é›†ç¾¤éƒ¨ç½²åº”ç”¨       | åœ°ç†åˆ†å¸ƒ | èµ„æºä¼˜åŒ–ã€å»¶è¿Ÿä½   |
| **æŒ‰éœ€éƒ¨ç½²** | æ ¹æ®éœ€æ±‚éƒ¨ç½²           | åŠ¨æ€è´Ÿè½½ | çµæ´»ã€å¤æ‚         |
| **ä¸»ä»éƒ¨ç½²** | ä¸»é›†ç¾¤éƒ¨ç½²ï¼Œä»é›†ç¾¤å¤‡ä»½ | ä¸»å¤‡æ¨¡å¼ | èµ„æºèŠ‚çœã€åˆ‡æ¢å¤æ‚ |

**åº”ç”¨éƒ¨ç½²ç­–ç•¥å†³ç­–æ ‘**ï¼š

```yaml
åº”ç”¨éƒ¨ç½²ç­–ç•¥:
  if éœ€è¦é«˜å¯ç”¨å’Œå®¹ç¾:
    ä½¿ç”¨: å®Œå…¨å¤åˆ¶
  elif éœ€è¦åœ°ç†åˆ†å¸ƒä¼˜åŒ–:
    ä½¿ç”¨: éƒ¨åˆ†å¤åˆ¶
  elif éœ€è¦åŠ¨æ€è´Ÿè½½å‡è¡¡:
    ä½¿ç”¨: æŒ‰éœ€éƒ¨ç½²
  else:
    ä½¿ç”¨: ä¸»ä»éƒ¨ç½²
```

### 20.6.2 é…ç½®ç®¡ç†ç­–ç•¥

**é…ç½®ç®¡ç†ç­–ç•¥**ï¼š

1. **é›†ä¸­ç®¡ç†**ï¼šåœ¨ä¸»é›†ç¾¤é›†ä¸­ç®¡ç†é…ç½®
2. **åˆ†å¸ƒç®¡ç†**ï¼šå„é›†ç¾¤ç‹¬ç«‹ç®¡ç†é…ç½®
3. **GitOps ç®¡ç†**ï¼šä½¿ç”¨ GitOps å·¥å…·ç»Ÿä¸€ç®¡ç†

**GitOps å¤šé›†ç¾¤é…ç½®ç®¡ç†**ï¼š

```yaml
# ArgoCD ApplicationSet - å¤šé›†ç¾¤åº”ç”¨
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: myapp
spec:
  generators:
    - clusters:
        selector:
          matchLabels:
            environment: production
  template:
    metadata:
      name: "{{name}}-myapp"
    spec:
      project: default
      source:
        repoURL: https://github.com/example/myapp
        targetRevision: main
        path: kustomize/overlays/production
      destination:
        server: "{{server}}"
        namespace: production
      syncPolicy:
        automated:
          prune: true
          selfHeal: true
```

### 20.6.3 æ•°æ®åŒæ­¥ç­–ç•¥

**æ•°æ®åŒæ­¥ç­–ç•¥**ï¼š

1. **å®æ—¶åŒæ­¥**ï¼šé…ç½®å’ŒçŠ¶æ€å®æ—¶åŒæ­¥
2. **å®šæ—¶åŒæ­¥**ï¼šæ•°æ®å®šæ—¶åŒæ­¥
3. **äº‹ä»¶é©±åŠ¨**ï¼šåŸºäºäº‹ä»¶è§¦å‘åŒæ­¥

## 20.7 è¾¹ç¼˜é›†ç¾¤ç®¡ç†ï¼ˆK3s å¤šé›†ç¾¤ï¼‰

### 20.7.1 K3s å¤šé›†ç¾¤æ¶æ„

> **ğŸ’¡ éš”ç¦»å±‚æ¬¡å…³è”**ï¼šK3s å¤šé›†ç¾¤ç®¡ç†æ¶‰åŠ L-3 å®¹å™¨åŒ–å±‚ï¼ˆcontainerdï¼‰å’Œ L-4 æ²™ç›’
> åŒ–å±‚ï¼ˆWasmEdgeï¼‰ï¼Œä¸åŒé›†ç¾¤å¯ä»¥ä½¿ç”¨ä¸åŒçš„è¿è¡Œæ—¶ã€‚è¯¦ç»†çš„æŠ€æœ¯è§£æè¯·å‚è€ƒï¼š
>
> - **[29. éš”ç¦»æ ˆ](../29-isolation-stack/isolation-stack.md)** - å®Œæ•´çš„éš”ç¦»æ ˆæŠ€
>   æœ¯è§£æ
> - **[L-3 å®¹å™¨åŒ–å±‚](../29-isolation-stack/layers/L-3-containerization.md)** -
>   containerd è¯¦ç»†æ–‡æ¡£
> - **[L-4 æ²™ç›’åŒ–å±‚](../29-isolation-stack/layers/L-4-sandboxing.md)** -
>   WasmEdge è¯¦ç»†æ–‡æ¡£ï¼ˆK3s æ”¯æŒï¼‰
> - **[éš”ç¦»å±‚æ¬¡å¯¹æ¯”æ–‡æ¡£](../29-isolation-stack/layers/isolation-comparison.md)** -
>   è¿è¡Œæ—¶æ€§èƒ½å¯¹æ¯”å’ŒæŠ€æœ¯é€‰å‹

**K3s å¤šé›†ç¾¤æ¶æ„**ï¼š

K3s æ”¯æŒé€šè¿‡ Rancher Fleet æˆ–å…¶ä»–å·¥å…·ç®¡ç†å¤šä¸ª K3s é›†ç¾¤ã€‚

**K3s å¤šé›†ç¾¤æ¨¡å¼**ï¼š

| æ¨¡å¼           | è¯´æ˜                    | é€‚ç”¨åœºæ™¯     |
| -------------- | ----------------------- | ------------ |
| **Fleet ç®¡ç†** | ä½¿ç”¨ Rancher Fleet ç®¡ç† | Rancher ç”Ÿæ€ |
| **ç‹¬ç«‹ç®¡ç†**   | å„é›†ç¾¤ç‹¬ç«‹ç®¡ç†          | ç®€å•åœºæ™¯     |
| **è”é‚¦æ¨¡å¼**   | é€šè¿‡è”é‚¦å·¥å…·ç®¡ç†        | å¤æ‚åœºæ™¯     |

### 20.7.2 K3s é›†ç¾¤é—´é€šä¿¡

**K3s é›†ç¾¤é—´é€šä¿¡**ï¼š

- **VPN è¿æ¥**ï¼šé€šè¿‡ VPN è¿æ¥å„é›†ç¾¤
- **å…¬ç½‘è¿æ¥**ï¼šé€šè¿‡å…¬ç½‘è¿æ¥ï¼ˆéœ€è¦å®‰å…¨é…ç½®ï¼‰
- **ä¸“çº¿è¿æ¥**ï¼šé€šè¿‡ä¸“çº¿è¿æ¥ï¼ˆæ¨èï¼‰

### 20.7.3 è¾¹ç¼˜é›†ç¾¤ç®¡ç†

**è¾¹ç¼˜é›†ç¾¤ç®¡ç†ç­–ç•¥**ï¼š

1. **é›†ä¸­ç®¡ç†**ï¼šé€šè¿‡ä¸»é›†ç¾¤ç®¡ç†è¾¹ç¼˜é›†ç¾¤
2. **ç¦»çº¿æ”¯æŒ**ï¼šè¾¹ç¼˜é›†ç¾¤æ”¯æŒç¦»çº¿è¿è¡Œ
3. **è‡ªåŠ¨åŒæ­¥**ï¼šè¾¹ç¼˜é›†ç¾¤è‡ªåŠ¨åŒæ­¥é…ç½®å’Œåº”ç”¨

## 20.8 å¤šé›†ç¾¤åœºæ™¯åˆ†æ

### 20.8.1 å¤šäº‘éƒ¨ç½²åœºæ™¯

**åœºæ™¯æè¿°**ï¼šåº”ç”¨éƒ¨ç½²åœ¨å¤šä¸ªäº‘å¹³å°ï¼Œå®ç°å¤šäº‘å®¹ç¾å’Œä¼˜åŒ–

**æŒ‘æˆ˜åˆ†æ**ï¼š

1. **ç½‘ç»œè¿é€š**ï¼šè·¨äº‘ç½‘ç»œè¿æ¥
2. **æœåŠ¡å‘ç°**ï¼šè·¨äº‘æœåŠ¡å‘ç°
3. **æ•°æ®åŒæ­¥**ï¼šè·¨äº‘æ•°æ®åŒæ­¥
4. **ç»Ÿä¸€ç®¡ç†**ï¼šç»Ÿä¸€ç®¡ç†æ¥å£

**è§£å†³æ–¹æ¡ˆ**ï¼š

```yaml
å¤šäº‘éƒ¨ç½²æ–¹æ¡ˆ:
  é›†ç¾¤è”é‚¦: Karmada
  æœåŠ¡ç½‘æ ¼: Istio Multi-Cluster
  GitOps: ArgoCD Multi-Cluster
  ç½‘ç»œ: VPN / ä¸“çº¿
  ç‰¹ç‚¹:
    - ç»Ÿä¸€ç®¡ç†
    - è·¨äº‘æœåŠ¡å‘ç°
    - è‡ªåŠ¨æ•…éšœè½¬ç§»
```

### 20.8.2 åœ°ç†åˆ†å¸ƒåœºæ™¯

**åœºæ™¯æè¿°**ï¼šåº”ç”¨éƒ¨ç½²åœ¨ä¸åŒåœ°ç†ä½ç½®çš„é›†ç¾¤ï¼Œå®ç°ä½å»¶è¿Ÿè®¿é—®

**æŒ‘æˆ˜åˆ†æ**ï¼š

1. **å»¶è¿Ÿä¼˜åŒ–**ï¼šå°±è¿‘è®¿é—®ï¼Œé™ä½å»¶è¿Ÿ
2. **æ•°æ®ä¸€è‡´æ€§**ï¼šè·¨åŒºåŸŸæ•°æ®ä¸€è‡´æ€§
3. **æµé‡è·¯ç”±**ï¼šæ™ºèƒ½æµé‡è·¯ç”±

**è§£å†³æ–¹æ¡ˆ**ï¼š

```yaml
åœ°ç†åˆ†å¸ƒæ–¹æ¡ˆ:
  é›†ç¾¤è”é‚¦: Karmada
  éƒ¨ç½²ç­–ç•¥: éƒ¨åˆ†å¤åˆ¶
  æµé‡è·¯ç”±: åŸºäºåœ°ç†ä½ç½®
  ç‰¹ç‚¹:
    - ä½å»¶è¿Ÿ
    - é«˜å¯ç”¨
    - èµ„æºä¼˜åŒ–
```

### 20.8.3 è¾¹ç¼˜è®¡ç®—åœºæ™¯

**åœºæ™¯æè¿°**ï¼šè¾¹ç¼˜ç¯å¢ƒéƒ¨ç½²å¤šä¸ª K3s é›†ç¾¤ï¼Œé›†ä¸­ç®¡ç†

**æŒ‘æˆ˜åˆ†æ**ï¼š

1. **èµ„æºå—é™**ï¼šè¾¹ç¼˜èŠ‚ç‚¹èµ„æºæœ‰é™
2. **ç½‘ç»œä¸ç¨³å®š**ï¼šç½‘ç»œè¿æ¥å¯èƒ½ä¸ç¨³å®š
3. **ç¦»çº¿èƒ½åŠ›**ï¼šéœ€è¦ç¦»çº¿è¿è¡Œèƒ½åŠ›

**è§£å†³æ–¹æ¡ˆ**ï¼š

```yaml
è¾¹ç¼˜è®¡ç®—æ–¹æ¡ˆ:
  é›†ç¾¤: K3s
  ç®¡ç†å·¥å…·: Rancher Fleet / Karmada
  ç‰¹ç‚¹:
    - è½»é‡çº§
    - ç¦»çº¿æ”¯æŒ
    - é›†ä¸­ç®¡ç†
```

## 20.9 å¤šé›†ç¾¤æŠ€æœ¯æ ˆç»„åˆæ–¹æ¡ˆ

### 20.9.1 å¤šäº‘ç»„åˆ

**å¤šäº‘å¤šé›†ç¾¤ç»„åˆ**ï¼š

| ç»„ä»¶         | æŠ€æœ¯                 | è¯´æ˜           |
| ------------ | -------------------- | -------------- |
| **é›†ç¾¤è”é‚¦** | Karmada              | å¤šé›†ç¾¤ç¼–æ’     |
| **æœåŠ¡ç½‘æ ¼** | Istio Multi-Cluster  | è·¨é›†ç¾¤æœåŠ¡é€šä¿¡ |
| **GitOps**   | ArgoCD Multi-Cluster | ç»Ÿä¸€åº”ç”¨éƒ¨ç½²   |
| **ç½‘ç»œ**     | VPN / ä¸“çº¿           | è·¨äº‘ç½‘ç»œè¿æ¥   |

### 20.9.2 è¾¹ç¼˜ç»„åˆ

**è¾¹ç¼˜å¤šé›†ç¾¤ç»„åˆ**ï¼š

| ç»„ä»¶         | æŠ€æœ¯          | è¯´æ˜              |
| ------------ | ------------- | ----------------- |
| **é›†ç¾¤**     | K3s           | è½»é‡çº§ Kubernetes |
| **ç®¡ç†å·¥å…·** | Rancher Fleet | å¤šé›†ç¾¤ç®¡ç†        |
| **GitOps**   | Flux          | è½»é‡çº§ GitOps     |
| **ç½‘ç»œ**     | VPN / å…¬ç½‘    | é›†ç¾¤é—´é€šä¿¡        |

### 20.9.3 æ··åˆç»„åˆ

**æ··åˆå¤šé›†ç¾¤ç»„åˆ**ï¼š

| ç»„ä»¶         | æŠ€æœ¯                  | è¯´æ˜             |
| ------------ | --------------------- | ---------------- |
| **é›†ç¾¤è”é‚¦** | Clusternet            | çµæ´»çš„å¤šé›†ç¾¤ç®¡ç† |
| **æœåŠ¡ç½‘æ ¼** | Linkerd Multi-Cluster | è½»é‡çº§æœåŠ¡ç½‘æ ¼   |
| **GitOps**   | ArgoCD                | ç»Ÿä¸€åº”ç”¨éƒ¨ç½²     |

## 20.10 å¤šé›†ç¾¤ç®¡ç†æœ€ä½³å®è·µ

### 20.10.1 é›†ç¾¤è§„åˆ’

**é›†ç¾¤è§„åˆ’æœ€ä½³å®è·µ**ï¼š

1. **æ˜ç¡®ç›®æ ‡**ï¼šæ˜ç¡®å¤šé›†ç¾¤çš„ç›®æ ‡å’Œéœ€æ±‚
2. **æ¶æ„è®¾è®¡**ï¼šè®¾è®¡åˆé€‚çš„å¤šé›†ç¾¤æ¶æ„
3. **ç½‘ç»œè§„åˆ’**ï¼šè§„åˆ’é›†ç¾¤é—´ç½‘ç»œè¿æ¥
4. **èµ„æºè§„åˆ’**ï¼šè§„åˆ’å„é›†ç¾¤çš„èµ„æºåˆ†é…

### 20.10.2 ç½‘ç»œé…ç½®

**ç½‘ç»œé…ç½®æœ€ä½³å®è·µ**ï¼š

1. **å®‰å…¨è¿æ¥**ï¼šä½¿ç”¨ VPN æˆ–ä¸“çº¿è¿æ¥
2. **ç½‘ç»œç­–ç•¥**ï¼šé…ç½®è·¨é›†ç¾¤ç½‘ç»œç­–ç•¥
3. **æœåŠ¡å‘ç°**ï¼šé…ç½®è·¨é›†ç¾¤æœåŠ¡å‘ç°
4. **ç›‘æ§ç½‘ç»œ**ï¼šç›‘æ§è·¨é›†ç¾¤ç½‘ç»œçŠ¶æ€

### 20.10.3 åº”ç”¨éƒ¨ç½²

**åº”ç”¨éƒ¨ç½²æœ€ä½³å®è·µ**ï¼š

1. **ç»Ÿä¸€é…ç½®**ï¼šä½¿ç”¨ GitOps ç»Ÿä¸€ç®¡ç†é…ç½®
2. **æ¸è¿›éƒ¨ç½²**ï¼šé€æ­¥æ‰©å±•å¤šé›†ç¾¤éƒ¨ç½²
3. **ç›‘æ§éªŒè¯**ï¼šéƒ¨ç½²åéªŒè¯åŠŸèƒ½
4. **æ•…éšœè½¬ç§»**ï¼šé…ç½®è‡ªåŠ¨æ•…éšœè½¬ç§»

## 20.11 å®é™…éƒ¨ç½²æ¡ˆä¾‹

### 20.11.1 æ¡ˆä¾‹ 1ï¼šKarmada å¤šé›†ç¾¤è”é‚¦éƒ¨ç½²

**åœºæ™¯**ï¼šä½¿ç”¨ Karmada ç®¡ç† 3 ä¸ª Kubernetes é›†ç¾¤ï¼ˆ2 ä¸ªäº‘ç«¯ + 1 ä¸ªè¾¹ç¼˜ï¼‰

**éƒ¨ç½²æ­¥éª¤**ï¼š

```bash
# 1. å®‰è£… Karmada Control Plane
kubectl create namespace karmada-system
helm repo add karmada https://charts.karmada.io
helm install karmada karmada/karmada \
  --namespace karmada-system \
  --create-namespace

# 2. æ³¨å†Œæˆå‘˜é›†ç¾¤
# é›†ç¾¤ 1ï¼šäº‘ç«¯ç”Ÿäº§é›†ç¾¤
karmadactl join member-cluster-1 \
  --karmada-context=karmada-apiserver \
  --cluster-kubeconfig=/path/to/cluster1-kubeconfig

# é›†ç¾¤ 2ï¼šäº‘ç«¯æµ‹è¯•é›†ç¾¤
karmadactl join member-cluster-2 \
  --karmada-context=karmada-apiserver \
  --cluster-kubeconfig=/path/to/cluster2-kubeconfig

# é›†ç¾¤ 3ï¼šè¾¹ç¼˜é›†ç¾¤ï¼ˆK3sï¼‰
karmadactl join edge-cluster \
  --karmada-context=karmada-apiserver \
  --cluster-kubeconfig=/path/to/edge-kubeconfig

# 3. éªŒè¯é›†ç¾¤æ³¨å†Œ
karmadactl get clusters --karmada-context=karmada-apiserver
```

**éƒ¨ç½²åº”ç”¨åˆ°å¤šé›†ç¾¤**ï¼š

```yaml
# myapp-deployment.yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: myapp
spec:
  replicas: 3
  selector:
    matchLabels:
      app: myapp
  template:
    metadata:
      labels:
        app: myapp
    spec:
      containers:
        - name: app
          image: myregistry.com/myapp:v1.0.0
---
# PropagationPolicy
apiVersion: policy.karmada.io/v1alpha1
kind: PropagationPolicy
metadata:
  name: myapp-propagation
spec:
  resourceSelectors:
    - apiVersion: apps/v1
      kind: Deployment
      name: myapp
  placement:
    clusterAffinity:
      clusterNames:
        - member-cluster-1
        - member-cluster-2
    replicaScheduling:
      replicaDivisionPreference: Weighted
      replicaSchedulingType: Divided
      weightPreference:
        staticWeightList:
          - targetCluster:
              clusterNames:
                - member-cluster-1
            weight: 2
          - targetCluster:
              clusterNames:
                - member-cluster-2
            weight: 1
```

### 20.11.2 æ¡ˆä¾‹ 2ï¼šRancher Fleet è¾¹ç¼˜é›†ç¾¤ç®¡ç†

**åœºæ™¯**ï¼šä½¿ç”¨ Rancher Fleet ç®¡ç† 100+ è¾¹ç¼˜ K3s é›†ç¾¤

**éƒ¨ç½²æ­¥éª¤**ï¼š

```bash
# 1. åœ¨ä¸»é›†ç¾¤å®‰è£… Fleet
helm repo add fleet https://charts.rancher.io
helm install fleet fleet/fleet \
  --namespace fleet-system \
  --create-namespace

# 2. åˆ›å»º GitRepo
kubectl apply -f - <<EOF
apiVersion: fleet.cattle.io/v1alpha1
kind: GitRepo
metadata:
  name: edge-apps
  namespace: fleet-default
spec:
  repo: https://github.com/example/edge-apps.git
  branch: main
  paths:
    - apps/**
EOF

# 3. è¾¹ç¼˜é›†ç¾¤è‡ªåŠ¨æ³¨å†Œ
# Fleet ä¼šè‡ªåŠ¨å‘ç°å¹¶æ³¨å†Œ K3s é›†ç¾¤
```

**Fleet é…ç½®ç¤ºä¾‹**ï¼š

```yaml
# apps/myapp/fleet.yaml
namespace: default
helm:
  chart: myapp
  repo: https://charts.example.com
  version: 1.0.0
  values:
    replicaCount: 1
---
# apps/myapp/cluster-group.yaml
apiVersion: fleet.cattle.io/v1alpha1
kind: ClusterGroup
metadata:
  name: edge-clusters
spec:
  selector:
    matchLabels:
      environment: edge
---
# apps/myapp/bundle.yaml
apiVersion: fleet.cattle.io/v1alpha1
kind: Bundle
metadata:
  name: myapp-edge
spec:
  targets:
    - clusterGroup: edge-clusters
      namespace: default
```

### 20.11.3 æ¡ˆä¾‹ 3ï¼šè·¨é›†ç¾¤æœåŠ¡å‘ç°ï¼ˆIstio Multi-Clusterï¼‰

**åœºæ™¯**ï¼šä½¿ç”¨ Istio å®ç°è·¨é›†ç¾¤æœåŠ¡å‘ç°å’Œæµé‡ç®¡ç†

**éƒ¨ç½²æ­¥éª¤**ï¼š

```bash
# 1. åœ¨æ¯ä¸ªé›†ç¾¤å®‰è£… Istio
istioctl install --set values.global.multiCluster.clusterName=cluster1

# 2. é…ç½®é›†ç¾¤é—´ç½‘ç»œ
# åˆ›å»º Secret åŒ…å«è¿œç¨‹é›†ç¾¤çš„ kubeconfig
istioctl create-remote-secret \
  --name=cluster2 \
  --kubeconfig=/path/to/cluster2-kubeconfig \
  | kubectl apply -f -

# 3. é…ç½®æœåŠ¡å‘ç°
# åœ¨æ¯ä¸ªé›†ç¾¤åˆ›å»º ServiceEntry
kubectl apply -f - <<EOF
apiVersion: networking.istio.io/v1beta1
kind: ServiceEntry
metadata:
  name: myapp-cluster2
spec:
  hosts:
    - myapp.cluster2.svc.cluster.local
  ports:
    - number: 8080
      name: http
      protocol: HTTP
  resolution: DNS
  location: MESH_INTERNAL
EOF
```

**è·¨é›†ç¾¤æµé‡è·¯ç”±**ï¼š

```yaml
# VirtualService for cross-cluster routing
apiVersion: networking.istio.io/v1beta1
kind: VirtualService
metadata:
  name: myapp
spec:
  hosts:
    - myapp.example.com
  http:
    - match:
        - headers:
            x-cluster:
              exact: cluster2
      route:
        - destination:
            host: myapp.cluster2.svc.cluster.local
            port:
              number: 8080
    - route:
        - destination:
            host: myapp.cluster1.svc.cluster.local
            port:
              number: 8080
          weight: 70
        - destination:
            host: myapp.cluster2.svc.cluster.local
            port:
              number: 8080
          weight: 30
```

### 20.11.4 æ¡ˆä¾‹ 4ï¼šArgoCD å¤šé›†ç¾¤åº”ç”¨éƒ¨ç½²

**åœºæ™¯**ï¼šä½¿ç”¨ ArgoCD åœ¨å¤šä¸ªé›†ç¾¤ä¸­éƒ¨ç½²åº”ç”¨

**éƒ¨ç½²æ­¥éª¤**ï¼š

```bash
# 1. åœ¨ä¸»é›†ç¾¤å®‰è£… ArgoCD
kubectl create namespace argocd
kubectl apply -n argocd -f https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml

# 2. æ·»åŠ è¿œç¨‹é›†ç¾¤
argocd cluster add cluster2-context \
  --name cluster2 \
  --kubeconfig=/path/to/cluster2-kubeconfig

# 3. åˆ›å»º ApplicationSet è‡ªåŠ¨éƒ¨ç½²åˆ°å¤šé›†ç¾¤
kubectl apply -f - <<EOF
apiVersion: argoproj.io/v1alpha1
kind: ApplicationSet
metadata:
  name: myapp
  namespace: argocd
spec:
  generators:
    - clusters:
        selector:
          matchLabels:
            environment: production
  template:
    metadata:
      name: "{{name}}-myapp"
    spec:
      project: default
      source:
        repoURL: https://github.com/example/gitops-repo.git
        targetRevision: main
        path: apps/myapp
      destination:
        server: "{{server}}"
        namespace: default
      syncPolicy:
        automated:
          prune: true
          selfHeal: true
EOF
```

## 20.12 å¤šé›†ç¾¤æ£€æŸ¥æ¸…å•

**é›†ç¾¤è”é‚¦æ£€æŸ¥**ï¼š

- [ ] é›†ç¾¤è”é‚¦ç»„ä»¶å·²æ­£ç¡®å®‰è£…ï¼ˆKarmada/Clusternetï¼‰
- [ ] æ§åˆ¶å¹³é¢é›†ç¾¤æ­£å¸¸è¿è¡Œ
- [ ] æˆå‘˜é›†ç¾¤å·²æˆåŠŸæ³¨å†Œ
- [ ] é›†ç¾¤é—´ç½‘ç»œè¿é€šæ€§æ­£å¸¸
- [ ] é›†ç¾¤è®¤è¯å’Œæˆæƒé…ç½®æ­£ç¡®

**å¤šé›†ç¾¤ç½‘ç»œæ£€æŸ¥**ï¼š

- [ ] è·¨é›†ç¾¤ç½‘ç»œæ¶æ„å·²é…ç½®
- [ ] æœåŠ¡å‘ç°é…ç½®å®Œæˆï¼ˆIstio/Service Meshï¼‰
- [ ] è·¨é›†ç¾¤æœåŠ¡å¯ä»¥æ­£å¸¸è®¿é—®
- [ ] ç½‘ç»œç­–ç•¥é…ç½®æ­£ç¡®
- [ ] è´Ÿè½½å‡è¡¡é…ç½®åˆç†

**åº”ç”¨éƒ¨ç½²æ£€æŸ¥**ï¼š

- [ ] å¤šé›†ç¾¤éƒ¨ç½²ç­–ç•¥å·²é…ç½®ï¼ˆPropagationPolicy/PlacementPolicyï¼‰
- [ ] åº”ç”¨å¯ä»¥æ­£å¸¸åˆ†å‘åˆ°æˆå‘˜é›†ç¾¤
- [ ] åº”ç”¨é…ç½®åŒæ­¥æ­£å¸¸
- [ ] åº”ç”¨çŠ¶æ€ç›‘æ§æ­£å¸¸
- [ ] åº”ç”¨æ•…éšœè½¬ç§»æœºåˆ¶å·²æµ‹è¯•

**è¾¹ç¼˜é›†ç¾¤ç®¡ç†æ£€æŸ¥**ï¼š

- [ ] è¾¹ç¼˜é›†ç¾¤å·²æ³¨å†Œåˆ°ç®¡ç†å¹³å°ï¼ˆRancher Fleetï¼‰
- [ ] GitOps é…ç½®åŒæ­¥æ­£å¸¸
- [ ] è¾¹ç¼˜é›†ç¾¤åº”ç”¨éƒ¨ç½²æ­£å¸¸
- [ ] è¾¹ç¼˜é›†ç¾¤çŠ¶æ€ç›‘æ§æ­£å¸¸
- [ ] è¾¹ç¼˜é›†ç¾¤ç¦»çº¿å¤„ç†ç­–ç•¥å·²é…ç½®

**å¤šé›†ç¾¤å®‰å…¨æ£€æŸ¥**ï¼š

- [ ] é›†ç¾¤é—´è®¤è¯é…ç½®å®‰å…¨
- [ ] é›†ç¾¤é—´é€šä¿¡åŠ å¯†ï¼ˆmTLSï¼‰
- [ ] å¤šé›†ç¾¤è®¿é—®æ§åˆ¶ç­–ç•¥å·²å®æ–½
- [ ] å¤šé›†ç¾¤å®¡è®¡æ—¥å¿—æ­£å¸¸è®°å½•
- [ ] å¤šé›†ç¾¤å¯†é’¥ç®¡ç†å®‰å…¨

**å¤šé›†ç¾¤ç›‘æ§æ£€æŸ¥**ï¼š

- [ ] å¤šé›†ç¾¤æŒ‡æ ‡æ­£å¸¸æ”¶é›†
- [ ] å¤šé›†ç¾¤æ—¥å¿—æ­£å¸¸èšåˆ
- [ ] å¤šé›†ç¾¤å‘Šè­¦è§„åˆ™å·²é…ç½®
- [ ] å¤šé›†ç¾¤æ€§èƒ½ç›‘æ§å®Œæˆ
- [ ] å¤šé›†ç¾¤å¥åº·æ£€æŸ¥æ­£å¸¸

---

## 20.13 å¤šé›†ç¾¤æ•…éšœæ’æŸ¥

### 20.13.1 å¸¸è§é—®é¢˜

**é—®é¢˜ 1ï¼šé›†ç¾¤æ— æ³•åŠ å…¥è”é‚¦**:

```bash
# æ£€æŸ¥ç½‘ç»œè¿æ¥
ping <cluster-api-server>

# æ£€æŸ¥ kubeconfig
kubectl --kubeconfig=/path/to/cluster-kubeconfig get nodes

# æ£€æŸ¥é›†ç¾¤çŠ¶æ€
karmadactl get clusters --karmada-context=karmada-apiserver

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯
karmadactl describe cluster <cluster-name> --karmada-context=karmada-apiserver
```

**é—®é¢˜ 2ï¼šè·¨é›†ç¾¤æœåŠ¡æ— æ³•è®¿é—®**:

```bash
# æ£€æŸ¥æœåŠ¡å‘ç°é…ç½®
kubectl get serviceentry -A

# æ£€æŸ¥ VirtualService
kubectl get virtualservice -A

# æ£€æŸ¥ç½‘ç»œç­–ç•¥
kubectl get networkpolicies -A

# æµ‹è¯•è·¨é›†ç¾¤è¿æ¥
kubectl run test-pod --image=busybox --rm -it -- \
  wget -O- http://service.cluster2.svc.cluster.local:8080
```

**é—®é¢˜ 3ï¼šåº”ç”¨æ— æ³•åˆ†å‘åˆ°æˆå‘˜é›†ç¾¤**:

```bash
# æ£€æŸ¥ PropagationPolicy
kubectl get propagationpolicy -A

# æ£€æŸ¥åº”ç”¨çŠ¶æ€
karmadactl get deployment myapp --karmada-context=karmada-apiserver

# æ£€æŸ¥æˆå‘˜é›†ç¾¤çŠ¶æ€
kubectl get deployment myapp -n default --context=member-cluster-1

# æŸ¥çœ‹è¯¦ç»†äº‹ä»¶
kubectl describe propagationpolicy myapp-propagation --karmada-context=karmada-apiserver
```

**é—®é¢˜ 4ï¼šFleet æ— æ³•åŒæ­¥åˆ°è¾¹ç¼˜é›†ç¾¤**:

```bash
# æ£€æŸ¥ GitRepo çŠ¶æ€
kubectl get gitrepo -n fleet-default

# æ£€æŸ¥ Bundle çŠ¶æ€
kubectl get bundle -n fleet-default

# æ£€æŸ¥è¾¹ç¼˜é›†ç¾¤çŠ¶æ€
kubectl get clusters -n fleet-default

# æŸ¥çœ‹ Fleet æ—¥å¿—
kubectl logs -n fleet-system deployment/fleet-controller -f
```

## 20.14 å‚è€ƒ

### 20.14.1 éš”ç¦»æ ˆç›¸å…³æ–‡æ¡£

- **[29. éš”ç¦»æ ˆ](../29-isolation-stack/isolation-stack.md)** - å®Œæ•´çš„éš”ç¦»æ ˆæŠ€æœ¯
  è§£æï¼ŒåŒ…æ‹¬å¤šé›†ç¾¤è¿è¡Œæ—¶
- **[L-3 å®¹å™¨åŒ–å±‚](../29-isolation-stack/layers/L-3-containerization.md)** -
  containerd è¯¦ç»†æ–‡æ¡£
- **[L-4 æ²™ç›’åŒ–å±‚](../29-isolation-stack/layers/L-4-sandboxing.md)** - WasmEdge
  è¯¦ç»†æ–‡æ¡£ï¼ˆK3s æ”¯æŒï¼‰
- **[éš”ç¦»å±‚æ¬¡å¯¹æ¯”æ–‡æ¡£](../29-isolation-stack/layers/isolation-comparison.md)** -
  è¿è¡Œæ—¶æ€§èƒ½å¯¹æ¯”å’ŒæŠ€æœ¯é€‰å‹

### 20.14.2 å¤šé›†ç¾¤ç›¸å…³æ–‡æ¡£

- **[01. Kubernetes](../01-kubernetes/kubernetes.md)** - Kubernetes è¯¦ç»†æ–‡æ¡£
- **[02. K3s](../02-k3s/k3s.md)** - K3s è¯¦ç»†æ–‡æ¡£
- **[17. GitOps å’ŒæŒç»­äº¤ä»˜](../17-gitops-cicd/gitops-cicd.md)** - GitOps å’Œ
  CI/CD æ–‡æ¡£
- **[19. æœåŠ¡ç½‘æ ¼](../19-service-mesh/service-mesh.md)** - æœåŠ¡ç½‘æ ¼æ–‡æ¡£ï¼ˆè·¨é›†ç¾¤
  æœåŠ¡å‘ç°ï¼‰

### 20.14.3 å¤–éƒ¨å‚è€ƒ

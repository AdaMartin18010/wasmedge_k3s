# 09. å®‰å…¨ä¸åˆè§„ï¼šé›¶ä¿¡ä»»ã€é•œåƒç­¾åã€ç­–ç•¥æ²»ç†

## ğŸ“‘ ç›®å½•

- [ğŸ“‘ ç›®å½•](#-ç›®å½•)
- [09.1 æ–‡æ¡£å®šä½](#091-æ–‡æ¡£å®šä½)
- [09.2 é›¶ä¿¡ä»»æ¶æ„](#092-é›¶ä¿¡ä»»æ¶æ„)
  - [09.2.1 é›¶ä¿¡ä»»æ¦‚å¿µ](#0921-é›¶ä¿¡ä»»æ¦‚å¿µ)
  - [09.2.2 é›¶ä¿¡ä»»åŸåˆ™](#0922-é›¶ä¿¡ä»»åŸåˆ™)
  - [09.2.3 é›¶ä¿¡ä»»å®ç°](#0923-é›¶ä¿¡ä»»å®ç°)
- [09.3 é•œåƒç­¾åä¸éªŒè¯](#093-é•œåƒç­¾åä¸éªŒè¯)
  - [09.3.1 é•œåƒç­¾åæ–¹æ¡ˆ](#0931-é•œåƒç­¾åæ–¹æ¡ˆ)
  - [09.3.2 ç­¾åéªŒè¯æµç¨‹](#0932-ç­¾åéªŒè¯æµç¨‹)
  - [09.3.3 ç­¾ååœºæ™¯ä¸å†³ç­–](#0933-ç­¾ååœºæ™¯ä¸å†³ç­–)
- [09.4 ç­–ç•¥æ²»ç†](#094-ç­–ç•¥æ²»ç†)
  - [09.4.1 OPA ç­–ç•¥æ²»ç†](#0941-opa-ç­–ç•¥æ²»ç†)
  - [09.4.2 Gatekeeper é›†æˆ](#0942-gatekeeper-é›†æˆ)
  - [09.4.3 Kyverno é›†æˆ](#0943-kyverno-é›†æˆ)
- [09.5 FIPS ä¸è¡Œä¸šåˆè§„](#095-fips-ä¸è¡Œä¸šåˆè§„)
  - [09.5.1 FIPS åˆè§„](#0951-fips-åˆè§„)
  - [09.5.2 è¡Œä¸šåˆè§„è¦æ±‚](#0952-è¡Œä¸šåˆè§„è¦æ±‚)
  - [09.5.3 åˆè§„åœºæ™¯ä¸å†³ç­–](#0953-åˆè§„åœºæ™¯ä¸å†³ç­–)
- [09.6 æ•°æ®å®‰å…¨](#096-æ•°æ®å®‰å…¨)
  - [09.6.1 æ•°æ®åŠ å¯†](#0961-æ•°æ®åŠ å¯†)
  - [09.6.2 æ•°æ®è„±æ•](#0962-æ•°æ®è„±æ•)
  - [09.6.3 OPA-Wasm æ•°æ®è„±æ•](#0963-opa-wasm-æ•°æ®è„±æ•)
- [09.7 æŠ€æœ¯åœºæ™¯åˆ†æ](#097-æŠ€æœ¯åœºæ™¯åˆ†æ)
  - [09.7.1 ç”Ÿäº§ç¯å¢ƒå®‰å…¨åœºæ™¯](#0971-ç”Ÿäº§ç¯å¢ƒå®‰å…¨åœºæ™¯)
  - [09.7.2 åˆè§„åœºæ™¯](#0972-åˆè§„åœºæ™¯)
  - [09.7.3 é›¶ä¿¡ä»»åœºæ™¯](#0973-é›¶ä¿¡ä»»åœºæ™¯)
- [09.8 å†³ç­–ä¾æ®ä¸æ€è·¯](#098-å†³ç­–ä¾æ®ä¸æ€è·¯)
  - [09.8.1 å®‰å…¨ç­–ç•¥å†³ç­–æ ‘](#0981-å®‰å…¨ç­–ç•¥å†³ç­–æ ‘)
  - [09.8.2 é•œåƒç­¾åå†³ç­–æ ‘](#0982-é•œåƒç­¾åå†³ç­–æ ‘)
  - [09.8.3 ç­–ç•¥æ²»ç†å†³ç­–æ ‘](#0983-ç­–ç•¥æ²»ç†å†³ç­–æ ‘)
- [09.9 å½¢å¼åŒ–æ€»ç»“](#099-å½¢å¼åŒ–æ€»ç»“)
  - [09.9.1 é›¶ä¿¡ä»»æ¨¡å‹å½¢å¼åŒ–](#0991-é›¶ä¿¡ä»»æ¨¡å‹å½¢å¼åŒ–)
  - [09.9.2 å®‰å…¨ç­–ç•¥æ¨¡å‹å½¢å¼åŒ–](#0992-å®‰å…¨ç­–ç•¥æ¨¡å‹å½¢å¼åŒ–)
- [09.10 ä¾›åº”é“¾å®‰å…¨æœ€ä½³å®è·µ](#0910-ä¾›åº”é“¾å®‰å…¨æœ€ä½³å®è·µ)
  - [09.10.1 ä¾›åº”é“¾å®‰å…¨æ¦‚è¿°](#09101-ä¾›åº”é“¾å®‰å…¨æ¦‚è¿°)
  - [09.10.2 SBOMï¼ˆè½¯ä»¶ç‰©æ–™æ¸…å•ï¼‰](#09102-sbomè½¯ä»¶ç‰©æ–™æ¸…å•)
  - [09.10.3 ä¾èµ–é¡¹æ¼æ´æ‰«æ](#09103-ä¾èµ–é¡¹æ¼æ´æ‰«æ)
  - [09.10.4 é•œåƒç­¾åå’ŒéªŒè¯å®Œæ•´æµç¨‹](#09104-é•œåƒç­¾åå’ŒéªŒè¯å®Œæ•´æµç¨‹)
  - [09.10.5 Kubernetes å‡†å…¥æ§åˆ¶é›†æˆ](#09105-kubernetes-å‡†å…¥æ§åˆ¶é›†æˆ)
  - [09.10.6 å®é™…å®‰å…¨æ¡ˆä¾‹](#09106-å®é™…å®‰å…¨æ¡ˆä¾‹)
    - [æ¡ˆä¾‹ 1ï¼šLog4Shell æ¼æ´åº”å¯¹](#æ¡ˆä¾‹-1log4shell-æ¼æ´åº”å¯¹)
    - [æ¡ˆä¾‹ 2ï¼šä¾›åº”é“¾æ”»å‡»é˜²èŒƒ](#æ¡ˆä¾‹-2ä¾›åº”é“¾æ”»å‡»é˜²èŒƒ)
    - [æ¡ˆä¾‹ 3ï¼šå¯†é’¥ç®¡ç†æœ€ä½³å®è·µ](#æ¡ˆä¾‹-3å¯†é’¥ç®¡ç†æœ€ä½³å®è·µ)
  - [09.10.7 å®‰å…¨åˆè§„æ£€æŸ¥æ¸…å•](#09107-å®‰å…¨åˆè§„æ£€æŸ¥æ¸…å•)
  - [09.10.8 å®‰å…¨å·¥å…·é›†æˆçŸ©é˜µ](#09108-å®‰å…¨å·¥å…·é›†æˆçŸ©é˜µ)
- [09.11 å‚è€ƒ](#0911-å‚è€ƒ)
  - [09.11.1 éš”ç¦»æ ˆç›¸å…³æ–‡æ¡£](#09111-éš”ç¦»æ ˆç›¸å…³æ–‡æ¡£)
  - [09.11.2 å®‰å…¨ç›¸å…³æ–‡æ¡£](#09112-å®‰å…¨ç›¸å…³æ–‡æ¡£)
  - [09.11.3 å…¶ä»–ç›¸å…³æ–‡æ¡£](#09113-å…¶ä»–ç›¸å…³æ–‡æ¡£)

---

## 09.1 æ–‡æ¡£å®šä½

æœ¬æ–‡æ¡£æ·±å…¥è§£æå®‰å…¨ä¸åˆè§„åœºæ™¯ä¸‹çš„æŠ€æœ¯æ–¹æ¡ˆï¼ŒåŒ…æ‹¬é›¶ä¿¡ä»»æ¶æ„ã€é•œåƒç­¾åä¸éªŒè¯ã€ç­–ç•¥æ²»
ç†å’Œ FIPS/è¡Œä¸šåˆè§„çš„æŠ€æœ¯åŸç†ã€å®ç°æ–¹å¼å’Œæœ€ä½³å®è·µã€‚

**æ–‡æ¡£ç»“æ„**ï¼š

- **é›¶ä¿¡ä»»æ¶æ„**ï¼šé›¶ä¿¡ä»»æ¦‚å¿µã€åŸåˆ™å’Œå®ç°æ–¹æ¡ˆ
- **é•œåƒç­¾å**ï¼šé•œåƒç­¾åæ–¹æ¡ˆã€éªŒè¯æµç¨‹å’Œåœºæ™¯å†³ç­–
- **ç­–ç•¥æ²»ç†**ï¼šOPAã€Gatekeeperã€Kyverno çš„ç­–ç•¥æ²»ç†æ–¹æ¡ˆ
- **FIPS åˆè§„**ï¼šFIPS åˆè§„å’Œè¡Œä¸šåˆè§„è¦æ±‚
- **æ•°æ®å®‰å…¨**ï¼šæ•°æ®åŠ å¯†ã€è„±æ•å’Œ OPA-Wasm æ•°æ®è„±æ•
- **æŠ€æœ¯åœºæ™¯**ï¼šç”Ÿäº§ç¯å¢ƒã€åˆè§„ã€é›¶ä¿¡ä»»åœºæ™¯çš„æ¶æ„è®¾è®¡

## 09.2 é›¶ä¿¡ä»»æ¶æ„

### 09.2.1 é›¶ä¿¡ä»»æ¦‚å¿µ

**å®šä¹‰**ï¼šé›¶ä¿¡ä»»ï¼ˆZero Trustï¼‰æ˜¯ä¸€ç§å®‰å…¨æ¶æ„ï¼Œé»˜è®¤ä¸ä¿¡ä»»ä»»ä½•å®ä½“ï¼Œéœ€è¦æŒç»­éªŒè¯ã€‚

**æ ¸å¿ƒåŸåˆ™**ï¼š

- **æ°¸ä¸ä¿¡ä»»ï¼Œå§‹ç»ˆéªŒè¯**ï¼šé»˜è®¤ä¸ä¿¡ä»»ï¼Œéœ€è¦æŒç»­éªŒè¯
- **æœ€å°æƒé™**ï¼šåªæˆäºˆå¿…è¦çš„æƒé™
- **å¾®åˆ†æ®µ**ï¼šç½‘ç»œå’Œèµ„æºåˆ†æ®µéš”ç¦»

### 09.2.2 é›¶ä¿¡ä»»åŸåˆ™

**é›¶ä¿¡ä»»åŸåˆ™**ï¼š

1. **èº«ä»½éªŒè¯**ï¼šæ‰€æœ‰å®ä½“å¿…é¡»éªŒè¯èº«ä»½
2. **è®¾å¤‡éªŒè¯**ï¼šæ‰€æœ‰è®¾å¤‡å¿…é¡»éªŒè¯
3. **ç½‘ç»œéªŒè¯**ï¼šæ‰€æœ‰ç½‘ç»œé€šä¿¡å¿…é¡»éªŒè¯
4. **èµ„æºéªŒè¯**ï¼šæ‰€æœ‰èµ„æºè®¿é—®å¿…é¡»éªŒè¯

**é›¶ä¿¡ä»»åŸåˆ™è®ºè¯**ï¼š

- **èº«ä»½éªŒè¯**ï¼šç¡®ä¿åªæœ‰æˆæƒç”¨æˆ·è®¿é—®
- **è®¾å¤‡éªŒè¯**ï¼šç¡®ä¿åªæœ‰æˆæƒè®¾å¤‡è®¿é—®
- **ç½‘ç»œéªŒè¯**ï¼šç¡®ä¿ç½‘ç»œé€šä¿¡å®‰å…¨
- **èµ„æºéªŒè¯**ï¼šç¡®ä¿èµ„æºè®¿é—®å®‰å…¨

### 09.2.3 é›¶ä¿¡ä»»å®ç°

**é›¶ä¿¡ä»»å®ç°æ–¹æ¡ˆ**ï¼š

```yaml
é›¶ä¿¡ä»»å®ç°:
  èº«ä»½éªŒè¯: OIDC/OAuth2ï¼ˆç”¨æˆ·èº«ä»½ï¼‰
  è®¾å¤‡éªŒè¯: è®¾å¤‡è¯ä¹¦ï¼ˆè®¾å¤‡èº«ä»½ï¼‰
  ç½‘ç»œéªŒè¯: mTLSï¼ˆç½‘ç»œé€šä¿¡ï¼‰
  èµ„æºéªŒè¯: RBAC + OPAï¼ˆèµ„æºè®¿é—®ï¼‰
  ä¼˜åŠ¿: å…¨é¢éªŒè¯ã€æœ€å°æƒé™ã€å¾®åˆ†æ®µ
```

**é›¶ä¿¡ä»»å®ç°è®ºè¯**ï¼š

- **èº«ä»½éªŒè¯**ï¼šä½¿ç”¨ OIDC/OAuth2 éªŒè¯ç”¨æˆ·èº«ä»½
- **è®¾å¤‡éªŒè¯**ï¼šä½¿ç”¨è®¾å¤‡è¯ä¹¦éªŒè¯è®¾å¤‡èº«ä»½
- **ç½‘ç»œéªŒè¯**ï¼šä½¿ç”¨ mTLS åŠ å¯†ç½‘ç»œé€šä¿¡
- **èµ„æºéªŒè¯**ï¼šä½¿ç”¨ RBAC + OPA æ§åˆ¶èµ„æºè®¿é—®

## 09.3 é•œåƒç­¾åä¸éªŒè¯

### 09.3.1 é•œåƒç­¾åæ–¹æ¡ˆ

**é•œåƒç­¾åæ–¹æ¡ˆ**ï¼š

- **Cosign**ï¼šSigstore é¡¹ç›®çš„é•œåƒç­¾åå·¥å…·
- **Notary**ï¼šDocker Content Trust çš„ç­¾åå·¥å…·
- **è‡ªå®šä¹‰ç­¾å**ï¼šä½¿ç”¨è‡ªå®šä¹‰ç­¾åæ–¹æ¡ˆ

**é•œåƒç­¾åæ–¹æ¡ˆè®ºè¯**ï¼š

- **Cosign**ï¼šåŸºäº OCI Artifactï¼Œæ ‡å‡†ç­¾åæ ¼å¼ï¼Œæ¨èä½¿ç”¨
- **Notary**ï¼šDocker å®˜æ–¹å·¥å…·ï¼Œä½†åŠŸèƒ½æœ‰é™
- **è‡ªå®šä¹‰ç­¾å**ï¼šçµæ´»ä½†éœ€è¦è‡ªå·±ç»´æŠ¤

### 09.3.2 ç­¾åéªŒè¯æµç¨‹

**ç­¾åéªŒè¯æµç¨‹**ï¼š

```mermaid
graph LR
    A[æ‹‰å–é•œåƒ] --> B[éªŒè¯ç­¾å]
    B --> C{ç­¾åæœ‰æ•ˆ?}
    C -->|æ˜¯| D[éƒ¨ç½² Pod]
    C -->|å¦| E[æ‹’ç»éƒ¨ç½²]

    style C fill:#ffe6e6
    style D fill:#e6ffe6
    style E fill:#ffcccc
```

**ç­¾åéªŒè¯æµç¨‹è®ºè¯**ï¼š

1. **æ‹‰å–é•œåƒ**ï¼šä»é•œåƒä»“åº“æ‹‰å–é•œåƒ
2. **éªŒè¯ç­¾å**ï¼šä½¿ç”¨å…¬é’¥éªŒè¯é•œåƒç­¾å
3. **å‡†å…¥æ§åˆ¶**ï¼šé€šè¿‡ Kubernetes å‡†å…¥æ§åˆ¶éªŒè¯ç­¾å
4. **éƒ¨ç½²å†³ç­–**ï¼šç­¾åæœ‰æ•ˆåˆ™éƒ¨ç½²ï¼Œæ— æ•ˆåˆ™æ‹’ç»

### 09.3.3 ç­¾ååœºæ™¯ä¸å†³ç­–

**åœºæ™¯ 1ï¼šç”Ÿäº§ç¯å¢ƒ**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… å¿…é¡»ç­¾åæ‰€æœ‰é•œåƒ
- âœ… å¿…é¡»éªŒè¯ç­¾å
- âœ… ç­¾åéªŒè¯å¤±è´¥å¿…é¡»æ‹’ç»éƒ¨ç½²

**å†³ç­–æ€è·¯**ï¼š

```yaml
ç”Ÿäº§ç¯å¢ƒç­¾åç­–ç•¥:
  ç­¾å: å¿…é¡»ç­¾åæ‰€æœ‰é•œåƒï¼ˆCosignï¼‰
  éªŒè¯: Kubernetes å‡†å…¥æ§åˆ¶ï¼ˆå¼ºåˆ¶éªŒè¯ï¼‰
  å¤±è´¥å¤„ç†: ç­¾åéªŒè¯å¤±è´¥å¿…é¡»æ‹’ç»éƒ¨ç½²
  ä¼˜åŠ¿: å®Œæ•´æ€§éªŒè¯ã€æ¥æºéªŒè¯ã€åˆè§„è¦æ±‚
```

**åœºæ™¯ 2ï¼šåˆè§„åœºæ™¯**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… æ»¡è¶³åˆè§„è¦æ±‚ï¼ˆå¦‚ EO 14028ï¼‰
- âœ… å®Œæ•´çš„ç­¾åå®¡è®¡
- âœ… ç­¾åå¯†é’¥ç®¡ç†

**å†³ç­–æ€è·¯**ï¼š

```yaml
åˆè§„åœºæ™¯ç­¾åç­–ç•¥:
  ç­¾å: å¿…é¡»ç­¾åæ‰€æœ‰é•œåƒ + SBOMï¼ˆCosignï¼‰
  éªŒè¯: Kubernetes å‡†å…¥æ§åˆ¶ï¼ˆå¼ºåˆ¶éªŒè¯ï¼‰
  å®¡è®¡: å®Œæ•´çš„ç­¾åå’ŒéªŒè¯è®°å½•
  å¯†é’¥ç®¡ç†: Sigstore å¯†é’¥ç®¡ç†
  ä¼˜åŠ¿: åˆè§„è¦æ±‚ã€å®Œæ•´å®¡è®¡ã€å¯†é’¥ç®¡ç†
```

## 09.4 ç­–ç•¥æ²»ç†

### 09.4.1 OPA ç­–ç•¥æ²»ç†

**OPA ç­–ç•¥æ²»ç†**ï¼šä½¿ç”¨ OPA å®šä¹‰å’Œæ‰§è¡Œå®‰å…¨ç­–ç•¥ã€‚

**ç­–ç•¥ç±»å‹**ï¼š

- **å‡†å…¥æ§åˆ¶ç­–ç•¥**ï¼šKubernetes å‡†å…¥æ§åˆ¶ç­–ç•¥
- **æˆæƒç­–ç•¥**ï¼šAPI æˆæƒç­–ç•¥
- **æ•°æ®ç­–ç•¥**ï¼šæ•°æ®è®¿é—®ç­–ç•¥

**OPA ç­–ç•¥æ²»ç†è®ºè¯**ï¼š

- **ç­–ç•¥å³ä»£ç **ï¼šç­–ç•¥ä»¥ä»£ç å½¢å¼å®šä¹‰ï¼Œå¯ç‰ˆæœ¬æ§åˆ¶
- **é€šç”¨å¼•æ“**ï¼šæ”¯æŒå¤šç§åœºæ™¯ï¼ˆKubernetesã€APIã€å¾®æœåŠ¡ç­‰ï¼‰
- **å£°æ˜å¼**ï¼šä½¿ç”¨ Rego è¯­è¨€ï¼Œå£°æ˜å¼å®šä¹‰ç­–ç•¥

### 09.4.2 Gatekeeper é›†æˆ

**Gatekeeper**ï¼šKubernetes å‡†å…¥æ§åˆ¶å™¨ï¼Œä½¿ç”¨ OPA ç­–ç•¥ã€‚

**Gatekeeper ç‰¹ç‚¹**ï¼š

- **å‡†å…¥æ§åˆ¶**ï¼šKubernetes å‡†å…¥æ§åˆ¶
- **OPA é›†æˆ**ï¼šä½¿ç”¨ OPA ç­–ç•¥å¼•æ“
- **ç­–ç•¥æ¨¡æ¿**ï¼šæ”¯æŒç­–ç•¥æ¨¡æ¿å’Œçº¦æŸ

**Gatekeeper é›†æˆè®ºè¯**ï¼š

- **å‡†å…¥æ§åˆ¶**ï¼šé€šè¿‡ Kubernetes å‡†å…¥æ§åˆ¶æ‰§è¡Œç­–ç•¥
- **OPA é›†æˆ**ï¼šä½¿ç”¨ OPA ç­–ç•¥å¼•æ“ï¼Œçµæ´»å®šä¹‰ç­–ç•¥
- **ç­–ç•¥æ¨¡æ¿**ï¼šæ”¯æŒç­–ç•¥æ¨¡æ¿ï¼Œä¾¿äºå¤ç”¨

### 09.4.3 Kyverno é›†æˆ

**Kyverno**ï¼šKubernetes åŸç”Ÿç­–ç•¥å¼•æ“ï¼Œä½¿ç”¨ YAML å®šä¹‰ç­–ç•¥ã€‚

**Kyverno ç‰¹ç‚¹**ï¼š

- **åŸç”Ÿé›†æˆ**ï¼šKubernetes åŸç”Ÿç­–ç•¥å¼•æ“
- **YAML ç­–ç•¥**ï¼šä½¿ç”¨ YAML å®šä¹‰ç­–ç•¥ï¼Œç®€å•æ˜“ç”¨
- **ç­–ç•¥ç±»å‹**ï¼šæ”¯æŒéªŒè¯ã€å˜æ›´ã€ç”Ÿæˆç­–ç•¥

**Kyverno é›†æˆè®ºè¯**ï¼š

- **åŸç”Ÿé›†æˆ**ï¼šKubernetes åŸç”Ÿç­–ç•¥å¼•æ“ï¼Œæ— éœ€é¢å¤–ç»„ä»¶
- **YAML ç­–ç•¥**ï¼šä½¿ç”¨ YAML å®šä¹‰ç­–ç•¥ï¼Œç®€å•æ˜“ç”¨
- **ç­–ç•¥ç±»å‹**ï¼šæ”¯æŒéªŒè¯ã€å˜æ›´ã€ç”Ÿæˆç­–ç•¥ï¼ŒåŠŸèƒ½å®Œæ•´

## 09.5 FIPS ä¸è¡Œä¸šåˆè§„

### 09.5.1 FIPS åˆè§„

**FIPS åˆè§„**ï¼šFIPSï¼ˆFederal Information Processing Standardsï¼‰æ˜¯ç¾å›½è”é‚¦ä¿¡æ¯å¤„
ç†æ ‡å‡†ã€‚

**FIPS è¦æ±‚**ï¼š

- **åŠ å¯†ç®—æ³•**ï¼šä½¿ç”¨ FIPS æ‰¹å‡†çš„åŠ å¯†ç®—æ³•
- **éšæœºæ•°ç”Ÿæˆ**ï¼šä½¿ç”¨ FIPS æ‰¹å‡†çš„éšæœºæ•°ç”Ÿæˆå™¨
- **å¯†é’¥ç®¡ç†**ï¼šä½¿ç”¨ FIPS æ‰¹å‡†çš„å¯†é’¥ç®¡ç†æ–¹æ¡ˆ

**FIPS åˆè§„è®ºè¯**ï¼š

- **åŠ å¯†ç®—æ³•**ï¼šä½¿ç”¨ FIPS æ‰¹å‡†çš„åŠ å¯†ç®—æ³•ï¼ˆå¦‚ AES-256ï¼‰
- **éšæœºæ•°ç”Ÿæˆ**ï¼šä½¿ç”¨ FIPS æ‰¹å‡†çš„éšæœºæ•°ç”Ÿæˆå™¨
- **å¯†é’¥ç®¡ç†**ï¼šä½¿ç”¨ FIPS æ‰¹å‡†çš„å¯†é’¥ç®¡ç†æ–¹æ¡ˆ

### 09.5.2 è¡Œä¸šåˆè§„è¦æ±‚

**è¡Œä¸šåˆè§„è¦æ±‚**ï¼š

- **HIPAA**ï¼šåŒ»ç–—ä¿å¥è¡Œä¸šåˆè§„
- **PCI DSS**ï¼šæ”¯ä»˜å¡è¡Œä¸šåˆè§„
- **GDPR**ï¼šæ•°æ®ä¿æŠ¤åˆè§„
- **SOC 2**ï¼šæœåŠ¡ç»„ç»‡æ§åˆ¶åˆè§„

**è¡Œä¸šåˆè§„è®ºè¯**ï¼š

- **HIPAA**ï¼šåŒ»ç–—ä¿å¥æ•°æ®ä¿æŠ¤å’Œéšç§è¦æ±‚
- **PCI DSS**ï¼šæ”¯ä»˜å¡æ•°æ®å®‰å…¨æ ‡å‡†
- **GDPR**ï¼šæ¬§ç›Ÿæ•°æ®ä¿æŠ¤æ³•è§„
- **SOC 2**ï¼šæœåŠ¡ç»„ç»‡æ§åˆ¶æ ‡å‡†

### 09.5.3 åˆè§„åœºæ™¯ä¸å†³ç­–

**åœºæ™¯ 1ï¼šFIPS åˆè§„åœºæ™¯**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… å¿…é¡»ä½¿ç”¨ FIPS æ‰¹å‡†çš„åŠ å¯†ç®—æ³•
- âœ… å¿…é¡»ä½¿ç”¨ FIPS æ‰¹å‡†çš„éšæœºæ•°ç”Ÿæˆå™¨
- âœ… å¿…é¡»ä½¿ç”¨ FIPS æ‰¹å‡†çš„å¯†é’¥ç®¡ç†æ–¹æ¡ˆ

**å†³ç­–æ€è·¯**ï¼š

```yaml
FIPS åˆè§„ç­–ç•¥:
  åŠ å¯†ç®—æ³•: FIPS æ‰¹å‡†ç®—æ³•ï¼ˆAES-256ï¼‰
  éšæœºæ•°ç”Ÿæˆ: FIPS æ‰¹å‡†éšæœºæ•°ç”Ÿæˆå™¨
  å¯†é’¥ç®¡ç†: FIPS æ‰¹å‡†å¯†é’¥ç®¡ç†æ–¹æ¡ˆ
  ä¼˜åŠ¿: FIPS åˆè§„ã€å®‰å…¨æ€§é«˜
```

**åœºæ™¯ 2ï¼šè¡Œä¸šåˆè§„åœºæ™¯**:

**å†³ç­–ä¾æ®**ï¼š

- âœ… æ»¡è¶³è¡Œä¸šåˆè§„è¦æ±‚ï¼ˆHIPAAã€PCI DSSã€GDPRã€SOC 2ï¼‰
- âœ… æ•°æ®ä¿æŠ¤å’Œéšç§è¦æ±‚
- âœ… å®¡è®¡å’ŒæŠ¥å‘Šè¦æ±‚

**å†³ç­–æ€è·¯**ï¼š

```yaml
è¡Œä¸šåˆè§„ç­–ç•¥:
  åˆè§„æ ‡å‡†: HIPAA/PCI DSS/GDPR/SOC 2
  æ•°æ®ä¿æŠ¤: æ•°æ®åŠ å¯†ã€è®¿é—®æ§åˆ¶
  å®¡è®¡: å®Œæ•´çš„å®¡è®¡æ—¥å¿—å’ŒæŠ¥å‘Š
  ä¼˜åŠ¿: è¡Œä¸šåˆè§„ã€æ•°æ®ä¿æŠ¤ã€å®¡è®¡èƒ½åŠ›
```

## 09.6 æ•°æ®å®‰å…¨

### 09.6.1 æ•°æ®åŠ å¯†

**æ•°æ®åŠ å¯†æ–¹æ¡ˆ**ï¼š

- **ä¼ è¾“åŠ å¯†**ï¼šä½¿ç”¨ TLS/mTLS åŠ å¯†æ•°æ®ä¼ è¾“
- **å­˜å‚¨åŠ å¯†**ï¼šä½¿ç”¨åŠ å¯†å­˜å‚¨ï¼ˆå¦‚åŠ å¯† Volumeï¼‰
- **åº”ç”¨åŠ å¯†**ï¼šåœ¨åº”ç”¨å±‚åŠ å¯†æ•æ„Ÿæ•°æ®

**æ•°æ®åŠ å¯†è®ºè¯**ï¼š

- **ä¼ è¾“åŠ å¯†**ï¼šä½¿ç”¨ TLS/mTLS åŠ å¯†æ•°æ®ä¼ è¾“ï¼Œé˜²æ­¢æ•°æ®æ³„éœ²
- **å­˜å‚¨åŠ å¯†**ï¼šä½¿ç”¨åŠ å¯†å­˜å‚¨ï¼Œé˜²æ­¢å­˜å‚¨æ•°æ®æ³„éœ²
- **åº”ç”¨åŠ å¯†**ï¼šåœ¨åº”ç”¨å±‚åŠ å¯†æ•æ„Ÿæ•°æ®ï¼Œå¤šå±‚é˜²æŠ¤

### 09.6.2 æ•°æ®è„±æ•

**æ•°æ®è„±æ•æ–¹æ¡ˆ**ï¼š

- **é™æ€è„±æ•**ï¼šåœ¨å­˜å‚¨æ—¶è„±æ•æ•°æ®
- **åŠ¨æ€è„±æ•**ï¼šåœ¨è®¿é—®æ—¶è„±æ•æ•°æ®
- **ç­–ç•¥è„±æ•**ï¼šä½¿ç”¨ç­–ç•¥å®šä¹‰è„±æ•è§„åˆ™

**æ•°æ®è„±æ•è®ºè¯**ï¼š

- **é™æ€è„±æ•**ï¼šåœ¨å­˜å‚¨æ—¶è„±æ•æ•°æ®ï¼Œä¿æŠ¤å­˜å‚¨æ•°æ®
- **åŠ¨æ€è„±æ•**ï¼šåœ¨è®¿é—®æ—¶è„±æ•æ•°æ®ï¼Œä¿æŠ¤è®¿é—®æ•°æ®
- **ç­–ç•¥è„±æ•**ï¼šä½¿ç”¨ç­–ç•¥å®šä¹‰è„±æ•è§„åˆ™ï¼Œçµæ´»æ§åˆ¶

### 09.6.3 OPA-Wasm æ•°æ®è„±æ•

> **ğŸ’¡ éš”ç¦»å±‚æ¬¡å…³è”**ï¼šOPA-Wasm æ•°æ®è„±æ•ä½¿ç”¨ L-4 æ²™ç›’åŒ–å±‚çš„ WASM è¿è¡Œæ—¶
> ï¼ˆWasmEdgeï¼‰è¿›è¡Œå¿«é€Ÿç­–ç•¥æ‰§è¡Œã€‚è¯¦ç»†çš„æŠ€æœ¯è§£æè¯·å‚è€ƒï¼š
>
> - **[29. éš”ç¦»æ ˆ](../29-isolation-stack/isolation-stack.md)** - å®Œæ•´çš„éš”ç¦»æ ˆæŠ€
>   æœ¯è§£æ
> - **[L-4 æ²™ç›’åŒ–å±‚](../29-isolation-stack/layers/L-4-sandboxing.md)** - WASM è¿
>   è¡Œæ—¶è¯¦ç»†æ–‡æ¡£
> - **[éš”ç¦»å±‚æ¬¡å¯¹æ¯”æ–‡æ¡£](../29-isolation-stack/layers/isolation-comparison.md)** -
>   WASM æ€§èƒ½å¯¹æ¯”å’Œå®‰å…¨ç‰¹ç‚¹

**OPA-Wasm æ•°æ®è„±æ•**ï¼šä½¿ç”¨ OPA-Wasm è¿›è¡Œç»†ç²’åº¦æ•°æ®è„±æ•ã€‚

**OPA-Wasm æ•°æ®è„±æ•æ–¹æ¡ˆ**ï¼š

```yaml
OPA-Wasm æ•°æ®è„±æ•:
  ç­–ç•¥: Rego ç­–ç•¥ï¼ˆç¼–è¯‘åˆ° Wasmï¼‰
  æ‰§è¡Œ: WasmEdgeï¼ˆå¿«é€Ÿæ‰§è¡Œï¼‰
  åœºæ™¯: API ç½‘å…³ã€æ•°æ®è®¿é—®
  ä¼˜åŠ¿: ç»†ç²’åº¦æ§åˆ¶ã€å¿«é€Ÿæ‰§è¡Œã€ç­–ç•¥å³ä»£ç 
```

**OPA-Wasm æ•°æ®è„±æ•è®ºè¯**ï¼š

- **ç»†ç²’åº¦æ§åˆ¶**ï¼šä½¿ç”¨ Rego ç­–ç•¥å®šä¹‰è„±æ•è§„åˆ™ï¼Œç»†ç²’åº¦æ§åˆ¶
- **å¿«é€Ÿæ‰§è¡Œ**ï¼šWasm æ‰§è¡Œå¿«ï¼Œæ»¡è¶³å®æ—¶è„±æ•è¦æ±‚
- **ç­–ç•¥å³ä»£ç **ï¼šç­–ç•¥ä»¥ä»£ç å½¢å¼å®šä¹‰ï¼Œå¯ç‰ˆæœ¬æ§åˆ¶

## 09.7 æŠ€æœ¯åœºæ™¯åˆ†æ

### 09.7.1 ç”Ÿäº§ç¯å¢ƒå®‰å…¨åœºæ™¯

**åœºæ™¯æè¿°**ï¼šç”Ÿäº§ç¯å¢ƒéœ€è¦å…¨é¢çš„å®‰å…¨ä¿æŠ¤ã€‚

**æ¶æ„æŒ‘æˆ˜**ï¼š

1. **é•œåƒå®‰å…¨**ï¼šç¡®ä¿é•œåƒæœªè¢«ç¯¡æ”¹
2. **è®¿é—®æ§åˆ¶**ï¼šæ§åˆ¶èµ„æºè®¿é—®
3. **æ•°æ®å®‰å…¨**ï¼šä¿æŠ¤æ•æ„Ÿæ•°æ®

**æ¶æ„å†³ç­–**ï¼š

```yaml
ç”Ÿäº§ç¯å¢ƒå®‰å…¨é…ç½®:
  é•œåƒç­¾å: Cosignï¼ˆå¿…é¡»ç­¾åæ‰€æœ‰é•œåƒï¼‰
  å‡†å…¥æ§åˆ¶: Gatekeeper/Kyvernoï¼ˆå¼ºåˆ¶ç­–ç•¥ï¼‰
  è®¿é—®æ§åˆ¶: RBAC + OPAï¼ˆç»†ç²’åº¦æ§åˆ¶ï¼‰
  æ•°æ®åŠ å¯†: TLS/mTLS + åŠ å¯†å­˜å‚¨
  ä¼˜åŠ¿: å…¨é¢å®‰å…¨ã€å¤šå±‚é˜²æŠ¤
```

**å†³ç­–ä¾æ®**ï¼š

- âœ… **é•œåƒå®‰å…¨**ï¼šé•œåƒç­¾åç¡®ä¿é•œåƒå®Œæ•´æ€§
- âœ… **è®¿é—®æ§åˆ¶**ï¼šå‡†å…¥æ§åˆ¶å’Œ RBAC æ§åˆ¶èµ„æºè®¿é—®
- âœ… **æ•°æ®å®‰å…¨**ï¼šæ•°æ®åŠ å¯†ä¿æŠ¤æ•æ„Ÿæ•°æ®

### 09.7.2 åˆè§„åœºæ™¯

**åœºæ™¯æè¿°**ï¼šéœ€è¦æ»¡è¶³åˆè§„è¦æ±‚ï¼ˆFIPSã€è¡Œä¸šåˆè§„ï¼‰ã€‚

**æ¶æ„æŒ‘æˆ˜**ï¼š

1. **åˆè§„è¦æ±‚**ï¼šæ»¡è¶³æ³•è§„è¦æ±‚
2. **å®¡è®¡èƒ½åŠ›**ï¼šæä¾›å®¡è®¡å’ŒæŠ¥å‘Šèƒ½åŠ›
3. **æ•°æ®ä¿æŠ¤**ï¼šä¿æŠ¤æ•æ„Ÿæ•°æ®

**æ¶æ„å†³ç­–**ï¼š

```yaml
åˆè§„åœºæ™¯å®‰å…¨é…ç½®:
  FIPS åˆè§„: FIPS æ‰¹å‡†åŠ å¯†ç®—æ³•å’Œå¯†é’¥ç®¡ç†
  è¡Œä¸šåˆè§„: æ»¡è¶³ HIPAA/PCI DSS/GDPR/SOC 2
  å®¡è®¡: å®Œæ•´çš„å®¡è®¡æ—¥å¿—å’ŒæŠ¥å‘Š
  æ•°æ®ä¿æŠ¤: æ•°æ®åŠ å¯†ã€è®¿é—®æ§åˆ¶ã€æ•°æ®è„±æ•
  ä¼˜åŠ¿: åˆè§„è¦æ±‚ã€å®¡è®¡èƒ½åŠ›ã€æ•°æ®ä¿æŠ¤
```

**å†³ç­–ä¾æ®**ï¼š

- âœ… **åˆè§„è¦æ±‚**ï¼šæ»¡è¶³ FIPS å’Œè¡Œä¸šåˆè§„è¦æ±‚
- âœ… **å®¡è®¡èƒ½åŠ›**ï¼šæä¾›å®Œæ•´çš„å®¡è®¡æ—¥å¿—å’ŒæŠ¥å‘Š
- âœ… **æ•°æ®ä¿æŠ¤**ï¼šæ•°æ®åŠ å¯†ã€è®¿é—®æ§åˆ¶ã€æ•°æ®è„±æ•

### 09.7.3 é›¶ä¿¡ä»»åœºæ™¯

**åœºæ™¯æè¿°**ï¼šå®ç°é›¶ä¿¡ä»»æ¶æ„ï¼Œé»˜è®¤ä¸ä¿¡ä»»ï¼ŒæŒç»­éªŒè¯ã€‚

**æ¶æ„æŒ‘æˆ˜**ï¼š

1. **èº«ä»½éªŒè¯**ï¼šéªŒè¯æ‰€æœ‰å®ä½“èº«ä»½
2. **è®¾å¤‡éªŒè¯**ï¼šéªŒè¯æ‰€æœ‰è®¾å¤‡
3. **ç½‘ç»œéªŒè¯**ï¼šéªŒè¯æ‰€æœ‰ç½‘ç»œé€šä¿¡
4. **èµ„æºéªŒè¯**ï¼šéªŒè¯æ‰€æœ‰èµ„æºè®¿é—®

**æ¶æ„å†³ç­–**ï¼š

```yaml
é›¶ä¿¡ä»»åœºæ™¯å®‰å…¨é…ç½®:
  èº«ä»½éªŒè¯: OIDC/OAuth2ï¼ˆç”¨æˆ·èº«ä»½ï¼‰
  è®¾å¤‡éªŒè¯: è®¾å¤‡è¯ä¹¦ï¼ˆè®¾å¤‡èº«ä»½ï¼‰
  ç½‘ç»œéªŒè¯: mTLSï¼ˆç½‘ç»œé€šä¿¡ï¼‰
  èµ„æºéªŒè¯: RBAC + OPAï¼ˆèµ„æºè®¿é—®ï¼‰
  ä¼˜åŠ¿: å…¨é¢éªŒè¯ã€æœ€å°æƒé™ã€å¾®åˆ†æ®µ
```

**å†³ç­–ä¾æ®**ï¼š

- âœ… **èº«ä»½éªŒè¯**ï¼šOIDC/OAuth2 éªŒè¯ç”¨æˆ·èº«ä»½
- âœ… **è®¾å¤‡éªŒè¯**ï¼šè®¾å¤‡è¯ä¹¦éªŒè¯è®¾å¤‡èº«ä»½
- âœ… **ç½‘ç»œéªŒè¯**ï¼šmTLS åŠ å¯†ç½‘ç»œé€šä¿¡
- âœ… **èµ„æºéªŒè¯**ï¼šRBAC + OPA æ§åˆ¶èµ„æºè®¿é—®

## 09.8 å†³ç­–ä¾æ®ä¸æ€è·¯

### 09.8.1 å®‰å…¨ç­–ç•¥å†³ç­–æ ‘

```yaml
å®‰å…¨ç­–ç•¥å†³ç­–:
  if ç”Ÿäº§ç¯å¢ƒ: é•œåƒç­¾å + å‡†å…¥æ§åˆ¶ + æ•°æ®åŠ å¯†
  elif åˆè§„åœºæ™¯: FIPS åˆè§„ + è¡Œä¸šåˆè§„ + å®¡è®¡
  elif é›¶ä¿¡ä»»åœºæ™¯: èº«ä»½éªŒè¯ + è®¾å¤‡éªŒè¯ + ç½‘ç»œéªŒè¯ + èµ„æºéªŒè¯
  else: åŸºç¡€å®‰å…¨ï¼ˆé•œåƒç­¾å + å‡†å…¥æ§åˆ¶ï¼‰
```

### 09.8.2 é•œåƒç­¾åå†³ç­–æ ‘

```yaml
é•œåƒç­¾åå†³ç­–:
  if ç”Ÿäº§ç¯å¢ƒ: å¿…é¡»ç­¾åæ‰€æœ‰é•œåƒï¼ˆCosignï¼‰
  elif åˆè§„åœºæ™¯: å¿…é¡»ç­¾åæ‰€æœ‰é•œåƒ + SBOMï¼ˆCosignï¼‰
  else: å¯é€‰ç­¾åï¼ˆæ¨èï¼‰
```

### 09.8.3 ç­–ç•¥æ²»ç†å†³ç­–æ ‘

```yaml
ç­–ç•¥æ²»ç†å†³ç­–:
  if å¤æ‚ç­–ç•¥: OPA + Gatekeeperï¼ˆçµæ´»ã€å¼ºå¤§ï¼‰
  elif ç®€å•ç­–ç•¥: Kyvernoï¼ˆç®€å•ã€æ˜“ç”¨ï¼‰
  else: OPA + Gatekeeperï¼ˆé»˜è®¤ã€æ¨èï¼‰
```

## 09.9 å½¢å¼åŒ–æ€»ç»“

### 09.9.1 é›¶ä¿¡ä»»æ¨¡å‹å½¢å¼åŒ–

**é›¶ä¿¡ä»»éªŒè¯å‡½æ•°**ï¼š

$$
ZT(E, D, N, R) = \begin{cases}
\text{allow} & \text{if } \text{verify}(E) \land \text{verify}(D) \land \text{verify}(N) \land \text{verify}(R) \\
\text{deny} & \text{otherwise}
\end{cases}
$$

å…¶ä¸­ï¼š

- $E$ = å®ä½“ï¼ˆEntityï¼Œç”¨æˆ·/æœåŠ¡ï¼‰
- $D$ = è®¾å¤‡ï¼ˆDeviceï¼‰
- $N$ = ç½‘ç»œï¼ˆNetworkï¼‰
- $R$ = èµ„æºï¼ˆResourceï¼‰

### 09.9.2 å®‰å…¨ç­–ç•¥æ¨¡å‹å½¢å¼åŒ–

**å®‰å…¨ç­–ç•¥å‡½æ•°**ï¼š
$$S(P) = \{\text{sign}(P), \text{verify}(P), \text{enforce}(P)\}$$

å…¶ä¸­ï¼š

- $P$ = ç­–ç•¥ï¼ˆPolicyï¼‰
- $\text{sign}$ = ç­¾åå‡½æ•°
- $\text{verify}$ = éªŒè¯å‡½æ•°
- $\text{enforce}$ = æ‰§è¡Œå‡½æ•°

## 09.10 ä¾›åº”é“¾å®‰å…¨æœ€ä½³å®è·µ

### 09.10.1 ä¾›åº”é“¾å®‰å…¨æ¦‚è¿°

**ä¾›åº”é“¾å®‰å…¨**æ˜¯æŒ‡åœ¨æ•´ä¸ªè½¯ä»¶ä¾›åº”é“¾ä¸­ç¡®ä¿ä»£ç ã€é•œåƒã€ä¾èµ–é¡¹ç­‰çš„å®‰å…¨æ€§å’Œå®Œæ•´æ€§ã€‚

**ä¾›åº”é“¾å®‰å…¨å¨èƒ**ï¼š

- **ä¾èµ–é¡¹æ¼æ´**ï¼šç¬¬ä¸‰æ–¹åº“çš„å®‰å…¨æ¼æ´
- **é•œåƒç¯¡æ”¹**ï¼šé•œåƒåœ¨ä¼ è¾“æˆ–å­˜å‚¨è¿‡ç¨‹ä¸­è¢«ç¯¡æ”¹
- **æ¶æ„ä»£ç æ³¨å…¥**ï¼šåœ¨æ„å»ºè¿‡ç¨‹ä¸­æ³¨å…¥æ¶æ„ä»£ç 
- **å¯†é’¥æ³„éœ²**ï¼šæ„å»ºå¯†é’¥æˆ–è®¿é—®å‡­è¯æ³„éœ²

### 09.10.2 SBOMï¼ˆè½¯ä»¶ç‰©æ–™æ¸…å•ï¼‰

**SBOM å®šä¹‰**ï¼šè½¯ä»¶ç‰©æ–™æ¸…å•ï¼ˆSoftware Bill of Materialsï¼‰è®°å½•äº†è½¯ä»¶çš„æ‰€æœ‰ç»„ä»¶å’Œ
ä¾èµ–é¡¹ã€‚

**SBOM ç”Ÿæˆå·¥å…·**ï¼š

```bash
# ä½¿ç”¨ Syft ç”Ÿæˆ SBOM
syft docker image myapp:latest -o spdx-json > sbom.json

# ä½¿ç”¨ Cosign ç­¾å SBOM
cosign sign-blob --bundle sbom.json --key cosign.key

# ä½¿ç”¨ in-toto ç”Ÿæˆå®Œæ•´ä¾›åº”é“¾è¯æ˜
```

**SBOM ç¤ºä¾‹**ï¼š

```json
{
  "spdxVersion": "SPDX-2.3",
  "name": "myapp-1.0.0",
  "packages": [
    {
      "name": "myapp",
      "version": "1.0.0",
      "supplier": "Organization: MyCompany",
      "dependencies": ["node:16-alpine", "express:4.18.0", "lodash:4.17.21"]
    }
  ]
}
```

### 09.10.3 ä¾èµ–é¡¹æ¼æ´æ‰«æ

**æ¼æ´æ‰«æå·¥å…·**ï¼š

```bash
# ä½¿ç”¨ Trivy æ‰«æé•œåƒæ¼æ´
trivy image myapp:latest

# ä½¿ç”¨ Grype æ‰«ææ¼æ´
grype docker:myapp:latest

# ä½¿ç”¨ Snyk æ‰«æä¾èµ–é¡¹
snyk test --docker myapp:latest
```

**CI/CD é›†æˆç¤ºä¾‹**ï¼š

```yaml
# .github/workflows/security-scan.yml
name: Security Scan

on:
  pull_request:
  push:
    branches: [main]

jobs:
  scan:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Build image
        run: docker build -t myapp:latest .

      - name: Run Trivy vulnerability scanner
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: "myapp:latest"
          format: "sarif"
          output: "trivy-results.sarif"

      - name: Upload Trivy results
        uses: github/codeql-action/upload-sarif@v2
        with:
          sarif_file: "trivy-results.sarif"

      - name: Generate SBOM
        run: |
          syft docker image myapp:latest -o spdx-json > sbom.json

      - name: Sign SBOM
        run: |
          cosign sign-blob --bundle sbom.json --key cosign.key
```

### 09.10.4 é•œåƒç­¾åå’ŒéªŒè¯å®Œæ•´æµç¨‹

**å®Œæ•´ç­¾åæµç¨‹**ï¼š

```bash
#!/bin/bash
# complete-signing-flow.sh

# 1. æ„å»ºé•œåƒ
docker build -t myapp:1.0.0 .

# 2. ç”Ÿæˆ SBOM
syft docker image myapp:1.0.0 -o spdx-json > sbom.json

# 3. æ‰«ææ¼æ´
trivy image myapp:1.0.0 --format json > vuln-report.json

# 4. éªŒè¯æ— é«˜å±æ¼æ´
if grep -q '"Severity":"CRITICAL"' vuln-report.json; then
    echo "Critical vulnerabilities found, aborting"
    exit 1
fi

# 5. ç­¾åé•œåƒ
cosign sign --key cosign.key myapp:1.0.0

# 6. ç­¾å SBOM
cosign sign-blob --bundle sbom.json --key cosign.key

# 7. æ¨é€é•œåƒå’Œç­¾å
docker push myapp:1.0.0
cosign copy myapp:1.0.0 myregistry.io/myapp:1.0.0

# 8. æ¨é€ SBOM
cosign upload blob --bundle sbom.json myregistry.io/myapp:1.0.0-sbom
```

**éªŒè¯æµç¨‹**ï¼š

```bash
#!/bin/bash
# verify-image.sh

IMAGE=$1

# 1. éªŒè¯é•œåƒç­¾å
if ! cosign verify --key cosign.pub $IMAGE; then
    echo "Image signature verification failed"
    exit 1
fi

# 2. éªŒè¯ SBOM ç­¾å
if ! cosign verify-blob --key cosign.pub --bundle sbom.json; then
    echo "SBOM signature verification failed"
    exit 1
fi

# 3. æ‰«ææ¼æ´
trivy image --exit-code 1 --severity HIGH,CRITICAL $IMAGE

echo "Image verification passed"
```

### 09.10.5 Kubernetes å‡†å…¥æ§åˆ¶é›†æˆ

**ä½¿ç”¨ Gatekeeper éªŒè¯é•œåƒç­¾å**ï¼š

```yaml
apiVersion: templates.gatekeeper.sh/v1beta1
kind: ConstraintTemplate
metadata:
  name: k8srequiredimagesignature
spec:
  crd:
    spec:
      names:
        kind: K8sRequiredImageSignature
      validation:
        openAPIV3Schema:
          type: object
          properties:
            key:
              type: string
            images:
              type: array
              items:
                type: string
  targets:
    - target: admission.k8s.gatekeeper.sh
      rego: |
        package k8srequiredimagesignature

        violation[{"msg": msg}] {
          container := input.review.object.spec.containers[_]
          not check_image_signature(container.image)
          msg := sprintf("Image %v is not signed", [container.image])
        }

        check_image_signature(image) {
          # è°ƒç”¨ cosign verify éªŒè¯ç­¾å
          # è¿™é‡Œéœ€è¦é›†æˆå¤–éƒ¨éªŒè¯æœåŠ¡
        }
---
apiVersion: config.gatekeeper.sh/v1alpha1
kind: Config
metadata:
  name: config
spec:
  match:
    - excludedNamespaces: ["kube-system", "gatekeeper-system"]
  validation:
    traces:
      - userGroups: ["system:serviceaccounts"]
        kind:
          group: ""
          version: "v1"
          kind: "Pod"
```

**ä½¿ç”¨ Kyverno éªŒè¯é•œåƒç­¾å**ï¼š

```yaml
apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: require-image-signature
spec:
  validationFailureAction: enforce
  rules:
    - name: verify-image-signature
      match:
        resources:
          kinds:
            - Pod
      validate:
        message: "All images must be signed"
        pattern:
          spec:
            containers:
              - name: "*"
                image: "myregistry.io/*"
          # è¿™é‡Œéœ€è¦é›†æˆå¤–éƒ¨éªŒè¯é€»è¾‘
```

### 09.10.6 å®é™…å®‰å…¨æ¡ˆä¾‹

#### æ¡ˆä¾‹ 1ï¼šLog4Shell æ¼æ´åº”å¯¹

**åœºæ™¯**ï¼š2021 å¹´ Log4Shell æ¼æ´ï¼ˆCVE-2021-44228ï¼‰å½±å“å¤§é‡ Java åº”ç”¨

**åº”å¯¹æªæ–½**ï¼š

```bash
# 1. æ‰«ææ‰€æœ‰é•œåƒä¸­çš„ Log4j
trivy image --severity CRITICAL myapp:latest | grep log4j

# 2. ç”Ÿæˆå—å½±å“é•œåƒæ¸…å•
kubectl get pods --all-namespaces -o json | \
  jq -r '.items[].spec.containers[].image' | \
  sort -u | \
  xargs -I {} trivy image --format json {} | \
  jq -r 'select(.Results[].Vulnerabilities[].VulnerabilityID=="CVE-2021-44228") | .Target'

# 3. è‡ªåŠ¨æ›´æ–°ç­–ç•¥
apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: block-log4j-vulnerable-images
spec:
  validationFailureAction: enforce
  rules:
  - name: block-log4j
    match:
      resources:
        kinds:
        - Pod
    validate:
      message: "Images with Log4j vulnerability are not allowed"
      deny:
        conditions:
        - key: "{{ images.containers.*.image }}"
          operator: AnyIn
          value: ["*log4j*"]
```

#### æ¡ˆä¾‹ 2ï¼šä¾›åº”é“¾æ”»å‡»é˜²èŒƒ

**åœºæ™¯**ï¼šé˜²æ­¢æ„å»ºè¿‡ç¨‹ä¸­æ³¨å…¥æ¶æ„ä»£ç 

**é˜²æŠ¤æªæ–½**ï¼š

```yaml
# 1. ä½¿ç”¨å¯ä¿¡åŸºç¡€é•œåƒ
FROM gcr.io/distroless/base:nonroot

# 2. å¤šé˜¶æ®µæ„å»ºéš”ç¦»
FROM node:16-alpine AS builder
WORKDIR /app
COPY package*.json ./
RUN npm ci --only=production

FROM gcr.io/distroless/nodejs:16
COPY --from=builder /app /app
CMD ["/app/server.js"]

# 3. æ„å»ºæ—¶æ‰«æ
# åœ¨ CI/CD ä¸­é›†æˆå®‰å…¨æ‰«æ
```

#### æ¡ˆä¾‹ 3ï¼šå¯†é’¥ç®¡ç†æœ€ä½³å®è·µ

**åœºæ™¯**ï¼šå®‰å…¨åœ°ç®¡ç†é•œåƒç­¾åå¯†é’¥å’Œè®¿é—®å‡­è¯

**æœ€ä½³å®è·µ**ï¼š

```bash
# 1. ä½¿ç”¨ Kubernetes Secrets å­˜å‚¨å¯†é’¥
kubectl create secret generic cosign-key \
  --from-file=cosign.key=cosign.key \
  --from-file=cosign.pub=cosign.pub

# 2. ä½¿ç”¨ Sealed Secrets åŠ å¯†å¯†é’¥
kubectl create secret generic cosign-key \
  --from-file=cosign.key=cosign.key \
  --dry-run=client -o yaml | \
  kubeseal -o yaml > sealed-secret.yaml

# 3. ä½¿ç”¨å¤–éƒ¨å¯†é’¥ç®¡ç†æœåŠ¡ï¼ˆå¦‚ HashiCorp Vaultï¼‰
vault kv put secret/cosign-key \
  private_key=@cosign.key \
  public_key=@cosign.pub
```

### 09.10.7 å®‰å…¨åˆè§„æ£€æŸ¥æ¸…å•

**å®šæœŸå®‰å…¨æ£€æŸ¥æ¸…å•**ï¼š

```yaml
ä¾›åº”é“¾å®‰å…¨æ£€æŸ¥æ¸…å•:
  é•œåƒå®‰å…¨:
    - [ ] æ‰€æœ‰é•œåƒå·²ç­¾å
    - [ ] ç­¾åéªŒè¯å·²å¯ç”¨
    - [ ] å®šæœŸæ‰«æé•œåƒæ¼æ´
    - [ ] ä½¿ç”¨å¯ä¿¡åŸºç¡€é•œåƒ
    - [ ] æœ€å°åŒ–é•œåƒå¤§å°å’Œæ”»å‡»é¢
  ä¾èµ–é¡¹å®‰å…¨:
    - [ ] ç”Ÿæˆ SBOM æ¸…å•
    - [ ] æ‰«ææ‰€æœ‰ä¾èµ–é¡¹æ¼æ´
    - [ ] åŠæ—¶æ›´æ–°ä¾èµ–é¡¹
    - [ ] ä½¿ç”¨ä¾èµ–é¡¹é”å®šæ–‡ä»¶
    - [ ] å®¡æ ¸ç¬¬ä¸‰æ–¹ä¾èµ–é¡¹
  æ„å»ºå®‰å…¨:
    - [ ] ä½¿ç”¨å¤šé˜¶æ®µæ„å»º
    - [ ] æ„å»ºè¿‡ç¨‹éš”ç¦»
    - [ ] æ„å»ºæ—¥å¿—å®¡è®¡
    - [ ] æ„å»ºå¯†é’¥å®‰å…¨å­˜å‚¨
    - [ ] CI/CD ç®¡é“å®‰å…¨åŠ å›º
  è¿è¡Œæ—¶å®‰å…¨:
    - [ ] ä½¿ç”¨é root ç”¨æˆ·è¿è¡Œ
    - [ ] æœ€å°æƒé™åŸåˆ™
    - [ ] ç½‘ç»œç­–ç•¥éš”ç¦»
    - [ ] å®šæœŸå®‰å…¨æ›´æ–°
    - [ ] è¿è¡Œæ—¶å®‰å…¨ç›‘æ§
```

### 09.10.8 å®‰å…¨å·¥å…·é›†æˆçŸ©é˜µ

**å®‰å…¨å·¥å…·å¯¹æ¯”**ï¼š

| å·¥å…·ç±»åˆ«       | å·¥å…·           | ç”¨é€”                | é›†æˆæ–¹å¼                   |
| -------------- | -------------- | ------------------- | -------------------------- |
| **é•œåƒç­¾å**   | Cosign         | é•œåƒç­¾åå’ŒéªŒè¯      | CI/CDã€Kubernetes å‡†å…¥æ§åˆ¶ |
| **SBOM ç”Ÿæˆ**  | Syft           | ç”Ÿæˆè½¯ä»¶ç‰©æ–™æ¸…å•    | CI/CD                      |
| **æ¼æ´æ‰«æ**   | Trivy          | é•œåƒå’Œæ–‡ä»¶ç³»ç»Ÿæ‰«æ  | CI/CDã€Kubernetes Operator |
| **ç­–ç•¥æ²»ç†**   | OPA Gatekeeper | Kubernetes ç­–ç•¥æ‰§è¡Œ | Kubernetes å‡†å…¥æ§åˆ¶        |
| **å¯†é’¥ç®¡ç†**   | Sealed Secrets | å¯†é’¥åŠ å¯†å­˜å‚¨        | Kubernetes Secrets         |
| **è¿è¡Œæ—¶å®‰å…¨** | Falco          | è¿è¡Œæ—¶å¨èƒæ£€æµ‹      | Kubernetes DaemonSet       |

## 09.11 å‚è€ƒ

### 09.11.1 éš”ç¦»æ ˆç›¸å…³æ–‡æ¡£

- **[29. éš”ç¦»æ ˆ](../29-isolation-stack/isolation-stack.md)** - å®Œæ•´çš„éš”ç¦»æ ˆæŠ€æœ¯
  è§£æï¼ŒåŒ…æ‹¬å®‰å…¨éš”ç¦»
- **[L-3 å®¹å™¨åŒ–å±‚](../29-isolation-stack/layers/L-3-containerization.md)** - å®¹
  å™¨å®‰å…¨æœ€ä½³å®è·µ
- **[L-4 æ²™ç›’åŒ–å±‚](../29-isolation-stack/layers/L-4-sandboxing.md)** - WASM å®‰å…¨
  ç‰¹ç‚¹ï¼ˆOPA-Wasmï¼‰
- **[éš”ç¦»å±‚æ¬¡å¯¹æ¯”æ–‡æ¡£](../29-isolation-stack/layers/isolation-comparison.md)** -
  å®‰å…¨ç‰¹ç‚¹å¯¹æ¯”å’ŒæŠ€æœ¯é€‰å‹

### 09.11.2 å®‰å…¨ç›¸å…³æ–‡æ¡£

- **[25. ç¤¾åŒºæœ€ä½³å®è·µ](../25-community-best-practices/community-best-practices.md)** -
  å®‰å…¨æœ€ä½³å®è·µ
- **[11. æ•…éšœæ’æŸ¥](../11-troubleshooting/troubleshooting.md)** - å®‰å…¨ç›¸å…³æ•…éšœæ’
  æŸ¥
- **[06. OPA ç­–ç•¥](../06-policy-opa/policy-opa.md)** - OPA ç­–ç•¥è¯¦ç»†æ–‡æ¡£

### 09.11.3 å…¶ä»–ç›¸å…³æ–‡æ¡£

- **[10. å¿«é€Ÿå‚è€ƒæŒ‡å—](../../COGNITIVE/10-decision-models/QUICK-REFERENCE.md)** -
  è®¾å¤‡è®¿é—®ï¼ˆUSB/PCI/GPUï¼‰å’Œå†…æ ¸ç‰¹æ€§å†³ç­–å¿«é€Ÿå‚è€ƒ
- **[01. Kubernetes](../01-kubernetes/kubernetes.md)** - Kubernetes æ¶æ„ä¸å®è·µ

---

**æœ€åæ›´æ–°**ï¼š2025-11-06 **ç»´æŠ¤è€…**ï¼šé¡¹ç›®å›¢é˜Ÿ
